import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as h}from"./vendor-react-Bzsngnqy.js";import{a as te,b as L}from"./vendor-query-CX8ZYlKb.js";import{e as re,q as F,B as c,P as H,i as z,C as ne,x as ie,Y as le,I as i,f as de,j as E,T as ce,a0 as oe,D as Q,E as $,F as K,H as R,L as n,K as M,v as A,N as D}from"./index-61RjstaY.js";import{S as g,a as j,b as p,c as v,d as u}from"./select-BgcBxbEj.js";import{T as me,a as xe,b as I,c as o,d as he,e as d}from"./table-B7L5kFC6.js";import{P as k}from"./package-equujGSd.js";import{B as U}from"./box-D5cByeO3.js";import{C as ue}from"./circle-dollar-sign-CHZIdIPB.js";import{S as W}from"./square-pen-ixcF0lYC.js";import{W as ge}from"./wrench-BB0An5h7.js";import{D as je}from"./droplet-d_AT2ZHO.js";import{C as pe}from"./circle-help-C5_YLaWl.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-BsuQiE4E.js";const b={ingredient:{label:"مكون",icon:z,color:"bg-primary text-accent border-primary dark:bg-primary/30 dark:text-accent dark:border-primary"},packaging:{label:"تغليف",icon:U,color:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-700"},equipment:{label:"معدات",icon:ge,color:"bg-slate-100 text-slate-800 border-slate-200 dark:bg-card/30 dark:text-slate-300 dark:border-slate-700"},consumable:{label:"مستهلكات",icon:je,color:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-700"},other:{label:"أخرى",icon:pe,color:"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-900/30 dark:text-gray-300 dark:border-gray-700"}},T={kg:"كيلوجرام",g:"جرام",liter:"لتر",ml:"ملليلتر",piece:"قطعة",box:"صندوق",bag:"كيس"};function Te(){const{toast:m}=re(),[N,Y]=h.useState(""),[C,G]=h.useState("all"),[J,f]=h.useState(!1),[X,y]=h.useState(!1),[O,P]=h.useState(null),[s,r]=h.useState({code:"",nameAr:"",nameEn:"",description:"",category:"ingredient",unit:"kg",unitCost:0,minStockLevel:0,maxStockLevel:0}),{data:x=[],isLoading:Z}=te({queryKey:["/api/inventory/raw-items"]}),w=L({mutationFn:a=>A("POST","/api/inventory/raw-items",a),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/inventory/raw-items"]}),f(!1),q(),m({title:"تم إضافة المادة الخام بنجاح"})},onError:a=>{m({title:a.message||"فشل في إضافة المادة الخام",variant:"destructive"})}}),S=L({mutationFn:({id:a,data:t})=>A("PUT",`/api/inventory/raw-items/${a}`,t),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/inventory/raw-items"]}),y(!1),P(null),q(),m({title:"تم تحديث المادة الخام بنجاح"})},onError:a=>{m({title:a.message||"فشل في تحديث المادة الخام",variant:"destructive"})}}),_=L({mutationFn:a=>A("DELETE",`/api/inventory/raw-items/${a}`),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/inventory/raw-items"]}),m({title:"تم حذف المادة الخام بنجاح"})},onError:a=>{m({title:a.message||"فشل في حذف المادة الخام",variant:"destructive"})}}),q=()=>{r({code:"",nameAr:"",nameEn:"",description:"",category:"ingredient",unit:"kg",unitCost:0,minStockLevel:0,maxStockLevel:0})},ee=a=>{P(a),r({code:a.code,nameAr:a.nameAr,nameEn:a.nameEn||"",description:a.description||"",category:a.category,unit:a.unit,unitCost:a.unitCost,minStockLevel:a.minStockLevel,maxStockLevel:a.maxStockLevel||0}),y(!0)},ae=a=>{confirm("هل أنت متأكد من حذف هذه المادة الخام؟")&&_.mutate(a)},B=x.filter(a=>{const t=a.nameAr.toLowerCase().includes(N.toLowerCase())||a.code.toLowerCase().includes(N.toLowerCase())||(a.nameEn?.toLowerCase().includes(N.toLowerCase())??!1),l=C==="all"||a.category===C;return t&&l}),V=x.reduce((a,t)=>(a[t.category]=(a[t.category]||0)+1,a),{}),se=x.reduce((a,t)=>a+t.unitCost,0);return Z?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"h-12 w-12 text-accent dark:text-accent animate-pulse mx-auto"}),e.jsx(F,{className:"h-6 w-6 animate-spin text-accent absolute -bottom-1 -right-1"})]}),e.jsx("p",{className:"text-muted-foreground mt-3",children:"جاري تحميل المواد الخام..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-amber-100 to-amber-200 dark:from-amber-900/50 dark:to-amber-800/50",children:e.jsx(k,{className:"h-8 w-8 text-accent dark:text-accent"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"المواد الخام"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"إدارة المواد الخام والمكونات"})]})]}),e.jsxs(c,{onClick:()=>f(!0),className:"bg-primary hover:bg-primary","data-testid":"button-add-raw-item",children:[e.jsx(H,{className:"h-4 w-4 ml-2"}),"إضافة مادة خام"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-xl border p-4 bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/30 dark:to-amber-800/30 border-primary dark:border-primary",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"إجمالي المواد"}),e.jsx(k,{className:"h-4 w-4 text-accent"})]}),e.jsx("div",{className:"text-3xl font-bold text-accent dark:text-accent",children:x.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"مادة خام مسجلة"})]}),e.jsxs("div",{className:"rounded-xl border p-4 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 border-blue-200 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"المكونات"}),e.jsx(z,{className:"h-4 w-4 text-blue-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-700 dark:text-blue-300",children:V.ingredient||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"مكون رئيسي"})]}),e.jsxs("div",{className:"rounded-xl border p-4 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 border-green-200 dark:border-green-700",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"التغليف"}),e.jsx(U,{className:"h-4 w-4 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-700 dark:text-green-300",children:V.packaging||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"مادة تغليف"})]}),e.jsxs("div",{className:"rounded-xl border p-4 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/30 border-purple-200 dark:border-purple-700",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"متوسط التكلفة"}),e.jsx(ue,{className:"h-4 w-4 text-purple-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-black dark:text-black",children:x.length>0?(se/x.length).toFixed(2):"0.00"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"ر.س / وحدة"})]})]}),e.jsxs(ne,{children:[e.jsx(ie,{className:"border-b bg-gradient-to-r from-stone-50/50 to-transparent dark:from-stone-900/20 dark:to-transparent",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(le,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(i,{placeholder:"بحث بالاسم أو الكود...",value:N,onChange:a=>Y(a.target.value),className:"pr-10","data-testid":"input-search-raw-items"})]}),e.jsxs(g,{value:C,onValueChange:G,children:[e.jsx(j,{className:"w-[180px]","data-testid":"select-category-filter",children:e.jsx(p,{placeholder:"الفئة"})}),e.jsxs(v,{children:[e.jsx(u,{value:"all",children:"جميع الفئات"}),Object.entries(b).map(([a,{label:t,icon:l}])=>e.jsx(u,{value:a,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4"}),t]})},a))]})]})]})}),e.jsx(de,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(me,{children:[e.jsx(xe,{children:e.jsxs(I,{className:"bg-muted/50",children:[e.jsx(o,{className:"text-right",children:"الكود"}),e.jsx(o,{className:"text-right",children:"الاسم"}),e.jsx(o,{className:"text-right",children:"الفئة"}),e.jsx(o,{className:"text-right",children:"الوحدة"}),e.jsx(o,{className:"text-right",children:"التكلفة"}),e.jsx(o,{className:"text-right",children:"الحد الأدنى"}),e.jsx(o,{className:"text-right",children:"الإجراءات"})]})}),e.jsx(he,{children:B.length===0?e.jsx(I,{children:e.jsxs(d,{colSpan:7,className:"text-center py-12 text-muted-foreground",children:[e.jsx(k,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"font-medium",children:"لا توجد مواد خام"}),e.jsx("p",{className:"text-sm",children:"أضف مواد خام جديدة للبدء"})]})}):B.map(a=>{const t=b[a.category]||b.other,l=t.icon;return e.jsxs(I,{className:"hover-elevate transition-all","data-testid":`row-raw-item-${a.id}`,children:[e.jsx(d,{children:e.jsx("code",{className:"px-2 py-1 rounded bg-muted font-mono text-sm",children:a.code})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.color}`,children:e.jsx(l,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.nameAr}),a.nameEn&&e.jsx("div",{className:"text-sm text-muted-foreground",children:a.nameEn})]})]})}),e.jsx(d,{children:e.jsx(E,{variant:"outline",className:t.color,children:t.label})}),e.jsx(d,{children:e.jsx("span",{className:"text-muted-foreground",children:T[a.unit]})}),e.jsxs(d,{children:[e.jsx("span",{className:"font-medium",children:a.unitCost.toFixed(2)}),e.jsx("span",{className:"text-muted-foreground mr-1",children:"ر.س"})]}),e.jsx(d,{children:e.jsx("div",{className:"flex items-center gap-2",children:a.minStockLevel>0?e.jsxs(E,{variant:"outline",className:"bg-background text-accent border-primary dark:bg-primary/30 dark:text-accent dark:border-primary",children:[e.jsx(ce,{className:"h-3 w-3 ml-1"}),a.minStockLevel]}):e.jsx(E,{variant:"outline",className:"bg-gray-50 text-muted-foreground border-gray-200 dark:bg-gray-900/30 dark:text-muted-foreground dark:border-gray-700",children:"غير محدد"})})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{size:"icon",variant:"ghost",onClick:()=>ee(a),"data-testid":`button-edit-${a.id}`,children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(c,{size:"icon",variant:"ghost",onClick:()=>ae(a.id),"data-testid":`button-delete-${a.id}`,children:e.jsx(oe,{className:"h-4 w-4 text-destructive"})})]})})]},a.id)})})]})})})]}),e.jsx(Q,{open:J,onOpenChange:f,children:e.jsxs($,{className:"max-w-2xl bg-[#F5F5DC]",dir:"rtl",children:[e.jsx(K,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-accent"}),"إضافة مادة خام جديدة"]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"code",children:"الكود *"}),e.jsx(i,{id:"code",value:s.code,onChange:a=>r({...s,code:a.target.value}),placeholder:"RAW-001","data-testid":"input-code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"nameAr",children:"الاسم بالعربي *"}),e.jsx(i,{id:"nameAr",value:s.nameAr,onChange:a=>r({...s,nameAr:a.target.value}),placeholder:"حبوب قهوة","data-testid":"input-name-ar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"nameEn",children:"الاسم بالإنجليزي"}),e.jsx(i,{id:"nameEn",value:s.nameEn,onChange:a=>r({...s,nameEn:a.target.value}),placeholder:"Coffee Beans","data-testid":"input-name-en"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"category",children:"الفئة *"}),e.jsxs(g,{value:s.category,onValueChange:a=>r({...s,category:a}),children:[e.jsx(j,{"data-testid":"select-category",children:e.jsx(p,{})}),e.jsx(v,{children:Object.entries(b).map(([a,{label:t,icon:l}])=>e.jsx(u,{value:a,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4"}),t]})},a))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"unit",children:"الوحدة *"}),e.jsxs(g,{value:s.unit,onValueChange:a=>r({...s,unit:a}),children:[e.jsx(j,{"data-testid":"select-unit",children:e.jsx(p,{})}),e.jsx(v,{children:Object.entries(T).map(([a,t])=>e.jsx(u,{value:a,children:t},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"unitCost",children:"تكلفة الوحدة (ر.س) *"}),e.jsx(i,{id:"unitCost",type:"number",step:"0.01",min:"0",value:s.unitCost,onChange:a=>r({...s,unitCost:parseFloat(a.target.value)||0}),"data-testid":"input-unit-cost"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"minStockLevel",children:"الحد الأدنى للمخزون *"}),e.jsx(i,{id:"minStockLevel",type:"number",min:"0",value:s.minStockLevel,onChange:a=>r({...s,minStockLevel:parseInt(a.target.value)||0}),"data-testid":"input-min-stock"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"maxStockLevel",children:"الحد الأقصى للمخزون"}),e.jsx(i,{id:"maxStockLevel",type:"number",min:"0",value:s.maxStockLevel,onChange:a=>r({...s,maxStockLevel:parseInt(a.target.value)||0}),"data-testid":"input-max-stock"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"الوصف"}),e.jsx(i,{id:"description",value:s.description,onChange:a=>r({...s,description:a.target.value}),placeholder:"وصف المادة الخام...","data-testid":"input-description"})]})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>f(!1),children:"إلغاء"}),e.jsxs(c,{onClick:()=>w.mutate(s),disabled:w.isPending||!s.code||!s.nameAr,className:"bg-primary hover:bg-primary","data-testid":"button-submit-add",children:[w.isPending&&e.jsx(F,{className:"h-4 w-4 ml-2 animate-spin"}),"إضافة"]})]})]})}),e.jsx(Q,{open:X,onOpenChange:y,children:e.jsxs($,{className:"max-w-2xl bg-[#F5F5DC]",dir:"rtl",children:[e.jsx(K,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-accent"}),"تعديل المادة الخام"]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-code",children:"الكود *"}),e.jsx(i,{id:"edit-code",value:s.code,onChange:a=>r({...s,code:a.target.value}),"data-testid":"input-edit-code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-nameAr",children:"الاسم بالعربي *"}),e.jsx(i,{id:"edit-nameAr",value:s.nameAr,onChange:a=>r({...s,nameAr:a.target.value}),"data-testid":"input-edit-name-ar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-nameEn",children:"الاسم بالإنجليزي"}),e.jsx(i,{id:"edit-nameEn",value:s.nameEn,onChange:a=>r({...s,nameEn:a.target.value}),"data-testid":"input-edit-name-en"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-category",children:"الفئة *"}),e.jsxs(g,{value:s.category,onValueChange:a=>r({...s,category:a}),children:[e.jsx(j,{"data-testid":"select-edit-category",children:e.jsx(p,{})}),e.jsx(v,{children:Object.entries(b).map(([a,{label:t,icon:l}])=>e.jsx(u,{value:a,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4"}),t]})},a))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-unit",children:"الوحدة *"}),e.jsxs(g,{value:s.unit,onValueChange:a=>r({...s,unit:a}),children:[e.jsx(j,{"data-testid":"select-edit-unit",children:e.jsx(p,{})}),e.jsx(v,{children:Object.entries(T).map(([a,t])=>e.jsx(u,{value:a,children:t},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-unitCost",children:"تكلفة الوحدة (ر.س) *"}),e.jsx(i,{id:"edit-unitCost",type:"number",step:"0.01",min:"0",value:s.unitCost,onChange:a=>r({...s,unitCost:parseFloat(a.target.value)||0}),"data-testid":"input-edit-unit-cost"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-minStockLevel",children:"الحد الأدنى للمخزون *"}),e.jsx(i,{id:"edit-minStockLevel",type:"number",min:"0",value:s.minStockLevel,onChange:a=>r({...s,minStockLevel:parseInt(a.target.value)||0}),"data-testid":"input-edit-min-stock"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-maxStockLevel",children:"الحد الأقصى للمخزون"}),e.jsx(i,{id:"edit-maxStockLevel",type:"number",min:"0",value:s.maxStockLevel,onChange:a=>r({...s,maxStockLevel:parseInt(a.target.value)||0}),"data-testid":"input-edit-max-stock"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-description",children:"الوصف"}),e.jsx(i,{id:"edit-description",value:s.description,onChange:a=>r({...s,description:a.target.value}),"data-testid":"input-edit-description"})]})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>y(!1),children:"إلغاء"}),e.jsxs(c,{onClick:()=>O&&S.mutate({id:O.id,data:s}),disabled:S.isPending||!s.code||!s.nameAr,className:"bg-primary hover:bg-primary","data-testid":"button-submit-edit",children:[S.isPending&&e.jsx(F,{className:"h-4 w-4 ml-2 animate-spin"}),"تحديث"]})]})]})})]})}export{Te as default};
