import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as x}from"./vendor-react-Bzsngnqy.js";import{u as K,a as U,b as j}from"./vendor-query-CX8ZYlKb.js";import{c as H,e as R,O as h,B as l,P as C,A as z,C as N,f as v,x as X,y as G,U as J,j as W,p as Y,D,E as F,F as P,H as T,L as t,I as i,v as y}from"./index-CLvpp2UE.js";import{S as q,a as S,b as A,c as k,d as n}from"./select-BzAjeBJu.js";import{C as Z}from"./circle-check-big-DlXUvwLH.js";import{C as _}from"./circle-x-B1Jm2Zh7.js";import{P as ee}from"./pen-DQVHph_P.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-CqdH-ack.js";function oe(){const[,E]=H(),[O,c]=x.useState(!1),[$,m]=x.useState(!1),[r,u]=x.useState(null);x.useState(null);const{toast:d}=R(),p=K(),{data:V=[],isLoading:B}=U({queryKey:["/api/employees"]}),f=V.filter(a=>a.role==="driver"),g=j({mutationFn:async a=>await(await y("POST","/api/employees",a)).json(),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/employees"]}),c(!1),d({title:"تم الإضاف� ",description:"تم إضاف� السائق بنجاح"})},onError:a=>{d({variant:"destructive",title:"فشل الإضاف� ",description:a.message||"حدث � طأ أثناء إضاف� السائق"})}}),b=j({mutationFn:async a=>await(await y("PUT",`/api/employees/${a.id}`,a.updates)).json(),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/employees"]}),m(!1),u(null),d({title:"تم التحديث",description:"تم تحديث معلومات السائق بنجاح"})},onError:a=>{d({variant:"destructive",title:"فشل التحديث",description:a.message||"حدث � طأ أثناء تحديث السائق"})}}),w=j({mutationFn:async({id:a,isAvailable:s})=>await(await y("PUT",`/api/employees/${a}`,{isAvailableForDelivery:s})).json(),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/employees"]}),d({title:"تم التحديث",description:"تم تحديث حال� توفر السائق"})}}),I=a=>{a.preventDefault();const s=new FormData(a.currentTarget),o={username:s.get("username"),password:s.get("password"),fullName:s.get("fullName"),phone:s.get("phone"),role:"driver",jobTitle:"سائق توصيل",vehicleType:s.get("vehicleType"),vehiclePlateNumber:s.get("vehiclePlateNumber"),vehicleColor:s.get("vehicleColor"),licenseNumber:s.get("licenseNumber"),isAvailableForDelivery:1,isActivated:1};g.mutate(o)},L=a=>{if(a.preventDefault(),!r)return;const s=new FormData(a.currentTarget),o={fullName:s.get("fullName"),phone:s.get("phone"),vehicleType:s.get("vehicleType"),vehiclePlateNumber:s.get("vehiclePlateNumber"),vehicleColor:s.get("vehicleColor"),licenseNumber:s.get("licenseNumber")};b.mutate({id:r.id,updates:o})},M=a=>{u(a),m(!0)},Q=a=>{const s=a.isAvailableForDelivery===1?0:1;w.mutate({id:a.id,isAvailable:s})};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-primary/5 to-background p-4",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-amber-700 rounded-full flex items-center justify-center",children:e.jsx(h,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-accent",children:"إدار� السائقين"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"إضاف� وتعديل حسابات السائقين"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(l,{onClick:()=>c(!0),className:"bg-gradient-to-r from-green-500 to-green-700","data-testid":"button-add-driver",children:[e.jsx(C,{className:"w-4 h-4 ml-2"}),"إضاف� سائق جديد"]}),e.jsxs(l,{variant:"outline",onClick:()=>E("/manager/dashboard"),className:"border-primary/50 text-accent hover:bg-background0 hover:text-white","data-testid":"button-back",children:[e.jsx(z,{className:"w-4 h-4 ml-2"}),"العود�"]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto",children:B?e.jsx(N,{className:"bg-[#2d1f1a] border-primary/20",children:e.jsxs(v,{className:"p-12 text-center",children:[e.jsx(h,{className:"w-12 h-12 animate-pulse mx-auto mb-4 text-accent"}),e.jsx("p",{className:"text-gray-400",children:"جاري تحميل السائقين..."})]})}):f.length===0?e.jsx(N,{className:"bg-[#2d1f1a] border-primary/20",children:e.jsxs(v,{className:"p-12 text-center",children:[e.jsx(h,{className:"w-12 h-12 mx-auto mb-4 text-gray-500"}),e.jsx("p",{className:"text-gray-400",children:"لا يوجد سائقين مسجلين"}),e.jsxs(l,{onClick:()=>c(!0),className:"mt-4 bg-gradient-to-r from-green-500 to-green-700",children:[e.jsx(C,{className:"w-4 h-4 ml-2"}),"إضاف� أول سائق"]})]})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:f.map(a=>e.jsxs(N,{className:"bg-[#2d1f1a] border-primary/20",children:[e.jsx(X,{children:e.jsxs(G,{className:"text-accent text-right flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),a.fullName]}),e.jsx(W,{className:a.isAvailableForDelivery===1?"bg-green-500":"bg-gray-500","data-testid":`badge-status-${a.id}`,children:a.isAvailableForDelivery===1?"متاح":"غير متاح"})]})}),e.jsxs(v,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(Y,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm",dir:"ltr",children:a.phone})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(h,{className:"w-4 h-4 text-accent"}),e.jsxs("span",{className:"text-sm",children:[a.vehicleType," - ",a.vehicleColor]})]}),e.jsxs("div",{className:"bg-[#1a1410] p-2 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"لوح� المركب� "}),e.jsx("p",{className:"text-white font-mono font-semibold","data-testid":`text-plate-${a.id}`,children:a.vehiclePlateNumber})]}),a.licenseNumber&&e.jsxs("div",{className:"bg-[#1a1410] p-2 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"رقم الر� ص� "}),e.jsx("p",{className:"text-white font-mono","data-testid":`text-license-${a.id}`,children:a.licenseNumber})]})]}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t border-primary/20",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>Q(a),className:`flex-1 ${a.isAvailableForDelivery===1?"border-green-500/30 text-green-500":"border-gray-500/30 text-gray-500"}`,disabled:w.isPending,"data-testid":`button-toggle-${a.id}`,children:a.isAvailableForDelivery===1?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 ml-1"}),"متاح"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 ml-1"}),"غير متاح"]})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>M(a),className:"border-blue-500/30 text-blue-500","data-testid":`button-edit-${a.id}`,children:e.jsx(ee,{className:"w-4 h-4"})})]})]})]},a.id))})}),e.jsx(D,{open:O,onOpenChange:c,children:e.jsxs(F,{className:"bg-[#2d1f1a] border-primary/20 text-white max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(P,{children:e.jsx(T,{className:"text-accent",children:"إضاف� سائق جديد"})}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"fullName",className:"text-gray-300",children:"الاسم الكامل *"}),e.jsx(i,{id:"fullName",name:"fullName",required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-fullname"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"phone",className:"text-gray-300",children:"رقم الهاتف *"}),e.jsx(i,{id:"phone",name:"phone",type:"tel",required:!0,placeholder:"05xxxxxxxx",className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-phone"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"username",className:"text-gray-300",children:"اسم المست� دم *"}),e.jsx(i,{id:"username",name:"username",required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-username"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"password",className:"text-gray-300",children:"كلم� المرور *"}),e.jsx(i,{id:"password",name:"password",type:"password",required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-password"})]})]}),e.jsxs("div",{className:"border-t border-primary/20 pt-4",children:[e.jsx("h3",{className:"text-accent font-semibold mb-3",children:"معلومات المركب� "}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"vehicleType",className:"text-gray-300",children:"نوع المركب� *"}),e.jsxs(q,{name:"vehicleType",required:!0,children:[e.jsx(S,{className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"select-vehicle-type",children:e.jsx(A,{placeholder:"ا� تر نوع المركب� "})}),e.jsxs(k,{className:"bg-[#2d1f1a] border-primary/20 text-white",children:[e.jsx(n,{value:"سيار� ",children:"سيار� "}),e.jsx(n,{value:"دراج� ناري� ",children:"دراج� ناري� "}),e.jsx(n,{value:"دراج� كهربائي� ",children:"دراج� كهربائي� "})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"vehicleColor",className:"text-gray-300",children:"لون المركب� *"}),e.jsx(i,{id:"vehicleColor",name:"vehicleColor",required:!0,placeholder:"مثال: أبيض",className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-vehicle-color"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"vehiclePlateNumber",className:"text-gray-300",children:"رقم اللوح� *"}),e.jsx(i,{id:"vehiclePlateNumber",name:"vehiclePlateNumber",required:!0,placeholder:"ABC 1234",className:"bg-[#1a1410] border-primary/30 text-white font-mono","data-testid":"input-plate-number"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"licenseNumber",className:"text-gray-300",children:"رقم الر� ص� "}),e.jsx(i,{id:"licenseNumber",name:"licenseNumber",className:"bg-[#1a1410] border-primary/30 text-white font-mono","data-testid":"input-license-number"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>c(!1),className:"border-gray-600 text-gray-300","data-testid":"button-cancel",children:"إلغاء"}),e.jsx(l,{type:"submit",disabled:g.isPending,className:"bg-gradient-to-r from-green-500 to-green-700","data-testid":"button-submit",children:g.isPending?"جاري الإضاف� ...":"إضاف� السائق"})]})]})]})}),e.jsx(D,{open:$,onOpenChange:m,children:e.jsxs(F,{className:"bg-[#2d1f1a] border-primary/20 text-white max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(P,{children:e.jsx(T,{className:"text-accent",children:"تعديل معلومات السائق"})}),r&&e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-fullName",className:"text-gray-300",children:"الاسم الكامل *"}),e.jsx(i,{id:"edit-fullName",name:"fullName",defaultValue:r.fullName,required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-edit-fullname"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-phone",className:"text-gray-300",children:"رقم الهاتف *"}),e.jsx(i,{id:"edit-phone",name:"phone",type:"tel",defaultValue:r.phone,required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-edit-phone"})]})]}),e.jsxs("div",{className:"border-t border-primary/20 pt-4",children:[e.jsx("h3",{className:"text-accent font-semibold mb-3",children:"معلومات المركب� "}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-vehicleType",className:"text-gray-300",children:"نوع المركب� *"}),e.jsxs(q,{name:"vehicleType",defaultValue:r.vehicleType,required:!0,children:[e.jsx(S,{className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"select-edit-vehicle-type",children:e.jsx(A,{})}),e.jsxs(k,{className:"bg-[#2d1f1a] border-primary/20 text-white",children:[e.jsx(n,{value:"سيار� ",children:"سيار� "}),e.jsx(n,{value:"دراج� ناري� ",children:"دراج� ناري� "}),e.jsx(n,{value:"دراج� كهربائي� ",children:"دراج� كهربائي� "})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-vehicleColor",className:"text-gray-300",children:"لون المركب� *"}),e.jsx(i,{id:"edit-vehicleColor",name:"vehicleColor",defaultValue:r.vehicleColor,required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-edit-vehicle-color"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-vehiclePlateNumber",className:"text-gray-300",children:"رقم اللوح� *"}),e.jsx(i,{id:"edit-vehiclePlateNumber",name:"vehiclePlateNumber",defaultValue:r.vehiclePlateNumber,required:!0,className:"bg-[#1a1410] border-primary/30 text-white font-mono","data-testid":"input-edit-plate-number"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-licenseNumber",className:"text-gray-300",children:"رقم الر� ص� "}),e.jsx(i,{id:"edit-licenseNumber",name:"licenseNumber",defaultValue:r.licenseNumber,className:"bg-[#1a1410] border-primary/30 text-white font-mono","data-testid":"input-edit-license-number"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{m(!1),u(null)},className:"border-gray-600 text-gray-300","data-testid":"button-edit-cancel",children:"إلغاء"}),e.jsx(l,{type:"submit",disabled:b.isPending,className:"bg-gradient-to-r from-blue-500 to-blue-700","data-testid":"button-edit-submit",children:b.isPending?"جاري التحديث...":"تحديث المعلومات"})]})]})]})})]})}export{oe as default};
