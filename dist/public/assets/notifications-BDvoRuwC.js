import{j as e}from"./vendor-ui-DJm-zmnP.js";import{a as p,b as t}from"./vendor-query-CX8ZYlKb.js";import{B as r,C as d,$ as j,au as f,G as N,v as i,N as l}from"./index-CLvpp2UE.js";import{C as c}from"./circle-check-CNDbPLNF.js";import{B as o}from"./bell-BKcM2vGh.js";import{M as b}from"./message-circle-CemxGmXD.js";import{P as y}from"./package-B_dGuXgn.js";import"./vendor-react-Bzsngnqy.js";import"./vendor-utils-BKCsaWdX.js";const g=a=>{switch(a){case"order_update":return e.jsx(y,{className:"w-5 h-5"});case"referral":return e.jsx(N,{className:"w-5 h-5"});case"loyalty":return e.jsx(f,{className:"w-5 h-5"});case"promotion":return e.jsx(b,{className:"w-5 h-5"});default:return e.jsx(o,{className:"w-5 h-5"})}},v=a=>{switch(a){case"order_update":return"تحديث الطلب";case"referral":return"الإحالات";case"loyalty":return"البرنامج الموالي";case"promotion":return"عروض ترويجية";default:return"نظام"}};function P(){const{data:a,isLoading:m}=p({queryKey:["/api/notifications"],queryFn:async()=>(await fetch("/api/notifications")).json()}),u=t({mutationFn:async s=>i("PATCH",`/api/notifications/${s}/read`,{}),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/notifications"]})}}),x=t({mutationFn:async s=>i("DELETE",`/api/notifications/${s}`,{}),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/notifications"]})}}),h=t({mutationFn:async()=>i("POST","/api/notifications/mark-all-read",{}),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/notifications"]})}}),n=a?.filter(s=>!s.isRead).length||0;return m?e.jsx("div",{className:"p-4",children:"جاري التحميل..."}):e.jsxs("div",{className:"max-w-3xl mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"الإشعارات"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[n," إشعارات جديدة"]})]}),n>0&&e.jsxs(r,{onClick:()=>h.mutate(),variant:"outline",size:"sm","data-testid":"button-mark-all-read",children:[e.jsx(c,{className:"w-4 h-4 ml-2"}),"وضع علامة على الكل كمقروء"]})]}),a&&a.length===0?e.jsxs(d,{className:"p-8 text-center",children:[e.jsx(o,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد إشعارات حالياً"})]}):e.jsx("div",{className:"space-y-2",children:a?.map(s=>e.jsx(d,{className:`p-4 transition-colors ${s.isRead?"":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,"data-testid":`card-notification-${s.id}`,children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"text-blue-500 mt-1",children:g(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-1",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded-full inline-block mt-1",children:v(s.type)})]}),!s.isRead&&e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mt-2"})]}),e.jsx("p",{className:"text-sm text-foreground my-2",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex gap-2",children:[!s.isRead&&e.jsx(r,{onClick:()=>u.mutate(s.id),size:"sm",variant:"ghost","data-testid":`button-mark-read-${s.id}`,children:e.jsx(c,{className:"w-4 h-4"})}),e.jsx(r,{onClick:()=>x.mutate(s.id),size:"sm",variant:"ghost",className:"text-red-500","data-testid":`button-delete-${s.id}`,children:e.jsx(j,{className:"w-4 h-4"})})]})]})},s.id))})]})}export{P as default};
