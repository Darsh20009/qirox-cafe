import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as s}from"./vendor-react-Bzsngnqy.js";import{c as F,e as V,v as p,C as A,x as B,i as D,y as O,V as U,f as I,L as x,I as h,B as g}from"./index-CLvpp2UE.js";import{C as Y}from"./circle-check-big-DlXUvwLH.js";import{L as w}from"./lock-Dvxo6ahY.js";import{E as b}from"./eye-off-AEXWPIZp.js";import{E as j}from"./eye-cZNGFzyE.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";function _(){const[,o]=F(),{toast:a}=V(),[n,v]=s.useState(""),[l,y]=s.useState(""),[c,N]=s.useState(!1),[d,C]=s.useState(!1),[m,u]=s.useState(!1),[S,f]=s.useState(!0),[k,P]=s.useState(!1),[i,T]=s.useState(!1),[E,L]=s.useState("");s.useEffect(()=>{document.title="إعادة تعيين كلمة المرور - CLUNY CAFE";const t=document.querySelector('meta[name="description"]');t&&t.setAttribute("content","إعادة تعيين كلمة المرور على CLUNY CAFE - أدخل كلمة مرور جديدة آمنة")},[]),s.useEffect(()=>{const r=new URLSearchParams(window.location.search).get("token");if(!r){a({title:"خطأ",description:"رابط إعادة التعيين غير صالح",variant:"destructive"}),o("/auth");return}L(r),R(r)},[]);const R=async t=>{f(!0);try{(await(await p("POST","/api/customers/verify-reset-token",{token:t})).json()).valid?P(!0):(a({title:"خطأ",description:"رابط إعادة التعيين غير صالح أو منتهي الصلاحية ",variant:"destructive"}),setTimeout(()=>o("/forgot-password"),2e3))}catch(r){console.error("Token verification error:",r),a({title:"خطأ",description:r.message||"رابط إعادة التعيين غير صالح",variant:"destructive"}),setTimeout(()=>o("/forgot-password"),2e3)}finally{f(!1)}},q=async t=>{if(t.preventDefault(),!n||n.length<4){a({title:"خطأ",description:"كلمة المرور يجب أن تكون على الأقل 4 أحرف",variant:"destructive"});return}if(n!==l){a({title:"خطأ",description:"كلمة المرور غير متطابقة",variant:"destructive"});return}u(!0);try{await p("POST","/api/customers/reset-password",{token:E,newPassword:n}),T(!0),a({title:"نجح!",description:"تم تغيير كلمة المرور بنجاح"}),setTimeout(()=>o("/auth"),3e3)}catch(r){console.error("Reset password error:",r),a({title:"خطأ",description:r.message||"حدث خطأ أثناء تغيير كلمة المرور",variant:"destructive"})}finally{u(!1)}};return S?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, hsl(165, 15%, 97%) 0%, hsl(165, 12%, 88%) 50%, hsl(165, 15%, 97%) 100%)"},dir:"rtl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-foreground",children:"جارٍ التحقق من الرابط..."})]})}):k?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, hsl(165, 15%, 97%) 0%, hsl(165, 12%, 88%) 50%, hsl(165, 15%, 97%) 100%)"},dir:"rtl",children:e.jsxs(A,{className:"w-full max-w-md border-primary/30 bg-card backdrop-blur shadow-xl",children:[e.jsxs(B,{className:"space-y-3 text-center pb-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary to-primary/70 flex items-center justify-center shadow-lg shadow-primary/30",children:i?e.jsx(Y,{className:"w-10 h-10 text-white"}):e.jsx(D,{className:"w-10 h-10 text-white"})})}),e.jsx(O,{className:"text-3xl font-bold text-foreground",children:i?"تم التغيير بنجاح!":"إعادةتعيين كلمة المرور"}),e.jsx(U,{className:"text-muted-foreground text-lg",children:i?"يمكنك الآن تسجيل الدخول بكلمة المرور الجديدة ":"أدخل كلمة المرور الجديدة "})]}),e.jsx(I,{className:"space-y-6",children:i?e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("div",{className:"p-4 rounded-lg bg-green-900/20 border border-green-700/30",children:e.jsx("p",{className:"text-green-300 text-sm",children:"تم تغيير كلمة المرور بنجاح! سيتم تحويلك لصفحة تسجيل الدخول..."})}),e.jsx(g,{onClick:()=>o("/auth"),className:"w-full bg-primary hover:bg-primary","data-testid":"button-go-to-login",children:"الذهاب لتسجيل الدخول"})]}):e.jsxs("form",{onSubmit:q,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"new-password",className:"text-foreground flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"كلمة المرور الجديدة"]}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"new-password",type:c?"text":"password",placeholder:"أدخل كلمة المرور الجديدة ",value:n,onChange:t=>v(t.target.value),className:"bg-secondary border-border text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-primary/30 pl-10","data-testid":"input-new-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>N(!c),className:"absolute left-3 top-2.5 text-muted-foreground hover:text-foreground","data-testid":"button-toggle-new-password",children:c?e.jsx(b,{className:"h-4 w-4"}):e.jsx(j,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"confirm-password",className:"text-foreground flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"تأكيد كلمة المرور"]}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"confirm-password",type:d?"text":"password",placeholder:"أعد إدخال كلمة المرور",value:l,onChange:t=>y(t.target.value),className:"bg-secondary border-border text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-primary/30 pl-10","data-testid":"input-confirm-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>C(!d),className:"absolute left-3 top-2.5 text-muted-foreground hover:text-foreground","data-testid":"button-toggle-confirm-password",children:d?e.jsx(b,{className:"h-4 w-4"}):e.jsx(j,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"كلمة المرور يجب أن تكون على الأقل 4 أحرف"})]}),e.jsx(g,{type:"submit",disabled:m,className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-accent to-accent/90 hover:from-accent/95 hover:to-accent/85 text-accent-foreground shadow-lg shadow-accent/30 transition-all duration-300","data-testid":"button-submit",children:m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-accent-foreground/30 border-t-accent-foreground rounded-full animate-spin"}),e.jsx("span",{children:"جارٍ التغيير..."})]}):"تغيير كلمة المرور"})]})})]})}):null}export{_ as default};
