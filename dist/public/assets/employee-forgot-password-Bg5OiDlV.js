import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as s}from"./vendor-react-Bzsngnqy.js";import{c as E,e as k,C as T,x as F,i as L,y as q,W as D,f as O,L as d,I as m,B as g,A as R}from"./index-61RjstaY.js";import{E as j}from"./eye-off-D4nLDnly.js";import{E as y}from"./eye-A6WRE6cq.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";function z(){const[,u]=E(),{toast:r}=k(),[n,N]=s.useState(""),[o,p]=s.useState(""),[h,x]=s.useState(""),[c,v]=s.useState(!1),[i,C]=s.useState(!1),[w,b]=s.useState(!1),[a,f]=s.useState("username"),S=async t=>{if(t.preventDefault(),!n||n.trim().length<2){r({title:"خطأ",description:"يرجى إدخال اسم المستخدم",variant:"destructive"});return}f("password")},P=async t=>{if(t.preventDefault(),!o||o.length<4){r({title:"خطأ",description:"كلمة المرور يجب أن تكون على الأقل 4 أحرف",variant:"destructive"});return}if(o!==h){r({title:"خطأ",description:"كلمة المرور غير متطابقة",variant:"destructive"});return}b(!0);try{if(!(await fetch("/api/employees/reset-password-by-username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,newPassword:o})})).ok)throw new Error("فشل تغيير كلمة المرور");r({title:"نجح!",description:"تم تغيير كلمة المرور بنجاح. يمكنك تسجيل الدخول الآن"}),setTimeout(()=>u("/employee/login"),2e3)}catch(l){console.error("Reset password error:",l),r({title:"خطأ",description:l.message||"حدث خطأ أثناء تغيير كلمة المرور",variant:"destructive"})}finally{b(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, #1a1410 0%, #2d1810 50%, #1a1410 100%)"},dir:"rtl",children:e.jsxs(T,{className:"w-full max-w-md border-primary/30 bg-gradient-to-br from-stone-900/95 to-stone-950/95 backdrop-blur shadow-2xl",children:[e.jsxs(F,{className:"space-y-3 text-center pb-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-amber-600 to-amber-800 flex items-center justify-center shadow-lg shadow-amber-900/50",children:e.jsx(L,{className:"w-10 h-10 text-white"})})}),e.jsx(q,{className:"text-3xl font-bold text-accent",children:"نسيت كلمة المرور؟"}),e.jsxs(D,{className:"text-accent/70 text-lg",children:[a==="username"&&"أدخل اسم المستخدم لتغيير كلمة المرور",a==="password"&&"أدخل كلمة المرور الجديدة"]})]}),e.jsxs(O,{className:"space-y-6",children:[a==="username"&&e.jsxs("form",{onSubmit:S,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"username",className:"text-accent",children:"اسم المستخدم"}),e.jsx(m,{id:"username",type:"text",placeholder:"أدخل اسم المستخدم الخاص بك",value:n,onChange:t=>N(t.target.value),className:"bg-stone-800/50 border-primary/50 text-accent placeholder:text-accent/40 focus:border-primary focus:ring-amber-600/30","data-testid":"input-username",required:!0})]}),e.jsx(g,{type:"submit",className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white shadow-lg shadow-amber-900/50 transition-all duration-300 hover:scale-[1.02]","data-testid":"button-submit",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"التالي"}),e.jsx(R,{className:"w-5 h-5"})]})})]}),a==="password"&&e.jsxs("form",{onSubmit:P,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"newPassword",className:"text-accent",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"newPassword",type:c?"text":"password",placeholder:"أدخل كلمة المرور الجديدة",value:o,onChange:t=>p(t.target.value),className:"bg-stone-800/50 border-primary/50 text-accent placeholder:text-accent/40 focus:border-primary focus:ring-amber-600/30 pl-10","data-testid":"input-new-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>v(!c),className:"absolute left-3 top-2.5 text-accent hover:text-accent","data-testid":"button-toggle-new-password",children:c?e.jsx(j,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirmPassword",className:"text-accent",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"confirmPassword",type:i?"text":"password",placeholder:"أعد إدخال كلمة المرور",value:h,onChange:t=>x(t.target.value),className:"bg-stone-800/50 border-primary/50 text-accent placeholder:text-accent/40 focus:border-primary focus:ring-amber-600/30 pl-10","data-testid":"input-confirm-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>C(!i),className:"absolute left-3 top-2.5 text-accent hover:text-accent","data-testid":"button-toggle-confirm-password",children:i?e.jsx(j,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-accent/50 mt-1",children:"كلمة المرور يجب أن تكون على الأقل 4 أحرف"})]}),e.jsx(g,{type:"submit",disabled:w,className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white shadow-lg shadow-amber-900/50 transition-all duration-300 hover:scale-[1.02]","data-testid":"button-reset-password",children:w?"جارٍ التغيير...":"تغيير كلمة المرور"})]}),e.jsx("div",{className:"pt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>{a==="password"?(f("username"),p(""),x("")):u("/employee/login")},className:"text-accent hover:text-accent text-sm","data-testid":"button-back",children:a==="password"?"رجوع":"العودة لتسجيل الدخول"})})]})]})})}export{z as default};
