import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as t}from"./vendor-react-Bzsngnqy.js";import{c as k,e as E,C as T,x as F,y as L,W as q,f as D,L as d,I as c,B as g,A as O}from"./index-61RjstaY.js";import{S as R}from"./shield-Dc4uCcfL.js";import{E as j}from"./eye-off-D4nLDnly.js";import{E as N}from"./eye-A6WRE6cq.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";function z(){const[,u]=k(),{toast:a}=E(),[l,v]=t.useState(""),[o,m]=t.useState(""),[h,x]=t.useState(""),[n,y]=t.useState(!1),[p,S]=t.useState(!1),[w,f]=t.useState(!1),[r,b]=t.useState("username"),C=async s=>{if(s.preventDefault(),!l||l.trim().length<2){a({title:"خطأ",description:"يرجى إدخال اسم المستخدم",variant:"destructive"});return}b("password")},P=async s=>{if(s.preventDefault(),!o||o.length<4){a({title:"خطأ",description:"كلمة المرور يجب أن تكون على الأقل 4 أحرف",variant:"destructive"});return}if(o!==h){a({title:"خطأ",description:"كلمة المرور غير متطابقة",variant:"destructive"});return}f(!0);try{if(!(await fetch("/api/employees/reset-password-by-username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,newPassword:o})})).ok)throw new Error("فشل تغيير كلمة المرور");a({title:"نجح!",description:"تم تغيير كلمة المرور بنجاح. يمكنك تسجيل الدخول الآن"}),setTimeout(()=>u("/manager/login"),2e3)}catch(i){console.error("Reset password error:",i),a({title:"خطأ",description:i.message||"حدث خطأ أثناء تغيير كلمة المرور",variant:"destructive"})}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, #1a1410 0%, #2d1810 50%, #1a1410 100%)"},dir:"rtl",children:e.jsxs(T,{className:"w-full max-w-md border-purple-900/30 bg-gradient-to-br from-stone-900/95 to-stone-950/95 backdrop-blur shadow-2xl",children:[e.jsxs(F,{className:"space-y-3 text-center pb-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-purple-600 to-purple-800 flex items-center justify-center shadow-lg shadow-purple-900/50",children:e.jsx(R,{className:"w-10 h-10 text-white"})})}),e.jsx(L,{className:"text-3xl font-bold text-purple-100",children:"نسيت كلمة المرور؟"}),e.jsxs(q,{className:"text-purple-200/70 text-lg",children:[r==="username"&&"أدخل اسم المستخدم لتغيير كلمة المرور",r==="password"&&"أدخل كلمة المرور الجديدة"]})]}),e.jsxs(D,{className:"space-y-6",children:[r==="username"&&e.jsxs("form",{onSubmit:C,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"username",className:"text-purple-100",children:"اسم المستخدم"}),e.jsx(c,{id:"username",type:"text",placeholder:"أدخل اسم المستخدم الخاص بك",value:l,onChange:s=>v(s.target.value),className:"bg-stone-800/50 border-purple-900/50 text-purple-50 placeholder:text-purple-200/40 focus:border-purple-600 focus:ring-purple-600/30","data-testid":"input-username",required:!0})]}),e.jsx(g,{type:"submit",className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white shadow-lg shadow-purple-900/50 transition-all duration-300 hover:scale-[1.02]","data-testid":"button-submit",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"التالي"}),e.jsx(O,{className:"w-5 h-5"})]})})]}),r==="password"&&e.jsxs("form",{onSubmit:P,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"newPassword",className:"text-purple-100",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"newPassword",type:n?"text":"password",placeholder:"أدخل كلمة المرور الجديدة",value:o,onChange:s=>m(s.target.value),className:"bg-stone-800/50 border-purple-900/50 text-purple-50 placeholder:text-purple-200/40 focus:border-purple-600 focus:ring-purple-600/30 pl-10","data-testid":"input-new-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>y(!n),className:"absolute left-3 top-2.5 text-purple-400 hover:text-purple-300","data-testid":"button-toggle-new-password",children:n?e.jsx(j,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirmPassword",className:"text-purple-100",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"confirmPassword",type:p?"text":"password",placeholder:"أعد إدخال كلمة المرور",value:h,onChange:s=>x(s.target.value),className:"bg-stone-800/50 border-purple-900/50 text-purple-50 placeholder:text-purple-200/40 focus:border-purple-600 focus:ring-purple-600/30 pl-10","data-testid":"input-confirm-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>S(!p),className:"absolute left-3 top-2.5 text-purple-400 hover:text-purple-300","data-testid":"button-toggle-confirm-password",children:p?e.jsx(j,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-purple-200/50 mt-1",children:"كلمة المرور يجب أن تكون على الأقل 4 أحرف"})]}),e.jsx(g,{type:"submit",disabled:w,className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white shadow-lg shadow-purple-900/50 transition-all duration-300 hover:scale-[1.02]","data-testid":"button-reset-password",children:w?"جارٍ التغيير...":"تغيير كلمة المرور"})]}),e.jsx("div",{className:"pt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>{r==="password"?(b("username"),m(""),x("")):u("/manager")},className:"text-purple-500 hover:text-purple-400 text-sm","data-testid":"button-back",children:r==="password"?"رجوع":"العودة لتسجيل الدخول"})})]})]})})}export{z as default};
