import{j as t}from"./vendor-ui-DJm-zmnP.js";import{r}from"./vendor-react-Bzsngnqy.js";import{c as I,B,g as k,r as A,j as p}from"./index-CLvpp2UE.js";import{S as L,a as O,b as T,c as R,d as _}from"./select-BzAjeBJu.js";import{C as D}from"./chef-hat-BflflgM-.js";import{C as $}from"./circle-check-CNDbPLNF.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-CqdH-ack.js";const V=5,H=5e3;function Q(){const[,l]=I(),[z,b]=r.useState(null),[a,d]=r.useState(""),[u,f]=r.useState([]),[y,j]=r.useState([]),[w,m]=r.useState(!1);r.useEffect(()=>{const e=localStorage.getItem("currentEmployee");if(e){const s=JSON.parse(e);b(s),s.branchId&&d(s.branchId)}else l("/employee/login")},[l]),r.useEffect(()=>{(async()=>{try{const s=await fetch("/api/branches");if(s.ok){const i=await s.json();f(i)}}catch(s){console.error("Error fetching branches:",s)}})()},[]);const o=r.useCallback(async()=>{if(a)try{m(!0);const e=await fetch(`/api/orders?branchId=${a}`);if(e.ok){const s=await e.json();j(s)}}catch(e){console.error("Error fetching orders:",e)}finally{m(!1)}},[a]);r.useEffect(()=>{o();const e=setInterval(o,H);return()=>clearInterval(e)},[o]);const N=e=>e.replace(/\D/g,"").slice(-3)||e.slice(-3),n=e=>y.filter(s=>s.status===e||e==="pending"&&s.status==="waiting").slice(0,V),S=e=>({pending:"bg-yellow-50",preparing:"bg-blue-50",ready:"bg-green-50"})[e]||"bg-gray-50",g=e=>({pending:"border-yellow-300",preparing:"border-blue-300",ready:"border-green-300"})[e]||"border-gray-300",v=e=>({pending:"bg-white border-l-4 border-l-yellow-400",preparing:"bg-white border-l-4 border-l-blue-400",ready:"bg-white border-l-4 border-l-green-400"})[e]||"bg-white border-l-4 border-l-gray-400",E=({order:e,statusSection:s})=>t.jsx("div",{className:`p-3 rounded-lg shadow-sm ${v(s)} hover:shadow-md transition-shadow min-w-0`,children:t.jsxs("div",{className:"text-center flex flex-col items-center justify-center overflow-hidden",children:[t.jsxs("div",{className:"flex justify-between items-start w-full mb-1",children:[e.orderType==="dine-in"&&e.tableNumber&&t.jsxs(p,{variant:"outline",className:"text-[10px] bg-primary/10 text-primary border-primary/20",children:["طاولة ",e.tableNumber]}),e.orderType==="car-pickup"&&e.carInfo&&t.jsxs(p,{variant:"outline",className:"text-[10px] bg-blue-100 text-blue-700 border-blue-200",children:["سيارة: ",e.carInfo.model," (",e.carInfo.color,") - ",e.carInfo.plateNumber]}),t.jsx("span",{className:"text-[10px] text-muted-foreground",children:new Date(e.createdAt||"").toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})})]}),t.jsx("p",{className:"text-3xl sm:text-4xl font-bold text-gray-900 font-mono mb-1 truncate w-full",children:N(e.orderNumber)}),t.jsxs("div",{className:"flex items-center justify-center gap-1 flex-wrap w-full",children:[t.jsx("p",{className:"text-base sm:text-lg font-bold text-gray-900 leading-none truncate max-w-[70%]",children:e.totalAmount}),t.jsx("p",{className:"text-xs sm:text-sm font-semibold text-gray-700 leading-none shrink-0",children:"ر.س"})]})]})}),c=({title:e,status:s,icon:i,count:C})=>{const x=n(s);return t.jsxs("div",{children:[t.jsxs("div",{className:`flex items-center gap-2 mb-4 pb-3 border-b-2 ${g(s)}`,children:[t.jsx(i,{className:"w-6 h-6 text-gray-700"}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:e}),t.jsxs("span",{className:"text-xl font-semibold text-gray-600 ml-2",children:["(",C,")"]})]}),t.jsx("div",{className:`p-4 rounded-lg border-2 ${S(s)} ${g(s)} min-h-40`,children:x.length>0?t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3",children:x.map(h=>t.jsx(E,{order:h,statusSection:s},h.id))}):t.jsx("p",{className:"text-center text-gray-500 py-8 font-semibold",children:"لا توجد طلبات"})})]})};return t.jsxs("div",{className:"min-h-screen bg-gray-100 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8 bg-white rounded-lg shadow p-4",children:[t.jsx(B,{onClick:()=>l("/employee/dashboard"),size:"icon",variant:"ghost",className:"text-gray-700","data-testid":"button-back",children:t.jsx(k,{className:"w-5 h-5"})}),t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"عرض الطلبات"}),t.jsx("div",{className:"w-10"})]}),!a&&t.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"اختر الفرع"}),t.jsxs(L,{value:a,onValueChange:d,children:[t.jsx(O,{className:"w-full border-2 border-gray-300 text-base h-12","data-testid":"select-branch",children:t.jsx(T,{placeholder:"اختر الفرع"})}),t.jsx(R,{children:u.map(e=>t.jsx(_,{value:e.id,children:e.nameAr},e.id))})]})]}),w&&a?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-lg text-gray-600 font-semibold",children:"جاري تحميل الطلبات..."})}):t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx(c,{title:"قيد الانتظار",status:"pending",icon:A,count:n("pending").length}),t.jsx(c,{title:"جاري التحضير",status:"preparing",icon:D,count:n("preparing").length+n("in_progress").length}),t.jsx(c,{title:"جاهز للاستلام",status:"ready",icon:$,count:n("ready").length})]})]})}export{Q as default};
