import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r}from"./vendor-react-Bzsngnqy.js";import{c as O,e as R,C as I,x as V,i as B,y as U,V as Y,f as $,L as m,aj as H,I as x,B as f,A as g,v as w}from"./index-CLvpp2UE.js";import{P as M}from"./phone-input-C_eDBAZg.js";import{E as y}from"./eye-off-AEXWPIZp.js";import{E as C}from"./eye-cZNGFzyE.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";function ee(){const[,j]=O(),{toast:s}=R(),[d,P]=r.useState(""),[u,S]=r.useState(""),[l,E]=r.useState(""),[b,k]=r.useState(""),[p,F]=r.useState(!1),[h,q]=r.useState(!1),[i,c]=r.useState(!1),[a,v]=r.useState("email"),[N,L]=r.useState("");r.useEffect(()=>{document.title="نسيت كلمة المرور - CLUNY CAFE | إعادة تعيين";const t=document.querySelector('meta[name="description"]');t&&t.setAttribute("content","نسيت كلمة المرور؟ أعد تعيين كلمة مرورك على CLUNY CAFE بسهولة")},[]);const T=async t=>{if(t.preventDefault(),!d||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)){s({title:"خطأ",description:"البريد الإلكتروني غير صحيح",variant:"destructive"});return}c(!0);try{(await(await w("POST","/api/customers/check-email",{email:d})).json()).exists?(L(d),v("phone"),s({title:"البريد موجود",description:"الآن أدخل رقم الجوال المرتبط بهذا البريد"})):s({title:"خطأ",description:"البريد الإلكتروني غير مسجل لدينا",variant:"destructive"})}catch(o){console.error("Check email error:",o),s({title:"خطأ",description:o.message||"حدث خطأ أثناء التحقق من البريد",variant:"destructive"})}finally{c(!1)}},A=async t=>{t.preventDefault();const o=u.trim().replace(/\s/g,"");if(!o||!/^5\d{8}$/.test(o)){s({title:"خطأ",description:"رقم الجوال يجب أن يبدأ بـ 5 ويتكون من 9 أرقام (مثال: 512345678)",variant:"destructive"});return}c(!0);try{(await(await w("POST","/api/customers/verify-phone-email",{email:N,phone:o})).json()).valid?(v("password"),s({title:"تم التحقق",description:"الآن أدخل كلمة المرور الجديدة "})):s({title:"خطأ",description:"رقم الجوال غير مطابق للبريد الإلكتروني",variant:"destructive"})}catch(n){console.error("Verify phone error:",n),s({title:"خطأ",description:n.message||"حدث خطأ أثناء التحقق من رقم الجوال",variant:"destructive"})}finally{c(!1)}},D=async t=>{if(t.preventDefault(),!l||l.length<4){s({title:"خطأ",description:"كلمة المرور يجب أن تكون على الأقل 4 أحرف",variant:"destructive"});return}if(l!==b){s({title:"خطأ",description:"كلمة المرور غير متطابقة",variant:"destructive"});return}c(!0);const o=u.trim().replace(/\s/g,"");try{await w("POST","/api/customers/reset-password-direct",{email:N,phone:o,newPassword:l}),s({title:"تم بنجاح!",description:"تم تغيير كلمة المرور بنجاح. يمكنك تسجيل الدخول الآن"}),setTimeout(()=>j("/auth"),1500)}catch(n){console.error("Reset password error:",n),s({title:"خطأ",description:n.message||"حدث خطأ أثناء تغيير كلمة المرور",variant:"destructive"})}finally{c(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, hsl(165, 15%, 97%) 0%, hsl(165, 12%, 88%) 50%, hsl(165, 15%, 97%) 100%)"},dir:"rtl",children:e.jsxs(I,{className:"w-full max-w-md border-primary/30 bg-card backdrop-blur shadow-xl",children:[e.jsxs(V,{className:"space-y-3 text-center pb-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary to-primary/70 flex items-center justify-center shadow-lg shadow-primary/30",children:e.jsx(B,{className:"w-10 h-10 text-white"})})}),e.jsxs(U,{className:"text-3xl font-bold text-foreground",children:[a==="email"&&"نسيت كلمة المرور؟",a==="phone"&&"تحقق من رقم الجوال",a==="password"&&"كلمة المرور الجديدة "]}),e.jsxs(Y,{className:"text-muted-foreground text-lg",children:[a==="email"&&"أدخل بريدك الإلكتروني لإعادةتعيين كلمة المرور",a==="phone"&&"أدخل رقم الجوال المرتبط بالبريد الإلكتروني",a==="password"&&"أدخل كلمة المرور الجديدة وقم بتأكيدها"]})]}),e.jsxs($,{className:"space-y-6",children:[a==="email"&&e.jsxs("form",{onSubmit:T,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"email",className:"text-foreground flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"البريد الإلكتروني"]}),e.jsx(x,{id:"email",type:"email",placeholder:"example@email.com",value:d,onChange:t=>P(t.target.value),className:"bg-secondary border-border text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-primary/30",dir:"ltr","data-testid":"input-email",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"أدخل البريد الإلكتروني الذي استخدمته عند إنشاء الحساب"})]}),e.jsx(f,{type:"submit",disabled:i,className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-accent to-accent/90 hover:from-accent/95 hover:to-accent/85 text-accent-foreground shadow-lg shadow-accent/30 transition-all duration-300","data-testid":"button-submit",children:i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-accent-foreground/30 border-t-accent-foreground rounded-full animate-spin"}),e.jsx("span",{children:"جارٍ التحقق..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"التالي"}),e.jsx(g,{className:"w-5 h-5"})]})})]}),a==="phone"&&e.jsxs("form",{onSubmit:A,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",className:"text-foreground",children:"رقم الجوال"}),e.jsx(M,{id:"phone",value:u,onChange:t=>S(t),placeholder:"5xxxxxxxx","data-testid":"input-phone",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"أدخل رقم الجوال بدون الصفر (9 أرقام تبدأ بـ 5)"})]}),e.jsx(f,{type:"submit",disabled:i,className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-accent to-accent/90 hover:from-accent/95 hover:to-accent/85 text-accent-foreground shadow-lg shadow-accent/30 transition-all duration-300","data-testid":"button-verify-phone",children:i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-accent-foreground/30 border-t-accent-foreground rounded-full animate-spin"}),e.jsx("span",{children:"جارٍ التحقق..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"التحقق"}),e.jsx(g,{className:"w-5 h-5"})]})})]}),a==="password"&&e.jsxs("form",{onSubmit:D,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"newPassword",className:"text-foreground",children:"كلمة المرور الجديدة "}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"newPassword",type:p?"text":"password",placeholder:"أدخل كلمة المرور الجديدة ",value:l,onChange:t=>E(t.target.value),className:"bg-secondary border-border text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-primary/30 pl-10","data-testid":"input-new-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>F(!p),className:"absolute left-3 top-2.5 text-muted-foreground hover:text-foreground","data-testid":"button-toggle-new-password",children:p?e.jsx(y,{className:"h-4 w-4"}):e.jsx(C,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"confirmPassword",className:"text-foreground",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"confirmPassword",type:h?"text":"password",placeholder:"أدخل كلمة المرور مرة أخرى",value:b,onChange:t=>k(t.target.value),className:"bg-secondary border-border text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-primary/30 pl-10","data-testid":"input-confirm-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>q(!h),className:"absolute left-3 top-2.5 text-muted-foreground hover:text-foreground","data-testid":"button-toggle-confirm-password",children:h?e.jsx(y,{className:"h-4 w-4"}):e.jsx(C,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"كلمة المرور يجب أن تكون 4 أحرف على الأقل"})]}),e.jsx(f,{type:"submit",disabled:i,className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-accent to-accent/90 hover:from-accent/95 hover:to-accent/85 text-accent-foreground shadow-lg shadow-accent/30 transition-all duration-300","data-testid":"button-reset-password",children:i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-accent-foreground/30 border-t-accent-foreground rounded-full animate-spin"}),e.jsx("span",{children:"جارٍ التغيير..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"تغيير كلمة المرور"}),e.jsx(g,{className:"w-5 h-5"})]})})]}),e.jsx("div",{className:"pt-4 text-center space-y-2",children:e.jsx("button",{type:"button",onClick:()=>j("/auth"),className:"text-muted-foreground hover:text-foreground transition-colors text-sm underline-offset-4 hover:underline","data-testid":"link-back",children:"العودةلتسجيل الدخول"})})]})]})})}export{ee as default};
