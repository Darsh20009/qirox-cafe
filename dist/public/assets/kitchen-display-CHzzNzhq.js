import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as x}from"./vendor-react-Bzsngnqy.js";import{a as xe,b as ue}from"./vendor-query-CX8ZYlKb.js";import{l as pe,j as f,m as v,r as B,_ as V,q as ge,T as H,O as de,C as L,x as Z,as as be,o as F,f as G,i as fe,aD as J,B as N,k as ee,y as he,U as je,c as ye,e as Ne,N as K,a5 as ve,g as ke,aa as we,ab as Te,ac as O,ai as Ce,v as Se}from"./index-CLvpp2UE.js";import{p as R,V as Ie,a as Oe}from"./notification-sounds-C4VBNWg2.js";import{u as Ae}from"./websocket-Bxdgjfcq.js";import{C as P}from"./circle-check-CNDbPLNF.js";import{C as se}from"./circle-x-B1Jm2Zh7.js";import{S as me}from"./store-DQDE2-Yy.js";import{C as _e}from"./car-0OJdyCDc.js";import{T as te}from"./timer-Nxcyi2sD.js";import{P as ae}from"./play-D4xqnKDj.js";import{P as De}from"./printer-CMPCONS0.js";import{S as ze,a as Me,b as $e,c as Ee,d as A}from"./select-BzAjeBJu.js";import{C as Re}from"./chef-hat-BflflgM-.js";import{W as Le}from"./wifi-BwJ6pui9.js";import{W as Pe}from"./wifi-off-D42PO9HC.js";import{N as qe}from"./navigation-C4sukurV.js";import{R as re}from"./refresh-cw-BuGj2LMM.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-CqdH-ack.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=pe("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]),q={spacing:{xs:"0.25rem",sm:"0.5rem",md:"1rem",lg:"1.5rem",xl:"2rem","2xl":"3rem"},fontSize:{xs:"0.75rem",sm:"0.875rem",base:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem"},fontWeight:{normal:"400",medium:"500",semibold:"600",bold:"700"},borderRadius:{sm:"0.375rem",md:"0.5rem",lg:"0.75rem",xl:"1rem",full:"9999px"},shadow:{sm:"0 1px 2px 0 rgb(0 0 0 / 0.05)",md:"0 4px 6px -1px rgb(0 0 0 / 0.1)",lg:"0 10px 15px -3px rgb(0 0 0 / 0.1)"},animation:{duration:{fast:"150ms",normal:"300ms",slow:"500ms"},easing:{default:"cubic-bezier(0.4, 0, 0.2, 1)",in:"cubic-bezier(0.4, 0, 1, 1)",out:"cubic-bezier(0, 0, 0.2, 1)"}},orderStatus:{pending:{bg:"bg-amber-500/20",text:"text-amber-600 dark:text-amber-400",border:"border-amber-500/30",label:"قيد الانتظار"},confirmed:{bg:"bg-blue-500/20",text:"text-blue-600 dark:text-blue-400",border:"border-blue-500/30",label:"تم التأكيد"},payment_confirmed:{bg:"bg-indigo-500/20",text:"text-indigo-600 dark:text-indigo-400",border:"border-indigo-500/30",label:"تم الدفع"},in_progress:{bg:"bg-orange-500/20",text:"text-orange-600 dark:text-orange-400",border:"border-orange-500/30",label:"قيد التحضير"},ready:{bg:"bg-green-500/20",text:"text-green-600 dark:text-green-400",border:"border-green-500/30",label:"جاهز للاستلام"},completed:{bg:"bg-emerald-500/20",text:"text-emerald-600 dark:text-emerald-400",border:"border-emerald-500/30",label:"مكتمل"},cancelled:{bg:"bg-red-500/20",text:"text-red-600 dark:text-red-400",border:"border-red-500/30",label:"ملغي"},refunded:{bg:"bg-gray-500/20",text:"text-gray-600 dark:text-gray-400",border:"border-gray-500/30",label:"مسترجع"},delayed:{bg:"bg-red-600/20",text:"text-red-700 dark:text-red-400",border:"border-red-600/30",label:"متأخر"}},deliveryType:{"dine-in":{icon:"Store",label:"طاولة",color:"text-blue-500"},pickup:{icon:"ShoppingBag",label:"استلام",color:"text-green-500"},delivery:{icon:"Truck",label:"توصيل",color:"text-orange-500"}},slaThresholds:{warning:5,delayed:10}};function Be(s){const t=s;return q.orderStatus[t]||q.orderStatus.pending}function Ue(s){const t=s;return q.deliveryType[t]||q.deliveryType.pickup}const Fe={pending:B,confirmed:P,in_progress:ge,ready:P,completed:P,cancelled:se,refunded:se,delayed:H};function W({status:s,size:t="md",showIcon:a=!0,className:i}){const n=Be(s),p=Fe[s]||B,d={sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"};return e.jsxs(f,{variant:"outline",className:v(n.bg,n.text,n.border,d[t],"flex items-center gap-1.5 font-medium",i),"data-testid":`badge-status-${s}`,children:[a&&e.jsx(p,{className:v("h-3.5 w-3.5",s==="in_progress"&&"animate-spin")}),e.jsx("span",{children:n.label})]})}const Ke={"dine-in":me,pickup:V,delivery:de};function le({type:s,size:t="md",showIcon:a=!0,className:i}){const n=Ue(s),p=Ke[s]||V,d={sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"};return e.jsxs(f,{variant:"secondary",className:v(d[t],"flex items-center gap-1.5 font-medium",i),"data-testid":`badge-delivery-${s}`,children:[a&&e.jsx(p,{className:v("h-3.5 w-3.5",n.color)}),e.jsx("span",{children:n.label})]})}function ie({minutes:s,warningThreshold:t=5,delayedThreshold:a=10,className:i}){const n=s>=a,p=s>=t&&!n,d=n?"bg-red-500/20 text-red-600 dark:text-red-400 border-red-500/30":p?"bg-amber-500/20 text-amber-600 dark:text-amber-400 border-amber-500/30":"bg-green-500/20 text-green-600 dark:text-green-400 border-green-500/30";return e.jsxs(f,{variant:"outline",className:v(d,"flex items-center gap-1.5 font-mono text-sm",i),"data-testid":"badge-timer",children:[e.jsx(B,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[s," د"]})]})}function We(s){return new Date(s).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}function Ve(s){const t=new Date(s).getTime(),a=Date.now();return Math.floor((a-t)/(1e3*60))}function ce(s){return{small:"صغير",medium:"وسط",large:"كبير"}[s]||s}function He(s){return s?{barista:"باريستا",kitchen:"المطبخ",cold:"المشروبات الباردة",hot:"المشروبات الساخنة",food:"الطعام",desserts:"الحلويات"}[s]||s:""}function Qe(s){return s.reduce((t,a)=>{const i=a.coffeeItem?.prepTimeMinutes||3;return t+i*a.quantity},0)}function Ye(s){if(!s.prepStartedAt||!s.estimatedPrepTimeMinutes)return null;const t=new Date(s.prepStartedAt).getTime(),i=(Date.now()-t)/(1e3*60);return Math.ceil(s.estimatedPrepTimeMinutes-i)}function Xe(s,t){const a=t||10;return s>=a?"overdue":s>=a*.7?"warning":"on-track"}function Ze(s){return s.map(a=>a.coffeeItem?.station||a.coffeeItem?.category).filter(a=>!!a&&a!=="general").filter((a,i,n)=>n.indexOf(a)===i)}function Ge(s){return s.some(t=>t.coffeeItem?.allergens&&t.coffeeItem.allergens.length>0)}function Je(s){const t=[];return s.forEach(a=>{a.coffeeItem?.allergens&&a.coffeeItem.allergens.forEach(i=>{t.includes(i)||t.push(i)})}),t}function es({order:s,variant:t="detailed",showActions:a=!0,showTimer:i=!0,onStartPreparing:n,onMarkReady:p,onPrint:d,isPending:w=!1,className:g}){const[Q,_]=x.useState(0);x.useEffect(()=>{if(!i)return;const b=setInterval(()=>_(h=>h+1),3e4);return()=>clearInterval(b)},[i]);const k=Ve(s.createdAt),u=k>=10,D=k>=5&&!u,m=s.tableStatus||s.status,z=s.orderNumber.includes("-")?s.orderNumber.split("-").pop():s.orderNumber.slice(-4),I=u?"border-red-500/50":D?"border-amber-500/50":"";if(t==="compact")return e.jsxs(L,{className:v("p-3",I,g),"data-testid":`card-order-${s.id}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-2xl font-bold font-mono","data-testid":"text-order-number",children:["#",z]}),e.jsx(W,{status:m,size:"sm"})]}),i&&e.jsx(ie,{minutes:k})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:[s.items.length," عنصر"]})]});if(t==="kds"){const b=!!(s.estimatedPrepTimeMinutes||s.prepStartedAt),h=b?Xe(k,s.estimatedPrepTimeMinutes):u?"overdue":D?"warning":"on-track",j=b?Ye(s):null,M=Ze(s.items),U=Ge(s.items),$=Je(s.items),T=Qe(s.items),C=h==="overdue"?"border-red-500 border-2":h==="warning"?"border-amber-500 border-2":I;return e.jsxs(L,{className:v("flex flex-col h-full",C,g),"data-testid":`card-order-kds-${s.id}`,children:[e.jsxs(Z,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-3xl font-bold font-mono text-primary","data-testid":"text-order-number-kds",children:["#",z]}),s.priority==="rush"&&e.jsxs(f,{className:"bg-red-500 text-white animate-pulse",children:[e.jsx(be,{className:"h-3 w-3 ml-1"}),"مستعجل"]}),s.priority==="vip"&&e.jsx(f,{className:"bg-amber-500 text-black",children:"VIP"}),s.deliveryType&&e.jsx(le,{type:s.deliveryType,size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{status:m,size:"sm"}),i&&e.jsx(ie,{minutes:k})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[s.tableNumber&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(F,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["طاولة ",s.tableNumber]})]}),(s.orderType==="car-pickup"||s.orderType==="car_pickup"||s.deliveryType==="car_pickup"||s.deliveryType==="car-pickup")&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-purple-600 dark:text-purple-400 font-bold",children:[e.jsx(_e,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"استلام من السيارة"})]}),(s.carType||s.carColor||s.carInfo?.carType)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs bg-purple-500/10 rounded p-1.5 border border-purple-500/20",children:[e.jsx("span",{className:"font-medium",children:s.carInfo?.carType||s.carType}),e.jsx("span",{children:s.carInfo?.carColor||s.carColor}),e.jsx("span",{className:"font-mono font-bold",children:s.carInfo?.plateNumber||s.carPlate})]})]}),M.length>0&&e.jsx("div",{className:"flex items-center gap-1",children:M.map((c,S)=>e.jsxs(f,{variant:"outline",className:"text-xs",children:[e.jsx(ne,{className:"h-3 w-3 ml-1"}),He(c)||c]},S))}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(te,{className:"h-3 w-3"}),e.jsxs("span",{children:["~",T," د"]})]})]}),U&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 p-1.5 rounded bg-red-500/10 border border-red-500/30",children:[e.jsx(H,{className:"h-3.5 w-3.5 text-red-500"}),e.jsxs("span",{className:"text-xs text-red-600 font-medium",children:["تنبيه: ",$.join(", ")]})]}),j!==null&&m==="in_progress"&&e.jsxs("div",{className:v("flex items-center gap-1 mt-2 p-1.5 rounded text-xs font-medium",j<=0?"bg-red-500/10 text-red-600":j<=2?"bg-amber-500/10 text-amber-600":"bg-green-500/10 text-green-600"),children:[e.jsx(te,{className:"h-3.5 w-3.5"}),j<=0?`متأخر ${Math.abs(j)} دقيقة`:`متبقي ${j} دقيقة`]})]}),e.jsxs(G,{className:"flex-1 pb-2",children:[e.jsx("div",{className:"space-y-2",children:s.items.map((c,S)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-md bg-muted/50","data-testid":`item-order-${s.id}-${S}`,children:[e.jsx(fe,{className:"h-4 w-4 mt-0.5 text-primary"}),e.jsxs("div",{className:"flex-1 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium",children:c.coffeeItem?.nameAr||c.coffeeItemId}),e.jsxs("span",{className:"text-muted-foreground",children:["x",c.quantity]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[ce(c.size),c.extras&&c.extras.length>0&&e.jsxs("span",{className:"mr-2",children:["+ ",c.extras.join(", ")]})]}),c.notes&&e.jsxs("div",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["ملاحظة: ",c.notes]})]})]},S))}),s.customerNotes&&e.jsx("div",{className:"mt-3 p-2 rounded-md bg-amber-500/10 border border-amber-500/20",children:e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:s.customerNotes})}),(s.deliveryType==="car-pickup"||s.deliveryType==="car_pickup"||s.deliveryType==="curbside")&&(s.carInfo||s.carType)&&e.jsxs("div",{className:"mt-3 p-3 rounded-md bg-blue-500/10 border border-blue-500/20 space-y-1",children:[e.jsxs("p",{className:"text-xs font-bold text-blue-700 dark:text-blue-300 flex items-center gap-1",children:[e.jsx(F,{className:"h-3 w-3"}),"بيانات الاستلام من السيارة:"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[10px] text-blue-600 dark:text-blue-400",children:[s.carInfo?.carType||s.carType?e.jsxs("span",{children:["النوع: ",s.carInfo?.carType||s.carType]}):null,s.carInfo?.carColor||s.carColor?e.jsxs("span",{children:["اللون: ",s.carInfo?.carColor||s.carColor]}):null,s.carInfo?.plateNumber||s.carPlate?e.jsxs("span",{className:"col-span-2 font-bold",children:["اللوحة: ",s.carInfo?.plateNumber||s.carPlate]}):null,s.arrivalTime&&e.jsxs("span",{className:"col-span-2 text-primary",children:["موعد الوصول: ",s.arrivalTime]})]})]}),s.deliveryType==="dine-in"&&s.tableNumber&&e.jsxs("div",{className:"mt-3 p-2 rounded-md bg-green-500/10 border border-green-500/20 space-y-1",children:[e.jsxs("p",{className:"text-xs font-bold text-green-700 dark:text-green-300 flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3"}),"جلوس في الكافيه:"]}),e.jsxs("div",{className:"text-[10px] text-green-600 dark:text-green-400",children:[e.jsxs("span",{children:["طاولة رقم: ",s.tableNumber]}),s.arrivalTime&&e.jsxs("span",{className:"mr-3",children:["موعد الوصول: ",s.arrivalTime]})]})]})]}),a&&e.jsxs(J,{className:"pt-2 gap-2",children:[(m==="confirmed"||m==="pending"||m==="payment_confirmed")&&n&&e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("div",{className:"flex gap-1 overflow-x-auto pb-1 no-scrollbar",children:[5,10,15,20,30].map(c=>e.jsxs(N,{size:"sm",variant:"outline",className:"h-7 text-[10px] px-2 min-w-fit",onClick:()=>n(s.id,c),children:[c," د"]},c))}),e.jsxs(N,{onClick:()=>n(s.id,5),disabled:w,className:"flex-1 bg-amber-500 hover:bg-amber-600 text-black","data-testid":`button-start-preparing-${s.orderNumber}`,children:[e.jsx(ae,{className:"h-4 w-4 ml-2"}),"بدء (5د)"]})]}),m==="in_progress"&&p&&e.jsxs(N,{onClick:()=>p(s.id),disabled:w,className:"flex-1 bg-green-500 hover:bg-green-600","data-testid":`button-mark-ready-${s.orderNumber}`,children:[e.jsx(ee,{className:"h-4 w-4 ml-2"}),"جاهز للتسليم"]}),d&&e.jsx(N,{variant:"outline",size:"icon",onClick:()=>d(s.id),"data-testid":"button-print-order",children:e.jsx(De,{className:"h-4 w-4"})})]})]})}return e.jsxs(L,{className:v(I,g),"data-testid":`card-order-${s.id}`,children:[e.jsxs(Z,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(he,{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-2xl font-bold font-mono","data-testid":"text-order-number",children:["#",lastThreeDigits]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{status:m}),s.deliveryType&&e.jsx(le,{type:s.deliveryType})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:We(s.createdAt)})]}),s.tableNumber&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["طاولة ",s.tableNumber]})]}),s.customerName&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:s.customerName})]})]})]}),e.jsx(G,{className:"pb-2",children:e.jsx("div",{className:"space-y-2",children:s.items.map((b,h)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:b.coffeeItem?.nameAr||b.coffeeItemId}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",ce(b.size),")"]})]}),e.jsxs("span",{className:"text-muted-foreground",children:["x",b.quantity]})]},h))})}),a&&e.jsxs(J,{className:"pt-2 gap-2",children:[(m==="confirmed"||m==="pending"||m==="payment_confirmed")&&n&&e.jsxs(N,{onClick:()=>n(s.id),disabled:w,className:"flex-1 bg-amber-500 hover:bg-amber-600 text-black","data-testid":`button-start-preparing-${s.orderNumber}`,children:[e.jsx(ae,{className:"h-4 w-4 ml-2"}),"بدء التحضير"]}),m==="in_progress"&&p&&e.jsxs(N,{onClick:()=>p(s.id),disabled:w,className:"flex-1 bg-green-500 hover:bg-green-600","data-testid":`button-mark-ready-${s.orderNumber}`,children:[e.jsx(ee,{className:"h-4 w-4 ml-2"}),"جاهز للتسليم"]})]})]})}if(typeof document<"u"){document.title="شاشة المطبخ - CLUNY CAFE | إدارة الطلبات";const s=document.querySelector('meta[name="description"]');s&&s.setAttribute("content","شاشة المطبخ لـ CLUNY CAFE - إدارة سهلة وسريعة للطلبات المدخلة")}const ss=10;function ts(s){const t=new Date(s).getTime(),a=Date.now();return Math.floor((a-t)/(1e3*60))}function ws(){const[,s]=ye(),{toast:t}=Ne(),[a,i]=x.useState("all"),[n,p]=x.useState(!0),[d,w]=x.useState(!0),[g,Q]=x.useState("all"),_=x.useRef(0),k=x.useRef(0),{data:u=[],isLoading:D,refetch:m}=xe({queryKey:["/api/orders/kitchen"],refetchInterval:n?5e3:!1}),z=x.useCallback(r=>{K.invalidateQueries({queryKey:["/api/orders/kitchen"]}),d&&(R("newOrder",.7),t({title:"طلب جديد!",description:`وصل طلب جديد #${r.orderNumber}`}))},[d,t]),I=x.useCallback(r=>{K.invalidateQueries({queryKey:["/api/orders/kitchen"]})},[]),b=x.useCallback(r=>{d&&R("success",.8)},[d]),{isConnected:h}=Ae({clientType:"kitchen",onNewOrder:z,onOrderUpdated:I,onOrderReady:b,enabled:!0});x.useEffect(()=>{if(!d||!Array.isArray(u)||u.length===0)return;const r=u.filter(l=>l.status==="pending"||l.status==="payment_confirmed"||l.status==="confirmed"||l.status==="in_progress"),o=u.filter(l=>l.status==="ready");r.length>_.current&&(d&&R("newOrder",1),t({title:"طلب جديد!",description:`وصل طلب جديد #${u.find(l=>l.status==="pending"||l.status==="payment_confirmed"||l.status==="in_progress")?.orderNumber||""}`})),o.length>k.current&&R("success",.8),_.current=r.length,k.current=o.length},[u,d,t]);const j=ue({mutationFn:async({id:r,status:o,estimatedPrepTimeInMinutes:l})=>Se("PUT",`/api/orders/${r}/status`,{status:o,estimatedPrepTimeInMinutes:l}),onSuccess:()=>{K.invalidateQueries({queryKey:["/api/orders/kitchen"]}),t({title:"تم تحديث الحالة",description:"تم تحديث حالة الطلب بنجاح"})},onError:r=>{console.error("[KDS] Status update failed:",r),t({title:"خطأ",description:r?.message||"فشل تحديث حالة الطلب",variant:"destructive"})}}),M=(r,o)=>{j.mutate({id:r,status:"in_progress",estimatedPrepTimeInMinutes:o||5})},U=r=>{j.mutate({id:r,status:"ready"})},$=x.useCallback(r=>g==="all"?r:r.filter(o=>{const l=o.deliveryType||o.orderType;return g==="dine-in"?l==="dine-in"||l==="dine_in":g==="pickup"?l==="pickup"||l==="takeaway":g==="delivery"?l==="delivery":g==="car-pickup"?l==="car-pickup"||l==="car_pickup":!0}),[g]),{pendingOrders:T,preparingOrders:C,readyOrders:c,delayedOrders:S,delayedCount:E}=x.useMemo(()=>{const r=$(u),o=r.filter(y=>y.status==="pending"||y.status==="payment_confirmed"||y.status==="confirmed"),l=r.filter(y=>y.status==="in_progress"),oe=r.filter(y=>y.status==="ready"||y.status==="completed"),X=[...o,...l].filter(y=>ts(y.createdAt)>=ss);return{pendingOrders:o,preparingOrders:l,readyOrders:oe,delayedOrders:X,delayedCount:X.length}},[u,$]),Y=()=>{switch(a){case"pending":return T;case"preparing":return C;case"ready":return c;case"delayed":return S;default:return[...T,...C,...c]}};return D?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",dir:"rtl",children:e.jsx(ve,{message:"جاري تحميل الطلبات..."})}):e.jsxs("div",{className:"min-h-screen bg-background",dir:"rtl",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-background/95 backdrop-blur border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>s("/employee/dashboard"),"data-testid":"button-back",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-xl font-bold",children:"شاشة المطبخ"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[E>0&&e.jsxs(f,{className:"bg-destructive text-destructive-foreground animate-pulse",children:[e.jsx(H,{className:"h-3 w-3 ml-1"}),E," طلب متأخر"]}),e.jsxs(f,{variant:"outline",className:h?"bg-green-500/10 text-green-500 border-green-500/50":"bg-red-500/10 text-red-500 border-red-500/50","data-testid":"badge-ws-status",children:[h?e.jsx(Le,{className:"h-3 w-3 ml-1"}):e.jsx(Pe,{className:"h-3 w-3 ml-1"}),h?"متصل":"غير متصل"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",className:"bg-primary/10 text-primary border-primary/20",children:["انتظار: ",T.length]}),e.jsxs(f,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/20",children:["تحضير: ",C.length]}),e.jsxs(f,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/20",children:["جاهز: ",c.length]})]}),e.jsxs(ze,{value:g,onValueChange:Q,children:[e.jsx(Me,{className:"w-32","data-testid":"select-delivery-filter",children:e.jsx($e,{placeholder:"نوع الطلب"})}),e.jsxs(Ee,{children:[e.jsx(A,{value:"all",children:"الكل"}),e.jsx(A,{value:"dine-in",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"محلي"]})}),e.jsx(A,{value:"pickup",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"سفري"]})}),e.jsx(A,{value:"delivery",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"توصيل"]})}),e.jsx(A,{value:"car-pickup",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),"استلام من السيارة"]})})]})]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>w(!d),className:d?"border-primary text-primary":"border-muted text-muted-foreground","data-testid":"button-toggle-sound",children:[d?e.jsx(Ie,{className:"h-4 w-4 ml-1"}):e.jsx(Oe,{className:"h-4 w-4 ml-1"}),d?"الصوت":"صامت"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>p(!n),className:n?"border-primary text-primary":"","data-testid":"button-toggle-auto-refresh",children:[e.jsx(re,{className:`h-4 w-4 ml-1 ${n?"animate-spin":""}`}),n?"تحديث تلقائي":"تحديث يدوي"]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>m(),"data-testid":"button-refresh",children:e.jsx(re,{className:"h-4 w-4"})})]})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-4",children:e.jsxs(we,{value:a,onValueChange:i,className:"space-y-4",children:[e.jsxs(Te,{className:"grid w-full grid-cols-5 lg:w-auto lg:inline-grid",children:[e.jsxs(O,{value:"all","data-testid":"tab-all",children:["الكل (",u.length,")"]}),e.jsxs(O,{value:"pending","data-testid":"tab-pending",children:["انتظار (",T.length,")"]}),e.jsxs(O,{value:"preparing","data-testid":"tab-preparing",children:["تحضير (",C.length,")"]}),e.jsxs(O,{value:"ready","data-testid":"tab-ready",children:["جاهز (",c.length,")"]}),e.jsxs(O,{value:"delayed","data-testid":"tab-delayed",className:E>0?"text-destructive":"",children:["متأخر (",E,")"]})]}),e.jsx(Ce,{value:a,className:"mt-4",children:Y().length===0?e.jsxs(L,{className:"p-12 text-center",children:[e.jsx(P,{className:"h-16 w-16 mx-auto text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"لا توجد طلبات"}),e.jsx("p",{className:"text-muted-foreground",children:a==="all"?"لا توجد طلبات حالياً":`لا توجد طلبات في حالة ${a==="pending"?"الانتظار":a==="preparing"?"التحضير":"جاهز"}`})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Y().sort((r,o)=>new Date(r.createdAt).getTime()-new Date(o.createdAt).getTime()).map(r=>e.jsx(es,{order:r,variant:"kds",showTimer:!0,showActions:!0,onStartPreparing:M,onMarkReady:U,isPending:j.isPending},r.id))})})]})})]})}export{ws as default};
