import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as h}from"./vendor-react-Bzsngnqy.js";import{a as C}from"./vendor-query-CX8ZYlKb.js";import{a5 as w,C as n,f as d,L as m,I as j,x as c,y as o,a6 as g}from"./index-CLvpp2UE.js";import{T,a as I,b as f,c as i,d as A,e as l}from"./table-DVDQb40v.js";import{P as k}from"./package-B_dGuXgn.js";import{A as L}from"./arrow-up-ecSxOdJ_.js";import{A as q}from"./arrow-down-BfTPv9Hp.js";import"./vendor-utils-BKCsaWdX.js";function U(){const[x,N]=h.useState("branch-1"),[r,y]=h.useState(""),[u,b]=h.useState("50"),{data:s=[],isLoading:v}=C({queryKey:[`/api/inventory/movements/${x}/${r||"all"}`,parseInt(u)],enabled:!!x&&!!r});if(v)return e.jsx(w,{});const S=t=>t==="in"?e.jsx(L,{className:"w-4 h-4 text-green-600"}):e.jsx(q,{className:"w-4 h-4 text-red-600"}),p=t=>t==="in"?"text-green-600":"text-red-600";return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Stock Movements"})]}),e.jsx(n,{"data-testid":"card-filters",children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Branch ID"}),e.jsx(j,{value:x,onChange:t=>N(t.target.value),placeholder:"branch-1","data-testid":"input-branch"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Item ID"}),e.jsx(j,{value:r,onChange:t=>y(t.target.value),placeholder:"coffee-beans","data-testid":"input-item"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Limit"}),e.jsx(j,{type:"number",value:u,onChange:t=>b(t.target.value),min:"10",max:"500","data-testid":"input-limit"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("p",{className:"text-xs text-secondary-foreground",children:["Showing movements for: ",r||"select item"]})})]})})}),e.jsxs(n,{"data-testid":"card-movements",children:[e.jsx(c,{children:e.jsx(o,{children:"Movement History"})}),e.jsx(d,{children:r?s&&s.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs(f,{children:[e.jsx(i,{children:"Date"}),e.jsx(i,{children:"Type"}),e.jsx(i,{className:"text-right",children:"Quantity"}),e.jsx(i,{children:"Unit"}),e.jsx(i,{className:"text-right",children:"Unit Cost"}),e.jsx(i,{className:"text-right",children:"Total Cost"}),e.jsx(i,{children:"Reason"})]})}),e.jsx(A,{children:s.map((t,a)=>e.jsxs(f,{"data-testid":`row-movement-${a}`,children:[e.jsx(l,{className:"text-sm",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[S(t.type),e.jsx("span",{className:p(t.type),children:t.type==="in"?"Stock In":"Stock Out"})]})}),e.jsx(l,{className:"text-right font-medium",children:t.quantity}),e.jsx(l,{children:t.unit}),e.jsxs(l,{className:"text-right",children:[t.unitCost?.toFixed(2)||"N/A"," SAR"]}),e.jsxs(l,{className:`text-right font-bold ${p(t.type)}`,children:[(t.quantity*(t.unitCost||0)).toFixed(2)," SAR"]}),e.jsx(l,{className:"text-sm text-secondary-foreground max-w-xs",children:t.notes||t.reason||"-"})]},a))})]})}):e.jsx(g,{title:"No movements found",description:`No stock movements for ${r} in the selected period`}):e.jsx(g,{title:"Select an item",description:"Please select a raw item to view its movement history"})})]}),r&&s.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(n,{"data-testid":"card-total-in",children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm text-secondary-foreground",children:"Total Stock In"})}),e.jsx(d,{children:e.jsxs("p",{className:"text-2xl font-bold text-green-600","data-testid":"text-total-in",children:[s.filter(t=>t.type==="in").reduce((t,a)=>t+a.quantity,0)," ",s[0]?.unit]})})]}),e.jsxs(n,{"data-testid":"card-total-out",children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm text-secondary-foreground",children:"Total Stock Out"})}),e.jsx(d,{children:e.jsxs("p",{className:"text-2xl font-bold text-red-600","data-testid":"text-total-out",children:[s.filter(t=>t.type==="out").reduce((t,a)=>t+a.quantity,0)," ",s[0]?.unit]})})]}),e.jsxs(n,{"data-testid":"card-total-cost",children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm text-secondary-foreground",children:"Total Cost"})}),e.jsx(d,{children:e.jsxs("p",{className:"text-2xl font-bold","data-testid":"text-total-cost",children:[s.reduce((t,a)=>t+a.quantity*(a.unitCost||0),0).toFixed(2)," ","SAR"]})})]})]})]})}export{U as default};
