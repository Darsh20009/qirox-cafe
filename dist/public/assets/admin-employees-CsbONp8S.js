import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as m}from"./vendor-react-Bzsngnqy.js";import{l as Q,c as Y,B as x,P as W,C as A,x as F,y as I,f as V,I as j,Y as X,V as Z,a0 as ee}from"./index-61RjstaY.js";import{a as se,b as y}from"./vendor-query-CX8ZYlKb.js";import{S as k,a as S,b as C,c as E,d as r}from"./select-BgcBxbEj.js";import{C as $}from"./chevron-down-BsuQiE4E.js";import{P as ae}from"./pen-DpqiHEKk.js";import"./vendor-utils-BKCsaWdX.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=Q("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);function me(){Y();const[b,D]=m.useState(""),[v,M]=m.useState("all"),[N,z]=m.useState("all"),[T,g]=m.useState(!1),[u,p]=m.useState(null),[d,f]=m.useState(new Set),[t,n]=m.useState({fullName:"",username:"",phone:"",jobTitle:"",role:"cashier",allowedPages:[],permissions:[]}),L=[{id:"pos",name:"نقاط البيع"},{id:"orders",name:"الطلبات"},{id:"inventory",name:"المخزون"},{id:"accounting",name:"المحاسبة"},{id:"settings",name:"الإعدادات"},{id:"delivery",name:"التوصيل"},{id:"reports",name:"التقارير"}],O=[{id:"void_order",name:"إلغاء الطلبات"},{id:"give_discount",name:"منح خصومات"},{id:"open_drawer",name:"فتح درج النقود"},{id:"edit_inventory",name:"تعديل المخزون"},{id:"view_reports",name:"عرض التقارير المالية"}],{data:R=[],refetch:w}=se({queryKey:["/api/employees"],queryFn:async()=>{const s=await fetch("/api/employees");if(!s.ok)throw new Error("Failed to fetch employees");return s.json()}}),_=y({mutationFn:async s=>{const a=await fetch("/api/employees",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create employee");return a.json()},onSuccess:()=>{w(),g(!1),n({fullName:"",username:"",phone:"",jobTitle:"",role:"cashier",allowedPages:[],permissions:[]})}}),B=y({mutationFn:async({id:s,data:a})=>{const l=await fetch(`/api/employees/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error("Failed to update employee");return l.json()},onSuccess:()=>{w(),p(null),n({fullName:"",username:"",phone:"",jobTitle:"",role:"cashier",allowedPages:[],permissions:[]})}}),P=y({mutationFn:async s=>{const a=await fetch(`/api/employees/${s}`,{method:"DELETE"});if(!a.ok)throw new Error("Failed to delete employee");return a.json()},onSuccess:()=>w()}),H=s=>{s.preventDefault(),u?B.mutate({id:u,data:t}):_.mutate(t)},i=R.filter(s=>{const a=s.fullName.includes(b)||s.phone.includes(b)||s.username.includes(b),l=v==="all"||s.role===v,c=N==="all"||(N==="active"?s.isActivated===1:s.isActivated===0);return a&&l&&c}),q=s=>{f(s?new Set(i.map(a=>a.id)):new Set)},J=s=>{const a=new Set(d);a.has(s)?a.delete(s):a.add(s),f(a)},U=async()=>{if(window.confirm(`هل تريد حذف ${d.size} موظف؟`)){for(const s of d)await P.mutateAsync(s);f(new Set)}},G=()=>{const s=["الاسم","رقم الهاتف","المسمى الوظيفي","الدور","الحالة"],a=i.map(h=>[h.fullName,h.phone,h.jobTitle,h.role,h.isActivated===1?"نشط":"معطل"]);let l=s.join(",")+`
`;a.forEach(h=>{l+=h.map(K=>`"${K}"`).join(",")+`
`});const c=new Blob([l],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(c),o.download=`employees-${new Date().toISOString().split("T")[0]}.csv`,o.click()};return e.jsxs("div",{className:"p-6 space-y-6 bg-white dark:bg-background min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة الموظفين"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إدارة بيانات الموظفين والأدوار والصلاحيات"})]}),e.jsxs(x,{onClick:()=>{g(!T),p(null),n({fullName:"",username:"",phone:"",jobTitle:"",role:"cashier",allowedPages:[],permissions:[]})},className:"bg-accent hover:bg-accent","data-testid":"button-add-employee",children:[e.jsx(W,{className:"w-4 h-4 ml-2"}),"إضافة موظف"]})]}),(T||u)&&e.jsxs(A,{className:"border-orange-200 dark:border-orange-900/30 bg-background dark:bg-accent/10",children:[e.jsx(F,{className:"pb-4",children:e.jsx(I,{children:u?"تعديل الموظف":"إضافة موظف جديد"})}),e.jsx(V,{children:e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"الاسم الكامل"}),e.jsx(j,{placeholder:"أحمد محمد",value:t.fullName,onChange:s=>n({...t,fullName:s.target.value}),"data-testid":"input-fullname"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"اسم المستخدم"}),e.jsx(j,{placeholder:"ahmed123",value:t.username,onChange:s=>n({...t,username:s.target.value}),"data-testid":"input-username"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"رقم الهاتف"}),e.jsx(j,{placeholder:"0501234567",value:t.phone,onChange:s=>n({...t,phone:s.target.value}),"data-testid":"input-phone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"المسمى الوظيفي"}),e.jsx(j,{placeholder:"كاشير",value:t.jobTitle,onChange:s=>n({...t,jobTitle:s.target.value}),"data-testid":"input-jobtitle"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"الدور"}),e.jsxs(k,{value:t.role,onValueChange:s=>n({...t,role:s}),children:[e.jsx(S,{"data-testid":"select-role",children:e.jsx(C,{})}),e.jsxs(E,{children:[e.jsx(r,{value:"cashier",children:"كاشير"}),e.jsx(r,{value:"barista",children:"باريستا"}),e.jsx(r,{value:"manager",children:"مدير"}),e.jsx(r,{value:"admin",children:"مسؤول"}),e.jsx(r,{value:"driver",children:"سائق"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-muted/30 rounded-lg border border-border",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"الصفحات المسموحة"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:L.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-background rounded cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:t.allowedPages?.includes(s.id),onChange:a=>{const l=t.allowedPages||[],c=a.target.checked?[...l,s.id]:l.filter(o=>o!==s.id);n({...t,allowedPages:c})},className:"w-4 h-4 rounded border-gray-300 text-accent focus:ring-accent"}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"صلاحيات خاصة"]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:O.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-background rounded cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:t.permissions?.includes(s.id),onChange:a=>{const l=t.permissions||[],c=a.target.checked?[...l,s.id]:l.filter(o=>o!==s.id);n({...t,permissions:c})},className:"w-4 h-4 rounded border-gray-300 text-accent focus:ring-accent"}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(x,{type:"submit",className:"bg-accent hover:bg-accent","data-testid":"button-save-employee",children:u?"تحديث":"إضافة"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>{g(!1),p(null)},"data-testid":"button-cancel",children:"إلغاء"})]})]})})]}),d.size>0&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d.size," موظف مختار"]}),e.jsxs(x,{variant:"destructive",size:"sm",onClick:U,"data-testid":"button-bulk-delete",children:[e.jsx(te,{className:"w-4 h-4 ml-2"}),"حذف المختارين"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(X,{className:"absolute right-3 top-2.5 w-4 h-4 text-muted-foreground"}),e.jsx(j,{placeholder:"ابحث برقم الهاتف أو الاسم...",value:b,onChange:s=>D(s.target.value),className:"pl-4","data-testid":"input-search"})]}),e.jsxs(k,{value:v,onValueChange:M,children:[e.jsx(S,{className:"w-40","data-testid":"select-role-filter",children:e.jsx(C,{})}),e.jsxs(E,{children:[e.jsx(r,{value:"all",children:"جميع الأدوار"}),e.jsx(r,{value:"cashier",children:"كاشير"}),e.jsx(r,{value:"barista",children:"باريستا"}),e.jsx(r,{value:"manager",children:"مدير"}),e.jsx(r,{value:"driver",children:"سائق"})]})]}),e.jsxs(k,{value:N,onValueChange:z,children:[e.jsx(S,{className:"w-40","data-testid":"select-status-filter",children:e.jsx(C,{})}),e.jsxs(E,{children:[e.jsx(r,{value:"all",children:"جميع الحالات"}),e.jsx(r,{value:"active",children:"نشط"}),e.jsx(r,{value:"inactive",children:"معطل"})]})]}),e.jsxs(x,{variant:"outline",onClick:G,"data-testid":"button-export-csv",children:[e.jsx(Z,{className:"w-4 h-4 ml-2"}),"تصدير"]})]}),e.jsxs(A,{className:"border-0 bg-white dark:bg-card",children:[e.jsx(F,{className:"pb-4",children:e.jsxs(I,{className:"text-lg",children:["الموظفون (",i.length,")"]})}),e.jsx(V,{children:i.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-orange-200 dark:border-orange-900/30",children:[e.jsx("th",{className:"text-right p-4 font-semibold w-8",children:e.jsx("input",{type:"checkbox",checked:d.size===i.length&&i.length>0,onChange:s=>q(s.target.checked),className:"w-4 h-4","data-testid":"checkbox-select-all"})}),e.jsx("th",{className:"text-right p-4 font-semibold",children:"الاسم"}),e.jsx("th",{className:"text-right p-4 font-semibold",children:"رقم الهاتف"}),e.jsx("th",{className:"text-right p-4 font-semibold",children:"المسمى الوظيفي"}),e.jsx("th",{className:"text-right p-4 font-semibold",children:"الدور"}),e.jsx("th",{className:"text-right p-4 font-semibold",children:"الحالة"}),e.jsx("th",{className:"text-right p-4 font-semibold",children:"الإجراءات"})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:d.has(s.id),onChange:()=>J(s.id),className:"w-4 h-4","data-testid":`checkbox-employee-${s.id}`})}),e.jsx("td",{className:"p-4 font-medium",children:s.fullName}),e.jsx("td",{className:"p-4 text-muted-foreground",children:s.phone}),e.jsx("td",{className:"p-4 text-muted-foreground",children:s.jobTitle}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",children:s.role==="cashier"?"كاشير":s.role==="barista"?"باريستا":s.role==="manager"?"مدير":s.role==="driver"?"سائق":s.role})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.isActivated===1?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}`,children:s.isActivated===1?"نشط":"معطل"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{p(s.id),n({fullName:s.fullName,username:s.username,phone:s.phone,jobTitle:s.jobTitle,role:s.role,allowedPages:s.allowedPages||[],permissions:s.permissions||[]}),g(!1)},"data-testid":`button-edit-${s.id}`,children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:()=>P.mutate(s.id),"data-testid":`button-delete-${s.id}`,children:e.jsx(ee,{className:"w-4 h-4"})})]})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"لا توجد موظفون"}),e.jsx("p",{className:"text-muted-foreground",children:"ابدأ بإضافة موظف جديد"})]})})]})]})}export{me as default};
