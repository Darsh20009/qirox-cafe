import{j as e}from"./vendor-ui-DJm-zmnP.js";import{a as f}from"./vendor-query-CX8ZYlKb.js";import{u as D,a as O,c as R,d as U,e as Q,C as G,f as H,B as o,A as I,g as J,h as b,i as V,j as x,k as W,M as X,P as F}from"./index-61RjstaY.js";import{r as p}from"./vendor-react-Bzsngnqy.js";import"./vendor-utils-BKCsaWdX.js";function re(){const{t:s,i18n:i}=D(),[,l]=O("/product/:id"),[,y]=R(),{addToCart:$}=U(),[d,j]=p.useState(1),[g,P]=p.useState(null),[m,q]=p.useState([]);p.useState([]),p.useState(!1);const{toast:E}=Q(),{data:t,isLoading:z,refetch:Y}=f({queryKey:["/api/coffee-items",l?.id],queryFn:async()=>{const a=await fetch(`/api/coffee-items/${l?.id}`);if(!a.ok){if(a.status===404)return null;throw new Error("Failed to fetch product")}return a.json()},enabled:!!l?.id,staleTime:0,gcTime:0}),{data:B=[]}=f({queryKey:["/api/coffee-items",l?.id,"ingredients"],queryFn:async()=>{const a=await fetch(`/api/coffee-items/${l?.id}/ingredients`);return a.ok?a.json():[]},enabled:!!l?.id}),{data:v=[]}=f({queryKey:["/api/coffee-items",l?.id,"addons"],queryFn:async()=>{const a=await fetch(`/api/coffee-items/${l?.id}/addons`);return a.ok?a.json():[]},enabled:!!l?.id});f({queryKey:["/api/branches"]});const N=B.map(a=>a.ingredient).filter(Boolean),T=()=>{t&&($(t.id,d,g,m),E({title:s("cart.added"),description:s("cart.added_desc")}),y("/menu"))},S=()=>{y("/menu")},L=()=>{if(!t)return 0;let a=typeof t.price=="number"?t.price:parseFloat(String(t.price||0));if(g&&t.availableSizes){const r=t.availableSizes.find(c=>c.nameAr===g);r&&(a=typeof r.price=="number"?r.price:parseFloat(String(r.price||0)))}let n=0;return m.forEach(r=>{const c=v.find(h=>h.id===r);if(c){const h=typeof c.price=="number"?c.price:parseFloat(String(c.price||0));n+=h}}),a+n},M=a=>{q(n=>n.includes(a)?n.filter(r=>r!==a):[...n,a])};if(z)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:s("product.loading")})]})});if(!t)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(G,{className:"max-w-md w-full mx-4",children:e.jsxs(H,{className:"pt-6 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:s("product.not_found")}),e.jsx(o,{onClick:S,variant:"outline",children:s("product.back")})]})})});const u=typeof t.oldPrice=="number"?t.oldPrice:parseFloat(String(t.oldPrice||0)),w=typeof t.price=="number"?t.price:parseFloat(String(t.price||0)),k=u>0?Math.round((u-w)/u*100):0,_=L(),K=_*d,A=i.language==="ar"?t.nameAr:t.nameEn||t.nameAr,C=v.reduce((a,n)=>{const r=i.language==="ar"?n.category||"أخرى":n.categoryEn||n.category||"Other";return a[r]||(a[r]=[]),a[r].push(n),a},{});return e.jsx("div",{className:"min-h-screen bg-background","data-testid":"page-product-details",dir:i.language==="ar"?"rtl":"ltr",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs(o,{onClick:S,variant:"ghost",className:"mb-6 hover-elevate","data-testid":"button-back",children:[i.language==="ar"?e.jsx(I,{className:"w-4 h-4 ml-2"}):e.jsx(J,{className:"w-4 h-4 mr-2"}),s("product.back")]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"relative","data-testid":"section-product-image",children:[t.imageUrl||b(t.id)?e.jsx("img",{src:t.imageUrl||b(t.id),alt:A,className:"w-full h-64 sm:h-80 md:h-96 object-cover rounded-2xl shadow-lg","data-testid":"img-product"}):null,e.jsxs("div",{"data-testid":"image-placeholder",className:`w-full h-96 rounded-2xl shadow-lg flex flex-col items-center justify-center gap-4 bg-gradient-to-br from-primary/10 to-primary/5 dark:from-primary/20 dark:to-primary/10 ${t.imageUrl||b(t.id)?"hidden":""}`,children:[e.jsx(V,{className:"w-20 h-20 text-primary/40"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:i.language==="ar"?"صورة المشروب":"Product Image"})]}),e.jsxs("div",{className:`flex gap-2 flex-wrap absolute top-4 ${i.language==="ar"?"left-4":"right-4"}`,children:[u>0&&e.jsxs(x,{className:"bg-red-500 text-white","data-testid":"badge-discount",children:[s("product.discount")," ",k,"%"]}),t.availabilityStatus&&t.availabilityStatus!=="available"&&e.jsxs(x,{className:t.availabilityStatus==="out_of_stock"?"bg-red-500":t.availabilityStatus==="coming_soon"?"bg-blue-500":"bg-background0","data-testid":"badge-availability",children:[t.availabilityStatus==="out_of_stock"&&s("product.out_of_stock"),t.availabilityStatus==="coming_soon"&&s("product.coming_soon"),t.availabilityStatus==="temporarily_unavailable"&&`⏸ ${s("product.temporarily_unavailable")}`]})]})]}),e.jsxs("div",{className:"space-y-6","data-testid":"section-product-info",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-amiri text-4xl font-bold text-foreground mb-2","data-testid":"text-product-name",children:A}),i.language==="ar"&&t.nameEn&&e.jsx("p",{className:"text-lg text-muted-foreground","data-testid":"text-product-name-en",children:t.nameEn}),i.language==="en"&&t.nameAr&&e.jsx("p",{className:"text-lg text-muted-foreground font-amiri","data-testid":"text-product-name-ar",children:t.nameAr})]}),e.jsx("p",{className:"text-lg text-muted-foreground leading-relaxed","data-testid":"text-product-description",children:i.language==="ar"?t.description:t.descriptionEn||t.description}),e.jsxs(x,{variant:"outline",className:"w-fit","data-testid":"badge-category",children:[t.category==="basic"&&(i.language==="ar"?"قهوة أساسية":"Basic Coffee"),t.category==="hot"&&(i.language==="ar"?"قهوة ساخنة":"Hot Coffee"),t.category==="cold"&&(i.language==="ar"?"قهوة باردة":"Cold Coffee")]}),N.length>0&&e.jsxs("div",{className:"space-y-3","data-testid":"section-ingredients",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s("product.ingredients")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map((a,n)=>e.jsxs(x,{variant:"secondary",className:`${a.isAvailable===0?"opacity-50 line-through":""}`,"data-testid":`badge-ingredient-${a.id||n}`,children:[i.language==="ar"?a.nameAr:a.nameEn||a.nameAr,a.isAvailable===0&&` (${s("product.not_available")})`]},a.id||n))})]}),e.jsxs("div",{className:"space-y-3","data-testid":"section-sizes",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s("product.size")}),t.availableSizes&&t.availableSizes.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:t.availableSizes.map((a,n)=>{const r=i.language==="ar"?a.nameAr:a.nameEn||a.nameAr;return e.jsxs(o,{variant:g===a.nameAr?"default":"outline",onClick:()=>P(a.nameAr),className:"text-sm h-11 sm:h-10 justify-between px-4","data-testid":`button-size-${a.nameAr}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r}),a.sizeML&&e.jsxs("span",{className:"text-[10px] opacity-70",children:["(",a.sizeML," ",i.language==="ar"?"مل":"ml",")"]})]}),a.price!==t.price&&e.jsxs("span",{className:"text-xs font-bold",children:["+",(a.price-(typeof t.price=="number"?t.price:parseFloat(String(t.price||0)))).toFixed(2)," ",s("currency")]})]},n)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:s("product.single_size")})]}),e.jsxs("div",{className:"space-y-4","data-testid":"section-addons",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s("product.addons")}),Object.keys(C).length>0?Object.entries(C).map(([a,n])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a}),e.jsx("div",{className:"space-y-2",children:n.map(r=>e.jsxs("button",{onClick:()=>M(r.id),className:`w-full flex items-center gap-3 p-3 rounded-lg border transition-colors ${m.includes(r.id)?"bg-primary text-primary-foreground border-primary":"bg-background border-border hover:border-primary hover:bg-muted"}`,"data-testid":`button-addon-${r.id}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center ${m.includes(r.id)?"bg-primary-foreground":"border-border"}`,children:m.includes(r.id)&&e.jsx(W,{className:"w-3 h-3 text-primary"})}),e.jsx("div",{className:`flex-1 ${i.language==="ar"?"text-right":"text-left"}`,children:e.jsx("p",{className:"font-medium",children:i.language==="ar"?r.nameAr:r.nameEn||r.nameAr})}),r.price>0&&e.jsxs("span",{className:"text-sm font-medium",children:["+",r.price.toFixed(2)," ",s("currency")]}),r.isFree&&r.price===0&&e.jsx(x,{variant:"secondary",className:"text-xs",children:s("product.free")})]},r.id))})]},a)):e.jsx("p",{className:"text-sm text-muted-foreground",children:s("product.no_addons")})]}),e.jsxs("div",{className:"space-y-2","data-testid":"section-pricing",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.oldPrice&&e.jsxs("span",{className:"price-old text-lg line-through","data-testid":"text-old-price",children:[t.oldPrice," ",s("currency")]}),e.jsxs("span",{className:"text-3xl font-bold text-primary","data-testid":"text-current-price",children:[_.toFixed(2)," ",s("currency")]})]}),k>0&&e.jsxs("p",{className:"text-sm text-green-600","data-testid":"text-savings",children:[i.language==="ar"?"توفير":"Savings"," ",(u-w).toFixed(2)," ",s("currency")]})]}),e.jsxs("div",{className:"space-y-3","data-testid":"section-quantity",children:[e.jsx("label",{className:"text-sm font-semibold text-foreground",children:s("product.quantity")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{variant:"outline",size:"icon",onClick:()=>j(Math.max(1,d-1)),disabled:d<=1,"data-testid":"button-decrease-quantity",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-xl font-semibold w-12 text-center","data-testid":"text-quantity",children:d}),e.jsx(o,{variant:"outline",size:"icon",onClick:()=>j(d+1),disabled:t.isAvailable===0||t.availabilityStatus!==void 0&&t.availabilityStatus!=="available","data-testid":"button-increase-quantity",children:e.jsx(F,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"bg-card rounded-xl p-4 border","data-testid":"section-total",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-semibold text-foreground",children:[s("product.total"),":"]}),e.jsxs("span",{className:"text-2xl font-bold text-primary","data-testid":"text-total-price",children:[K.toFixed(2)," ",s("currency")]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-background/80 backdrop-blur-lg border-t z-50 lg:relative lg:p-0 lg:bg-transparent lg:border-0",children:e.jsxs(o,{onClick:T,size:"lg",disabled:t.isAvailable===0||t.availabilityStatus!==void 0&&t.availabilityStatus!=="available",className:"w-full btn-primary text-accent-foreground py-6 sm:py-7 text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-xl lg:shadow-none","data-testid":"button-add-to-cart",children:[e.jsx(F,{className:`w-5 h-5 ${i.language==="ar"?"ml-2":"mr-2"}`}),t.availabilityStatus==="out_of_stock"?s("product.out_of_stock"):t.availabilityStatus==="coming_soon"?s("product.coming_soon"):t.availabilityStatus==="temporarily_unavailable"?`⏸ ${s("product.temporarily_unavailable")}`:s("product.add_to_cart")]})}),e.jsx("div",{className:"h-20 lg:hidden"})]})]})]})})}export{re as default};
