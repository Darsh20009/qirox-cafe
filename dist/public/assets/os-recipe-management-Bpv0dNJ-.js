import{j as e}from"./vendor-ui-DJm-zmnP.js";import{a as h,b as E}from"./vendor-query-CX8ZYlKb.js";import{r as p}from"./vendor-react-Bzsngnqy.js";import{e as F,C as g,x as f,y as C,W as y,f as N,B as u,P as H,I as K,a0 as M,q as O,ap as V,v as z}from"./index-61RjstaY.js";import{S as b,a as v,b as I,c as S,d as T}from"./select-BgcBxbEj.js";import{T as A,a as D,b as w,c as l,d as G,e as d}from"./table-B7L5kFC6.js";import{B as L}from"./beaker-BbpVPEX-.js";import{C as Q}from"./calculator-CQwEPkXh.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-BsuQiE4E.js";function te(){const{toast:q}=F(),[r,R]=p.useState(""),[n,o]=p.useState([]),{data:P}=h({queryKey:["/api/coffee-items"]}),{data:x}=h({queryKey:["/api/ingredients"]});h({queryKey:["/api/recipes/product",r],enabled:!!r});const m=E({mutationFn:async s=>(await z("POST","/api/recipes",s)).json(),onSuccess:()=>{q({title:"تم حفظ الوصفة",description:"تم تحديث وصفة المنتج وتكلفته"})}}),k=()=>{o([...n,{ingredientId:"",quantity:0,unit:"g"}])},B=s=>{o(n.filter((a,i)=>i!==s))},j=()=>n.reduce((s,a)=>{const i=x?.find(t=>t.id===a.ingredientId);return s+(i?i.unitCost*a.quantity:0)},0);return e.jsxs("div",{className:"p-6 space-y-6 bg-background min-h-screen text-right",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"هندسة الوصفات (Recipe Engine)"}),e.jsx(L,{className:"w-8 h-8 text-primary"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(g,{className:"md:col-span-1",children:[e.jsxs(f,{children:[e.jsx(C,{children:"اختر المنتج"}),e.jsx(y,{children:"اختر المشروب لإدارة مكوناته"})]}),e.jsx(N,{children:e.jsxs(b,{onValueChange:R,value:r,children:[e.jsx(v,{children:e.jsx(I,{placeholder:"اختر المنتج"})}),e.jsx(S,{children:P?.map(s=>e.jsx(T,{value:s.id,children:s.nameAr},s.id))})]})})]}),e.jsxs(g,{className:"md:col-span-3",children:[e.jsxs(f,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{children:"مكونات الوصفة"}),e.jsx(y,{children:"حدد كميات المواد الخام لكل كوب"})]}),r&&e.jsxs(u,{onClick:k,variant:"outline",size:"sm",children:[e.jsx(H,{className:"ml-2 w-4 h-4"})," إضافة مكون"]})]}),e.jsx(N,{children:r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(A,{children:[e.jsx(D,{children:e.jsxs(w,{children:[e.jsx(l,{className:"text-right",children:"المادة الخام"}),e.jsx(l,{className:"text-right",children:"الكمية"}),e.jsx(l,{className:"text-right",children:"الوحدة"}),e.jsx(l,{className:"text-right",children:"التكلفة المتوقعة"}),e.jsx(l,{})]})}),e.jsx(G,{children:n.map((s,a)=>{const i=x?.find(t=>t.id===s.ingredientId);return e.jsxs(w,{children:[e.jsx(d,{children:e.jsxs(b,{onValueChange:t=>{const c=[...n];c[a].ingredientId=t,o(c)},value:s.ingredientId,children:[e.jsx(v,{children:e.jsx(I,{placeholder:"اختر مادة"})}),e.jsx(S,{children:x?.map(t=>e.jsx(T,{value:t.id,children:t.nameAr},t.id))})]})}),e.jsx(d,{children:e.jsx(K,{type:"number",value:s.quantity,onChange:t=>{const c=[...n];c[a].quantity=Number(t.target.value),o(c)}})}),e.jsx(d,{children:i?.unit||"---"}),e.jsxs(d,{children:[(i?i.unitCost*s.quantity:0).toFixed(2)," ريال"]}),e.jsx(d,{children:e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>B(a),children:e.jsx(M,{className:"w-4 h-4 text-destructive"})})})]},a)})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-lg",children:[e.jsx(Q,{className:"w-5 h-5"}),"إجمالي التكلفة (COGS): ",j().toFixed(2)," ريال"]}),e.jsxs(u,{onClick:()=>m.mutate({productId:r,ingredients:n,totalCost:j()}),disabled:m.isPending||n.length===0,children:[m.isPending?e.jsx(O,{className:"animate-spin"}):e.jsx(V,{className:"ml-2 w-4 h-4"}),"حفظ الوصفة"]})]})]}):e.jsx("div",{className:"text-center p-12 text-muted-foreground italic",children:"الرجاء اختيار منتج للبدء"})})]})]})]})}export{te as default};
