import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as g}from"./vendor-react-Bzsngnqy.js";import{a as v}from"./vendor-query-CX8ZYlKb.js";import{q as F,B as K,N as V,C as n,x as i,y as o,f as c,ag as $,a0 as D,Y as E,I as _,j as O}from"./index-61RjstaY.js";import{S as C,a as T,b as k,c as S,d as x}from"./select-BgcBxbEj.js";import{T as P,a as U,b as f,c as r,d as Y,e as a}from"./table-B7L5kFC6.js";import{H as b}from"./history-BiYVo1q8.js";import{R as z}from"./refresh-cw-DWvJTizr.js";import{A as m}from"./arrow-up-DN6yfCj7.js";import{A as N}from"./arrow-down-CKWU1L6C.js";import{A as G}from"./arrow-right-left-BG1RSmdA.js";import{f as J}from"./vendor-utils-BKCsaWdX.js";import{a as W}from"./ar-CeWsqWSX.js";import"./chevron-down-BsuQiE4E.js";const d={purchase:{label:"شراء",icon:m,color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",direction:"in"},sale:{label:"بيع",icon:N,color:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",direction:"out"},transfer_in:{label:"تحويل وارد",icon:m,color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",direction:"in"},transfer_out:{label:"تحويل صادر",icon:N,color:"bg-accent text-accent dark:bg-accent dark:text-accent",direction:"out"},adjustment:{label:"تعديل",icon:G,color:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",direction:"neutral"},waste:{label:"تالف",icon:N,color:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",direction:"out"},return:{label:"إرجاع",icon:m,color:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",direction:"in"}},X={kg:"كيلوجرام",g:"جرام",liter:"لتر",ml:"ملليلتر",piece:"قطعة",box:"صندوق",bag:"كيس"};function he(){const[h,I]=g.useState(""),[u,A]=g.useState("all"),[j,L]=g.useState("all"),{data:l=[],isLoading:M}=v({queryKey:["/api/inventory/movements"]}),{data:y=[]}=v({queryKey:["/api/branches"]}),B=s=>y.find(t=>t.id===s)?.nameAr||s,w=l.filter(s=>{const t=(s.rawItem?.nameAr?.toLowerCase().includes(h.toLowerCase())??!1)||(s.rawItem?.code?.toLowerCase().includes(h.toLowerCase())??!1),p=u==="all"||s.branchId===u,R=j==="all"||s.movementType===j;return t&&p&&R}),H=l.filter(s=>d[s.movementType]?.direction==="in").length;l.filter(s=>d[s.movementType]?.direction==="out").length;const q=l.filter(s=>s.movementType==="sale").length,Q=l.filter(s=>s.movementType==="waste").length;return M?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"حركات المخزون"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"سجل جميع حركات المخزون (شراء، بيع، تحويل، تعديل)"})]})]}),e.jsxs(K,{variant:"outline",onClick:()=>V.invalidateQueries({queryKey:["/api/inventory/movements"]}),"data-testid":"button-refresh",children:[e.jsx(z,{className:"h-4 w-4 ml-2"}),"تحديث"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"إجمالي الحركات"}),e.jsx(b,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"حركة مخزون"})]})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"حركات واردة"}),e.jsx(m,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:H}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"شراء وتحويل وارد"})]})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"مبيعات"}),e.jsx($,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:q}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"خصم من الطلبات"})]})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"هدر/تالف"}),e.jsx(D,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:Q}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"مواد تالفة"})]})]})]}),e.jsxs(n,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(E,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:"بحث بالمادة...",value:h,onChange:s=>I(s.target.value),className:"pr-10","data-testid":"input-search-movements"})]}),e.jsxs(C,{value:u,onValueChange:A,children:[e.jsx(T,{className:"w-[180px]","data-testid":"select-branch-filter",children:e.jsx(k,{placeholder:"الفرع"})}),e.jsxs(S,{children:[e.jsx(x,{value:"all",children:"جميع الفروع"}),y.map(s=>e.jsx(x,{value:s.id,children:s.nameAr},s.id))]})]}),e.jsxs(C,{value:j,onValueChange:L,children:[e.jsx(T,{className:"w-[180px]","data-testid":"select-type-filter",children:e.jsx(k,{placeholder:"نوع الحركة"})}),e.jsxs(S,{children:[e.jsx(x,{value:"all",children:"جميع الأنواع"}),Object.entries(d).map(([s,{label:t}])=>e.jsx(x,{value:s,children:t},s))]})]})]})}),e.jsx(c,{children:e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(P,{children:[e.jsx(U,{children:e.jsxs(f,{className:"bg-muted/50",children:[e.jsx(r,{className:"text-right",children:"التاريخ"}),e.jsx(r,{className:"text-right",children:"النوع"}),e.jsx(r,{className:"text-right",children:"المادة"}),e.jsx(r,{className:"text-right",children:"الفرع"}),e.jsx(r,{className:"text-right",children:"الكمية"}),e.jsx(r,{className:"text-right",children:"قبل"}),e.jsx(r,{className:"text-right",children:"بعد"}),e.jsx(r,{className:"text-right",children:"ملاحظات"})]})}),e.jsx(Y,{children:w.length===0?e.jsx(f,{children:e.jsxs(a,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد حركات مخزون"})]})}):w.map(s=>{const t=d[s.movementType]||d.adjustment,p=t.icon;return e.jsxs(f,{"data-testid":`row-movement-${s.id}`,children:[e.jsx(a,{className:"text-muted-foreground",children:J(new Date(s.createdAt),"dd/MM/yyyy HH:mm",{locale:W})}),e.jsx(a,{children:e.jsxs(O,{className:`${t.color} flex items-center gap-1 w-fit`,children:[e.jsx(p,{className:"h-3 w-3"}),t.label]})}),e.jsx(a,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.rawItem?.nameAr}),e.jsx("div",{className:"text-sm text-muted-foreground font-mono",children:s.rawItem?.code})]})}),e.jsx(a,{children:s.branch?.nameAr||B(s.branchId)}),e.jsxs(a,{children:[e.jsxs("span",{className:`font-medium ${t.direction==="in"?"text-green-600":t.direction==="out"?"text-red-600":""}`,children:[t.direction==="in"?"+":t.direction==="out"?"-":"",s.quantity]}),e.jsx("span",{className:"text-muted-foreground mr-1",children:X[s.rawItem?.unit||""]||s.rawItem?.unit})]}),e.jsx(a,{className:"text-muted-foreground",children:s.previousQuantity}),e.jsx(a,{className:"font-medium",children:s.newQuantity}),e.jsx(a,{className:"text-muted-foreground max-w-[200px] truncate",children:s.notes||"-"})]},s.id)})})]})})})]})]})}export{he as default};
