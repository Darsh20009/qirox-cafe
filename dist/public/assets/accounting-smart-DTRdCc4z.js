import{t as ve,j as e,O as ie,q as ce,r as we,T as oe,s as xe,w as ke}from"./vendor-ui-DJm-zmnP.js";import{r as x}from"./vendor-react-Bzsngnqy.js";import{a as u,b as Ce}from"./vendor-query-CX8ZYlKb.js";import{m as y,a1 as Se,n as Te,e as Pe,q as k,B as L,P as se,C as d,f as n,Z as B,j as h,aa as Fe,ab as Re,ac as q,ai as M,x as f,y as g,a0 as De,D as Oe,E as Ae,F as Ee,H as Ke,L as C,I as V,K as $e,i as Le,v as Be,N as qe}from"./index-CLvpp2UE.js";import{S as H,a as I,b as G,c as W,d as S}from"./select-BzAjeBJu.js";import{S as Me}from"./scroll-area-DK2Y4dAh.js";import{C as T}from"./chart-column-CfkHrk5y.js";import{C as ae}from"./calendar-MKHPq1ii.js";import{E as X}from"./eye-cZNGFzyE.js";import{a as Ve,A as He}from"./arrow-up-right-3GAflgIx.js";import{T as _}from"./trending-up-BzxeYQ4e.js";import{P as Ie}from"./package-B_dGuXgn.js";import{L as Ge}from"./layers-C7KZUnhu.js";import{T as We}from"./target-Dt49oDVe.js";import{D as Xe}from"./dollar-sign-CFWcU9O3.js";import{R as _e}from"./receipt-7jFYni-X.js";import{R as b,C as z,X as Q,Y as U,T as N,L as Y,B as ze,N as P,a as te}from"./BarChart-C-BXurcz.js";import{A as Qe,a as re}from"./AreaChart-EwIn2y1e.js";import{L as Ue,a as le}from"./LineChart-BOzbQhgh.js";import{P as de,a as ne}from"./PieChart-CcImm4lT.js";import{f as F}from"./vendor-utils-BKCsaWdX.js";import{a as R}from"./ar-CeWsqWSX.js";import"./chevron-down-CqdH-ack.js";const Ye=ve,Ze=ke,me=x.forwardRef(({className:i,...r},o)=>e.jsx(ie,{className:y("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...r,ref:o}));me.displayName=ie.displayName;const Je=Te("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),he=x.forwardRef(({side:i="right",className:r,children:o,...m},O)=>e.jsxs(Ze,{children:[e.jsx(me,{}),e.jsxs(ce,{ref:O,className:y(Je({side:i}),r),...m,children:[o,e.jsxs(we,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));he.displayName=ce.displayName;const pe=({className:i,...r})=>e.jsx("div",{className:y("flex flex-col space-y-2 text-center sm:text-left",i),...r});pe.displayName="SheetHeader";const je=x.forwardRef(({className:i,...r},o)=>e.jsx(oe,{ref:o,className:y("text-lg font-semibold text-foreground",i),...r}));je.displayName=oe.displayName;const es=x.forwardRef(({className:i,...r},o)=>e.jsx(xe,{ref:o,className:y("text-sm text-muted-foreground",i),...r}));es.displayName=xe.displayName;const D=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#ef4444","#ec4899"],ss=[{value:"today",label:"اليوم"},{value:"week",label:"هذا الأسبوع"},{value:"month",label:"هذا الشهر"},{value:"last30",label:"آخر 30 يوم"}],Z=[{value:"inventory",label:"المخزون والمواد الخام"},{value:"salaries",label:"الرواتب والأجور"},{value:"rent",label:"الإيجار"},{value:"utilities",label:"المرافق"},{value:"marketing",label:"التسويق"},{value:"maintenance",label:"الصيانة"},{value:"other",label:"أخرى"}],as={cash:"نقدي",pos:"شبكة",online:"أونلاين",wallet:"محفظة"};function Ss(){const{toast:i}=Pe(),[r,o]=x.useState("today"),[m,O]=x.useState("all"),[ue,v]=x.useState(!1),[c,w]=x.useState(null),[l,p]=x.useState({category:"",description:"",amount:"",notes:""}),{data:j,isLoading:fe}=u({queryKey:["/api/accounting/dashboard",r,m]}),{data:ge=[]}=u({queryKey:["/api/branches"]});u({queryKey:["/api/orders",{limit:5}]});const{data:J=[],isLoading:be}=u({queryKey:[`/api/orders?period=${r}&branchId=${m}&limit=50`],enabled:c==="revenue"||c==="orders"}),{data:ee=[],isLoading:Ne}=u({queryKey:[`/api/accounting/expenses?period=${r}&branchId=${m}`],enabled:c==="expenses"}),A=Ce({mutationFn:async s=>Be("POST","/api/accounting/expenses",s),onSuccess:()=>{qe.invalidateQueries({queryKey:["/api/accounting/dashboard"]}),v(!1),p({category:"",description:"",amount:"",notes:""}),i({title:"تم إضافة المصروف بنجاح"})},onError:s=>{i({title:s.message||"فشل في إضافة المصروف",variant:"destructive"})}}),ye=()=>{const s=parseFloat(l.amount);if(!l.category||!l.description||isNaN(s)||s<=0){i({title:"يرجى ملء جميع الحقول",variant:"destructive"});return}A.mutate({branchId:m!=="all"?m:void 0,date:new Date().toISOString(),category:l.category,description:l.description,amount:s,totalAmount:s,notes:l.notes})},E=j?.revenueByPayment?Object.entries(j.revenueByPayment).map(([s,t])=>({name:as[s]||s,value:t})):[],K=j?.expensesByCategory?Object.entries(j.expensesByCategory).map(([s,t])=>({name:Z.find($=>$.value===s)?.label||s,value:t})):[];if(fe)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"h-16 w-16 text-accent animate-pulse mx-auto"}),e.jsx(k,{className:"h-8 w-8 animate-spin text-accent absolute -bottom-2 -right-2"})]}),e.jsx("p",{className:"text-muted-foreground mt-4 text-lg",children:"جاري تحميل البيانات المالية..."})]})});const a=j||{totalRevenue:0,totalVat:0,totalExpenses:0,totalCogs:0,grossProfit:0,netProfit:0,orderCount:0,invoiceCount:0,profitMargin:0,expensesByCategory:{},revenueByPayment:{},dailyTrend:[],weeklyTrend:[],monthlyTrend:[]};return e.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 rounded-2xl bg-gradient-to-br from-emerald-100 to-emerald-200 dark:from-emerald-900/50 dark:to-emerald-800/50 shadow-lg",children:e.jsx(T,{className:"h-10 w-10 text-emerald-700 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-l from-emerald-600 to-emerald-800 bg-clip-text text-transparent",children:"المحاسبة الذكية"}),e.jsx("p",{className:"text-muted-foreground",children:"تحليل مالي شامل ومتكامل"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(H,{value:r,onValueChange:o,children:[e.jsxs(I,{className:"w-[150px]","data-testid":"select-period",children:[e.jsx(ae,{className:"h-4 w-4 ml-2"}),e.jsx(G,{})]}),e.jsx(W,{children:ss.map(s=>e.jsx(S,{value:s.value,children:s.label},s.value))})]}),e.jsxs(H,{value:m,onValueChange:O,children:[e.jsx(I,{className:"w-[150px]","data-testid":"select-branch",children:e.jsx(G,{placeholder:"الفرع"})}),e.jsxs(W,{children:[e.jsx(S,{value:"all",children:"جميع الفروع"}),ge.map(s=>e.jsx(S,{value:s.id,children:s.nameAr},s.id))]})]}),e.jsxs(L,{onClick:()=>v(!0),variant:"outline","data-testid":"button-add-expense",children:[e.jsx(se,{className:"h-4 w-4 ml-2"}),"مصروف جديد"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(d,{className:"border-0 shadow-lg bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/30 dark:to-emerald-800/30 cursor-pointer hover-elevate",onClick:()=>w("revenue"),"data-testid":"card-revenue-drilldown",children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground mb-1 flex items-center gap-1",children:["إجمالي الإيرادات",e.jsx(X,{className:"h-3 w-3 opacity-50"})]}),e.jsxs("p",{className:"text-3xl font-bold text-emerald-700 dark:text-emerald-300","data-testid":"text-revenue",children:[a.totalRevenue.toFixed(0),e.jsx("span",{className:"text-lg mr-1",children:"ر.س"})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-emerald-600",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.orderCount," طلب"]})]})]}),e.jsx("div",{className:"p-3 rounded-full bg-emerald-200/50 dark:bg-emerald-700/30",children:e.jsx(_,{className:"h-8 w-8 text-emerald-600 dark:text-emerald-400"})})]})})}),e.jsx(d,{className:"border-0 shadow-lg bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/30 dark:to-amber-800/30 cursor-pointer hover-elevate",onClick:()=>w("orders"),"data-testid":"card-cogs-drilldown",children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground mb-1 flex items-center gap-1",children:["تكلفة المكونات (COGS)",e.jsx(X,{className:"h-3 w-3 opacity-50"})]}),e.jsxs("p",{className:"text-3xl font-bold text-accent dark:text-accent","data-testid":"text-cogs",children:[a.totalCogs.toFixed(0),e.jsx("span",{className:"text-lg mr-1",children:"ر.س"})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-accent",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{children:"خصم تلقائي من المخزون"})]})]}),e.jsx("div",{className:"p-3 rounded-full bg-primary/50 dark:bg-primary/30",children:e.jsx(Ge,{className:"h-8 w-8 text-accent dark:text-accent"})})]})})}),e.jsx(d,{className:"border-0 shadow-lg bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-800/30 cursor-pointer hover-elevate",onClick:()=>w("expenses"),"data-testid":"card-expenses-drilldown",children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground mb-1 flex items-center gap-1",children:["المصروفات",e.jsx(X,{className:"h-3 w-3 opacity-50"})]}),e.jsxs("p",{className:"text-3xl font-bold text-red-700 dark:text-red-300","data-testid":"text-expenses",children:[a.totalExpenses.toFixed(0),e.jsx("span",{className:"text-lg mr-1",children:"ر.س"})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-red-600",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{children:"مصروفات تشغيلية"})]})]}),e.jsx("div",{className:"p-3 rounded-full bg-red-200/50 dark:bg-red-700/30",children:e.jsx(B,{className:"h-8 w-8 text-red-600 dark:text-red-400"})})]})})}),e.jsx(d,{className:"border-0 shadow-lg bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30",children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"صافي الربح"}),e.jsxs("p",{className:`text-3xl font-bold ${a.netProfit>=0?"text-blue-700 dark:text-blue-300":"text-red-700 dark:text-red-300"}`,"data-testid":"text-net-profit",children:[a.netProfit.toFixed(0),e.jsx("span",{className:"text-lg mr-1",children:"ر.س"})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-blue-600",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsxs("span",{children:["هامش الربح: ",a.profitMargin.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"p-3 rounded-full bg-blue-200/50 dark:bg-blue-700/30",children:e.jsx(Xe,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})})]})})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(d,{className:"border-0 shadow-lg bg-gradient-to-br from-purple-50/50 to-purple-100/50 dark:from-purple-900/20 dark:to-purple-800/20",children:e.jsx(n,{className:"p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"الربح الإجمالي"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.grossProfit.toFixed(0)," ر.س"]})]}),e.jsx(h,{variant:"outline",className:"text-purple-600 border-purple-300",children:"الإيرادات - COGS"})]})})}),e.jsx(d,{className:"border-0 shadow-lg bg-gradient-to-br from-cyan-50/50 to-cyan-100/50 dark:from-cyan-900/20 dark:to-cyan-800/20",children:e.jsx(n,{className:"p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ضريبة القيمة المضافة"}),e.jsxs("p",{className:"text-2xl font-bold text-cyan-700 dark:text-cyan-300",children:[a.totalVat.toFixed(0)," ر.س"]})]}),e.jsx(h,{variant:"outline",className:"text-cyan-600 border-cyan-300",children:"15% VAT"})]})})}),e.jsx(d,{className:"border-0 shadow-lg bg-gradient-to-br from-pink-50/50 to-pink-100/50 dark:from-pink-900/20 dark:to-pink-800/20",children:e.jsx(n,{className:"p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"عدد الفواتير"}),e.jsx("p",{className:"text-2xl font-bold text-pink-700 dark:text-pink-300",children:a.invoiceCount})]}),e.jsxs(h,{variant:"outline",className:"text-pink-600 border-pink-300",children:[e.jsx(_e,{className:"h-3 w-3 ml-1"}),"فواتير"]})]})})})]}),e.jsxs(Fe,{defaultValue:"daily",className:"space-y-4",children:[e.jsxs(Re,{className:"bg-muted/50 p-1 rounded-xl",children:[e.jsx(q,{value:"daily",className:"rounded-lg px-6",children:"يومي"}),e.jsx(q,{value:"weekly",className:"rounded-lg px-6",children:"أسبوعي"}),e.jsx(q,{value:"monthly",className:"rounded-lg px-6",children:"شهري"})]}),e.jsx(M,{value:"daily",children:e.jsxs(d,{className:"border-0 shadow-lg",children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-accent"}),"صافي الربح اليومي (آخر 7 أيام)"]})}),e.jsx(n,{children:a.dailyTrend&&a.dailyTrend.length>0?e.jsx("div",{className:"h-[350px]",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(Qe,{data:a.dailyTrend,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:.1})]}),e.jsxs("linearGradient",{id:"colorProfit",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})]}),e.jsx(z,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Q,{dataKey:"date",tickFormatter:s=>F(new Date(s),"EEE",{locale:R}),stroke:"#9ca3af"}),e.jsx(U,{stroke:"#9ca3af"}),e.jsx(N,{formatter:s=>[`${s.toFixed(2)} ر.س`],labelFormatter:s=>F(new Date(s),"EEEE dd/MM",{locale:R}),contentStyle:{borderRadius:12,border:"none",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),e.jsx(Y,{}),e.jsx(re,{type:"monotone",dataKey:"revenue",stroke:"#10b981",fill:"url(#colorRevenue)",name:"الإيرادات",strokeWidth:2}),e.jsx(re,{type:"monotone",dataKey:"netProfit",stroke:"#3b82f6",fill:"url(#colorProfit)",name:"صافي الربح",strokeWidth:2})]})})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"h-16 w-16 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"لا توجد بيانات كافية لعرض الرسم البياني"})]})})})]})}),e.jsx(M,{value:"weekly",children:e.jsxs(d,{className:"border-0 shadow-lg",children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-purple-600"}),"صافي الربح الأسبوعي"]})}),e.jsx(n,{children:a.weeklyTrend&&a.weeklyTrend.length>0?e.jsx("div",{className:"h-[350px]",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(ze,{data:a.weeklyTrend,children:[e.jsx(z,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Q,{dataKey:"week",stroke:"#9ca3af"}),e.jsx(U,{stroke:"#9ca3af"}),e.jsx(N,{formatter:s=>[`${s.toFixed(2)} ر.س`],contentStyle:{borderRadius:12,border:"none",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),e.jsx(Y,{}),e.jsx(P,{dataKey:"revenue",fill:"#10b981",name:"الإيرادات",radius:[4,4,0,0]}),e.jsx(P,{dataKey:"cogs",fill:"#f59e0b",name:"تكلفة المكونات",radius:[4,4,0,0]}),e.jsx(P,{dataKey:"expenses",fill:"#ef4444",name:"المصروفات",radius:[4,4,0,0]}),e.jsx(P,{dataKey:"netProfit",fill:"#3b82f6",name:"صافي الربح",radius:[4,4,0,0]})]})})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-muted-foreground",children:e.jsx("p",{children:"لا توجد بيانات كافية"})})})]})}),e.jsx(M,{value:"monthly",children:e.jsxs(d,{className:"border-0 shadow-lg",children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-emerald-600"}),"التحليل الشهري"]})}),e.jsx(n,{children:a.monthlyTrend&&a.monthlyTrend.length>0?e.jsx("div",{className:"h-[350px]",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(Ue,{data:a.monthlyTrend,children:[e.jsx(z,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Q,{dataKey:"month",stroke:"#9ca3af"}),e.jsx(U,{stroke:"#9ca3af"}),e.jsx(N,{formatter:s=>[`${s.toFixed(2)} ر.س`],contentStyle:{borderRadius:12,border:"none",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),e.jsx(Y,{}),e.jsx(le,{type:"monotone",dataKey:"revenue",stroke:"#10b981",name:"الإيرادات",strokeWidth:3,dot:{r:6}}),e.jsx(le,{type:"monotone",dataKey:"netProfit",stroke:"#3b82f6",name:"صافي الربح",strokeWidth:3,dot:{r:6}})]})})}):e.jsx("div",{className:"h-[350px] flex items-center justify-center text-muted-foreground",children:e.jsx("p",{children:"لا توجد بيانات كافية"})})})]})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(d,{className:"border-0 shadow-lg",children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-green-600"}),"الإيرادات حسب طريقة الدفع"]})}),e.jsx(n,{children:E.length>0?e.jsx("div",{className:"h-[280px]",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(de,{children:[e.jsx(ne,{data:E,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,fill:"#8884d8",paddingAngle:5,dataKey:"value",label:({name:s,percent:t})=>`${s} (${(t*100).toFixed(0)}%)`,children:E.map((s,t)=>e.jsx(te,{fill:D[t%D.length]},`cell-${t}`))}),e.jsx(N,{formatter:s=>[`${s.toFixed(2)} ر.س`]})]})})}):e.jsx("div",{className:"h-[280px] flex items-center justify-center text-muted-foreground",children:e.jsx("p",{children:"لا توجد بيانات"})})})]}),e.jsxs(d,{className:"border-0 shadow-lg",children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-red-600"}),"المصروفات حسب الفئة"]})}),e.jsx(n,{children:K.length>0?e.jsx("div",{className:"h-[280px]",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(de,{children:[e.jsx(ne,{data:K,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,fill:"#8884d8",paddingAngle:5,dataKey:"value",label:({name:s,percent:t})=>`${s} (${(t*100).toFixed(0)}%)`,children:K.map((s,t)=>e.jsx(te,{fill:D[t%D.length]},`cell-${t}`))}),e.jsx(N,{formatter:s=>[`${s.toFixed(2)} ر.س`]})]})})}):e.jsx("div",{className:"h-[280px] flex items-center justify-center text-muted-foreground",children:e.jsx("p",{children:"لا توجد مصروفات مسجلة"})})})]})]}),e.jsx(Oe,{open:ue,onOpenChange:v,children:e.jsxs(Ae,{className:"max-w-md",dir:"rtl",children:[e.jsx(Ee,{children:e.jsxs(Ke,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-red-600"}),"إضافة مصروف جديد"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"الفئة"}),e.jsxs(H,{value:l.category,onValueChange:s=>p({...l,category:s}),children:[e.jsx(I,{"data-testid":"select-expense-category",children:e.jsx(G,{placeholder:"اختر الفئة"})}),e.jsx(W,{children:Z.map(s=>e.jsx(S,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"الوصف"}),e.jsx(V,{value:l.description,onChange:s=>p({...l,description:s.target.value}),placeholder:"وصف المصروف...","data-testid":"input-expense-desc"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"المبلغ (ر.س)"}),e.jsx(V,{type:"number",value:l.amount,onChange:s=>p({...l,amount:s.target.value}),placeholder:"0.00",min:0,step:.01,"data-testid":"input-expense-amount"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"ملاحظات (اختياري)"}),e.jsx(V,{value:l.notes,onChange:s=>p({...l,notes:s.target.value}),placeholder:"ملاحظات إضافية...","data-testid":"input-expense-notes"})]})]}),e.jsxs($e,{children:[e.jsx(L,{variant:"outline",onClick:()=>v(!1),children:"إلغاء"}),e.jsxs(L,{onClick:ye,disabled:A.isPending,className:"bg-red-600 hover:bg-red-700",children:[A.isPending?e.jsx(k,{className:"h-4 w-4 animate-spin ml-2"}):null,"إضافة المصروف"]})]})]})}),e.jsx(Ye,{open:c!==null,onOpenChange:s=>!s&&w(null),children:e.jsxs(he,{side:"left",className:"w-full sm:max-w-xl",dir:"rtl",children:[e.jsx(pe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[c==="revenue"&&e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-5 w-5 text-emerald-600"}),"تفاصيل الإيرادات"]}),c==="orders"&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"h-5 w-5 text-accent"}),"تفاصيل الطلبات (COGS)"]}),c==="expenses"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-5 w-5 text-red-600"}),"تفاصيل المصروفات"]})]})}),e.jsxs(Me,{className:"h-[calc(100vh-120px)] mt-4",children:[(c==="revenue"||c==="orders")&&e.jsx("div",{className:"space-y-3",children:be?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(k,{className:"h-6 w-6 animate-spin"})}):J.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"لا توجد طلبات في هذه الفترة"}):J.map(s=>e.jsx(d,{className:"border shadow-sm","data-testid":`card-order-${s.id}`,children:e.jsxs(n,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",children:["#",s.orderNumber||s.id?.slice(-6)]}),e.jsx(h,{variant:s.status==="completed"?"default":"secondary",className:s.status==="completed"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"",children:s.status==="completed"?"مكتمل":s.status==="pending"?"قيد الانتظار":s.status==="preparing"?"قيد التحضير":s.status})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.createdAt&&F(new Date(s.createdAt),"dd/MM HH:mm",{locale:R})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.items?.length||0," عناصر"]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-emerald-600",children:[(s.totalAmount||0).toFixed(2)," ر.س"]}),c==="orders"&&s.totalCost!==void 0&&e.jsxs("p",{className:"text-xs text-accent",children:["COGS: ",(s.totalCost||0).toFixed(2)," ر.س"]})]})]}),s.items&&s.items.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"العناصر:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.items.slice(0,3).map((t,$)=>e.jsxs(h,{variant:"secondary",className:"text-xs",children:[t.nameAr||t.name," x",t.quantity]},$)),s.items.length>3&&e.jsxs(h,{variant:"secondary",className:"text-xs",children:["+",s.items.length-3," أخرى"]})]})]})]})},s.id))}),c==="expenses"&&e.jsx("div",{className:"space-y-3",children:Ne?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(k,{className:"h-6 w-6 animate-spin"})}):ee.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"لا توجد مصروفات في هذه الفترة"}):ee.map(s=>e.jsx(d,{className:"border shadow-sm","data-testid":`card-expense-${s.id}`,children:e.jsxs(n,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(h,{variant:"outline",children:Z.find(t=>t.value===s.category)?.label||s.category}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.date&&F(new Date(s.date),"dd/MM/yyyy",{locale:R})})]}),e.jsx("p",{className:"font-medium mb-1",children:s.description}),s.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.notes}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المبلغ:"}),e.jsxs("span",{className:"font-bold text-red-600",children:[(s.amount||0).toFixed(2)," ر.س"]})]})]})},s.id))})]})]})})]})}export{Ss as default};
