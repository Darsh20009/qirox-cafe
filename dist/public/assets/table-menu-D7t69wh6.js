import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as m}from"./vendor-react-Bzsngnqy.js";import{l as Z,c as G,a as X,e as ee,ar as te,i as u,B as o,af as se,j as P,as as O,ad as ae,a4 as L,at as re,au as ie,v as k,N as q}from"./index-CLvpp2UE.js";import{a as $}from"./vendor-query-CX8ZYlKb.js";import{C as ne}from"./circle-alert-CfteRpPO.js";import"./vendor-utils-BKCsaWdX.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=Z("Sprout",[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]]);function pe(){const[,A]=G(),[de,_]=X("/table-menu/:qrToken"),{toast:l}=ee(),[x,j]=m.useState([]),[p,R]=m.useState("all"),[N,D]=m.useState("all"),[z,w]=m.useState(!1),[y,K]=m.useState(""),[b,M]=m.useState(null),f=_?.qrToken,B=t=>{if(!t)return"valid";const r=new Date(t),i=new Date,a=(r.getTime()-i.getTime())/(1e3*60);return a>=-30&&a<=5?"valid":a<-30?"after_window":"before_window"},{data:s,isLoading:J,isError:Q}=$({queryKey:["/api/tables/qr",f],enabled:!!f,retry:1,queryFn:async()=>{const t=await fetch(`/api/tables/qr/${f}`);if(!t.ok)throw new Error("الطاولة غير موجودة");return t.json()}});m.useEffect(()=>{if(s?.reservedFor?.reservationTime){const t=B(s.reservedFor.reservationTime);M(t)}},[s]);const{data:E}=$({queryKey:["/api/orders",s?.id],enabled:!!s?.currentOrderId,queryFn:async()=>{const t=await fetch(`/api/orders/${s?.currentOrderId}`);if(!t.ok)throw new Error("الطلب غير موجود");return t.json()}}),{data:F=[],isLoading:U}=$({queryKey:["/api/coffee-items"]}),I=x.reduce((t,r)=>t+r.quantity,0),V=[{id:"all",nameAr:"الكل",nameEn:"All",icon:u},{id:"basic",nameAr:"قهوة أساسية",nameEn:"Basic Coffee",icon:u},{id:"hot",nameAr:"قهوة ساخنة",nameEn:"Hot Coffee",icon:O},{id:"cold",nameAr:"قهوة باردة",nameEn:"Cold Coffee",icon:ae},{id:"specialty",nameAr:"المشروبات الإضافية",nameEn:"Specialty Drinks",icon:L},{id:"desserts",nameAr:"الحلويات",nameEn:"Desserts",icon:re}],H=[{id:"all",labelAr:"جميع الأنواع",icon:L},{id:"mild",labelAr:"خفيف (1-4)",icon:le},{id:"medium",labelAr:"متوسط (4-8)",icon:ie},{id:"strong",labelAr:"قوي (8-12)",icon:O},{id:"classic",labelAr:"العادي/الكلاسيك",icon:u}];let g=p==="all"?F:F.filter(t=>t.category===p);g=te(g,N),m.useEffect(()=>{if(s?.id){`${s.id}`;const t=sessionStorage.getItem(`cart_${s.id}`);if(t)try{const i=JSON.parse(t).map(a=>a.item?a:a.coffeeItem?{id:a.id,item:a.coffeeItem,quantity:a.quantity,selectedSize:a.selectedSize,selectedAddons:a.selectedAddons||[]}:a).filter(a=>a.item);j(i)}catch(r){console.error("Error parsing saved cart:",r)}}},[s?.id]);const C=async(t,r,i=[])=>{const a=r||"default",c=`${t.id}-${a}-${i.sort().join(",")}`,n=s?.id?`table-${s.id}`:"guest";try{j(d=>{const S=d.find(h=>h.id===c);let v;return S?v=d.map(h=>h.id===c?{...h,quantity:h.quantity+1}:h):v=[...d,{id:c,item:t,quantity:1,selectedSize:a,selectedAddons:i}],sessionStorage.setItem(`cart_${s?.id}`,JSON.stringify(v)),v}),await k("POST","/api/cart",{sessionId:n,coffeeItemId:t.id,quantity:1,selectedSize:a,selectedAddons:i}),q.invalidateQueries({queryKey:[`/api/cart/${n}`]}),l({title:"تمت الإضافة للسلة",description:`تم إضافة ${t.nameAr} إلى سلتك`})}catch(d){console.error("Add to cart error:",d),l({title:"خطأ",description:"فشل في إضافة المنتج للسلة",variant:"destructive"})}},T=async t=>{const r=s?.id?`table-${s.id}`:"guest";try{const i=x.find(a=>a.id===t);if(!i)return;j(a=>{let c;return i.quantity>1?c=a.map(n=>n.id===t?{...n,quantity:n.quantity-1}:n):c=a.filter(n=>n.id!==t),sessionStorage.setItem(`cart_${s?.id}`,JSON.stringify(c)),c}),i.quantity>1?await k("PUT",`/api/cart/${r}/${t}`,{quantity:i.quantity-1}):await k("DELETE",`/api/cart/${r}/${t}`),q.invalidateQueries({queryKey:[`/api/cart/${r}`]})}catch(i){console.error("Remove from cart error:",i)}},W=async()=>{if(s?.id)try{(await fetch(`/api/tables/${s.id}/extend-reservation`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok&&(l({title:"تم التمديد",description:"تم تمديد الحجز لمدة ساعة إضافية",className:"bg-green-600 text-white border-green-700"}),q.invalidateQueries({queryKey:["/api/tables/qr",f]}))}catch{l({title:"خطأ",description:"فشل تمديد الحجز",variant:"destructive"})}},Y=async()=>{if(x.length===0){l({title:"السلة فارغة",description:"الرجاء إضافة عناصر للسلة أولاً",variant:"destructive"});return}if(s?.reservedFor?.customerName){if(b==="after_window"){l({title:"انتهاء فترة الحجز",description:"آسفون، فترة الحجز قد انتهت. يمكنك عمل طلب عادي جديد.",variant:"destructive"});return}if(b==="before_window"){l({title:"الحجز في وقت لاحق",description:"الحجز لم يبدأ بعد. يمكنك عمل طلب عادي الآن."}),w(!0);return}if(!z){const t=y.trim();if(!t){l({title:"التحقق من الحجز",description:"الرجاء إدخال رقم الجوال المسجل في الحجز",variant:"destructive"});return}const r=s.reservedFor.customerPhone.replace(/^0/,""),i=t.replace(/^0/,"");if(r!==i&&r!==t){l({title:"خطأ في التحقق",description:"رقم الجوال غير مطابق للحجز",variant:"destructive"});return}w(!0);return}}if(s?.id)try{await fetch(`/api/tables/${s.id}/occupancy`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isOccupied:1})})}catch(t){console.error("Error updating table occupancy:",t)}sessionStorage.setItem(`cart_${s?.id}`,JSON.stringify(x)),sessionStorage.setItem(`branchId_${s?.id}`,s?.branchId||""),A(`/table-checkout/${s?.id}/${s?.tableNumber}`)};return J&&!Q||U?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-48 h-48 bg-secondary/15 rounded-full blur-2xl animate-pulse",style:{animationDelay:"0.8s"}})]}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 rounded-full blur-2xl animate-pulse"}),e.jsx(u,{className:"w-20 h-20 text-primary mx-auto relative z-10 coffee-steam"})]}),e.jsx("h3",{className:"font-amiri text-3xl font-bold text-primary mb-4 golden-gradient",children:"جاري تحضير المنيو"}),e.jsx("p",{className:"text-muted-foreground text-xl",children:"أفضل ما لدينا من القهوة الطازجة"})]})]}):s?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-primary/5 to-yellow-50",children:[e.jsx("header",{className:"sticky top-0 bg-white border-b-2 border-primary z-40 shadow-md",dir:"rtl",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-14 sm:h-16",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4 space-x-reverse",children:[e.jsx(u,{className:"w-6 h-6 sm:w-8 sm:h-8 text-slate-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-amiri text-lg sm:text-2xl font-bold text-slate-700",children:"CLUNY CAFE"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["طاولة ",s.tableNumber]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(o,{onClick:Y,variant:"default",size:"sm",disabled:x.length===0,className:"relative bg-slate-600 hover:bg-slate-700 text-white transition-all duration-300 px-3 sm:px-6 py-1.5 sm:py-3 text-sm sm:text-lg font-semibold shadow-md hover:shadow-lg rounded-lg",children:[e.jsx(se,{className:"w-4 h-4 sm:w-5 sm:h-5 sm:ml-2"}),e.jsx("span",{className:"hidden sm:inline",children:"السلة"}),I>0&&e.jsx(P,{variant:"destructive",className:"absolute -top-1.5 sm:-top-2 -left-1.5 sm:-left-2 h-5 w-5 sm:h-6 sm:w-6 flex items-center justify-center p-0 text-xs sm:text-sm font-bold bg-blue-500",children:I})]})})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8 py-6 sm:py-8 md:py-12 relative z-10",children:[s?.reservedFor?.status==="pending"&&e.jsx("div",{className:"mb-8 p-5 bg-blue-50 border-2 border-blue-300 rounded-lg shadow-md",dir:"rtl",children:e.jsx("div",{className:"flex justify-between items-start gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-blue-900 mb-2",children:"معلومات الحجز"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["الحجز باسم: ",e.jsx("strong",{children:s.reservedFor.customerName})]}),s.reservedFor.autoExpiryTime&&e.jsxs("p",{className:"text-sm text-blue-800 mt-1",children:["ينتهي الحجز في: ",e.jsx("strong",{children:new Date(s.reservedFor.autoExpiryTime).toLocaleTimeString("ar")})]}),s.reservedFor.extensionCount===0&&e.jsx(o,{onClick:W,size:"sm",className:"mt-3 bg-blue-600 hover:bg-blue-700 text-white","data-testid":"button-extend-reservation",children:"تمديد الحجز ساعة إضافية"})]})})}),E&&E.status!=="completed"&&e.jsx("div",{className:"mb-8 p-5 bg-background border-2 border-primary rounded-lg shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-6 h-6 text-accent flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-accent mb-2",children:"لديك طلب معلق!"}),e.jsx("p",{className:"text-sm text-accent mb-3",children:"لديك طلب تم طلبه سابقاً من هذه الطاولة ولا يزال في الانتظار. يمكنك متابعة الطلب أو إنشاء طلب جديد."}),e.jsx(o,{onClick:()=>{A(`/table-order-tracking/${s?.currentOrderId}`)},className:"bg-primary hover:bg-primary text-white","data-testid":"button-view-pending-order",children:"متابعة الطلب السابق"})]})]})}),s?.reservedFor?.customerName&&e.jsx("div",{className:"mb-8 p-4 bg-blue-50 border-2 border-blue-300 rounded-lg",children:b==="after_window"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-bold text-lg mb-3 text-red-900",children:"⏰ انتهت فترة الحجز"}),e.jsxs("p",{className:"text-sm text-red-800 mb-3",children:["الحجز لـ: ",e.jsx("strong",{children:s.reservedFor.customerName})," قد انتهت فترته."]}),e.jsx("p",{className:"text-sm text-red-700",children:"يمكنك تقديم طلب عادي جديد."})]}):b==="before_window"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-bold text-lg mb-3 text-accent",children:"ℹ️ الحجز لم يبدأ بعد"}),e.jsxs("p",{className:"text-sm text-accent mb-3",children:["هناك حجز باسم: ",e.jsx("strong",{children:s.reservedFor.customerName})]}),e.jsx("p",{className:"text-sm text-accent",children:"يمكنك تقديم طلب عادي حالياً."})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-bold text-lg mb-3 text-blue-900",children:"التحقق من الحجز"}),e.jsxs("p",{className:"text-sm text-blue-800 mb-3",children:["هذه الطاولة محجوزة باسم: ",e.jsx("strong",{children:s.reservedFor.customerName})]}),!z&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"tel",placeholder:"أدخل رقم الجوال المسجل في الحجز",value:y,onChange:t=>K(t.target.value),className:"flex-1 px-3 py-2 border border-blue-300 rounded-lg",maxLength:9}),e.jsx(o,{onClick:()=>{const t=y.trim(),r=s.reservedFor.customerPhone.replace(/^0/,""),i=t.replace(/^0/,"");r===i||r===t?(w(!0),l({title:"تم التحقق",description:"تم التحقق من الحجز بنجاح"})):l({title:"خطأ",description:"رقم الجوال غير مطابق",variant:"destructive"})},className:"bg-blue-600 hover:bg-blue-700",children:"تحقق"})]})]})}),e.jsxs("section",{className:"mb-12 sm:mb-16 md:mb-20",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16 animate-in fade-in-0 slide-in-from-bottom-10 duration-1000",children:[e.jsxs("div",{className:"relative inline-block mb-4 sm:mb-6",children:[e.jsx("h2",{className:"font-amiri text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-slate-700 mb-2 sm:mb-4",children:"منيو CLUNY CAFE"}),e.jsx("div",{className:"absolute -bottom-1 sm:-bottom-2 left-1/2 transform -translate-x-1/2 w-16 sm:w-20 md:w-24 h-0.5 sm:h-1 bg-slate-300 rounded-full"})]}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg text-slate-600 max-w-2xl mx-auto leading-relaxed px-4",children:"انطلق في رحلة قهوة استثنائية مع تشكيلتنا المختارة بعناية من أجود حبوب القهوة العربية الأصيلة"}),e.jsxs("div",{className:"flex justify-center space-x-4 mt-6",children:[e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full"}),e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full"})]})]}),e.jsx("div",{className:"mb-8 overflow-x-auto scrollbar-hide",children:e.jsx("div",{className:"flex gap-2 sm:gap-3 min-w-max px-2 sm:justify-center",children:V.map(t=>e.jsxs(o,{onClick:()=>R(t.id),variant:p===t.id?"default":"outline",size:"sm",className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-6 py-2 sm:py-3 rounded-full font-medium whitespace-nowrap transition-all duration-300 ${p===t.id?"bg-slate-600 text-white shadow-lg scale-105":"bg-white text-slate-700 hover:bg-slate-100 border-slate-200 shadow-sm hover:shadow-md"}`,"data-testid":`button-category-${t.id}`,children:[e.jsx(t.icon,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:t.nameAr})]},t.id))})}),e.jsx("div",{className:"mb-8 overflow-x-auto scrollbar-hide",children:e.jsx("div",{className:"flex gap-2 min-w-max px-2 sm:justify-center",children:H.map(t=>e.jsxs(o,{onClick:()=>D(t.id),variant:N===t.id?"default":"outline",size:"sm",className:`flex items-center gap-1.5 px-3 sm:px-4 py-2 rounded-full font-medium whitespace-nowrap transition-all duration-300 ${N===t.id?"bg-indigo-500 text-white shadow-md scale-105":"bg-white text-slate-700 hover:bg-indigo-50 border-indigo-200/50 shadow-sm"}`,"data-testid":`button-strength-${t.id}`,children:[e.jsx(t.icon,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs",children:t.labelAr})]},t.id))})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:g.map(t=>{const r=x.find(a=>a.item.id===t.id&&a.selectedSize==="default"),i=r?.quantity||0;return e.jsxs("div",{className:"group relative bg-white rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-slate-100",children:[t.imageUrl&&e.jsx("div",{className:"relative h-48 overflow-hidden",children:e.jsx("img",{src:t.imageUrl,alt:t.nameAr,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:t.nameAr}),e.jsx("p",{className:"text-sm text-slate-600 line-clamp-2",children:t.description}),t.sizes&&t.sizes.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 border-t pt-3",children:[e.jsx("p",{className:"w-full text-[10px] text-slate-400 mb-1 font-bold",children:"الأحجام المتوفرة:"}),t.sizes.map(a=>{const c=`${t.id}-${a.nameAr}-`,n=x.find(S=>S.id.startsWith(c)),d=n?.quantity||0;return e.jsxs("div",{className:"flex items-center gap-1 bg-slate-50 rounded-lg p-1 border border-slate-100",children:[e.jsxs(o,{size:"sm",variant:d>0?"default":"outline",className:`h-8 text-[10px] sm:text-xs rounded-md ${d>0?"bg-slate-600 border-transparent shadow-sm":"bg-white border-slate-200"}`,onClick:()=>C(t,a.nameAr),children:[a.nameAr," (",a.price," ر.س)",d>0&&e.jsx(P,{className:"mr-1 h-4 w-4 p-0 flex items-center justify-center bg-blue-500 text-[8px] border-none",children:d})]}),d>0&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md",onClick:()=>T(n.id),children:"-"})]},a.nameAr)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-xl font-bold text-slate-800",children:[t.price," ر.س"]})}),i>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:"icon",variant:"outline",className:"h-8 w-8",onClick:()=>T(r.id),children:"-"}),e.jsx("span",{className:"text-lg font-medium w-8 text-center",children:i}),e.jsx(o,{size:"icon",className:"h-8 w-8",onClick:()=>C(t),children:"+"})]}):e.jsx(o,{onClick:()=>C(t),className:"bg-slate-600 hover:bg-slate-700 text-white",children:"إضافة للسلة"})]})]})]},t.id)})}),g.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"لا توجد منتجات في هذه الفئة"})]})]})]})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",dir:"rtl",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"طاولة غير موجودة"}),e.jsx("p",{className:"text-muted-foreground",children:"عذراً، لم نتمكن من العثور على هذه الطاولة."})]})})}export{pe as default};
