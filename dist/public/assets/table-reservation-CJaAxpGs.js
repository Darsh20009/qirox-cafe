import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as t}from"./vendor-react-Bzsngnqy.js";import{a as D,b as Q}from"./vendor-query-CX8ZYlKb.js";import{c as U,e as z,C as R,f as E,x as H,y as J,i as G,V as W,L as a,o as X,I as d,U as M,p as Y,B as V,N as Z}from"./index-CLvpp2UE.js";import{S as g,a as f,b as N,c as v,d as o}from"./select-BzAjeBJu.js";import{C as _}from"./circle-check-CNDbPLNF.js";import{C as b}from"./calendar-MKHPq1ii.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-CqdH-ack.js";function oe(){const[,k]=U(),{toast:l}=z(),[r,y]=t.useState("none"),[c,w]=t.useState("none"),[m,C]=t.useState(""),[n,S]=t.useState(""),[x,T]=t.useState(""),[h,I]=t.useState(""),[u,F]=t.useState("2"),[q,O]=t.useState(!1),{data:B=[]}=D({queryKey:["/api/branches"]}),{data:L=[]}=D({queryKey:["/api/tables"]}),P=L.filter(s=>s.branchId===r&&s.isActive===1&&s.isOccupied===0&&!s.reservedFor),p=Q({mutationFn:async s=>{const i=await fetch("/api/tables/customer-reserve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:s.tableId,customerName:s.customerName,customerPhone:s.customerPhone,reservationDate:s.reservationDate,reservationTime:s.reservationTime,numberOfGuests:s.numberOfGuests,branchId:s.branchId})});if(!i.ok){const A=(await i.json()).error||"فشل حجز الطاولة. حاول مرة أخرى";throw new Error(A)}const j=await i.json();if(!j.success)throw new Error(j.message||"فشل حجز الطاولة. حاول مرة أخرى");return j},onSuccess:s=>{Z.invalidateQueries({queryKey:["/api/tables"]}),l({title:"تم الحجز بنجاح",description:s.message||"تم حجز طاولتك بنجاح",className:"bg-green-600 text-white border-green-700"}),O(!0),setTimeout(()=>{O(!1),y("none"),w("none"),C(""),S(""),T(""),I(""),F("2")},3e3)},onError:s=>{const i=s.message||"فشل حجز الطاولة. حاول مرة أخرى";console.error("Reservation error:",i),l({title:"خطأ في الحجز",description:i,variant:"destructive"})}}),K=()=>{if(!r||!c||!m||!n||!x||!h||!u){l({title:"معلومات ناقصة",description:"الرجاء ملء جميع الحقول",variant:"destructive"});return}if(n.length!==9||!n.startsWith("5")){l({title:"رقم جوال غير صحيح",description:"الرجاء إدخال رقم جوال صحيح يبدأ بـ 5 ويتكون من 9 أرقام",variant:"destructive"});return}const s=parseInt(u);if(isNaN(s)||s<1||s>20){l({title:"عدد الضيوف غير صحيح",description:"الرجاء إدخال عدد صحيح من 1 إلى 20",variant:"destructive"});return}p.mutate({tableId:c,customerName:m,customerPhone:n,reservationDate:x,reservationTime:h,numberOfGuests:s,branchId:r})};return q?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 flex items-center justify-center p-4",dir:"rtl",children:e.jsx(R,{className:"w-full max-w-md shadow-2xl animate-in fade-in zoom-in duration-500",children:e.jsxs(E,{className:"pt-12 pb-8 text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-green-100 rounded-full mb-4 animate-bounce",children:e.jsx(_,{className:"w-12 h-12 text-green-600"})})}),e.jsx("h2",{className:"text-3xl font-bold text-green-700 mb-3",children:"تم الحجز بنجاح!"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-6",children:"تم حجز طاولتك بنجاح. سنتواصل معك قريباً للتأكيد."}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border-2 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-800",children:["سيتم إرسال رسالة تأكيد على الرقم ",n]})})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-primary/5 to-yellow-50 py-8 px-4",dir:"rtl",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-primary/10 rounded-full mb-4",children:e.jsx(b,{className:"w-10 h-10 text-primary"})}),e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"حجز طاولة"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"احجز طاولتك المفضلة في أقرب فرع واستمتع بتجربة قهوة لا تُنسى"})]}),e.jsxs(R,{className:"shadow-xl",children:[e.jsxs(H,{children:[e.jsxs(J,{className:"text-2xl flex items-center gap-2",children:[e.jsx(G,{className:"w-6 h-6 text-primary"}),"معلومات الحجز"]}),e.jsx(W,{className:"text-base",children:"اختر الفرع والطاولة واملأ معلوماتك"})]}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{htmlFor:"branch",className:"text-base flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"اختر الفرع *"]}),e.jsxs(g,{value:r,onValueChange:y,children:[e.jsx(f,{className:"h-12 text-lg",children:e.jsx(N,{placeholder:"اختر الفرع"})}),e.jsx(v,{children:B.map(s=>e.jsxs(o,{value:s.id,children:[s.nameAr," - ",s.city]},s.id))})]})]}),r!=="none"&&r&&e.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top duration-500",children:[e.jsxs(a,{htmlFor:"table",className:"text-base flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"اختر الطاولة *"]}),P.length===0?e.jsx("div",{className:"text-center py-8 bg-muted/50 rounded-lg",children:e.jsx("p",{className:"text-muted-foreground",children:"لا توجد طاولات متاحة في هذا الفرع حالياً"})}):e.jsxs(g,{value:c,onValueChange:w,children:[e.jsx(f,{className:"h-12 text-lg",children:e.jsx(N,{placeholder:"اختر رقم الطاولة"})}),e.jsx(v,{children:P.map(s=>e.jsxs(o,{value:s.id,children:["طاولة رقم ",s.tableNumber]},s.id))})]})]}),c!=="none"&&c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 animate-in slide-in-from-top duration-500",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{htmlFor:"date",className:"text-base flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"تاريخ الحجز *"]}),e.jsx(d,{id:"date",type:"date",value:x,onChange:s=>T(s.target.value),min:new Date().toISOString().split("T")[0],className:"h-12 text-lg","data-testid":"input-reservation-date"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{htmlFor:"time",className:"text-base flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"وقت الحجز *"]}),e.jsx(d,{id:"time",type:"time",value:h,onChange:s=>I(s.target.value),className:"h-12 text-lg","data-testid":"input-reservation-time"})]})]}),e.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top duration-500",children:[e.jsxs(a,{htmlFor:"guests",className:"text-base flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"عدد الضيوف *"]}),e.jsxs(g,{value:u,onValueChange:F,children:[e.jsx(f,{className:"h-12 text-lg","data-testid":"select-guests",children:e.jsx(N,{placeholder:"اختر عدد الضيوف"})}),e.jsxs(v,{children:[[1,2,3,4,5,6,7,8].map(s=>e.jsxs(o,{value:s.toString(),children:[s," ",s===1?"شخص":s===2?"شخصين":"أشخاص"]},s)),e.jsx(o,{value:"9",children:"9 أشخاص"}),e.jsx(o,{value:"10",children:"10 أشخاص"})]})]})]}),e.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top duration-500",children:[e.jsxs(a,{htmlFor:"name",className:"text-base flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"الاسم *"]}),e.jsx(d,{id:"name",placeholder:"أدخل اسمك",value:m,onChange:s=>C(s.target.value),className:"h-12 text-lg"})]}),e.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top duration-500",children:[e.jsxs(a,{htmlFor:"phone",className:"text-base flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"رقم الجوال *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{id:"phone",placeholder:"5xxxxxxxx",value:n,onChange:s=>S(s.target.value),maxLength:9,className:"h-12 text-lg flex-1"}),e.jsx("div",{className:"flex items-center justify-center h-12 px-4 bg-muted rounded-md text-muted-foreground font-medium",children:"+966"})]})]}),e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg animate-in slide-in-from-top duration-500",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"سنتواصل معك على رقم الجوال لتأكيد الحجز"})}),e.jsx(V,{onClick:K,disabled:p.isPending,className:"w-full h-14 text-lg font-bold shadow-lg animate-in slide-in-from-bottom duration-500",children:p.isPending?"جاري الحجز...":"تأكيد الحجز"})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(V,{variant:"outline",onClick:()=>k("/"),children:"العودة للصفحة الرئيسية"})})]})})}export{oe as default};
