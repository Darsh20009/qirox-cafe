import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as a}from"./vendor-react-Bzsngnqy.js";import{l as Y,c as ae,e as re,B as l,A as ce,C as d,f as m,a0 as T,af as Z,x as w,y as C,V as k,D as P,Y as M,$ as D,E as q,F as B,H as F,J as H,I as J,K as V,al as le,am as ie,T as G,v as S,r as ne}from"./index-CLvpp2UE.js";import{S as oe}from"./shield-BnyrfBf-.js";import{R as de}from"./refresh-cw-BuGj2LMM.js";import{C as me}from"./chart-column-CfkHrk5y.js";import{U as O}from"./users-Ce5vrIiy.js";import{P as U}from"./package-B_dGuXgn.js";import{T as xe}from"./table-CfApp7zM.js";import{S as K}from"./settings-CIxkmZWE.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=Y("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=Y("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]),pe={orders:Z,customers:O,employees:O,coffeeItems:U,branches:he,discountCodes:T,loyaltyCards:T,tables:xe,attendance:ne,ingredients:U,categories:K,deliveryZones:K};function Se(){const[,g]=ae(),{toast:n}=re(),[j,Q]=a.useState(null),[o,W]=a.useState(null),[X,R]=a.useState(!0),[c,b]=a.useState(null),[i,f]=a.useState(null),[x,N]=a.useState(1),[I,L]=a.useState(!1),[y,$]=a.useState(""),[_,v]=a.useState(!1),[u,A]=a.useState("");a.useEffect(()=>{const s=localStorage.getItem("currentEmployee");if(s){const t=JSON.parse(s);if(t.role!=="owner"&&t.role!=="admin"){g("/employee/gateway");return}Q(t)}else g("/employee/gateway")},[g]),a.useEffect(()=>{j&&h()},[j]),a.useEffect(()=>{c&&z(c,x)},[c,x]);const h=async()=>{R(!0);try{const s=await fetch("/api/owner/database-stats",{credentials:"include"});if(s.ok){const t=await s.json();W(t)}}catch(s){console.error("Error fetching stats:",s)}finally{R(!1)}},z=async(s,t)=>{try{const r=await fetch(`/api/owner/collection/${s}?page=${t}&limit=20`,{credentials:"include"});if(r.ok){const p=await r.json();f(p)}}catch(r){console.error("Error fetching collection data:",r)}},ee=async s=>{if(y!=="حذف"){n({title:"خطأ",description:"يرجى كتابة 'حذف' للتأكيد",variant:"destructive"});return}L(!0);try{const r=await(await S("DELETE",`/api/owner/collection/${s}`)).json();n({title:"تم الحذف",description:r.message}),h(),b(null),f(null),$("")}catch(t){n({title:"خطأ",description:t.message||"فشل الحذف",variant:"destructive"})}finally{L(!1)}},se=async(s,t)=>{try{await S("DELETE",`/api/owner/record/${s}/${t}`),n({title:"تم الحذف",description:"تم حذف السجل بنجاح"}),z(s,x),h()}catch(r){n({title:"خطأ",description:r.message||"فشل الحذف",variant:"destructive"})}},te=async()=>{if(u!=="احذف جميع البيانات"){n({title:"خطأ",description:"يرجى كتابة العبارة الصحيحة للتأكيد",variant:"destructive"});return}try{const t=await(await S("POST","/api/owner/reset-database",{confirmPhrase:u})).json();n({title:"تم إعادة التعيين",description:t.message}),h(),v(!1),A("")}catch(s){n({title:"خطأ",description:s.message||"فشل إعادة التعيين",variant:"destructive"})}};return j?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-primary/5 to-background p-4",dir:"rtl",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-700 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-red-500",children:"لوحة تحكم المالك"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"إدارة قاعدة البيانات"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"outline",onClick:h,className:"border-primary/50 text-accent","data-testid":"button-refresh",children:[e.jsx(de,{className:"w-4 h-4 ml-2"}),"تحديث"]}),e.jsxs(l,{variant:"outline",onClick:()=>g("/manager/dashboard"),className:"border-primary/50 text-accent","data-testid":"button-back",children:[e.jsx(ce,{className:"w-4 h-4 ml-2"}),"العودة"]})]})]}),X?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-10 h-10 border-2 border-primary border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"text-gray-400 mt-4",children:"جاري التحميل..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(d,{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/10 border-blue-500/20",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-400 text-2xl font-bold",children:o?.summary.todayOrders||0}),e.jsx("p",{className:"text-gray-400 text-xs",children:"طلبات اليوم"})]})]})})}),e.jsx(d,{className:"bg-gradient-to-br from-green-500/20 to-green-600/10 border-green-500/20",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-green-400 text-2xl font-bold",children:[(o?.summary.totalRevenue||0).toLocaleString()," ر.س"]}),e.jsx("p",{className:"text-gray-400 text-xs",children:"إجمالي الإيرادات"})]})]})})}),e.jsx(d,{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/10 border-purple-500/20",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-purple-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-400 text-2xl font-bold",children:o?.collections.customers?.count||0}),e.jsx("p",{className:"text-gray-400 text-xs",children:"العملاء"})]})]})})}),e.jsx(d,{className:"bg-gradient-to-br from-amber-500/20 to-amber-600/10 border-primary/20",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-accent text-2xl font-bold",children:o?.collections.orders?.count||0}),e.jsx("p",{className:"text-gray-400 text-xs",children:"الطلبات"})]})]})})})]}),e.jsxs(d,{className:"bg-gradient-to-br from-background to-background border-primary/20 mb-6",children:[e.jsxs(w,{children:[e.jsxs(C,{className:"text-accent flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"مجموعات قاعدة البيانات"]}),e.jsx(k,{className:"text-gray-400",children:"اضغط على أي مجموعة لعرض بياناتها"})]}),e.jsx(m,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:o?.collections&&Object.entries(o.collections).map(([s,t])=>{const r=pe[s]||E;return e.jsxs("div",{onClick:()=>{b(s),N(1)},className:`p-4 rounded-lg border cursor-pointer transition-all ${c===s?"border-primary bg-background0/10":"border-primary/20 hover:border-primary/50 hover:bg-background0/5"}`,"data-testid":`collection-${s}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(r,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-white font-medium",children:t.nameAr})]}),e.jsx("p",{className:"text-2xl font-bold text-accent",children:t.count}),e.jsx("p",{className:"text-gray-500 text-xs",children:s})]},s)})})})]}),c&&e.jsxs(d,{className:"bg-gradient-to-br from-background to-background border-primary/20 mb-6",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-accent",children:o?.collections[c]?.nameAr||c}),e.jsxs(k,{className:"text-gray-400",children:[i?.pagination.total||0," سجل"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[["orders","customers","discountCodes","loyaltyCards","attendance"].includes(c)&&e.jsxs(P,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(l,{variant:"destructive",size:"sm","data-testid":"button-delete-collection",children:[e.jsx(D,{className:"w-4 h-4 ml-2"}),"حذف الكل"]})}),e.jsxs(q,{className:"bg-[#2d1f1a] border-primary/20",children:[e.jsxs(B,{children:[e.jsx(F,{className:"text-red-500",children:"تأكيد الحذف"}),e.jsxs(H,{className:"text-gray-400",children:["سيتم حذف جميع سجلات ",o?.collections[c]?.nameAr,'. اكتب "حذف" للتأكيد.']})]}),e.jsx(J,{value:y,onChange:s=>$(s.target.value),placeholder:"اكتب: حذف",className:"bg-[#1a1410] border-red-500/50 text-white","data-testid":"input-delete-confirm"}),e.jsx(V,{children:e.jsx(l,{variant:"destructive",onClick:()=>ee(c),disabled:I||y!=="حذف","data-testid":"button-confirm-delete",children:I?"جاري الحذف...":"تأكيد الحذف"})})]})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{b(null),f(null)},className:"text-gray-400","data-testid":"button-close-collection",children:"إغلاق"})]})]}),e.jsx(m,{children:i&&i.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-primary/20",children:[Object.keys(i.data[0]).slice(0,6).map(s=>e.jsx("th",{className:"text-right py-2 px-3 text-gray-400 font-medium",children:s},s)),e.jsx("th",{className:"text-right py-2 px-3 text-gray-400 font-medium",children:"إجراءات"})]})}),e.jsx("tbody",{children:i.data.map((s,t)=>e.jsxs("tr",{className:"border-b border-primary/10",children:[Object.entries(s).slice(0,6).map(([r,p])=>e.jsx("td",{className:"py-2 px-3 text-white",children:typeof p=="object"?JSON.stringify(p).slice(0,50)+"...":String(p).slice(0,30)},r)),e.jsx("td",{className:"py-2 px-3",children:e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>se(c,s.id),className:"text-red-500 hover:text-red-400 p-1 h-auto","data-testid":`button-delete-record-${s.id}`,children:e.jsx(D,{className:"w-4 h-4"})})})]},s.id||t))})]})}),i.pagination.pages>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>N(s=>Math.max(1,s-1)),disabled:x===1,className:"border-primary/50 text-accent","data-testid":"button-prev-page",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-gray-400",children:["صفحة ",x," من ",i.pagination.pages]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>N(s=>Math.min(i.pagination.pages,s+1)),disabled:x===i.pagination.pages,className:"border-primary/50 text-accent","data-testid":"button-next-page",children:e.jsx(ie,{className:"w-4 h-4"})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"w-12 h-12 text-gray-500 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400",children:"لا توجد بيانات"})]})})]}),j.role==="owner"&&e.jsxs(d,{className:"bg-gradient-to-br from-red-900/20 to-red-950/10 border-red-500/20",children:[e.jsxs(w,{children:[e.jsxs(C,{className:"text-red-500 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"منطقة الخطر"]}),e.jsx(k,{className:"text-gray-400",children:"عمليات لا يمكن التراجع عنها"})]}),e.jsx(m,{children:e.jsxs(P,{open:_,onOpenChange:v,children:[e.jsx(M,{asChild:!0,children:e.jsxs(l,{variant:"destructive",className:"w-full","data-testid":"button-reset-database",children:[e.jsx(D,{className:"w-4 h-4 ml-2"}),"إعادة تعيين قاعدة البيانات"]})}),e.jsxs(q,{className:"bg-[#2d1f1a] border-red-500/20",children:[e.jsxs(B,{children:[e.jsxs(F,{className:"text-red-500 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"تحذير خطير"]}),e.jsxs(H,{className:"text-gray-400",children:["سيتم حذف جميع بيانات العمليات (الطلبات، العملاء، أكواد الخصم، بطاقات الولاء، سجلات الحضور).",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{className:"text-red-400",children:"هذه العملية لا يمكن التراجع عنها!"}),e.jsx("br",{}),e.jsx("br",{}),'اكتب "احذف جميع البيانات" للتأكيد.']})]}),e.jsx(J,{value:u,onChange:s=>A(s.target.value),placeholder:"اكتب: احذف جميع البيانات",className:"bg-[#1a1410] border-red-500/50 text-white","data-testid":"input-reset-confirm"}),e.jsxs(V,{children:[e.jsx(l,{variant:"outline",onClick:()=>v(!1),className:"border-gray-500/50 text-gray-400",children:"إلغاء"}),e.jsx(l,{variant:"destructive",onClick:te,disabled:u!=="احذف جميع البيانات","data-testid":"button-confirm-reset",children:"تأكيد إعادة التعيين"})]})]})]})})]})]})]})}):null}export{Se as default};
