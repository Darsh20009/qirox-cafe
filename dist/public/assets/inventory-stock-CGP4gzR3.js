import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as l}from"./vendor-react-Bzsngnqy.js";import{a as O,b as ee}from"./vendor-query-CX8ZYlKb.js";import{e as Pe,q as z,B as n,N as w,C as g,f as j,T as te,x as ae,y as Te,V as De,j as se,P as y,X as Ae,I as D,M as k,D as re,E as le,F as ne,H as ie,J as de,aa as Be,ab as $e,ac as ce,L as b,a7 as oe,K as me,i as Me,v as xe}from"./index-CLvpp2UE.js";import{P as Ve}from"./progress-DVPXITZU.js";import{S as Q,a as q,b as F,c as L,d as i}from"./select-BzAjeBJu.js";import{W as ue}from"./warehouse-ByZ2zAAq.js";import{P as E}from"./package-plus-mC8EAJyD.js";import{R as Ke}from"./refresh-cw-BuGj2LMM.js";import{C as he}from"./circle-check-CNDbPLNF.js";import{T as ge}from"./trending-down-By0t33Hr.js";import{D as je}from"./dollar-sign-CFWcU9O3.js";import{B as be}from"./bell-BKcM2vGh.js";import{P as Oe}from"./package-B_dGuXgn.js";import{T as ze}from"./target-Dt49oDVe.js";import{B as Ee}from"./box-BLG49O_d.js";import{W as He}from"./wrench-C4Y35z7Q.js";import{D as Re}from"./droplet-DmibwVCE.js";import{C as We}from"./circle-help-DJDmt5XW.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-CqdH-ack.js";const p={kg:"كيلو",g:"جرام",liter:"لتر",ml:"مل",piece:"قطعة",box:"صندوق",bag:"كيس"},H={ingredient:{label:"مكون",icon:Me,gradient:"from-amber-500 to-background0"},packaging:{label:"تغليف",icon:Ee,gradient:"from-blue-500 to-cyan-500"},equipment:{label:"معدات",icon:He,gradient:"from-slate-500 to-slate-600"},consumable:{label:"مستهلكات",icon:Re,gradient:"from-green-500 to-emerald-500"},other:{label:"أخرى",icon:We,gradient:"from-gray-500 to-gray-600"}};function ht(){const{toast:c}=Pe(),[A,pe]=l.useState(""),[B,fe]=l.useState("all"),[C,Ne]=l.useState("all"),[$,ve]=l.useState("all");l.useState("cards");const[we,P]=l.useState(!1),[ye,T]=l.useState(!1),[r,R]=l.useState(null),[f,I]=l.useState("1"),[d,W]=l.useState("add"),[J,M]=l.useState(""),[s,N]=l.useState({branchId:"",rawItemId:"",quantity:"",unitCost:"",notes:""}),{data:m=[],isLoading:Ce}=O({queryKey:["/api/inventory/stock"]}),{data:V=[]}=O({queryKey:["/api/branches"]}),{data:Ie=[]}=O({queryKey:["/api/inventory/raw-items"]}),x=ee({mutationFn:t=>!t.branchId||!t.rawItemId?Promise.reject(new Error("بيانات غير صالحة")):xe("POST","/api/inventory/stock/adjust",t),onSuccess:(t,a)=>{w.invalidateQueries({queryKey:["/api/inventory/stock"]}),w.invalidateQueries({queryKey:["/api/inventory/movements"]}),P(!1),R(null),I("1"),M(""),c({title:a.type==="add"?"تمت الإضافة بنجاح":"تم الخصم بنجاح",description:`${Math.abs(a.quantity)} ${p[r?.rawItem?.unit||""]||""}`})},onError:t=>{c({title:t.message||"فشل في تعديل المخزون",variant:"destructive"})}}),K=ee({mutationFn:t=>xe("POST","/api/inventory/stock/adjust",{...t,type:"add"}),onSuccess:()=>{w.invalidateQueries({queryKey:["/api/inventory/stock"]}),w.invalidateQueries({queryKey:["/api/inventory/movements"]}),w.invalidateQueries({queryKey:["/api/accounting/journal-entries"]}),T(!1),N({branchId:"",rawItemId:"",quantity:"",unitCost:"",notes:""}),c({title:"تمت إضافة الدفعة بنجاح",description:"تم تحديث المخزون والقيود المحاسبية بالكمية الجديدة"})},onError:t=>{c({title:t.message||"فشل في إضافة الدفعة",variant:"destructive"})}}),X=(t,a)=>{R(t),W(a),I("1"),M(""),P(!0)},Se=()=>{if(!r)return;const t=parseFloat(f);if(isNaN(t)||t<=0){c({title:"يرجى إدخال كمية صحيحة",variant:"destructive"});return}if(d==="subtract"&&t>r.currentQuantity){c({title:"لا يمكن خصم كمية أكبر من المتوفر",variant:"destructive"});return}x.mutate({branchId:r.branchId,rawItemId:r.rawItemId,quantity:d==="add"?t:-t,type:d,notes:J||(d==="add"?"إضافة مخزون":"خصم يدوي")})},_=(t,a)=>{if(a<0&&Math.abs(a)>t.currentQuantity){c({title:"لا يمكن خصم كمية أكبر من المتوفر",variant:"destructive"});return}x.mutate({branchId:t.branchId,rawItemId:t.rawItemId,quantity:a,type:a>0?"add":"subtract",notes:a>0?"إضافة سريعة":"خصم سريع"})},ke=()=>{const t=parseFloat(s.quantity);if(!s.branchId||!s.rawItemId){c({title:"يرجى اختيار الفرع والمادة",variant:"destructive"});return}if(isNaN(t)||t<=0){c({title:"يرجى إدخال كمية صحيحة",variant:"destructive"});return}K.mutate({branchId:s.branchId,rawItemId:s.rawItemId,quantity:t,unitCost:s.unitCost?parseFloat(s.unitCost):void 0,notes:s.notes||"دفعة جديدة"})},Qe=t=>V.find(a=>a.id===t)?.nameAr||t,u=t=>{const a=t.rawItem?.minStockLevel||0,o=a>0?t.currentQuantity/(a*2)*100:100;return t.currentQuantity<=0?{label:"نفاد",color:"bg-red-500",textColor:"text-red-700 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/30",borderColor:"border-red-300 dark:border-red-700",icon:te,priority:3,percentage:0}:t.currentQuantity<=a?{label:"منخفض",color:"bg-yellow-500",textColor:"text-yellow-700 dark:text-yellow-400",bgColor:"bg-yellow-100 dark:bg-yellow-900/30",borderColor:"border-yellow-300 dark:border-yellow-700",icon:ge,priority:2,percentage:Math.min(o,40)}:t.currentQuantity<=a*1.5?{label:"تنبيه",color:"bg-blue-500",textColor:"text-blue-700 dark:text-blue-400",bgColor:"bg-blue-100 dark:bg-blue-900/30",borderColor:"border-blue-300 dark:border-blue-700",icon:be,priority:1,percentage:Math.min(o,60)}:{label:"متوفر",color:"bg-green-500",textColor:"text-green-700 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900/30",borderColor:"border-green-300 dark:border-green-700",icon:he,priority:0,percentage:Math.min(o,100)}},G=t=>{const a=t.rawItem?.unitCost||0;return t.currentQuantity*a},U=m.filter(t=>{const a=(t.rawItem?.nameAr?.toLowerCase().includes(A.toLowerCase())??!1)||(t.rawItem?.code?.toLowerCase().includes(A.toLowerCase())??!1),o=B==="all"||t.branchId===B,S=$==="all"||t.rawItem?.category===$;let h=!0;if(C==="low")h=t.currentQuantity<=(t.rawItem?.minStockLevel||0)&&t.currentQuantity>0;else if(C==="out")h=t.currentQuantity<=0;else if(C==="warning"){const v=t.rawItem?.minStockLevel||0;h=t.currentQuantity>v&&t.currentQuantity<=v*1.5}else if(C==="available"){const v=t.rawItem?.minStockLevel||0;h=t.currentQuantity>v*1.5}return a&&o&&h&&S}).sort((t,a)=>u(a).priority-u(t).priority),qe=m.length,Y=m.filter(t=>t.currentQuantity<=(t.rawItem?.minStockLevel||0)&&t.currentQuantity>0).length,Z=m.filter(t=>t.currentQuantity<=0).length,Fe=m.filter(t=>{const a=t.rawItem?.minStockLevel||0;return t.currentQuantity>a*1.5}).length,Le=m.reduce((t,a)=>t+G(a),0);return Ce?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"h-16 w-16 text-accent animate-pulse mx-auto"}),e.jsx(z,{className:"h-8 w-8 animate-spin text-accent absolute -bottom-2 -right-2"})]}),e.jsx("p",{className:"text-muted-foreground mt-4 text-lg",children:"جاري تحميل المخزون..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-background/30 dark:from-slate-950 dark:via-slate-900 dark:to-amber-950/10 p-4 md:p-6",dir:"rtl",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 shadow-lg shadow-amber-500/20",children:e.jsx(ue,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent",children:"إدارة المخزون"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"تحكم كامل في المواد الخام والمخزون"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(n,{onClick:()=>T(!0),className:"bg-gradient-to-r from-amber-500 to-background0 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg shadow-amber-500/20","data-testid":"button-new-batch",children:[e.jsx(E,{className:"h-4 w-4 ml-2"}),"إضافة دفعة جديدة"]}),e.jsxs(n,{variant:"outline",onClick:()=>w.invalidateQueries({queryKey:["/api/inventory/stock"]}),"data-testid":"button-refresh",children:[e.jsx(Ke,{className:"h-4 w-4 ml-2"}),"تحديث"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(g,{className:"border-0 shadow-lg bg-gradient-to-br from-green-50 to-emerald-100 dark:from-green-950/50 dark:to-emerald-900/30",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"مخزون سليم"}),e.jsx("p",{className:"text-3xl font-bold text-green-700 dark:text-green-400",children:Fe}),e.jsxs("p",{className:"text-xs text-green-600/70",children:["من أصل ",qe," مادة"]})]}),e.jsx("div",{className:"p-3 rounded-xl bg-green-500/20",children:e.jsx(he,{className:"h-8 w-8 text-green-600"})})]})})}),e.jsx(g,{className:"border-0 shadow-lg bg-gradient-to-br from-yellow-50 to-amber-100 dark:from-yellow-950/50 dark:to-amber-900/30",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"مخزون منخفض"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-700 dark:text-yellow-400",children:Y}),e.jsx("p",{className:"text-xs text-yellow-600/70",children:"يحتاج إعادة تعبئة"})]}),e.jsx("div",{className:"p-3 rounded-xl bg-yellow-500/20",children:e.jsx(ge,{className:"h-8 w-8 text-yellow-600"})})]})})}),e.jsx(g,{className:"border-0 shadow-lg bg-gradient-to-br from-red-50 to-rose-100 dark:from-red-950/50 dark:to-rose-900/30",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"نفاد المخزون"}),e.jsx("p",{className:"text-3xl font-bold text-red-700 dark:text-red-400",children:Z}),e.jsx("p",{className:"text-xs text-red-600/70",children:"يجب الطلب فوراً"})]}),e.jsx("div",{className:"p-3 rounded-xl bg-red-500/20",children:e.jsx(te,{className:"h-8 w-8 text-red-600"})})]})})}),e.jsx(g,{className:"border-0 shadow-lg bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-950/50 dark:to-indigo-900/30",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"قيمة المخزون"}),e.jsx("p",{className:"text-3xl font-bold text-blue-700 dark:text-blue-400",children:Le.toFixed(0)}),e.jsx("p",{className:"text-xs text-blue-600/70",children:"ريال سعودي"})]}),e.jsx("div",{className:"p-3 rounded-xl bg-blue-500/20",children:e.jsx(je,{className:"h-8 w-8 text-blue-600"})})]})})})]}),(Y>0||Z>0)&&e.jsxs(g,{className:"border-2 border-yellow-300 dark:border-yellow-700 bg-gradient-to-r from-yellow-50 to-background dark:from-yellow-950/30 dark:to-amber-950/30 shadow-lg",children:[e.jsxs(ae,{className:"pb-3",children:[e.jsxs(Te,{className:"flex items-center gap-2 text-yellow-700 dark:text-yellow-400",children:[e.jsx(be,{className:"h-5 w-5 animate-pulse"}),"تنبيهات المخزون العاجلة"]}),e.jsx(De,{className:"text-yellow-600/80",children:"هذه المواد تحتاج انتباهك الفوري"})]}),e.jsx(j,{children:e.jsx("div",{className:"flex flex-wrap gap-3",children:m.filter(t=>u(t).priority>=2).sort((t,a)=>u(a).priority-u(t).priority).slice(0,8).map(t=>{const a=u(t),o=a.icon;return e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-xl ${a.bgColor} ${a.borderColor} border-2 cursor-pointer transition-transform hover:scale-105`,onClick:()=>X(t,"add"),children:[e.jsx(o,{className:`h-4 w-4 ${a.textColor}`}),e.jsx("span",{className:`font-medium ${a.textColor}`,children:t.rawItem?.nameAr}),e.jsxs(se,{variant:"outline",className:a.textColor,children:[t.currentQuantity," ",p[t.rawItem?.unit||""]]}),e.jsx(n,{size:"sm",variant:"ghost",className:"h-6 px-2",children:e.jsx(y,{className:"h-3 w-3"})})]},t.id)})})})]}),e.jsxs(g,{className:"shadow-lg border-0",children:[e.jsx(ae,{className:"border-b bg-muted/30",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ae,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"ابحث عن مادة بالاسم أو الكود...",value:A,onChange:t=>pe(t.target.value),className:"pr-10 bg-background","data-testid":"input-search-stock"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(Q,{value:B,onValueChange:fe,children:[e.jsx(q,{className:"w-[140px]","data-testid":"select-branch-filter",children:e.jsx(F,{placeholder:"الفرع"})}),e.jsxs(L,{children:[e.jsx(i,{value:"all",children:"كل الفروع"}),V.map(t=>e.jsx(i,{value:t.id,children:t.nameAr},t.id))]})]}),e.jsxs(Q,{value:C,onValueChange:Ne,children:[e.jsx(q,{className:"w-[140px]","data-testid":"select-stock-filter",children:e.jsx(F,{placeholder:"الحالة"})}),e.jsxs(L,{children:[e.jsx(i,{value:"all",children:"كل الحالات"}),e.jsx(i,{value:"available",children:"متوفر"}),e.jsx(i,{value:"warning",children:"تنبيه"}),e.jsx(i,{value:"low",children:"منخفض"}),e.jsx(i,{value:"out",children:"نفاد"})]})]}),e.jsxs(Q,{value:$,onValueChange:ve,children:[e.jsx(q,{className:"w-[140px]","data-testid":"select-category-filter",children:e.jsx(F,{placeholder:"النوع"})}),e.jsxs(L,{children:[e.jsx(i,{value:"all",children:"كل الأنواع"}),Object.entries(H).map(([t,a])=>e.jsx(i,{value:t,children:a.label},t))]})]})]})]})}),e.jsx(j,{className:"p-4",children:U.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Oe,{className:"h-16 w-16 text-muted-foreground/30 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"لا توجد بيانات مخزون"}),e.jsx("p",{className:"text-sm text-muted-foreground/70",children:"حاول تغيير معايير البحث"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:U.map(t=>{const a=u(t),o=a.icon,S=H[t.rawItem?.category||"other"]||H.other,h=S.icon,v=G(t);return e.jsxs(g,{className:`overflow-hidden border-2 transition-all hover:shadow-lg ${a.borderColor}`,"data-testid":`card-stock-${t.id}`,children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${S.gradient}`}),e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${S.gradient} text-white`,children:e.jsx(h,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-base",children:t.rawItem?.nameAr}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:t.rawItem?.code})]})]}),e.jsxs(se,{className:`${a.bgColor} ${a.textColor} border ${a.borderColor}`,children:[e.jsx(o,{className:"h-3 w-3 ml-1"}),a.label]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"الكمية المتوفرة"}),e.jsxs("span",{className:"font-bold text-lg",children:[t.currentQuantity," ",p[t.rawItem?.unit||""]]})]}),e.jsx(Ve,{value:a.percentage,className:`h-2 ${a.color==="bg-green-500"?"[&>div]:bg-green-500":a.color==="bg-yellow-500"?"[&>div]:bg-yellow-500":a.color==="bg-red-500"?"[&>div]:bg-red-500":"[&>div]:bg-blue-500"}`}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{children:["الحد الأدنى: ",t.rawItem?.minStockLevel||0]}),e.jsx("span",{children:Qe(t.branchId)})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm bg-muted/50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"h-3 w-3 text-accent"}),e.jsx("span",{className:"text-muted-foreground",children:"المخزون الحصري:"})]}),e.jsxs("span",{className:"font-bold font-mono",children:[t.currentQuantity," ",p[t.rawItem?.unit||""]]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm bg-muted/50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-muted-foreground",children:"القيمة:"})]}),e.jsxs("span",{className:"font-bold text-green-600",children:[v.toFixed(2)," ر.س"]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(n,{size:"sm",variant:"outline",className:"flex-1 border-red-200 text-red-600 hover:bg-red-50 dark:border-red-800 dark:hover:bg-red-950",onClick:()=>_(t,-1),disabled:t.currentQuantity<=0||x.isPending,"data-testid":`button-quick-subtract-${t.id}`,children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(n,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>X(t,"subtract"),disabled:x.isPending,children:"تعديل"}),e.jsx(n,{size:"sm",className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white hover:from-green-600 hover:to-emerald-600",onClick:()=>_(t,1),disabled:x.isPending,"data-testid":`button-quick-add-${t.id}`,children:e.jsx(y,{className:"h-4 w-4"})})]})]})]})]},t.id)})})})]}),e.jsx(re,{open:we,onOpenChange:P,children:e.jsxs(le,{dir:"rtl",className:"sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsxs(ie,{className:"flex items-center gap-2",children:[d==="add"?e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(y,{className:"h-5 w-5 text-green-600"})}):e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900/30",children:e.jsx(k,{className:"h-5 w-5 text-red-600"})}),d==="add"?"إضافة للمخزون":"خصم من المخزون"]}),e.jsx(de,{children:r?.rawItem?.nameAr})]}),r&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-xl text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"الكمية الحالية"}),e.jsxs("p",{className:"text-3xl font-bold",children:[r.currentQuantity,e.jsx("span",{className:"text-base font-normal text-muted-foreground mr-2",children:p[r.rawItem?.unit||""]})]})]}),e.jsx(Be,{value:d,onValueChange:t=>W(t),className:"w-full",children:e.jsxs($e,{className:"grid w-full grid-cols-2",children:[e.jsxs(ce,{value:"add",className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"إضافة"]}),e.jsxs(ce,{value:"subtract",className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"خصم"]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"الكمية"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"outline",size:"icon",onClick:()=>I(String(Math.max(1,parseFloat(f||"1")-1))),children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(D,{type:"number",value:f,onChange:t=>I(t.target.value),className:"text-center text-xl font-bold",min:"0.1",step:"0.1","data-testid":"input-adjust-quantity"}),e.jsx(n,{variant:"outline",size:"icon",onClick:()=>I(String(parseFloat(f||"0")+1)),children:e.jsx(y,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:p[r.rawItem?.unit||""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"ملاحظات (اختياري)"}),e.jsx(oe,{placeholder:"سبب التعديل...",value:J,onChange:t=>M(t.target.value),className:"resize-none",rows:2})]}),e.jsx("div",{className:"p-4 rounded-xl bg-muted/30 border",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"الكمية بعد التعديل:"}),e.jsxs("span",{className:"text-xl font-bold",children:[d==="add"?(r.currentQuantity+parseFloat(f||"0")).toFixed(1):(r.currentQuantity-parseFloat(f||"0")).toFixed(1),e.jsx("span",{className:"text-sm font-normal text-muted-foreground mr-1",children:p[r.rawItem?.unit||""]})]})]})})]}),e.jsxs(me,{children:[e.jsx(n,{variant:"outline",onClick:()=>P(!1),children:"إلغاء"}),e.jsxs(n,{onClick:Se,disabled:x.isPending,className:d==="add"?"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600":"bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600","data-testid":"button-confirm-adjust",children:[x.isPending?e.jsx(z,{className:"h-4 w-4 animate-spin ml-2"}):d==="add"?e.jsx(y,{className:"h-4 w-4 ml-2"}):e.jsx(k,{className:"h-4 w-4 ml-2"}),"تأكيد"]})]})]})}),e.jsx(re,{open:ye,onOpenChange:T,children:e.jsxs(le,{dir:"rtl",className:"sm:max-w-lg",children:[e.jsxs(ne,{children:[e.jsxs(ie,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary dark:bg-primary/30",children:e.jsx(E,{className:"h-5 w-5 text-accent"})}),"إضافة دفعة جديدة"]}),e.jsx(de,{children:"أضف كمية جديدة من المواد الخام للمخزون"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"الفرع"}),e.jsxs(Q,{value:s.branchId,onValueChange:t=>N({...s,branchId:t}),children:[e.jsx(q,{"data-testid":"select-new-batch-branch",children:e.jsx(F,{placeholder:"اختر الفرع"})}),e.jsx(L,{children:V.map(t=>e.jsx(i,{value:t.id,children:t.nameAr},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"المادة"}),e.jsxs(Q,{value:s.rawItemId,onValueChange:t=>N({...s,rawItemId:t}),children:[e.jsx(q,{"data-testid":"select-new-batch-item",children:e.jsx(F,{placeholder:"اختر المادة"})}),e.jsx(L,{children:Ie.map(t=>e.jsxs(i,{value:t.id,children:[t.nameAr," (",t.code,")"]},t.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"الكمية"}),e.jsx(D,{type:"number",placeholder:"أدخل الكمية",value:s.quantity,onChange:t=>N({...s,quantity:t.target.value}),min:"0.1",step:"0.1","data-testid":"input-new-batch-quantity"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"تكلفة الوحدة (اختياري)"}),e.jsx(D,{type:"number",placeholder:"ر.س",value:s.unitCost,onChange:t=>N({...s,unitCost:t.target.value}),min:"0",step:"0.01","data-testid":"input-new-batch-cost"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"ملاحظات"}),e.jsx(oe,{placeholder:"ملاحظات عن الدفعة...",value:s.notes,onChange:t=>N({...s,notes:t.target.value}),className:"resize-none",rows:2})]})]}),e.jsxs(me,{children:[e.jsx(n,{variant:"outline",onClick:()=>T(!1),children:"إلغاء"}),e.jsxs(n,{onClick:ke,disabled:K.isPending,className:"bg-gradient-to-r from-amber-500 to-background0 hover:from-amber-600 hover:to-orange-600","data-testid":"button-confirm-new-batch",children:[K.isPending?e.jsx(z,{className:"h-4 w-4 animate-spin ml-2"}):e.jsx(E,{className:"h-4 w-4 ml-2"}),"إضافة الدفعة"]})]})]})})]})})}export{ht as default};
