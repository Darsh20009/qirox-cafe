import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as T}from"./vendor-react-Bzsngnqy.js";import{a as R}from"./vendor-query-CX8ZYlKb.js";import{a as U,c as B,C as a,x as c,y as l,f as t,ay as x,B as d,A as v,a5 as _,ax as $,j as u,r as z,O as w,U as k,p as D,o as F,i as C}from"./index-CLvpp2UE.js";import{P as M}from"./progress-DVPXITZU.js";import{P as f}from"./package-B_dGuXgn.js";import{R as q}from"./refresh-cw-BuGj2LMM.js";import{C as p}from"./circle-check-big-DlXUvwLH.js";import"./vendor-utils-BKCsaWdX.js";const N=[{key:"pending",label:"جاري التجهيز",icon:f},{key:"assigned",label:"تم تعيين المندوب",icon:k},{key:"picked_up",label:"تم الاستلام",icon:C},{key:"on_the_way",label:"في الطريق",icon:w},{key:"delivered",label:"تم التوصيل",icon:p}],P=i=>{const r=N.findIndex(o=>o.key===i);return r>=0?r:0},H=i=>(P(i)+1)/N.length*100;function Z(){const[,i]=U("/delivery/track/:orderId");B();const r=i?.orderId;T.useEffect(()=>{document.title="تتبع التوصيل - CLUNY CAFE"},[]);const{data:o,isLoading:A,error:S,refetch:I}=R({queryKey:["/api/delivery/orders/by-order",r],enabled:!!r,refetchInterval:3e4}),s=o?.order;if(!r)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",dir:"rtl",children:e.jsxs(a,{className:"w-full max-w-md text-center",children:[e.jsxs(c,{children:[e.jsx(f,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx(l,{children:"تتبع التوصيل"})]}),e.jsxs(t,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"يرجى إدخال رقم الطلب للتتبع"}),e.jsx(x,{href:"/menu",children:e.jsxs(d,{className:"w-full",children:[e.jsx(v,{className:"w-4 h-4 ml-2"}),"العودة للقائمة"]})})]})]})});if(A)return e.jsx("div",{className:"min-h-screen bg-background p-4",dir:"rtl",children:e.jsx(_,{})});if(S||!s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",dir:"rtl",children:e.jsxs(a,{className:"w-full max-w-md text-center",children:[e.jsxs(c,{children:[e.jsx(f,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx(l,{children:"لم يتم العثور على الطلب"})]}),e.jsxs(t,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"تأكد من رقم الطلب وحاول مرة أخرى"}),e.jsx(x,{href:"/menu",children:e.jsxs(d,{className:"w-full",children:[e.jsx($,{className:"w-4 h-4 ml-2"}),"العودة للقائمة"]})})]})]})});const g=P(s.status),L=H(s.status),b=s.status==="delivered",y=s.status==="cancelled";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background to-primary/5",dir:"rtl",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-sm",children:e.jsx("div",{className:"max-w-lg mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{href:"/menu",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(v,{className:"w-4 h-4 ml-2"}),"العودة"]})}),e.jsx("h1",{className:"font-bold text-foreground",children:"تتبع الطلب"}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>I(),"data-testid":"button-refresh",children:e.jsx(q,{className:"w-4 h-4"})})]})})}),e.jsxs("main",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[e.jsxs(a,{children:[e.jsx(c,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{className:"text-lg",children:["طلب #",s.orderNumber||r?.slice(-6)]}),y?e.jsx(u,{variant:"destructive",children:"ملغي"}):b?e.jsx(u,{className:"bg-green-500 text-white",children:"تم التوصيل"}):e.jsx(u,{className:"bg-primary text-primary-foreground",children:"جاري التوصيل"})]})}),e.jsx(t,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.createdAt).toLocaleString("ar-SA")})})]}),!y&&e.jsx(a,{children:e.jsxs(t,{className:"pt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(M,{value:L,className:"h-2"})}),e.jsx("div",{className:"space-y-4",children:N.map((n,m)=>{const E=n.icon,h=m<=g,j=m===g;return e.jsxs("div",{className:`flex items-center gap-3 ${h?"text-foreground":"text-muted-foreground"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${h?j?"bg-primary text-primary-foreground animate-pulse":"bg-green-500 text-white":"bg-muted"}`,children:e.jsx(E,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-medium ${j?"text-primary":""}`,children:n.label}),j&&s.estimatedMinutes&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),"~",s.estimatedMinutes," دقيقة متبقية"]})]}),h&&e.jsx(p,{className:"w-5 h-5 text-green-500"})]},n.key)})})]})}),s.driverName&&e.jsxs(a,{children:[e.jsx(c,{className:"pb-2",children:e.jsxs(l,{className:"text-base flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-primary"}),"معلومات المندوب"]})}),e.jsxs(t,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:s.driverName})]}),s.driverPhone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`tel:${s.driverPhone}`,className:"text-primary hover:underline",children:s.driverPhone})]})]})]}),e.jsxs(a,{children:[e.jsx(c,{className:"pb-2",children:e.jsxs(l,{className:"text-base flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-primary"}),"عنوان التوصيل"]})}),e.jsx(t,{children:e.jsx("p",{className:"text-sm",children:s.customerAddress})})]}),s.items&&s.items.length>0&&e.jsxs(a,{children:[e.jsx(c,{className:"pb-2",children:e.jsxs(l,{className:"text-base flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-primary"}),"تفاصيل الطلب"]})}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-2",children:[s.items.map((n,m)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:n.name}),e.jsxs("span",{className:"text-muted-foreground",children:["×",n.quantity]})]},m)),e.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between font-bold",children:[e.jsx("span",{children:"المجموع"}),e.jsxs("span",{className:"text-primary",children:[s.totalAmount?.toFixed(2)," ر.س"]})]})]})})]}),b&&e.jsx(a,{className:"bg-green-50 dark:bg-green-950/20 border-green-200",children:e.jsxs(t,{className:"pt-6 text-center",children:[e.jsx(p,{className:"w-16 h-16 mx-auto text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-green-600 mb-2",children:"تم التوصيل بنجاح!"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"شكراً لطلبك من CLUNY CAFE"}),e.jsx(x,{href:"/menu",children:e.jsx(d,{className:"w-full",children:"طلب جديد"})})]})})]})]})}export{Z as default};
