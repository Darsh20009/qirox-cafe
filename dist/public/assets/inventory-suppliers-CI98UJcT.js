import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as m}from"./vendor-react-Bzsngnqy.js";import{a as I,b as p}from"./vendor-query-CX8ZYlKb.js";import{e as K,q as v,B as d,P as M,C as U,x as B,X as R,I as i,f as z,p as G,$ as J,D as E,E as T,F as P,H as w,L as n,a7 as S,K as A,v as g,N as y}from"./index-CLvpp2UE.js";import{T as V,a as W,b as N,c,d as Y,e as r}from"./table-DVDQb40v.js";import{U as Z}from"./users-Ce5vrIiy.js";import{S as _}from"./square-pen-C2M2occ2.js";import"./vendor-utils-BKCsaWdX.js";function le(){const{toast:l}=K(),[o,X]=m.useState(""),[D,h]=m.useState(!1),[L,x]=m.useState(!1),[C,f]=m.useState(null),[s,t]=m.useState({code:"",nameAr:"",nameEn:"",contactPerson:"",phone:"",email:"",address:"",city:"",taxNumber:"",paymentTerms:"",notes:""}),{data:q=[],isLoading:k}=I({queryKey:["/api/inventory/suppliers"]}),u=p({mutationFn:a=>g("POST","/api/inventory/suppliers",a),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/inventory/suppliers"]}),h(!1),b(),l({title:"تم إضافة المورد بنجاح"})},onError:a=>{l({title:a.message||"فشل في إضافة المورد",variant:"destructive"})}}),j=p({mutationFn:({id:a,data:H})=>g("PUT",`/api/inventory/suppliers/${a}`,H),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/inventory/suppliers"]}),x(!1),f(null),b(),l({title:"تم تحديث المورد بنجاح"})},onError:a=>{l({title:a.message||"فشل في تحديث المورد",variant:"destructive"})}}),O=p({mutationFn:a=>g("DELETE",`/api/inventory/suppliers/${a}`),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/inventory/suppliers"]}),l({title:"تم حذف المورد بنجاح"})},onError:a=>{l({title:a.message||"فشل في حذف المورد",variant:"destructive"})}}),b=()=>{t({code:"",nameAr:"",nameEn:"",contactPerson:"",phone:"",email:"",address:"",city:"",taxNumber:"",paymentTerms:"",notes:""})},Q=a=>{f(a),t({code:a.code,nameAr:a.nameAr,nameEn:a.nameEn||"",contactPerson:a.contactPerson||"",phone:a.phone,email:a.email||"",address:a.address||"",city:a.city||"",taxNumber:a.taxNumber||"",paymentTerms:a.paymentTerms||"",notes:a.notes||""}),x(!0)},$=a=>{confirm("هل أنت متأكد من حذف هذا المورد؟")&&O.mutate(a)},F=q.filter(a=>a.nameAr.toLowerCase().includes(o.toLowerCase())||a.code.toLowerCase().includes(o.toLowerCase())||(a.nameEn?.toLowerCase().includes(o.toLowerCase())??!1)||a.phone.includes(o));return k?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"الموردين"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"إدارة الموردين والشركات المتعاملة"})]})]}),e.jsxs(d,{onClick:()=>h(!0),"data-testid":"button-add-supplier",children:[e.jsx(M,{className:"h-4 w-4 ml-2"}),"إضافة مورد"]})]}),e.jsxs(U,{children:[e.jsx(B,{children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(R,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(i,{placeholder:"بحث بالاسم أو الكود أو رقم الهاتف...",value:o,onChange:a=>X(a.target.value),className:"pr-10","data-testid":"input-search-suppliers"})]})}),e.jsx(z,{children:e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(V,{children:[e.jsx(W,{children:e.jsxs(N,{className:"bg-muted/50",children:[e.jsx(c,{className:"text-right",children:"الكود"}),e.jsx(c,{className:"text-right",children:"الاسم"}),e.jsx(c,{className:"text-right",children:"جهة الاتصال"}),e.jsx(c,{className:"text-right",children:"الهاتف"}),e.jsx(c,{className:"text-right",children:"المدينة"}),e.jsx(c,{className:"text-right",children:"الإجراءات"})]})}),e.jsx(Y,{children:F.length===0?e.jsx(N,{children:e.jsx(r,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"لا يوجد موردين"})}):F.map(a=>e.jsxs(N,{"data-testid":`row-supplier-${a.id}`,children:[e.jsx(r,{className:"font-mono",children:a.code}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.nameAr}),a.nameEn&&e.jsx("div",{className:"text-sm text-muted-foreground",children:a.nameEn})]})}),e.jsx(r,{children:a.contactPerson||"-"}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3 text-muted-foreground"}),a.phone]})}),e.jsx(r,{children:a.city||"-"}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"icon",variant:"ghost",onClick:()=>Q(a),"data-testid":`button-edit-${a.id}`,children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(d,{size:"icon",variant:"ghost",onClick:()=>$(a.id),"data-testid":`button-delete-${a.id}`,children:e.jsx(J,{className:"h-4 w-4 text-destructive"})})]})})]},a.id))})]})})})]}),e.jsx(E,{open:D,onOpenChange:h,children:e.jsxs(T,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx(P,{children:e.jsx(w,{children:"إضافة مورد جديد"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"code",children:"الكود *"}),e.jsx(i,{id:"code",value:s.code,onChange:a=>t({...s,code:a.target.value}),placeholder:"SUP-001","data-testid":"input-code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"nameAr",children:"الاسم بالعربي *"}),e.jsx(i,{id:"nameAr",value:s.nameAr,onChange:a=>t({...s,nameAr:a.target.value}),placeholder:"شركة التوريد","data-testid":"input-name-ar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"nameEn",children:"الاسم بالإنجليزي"}),e.jsx(i,{id:"nameEn",value:s.nameEn,onChange:a=>t({...s,nameEn:a.target.value}),placeholder:"Supply Company","data-testid":"input-name-en"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"contactPerson",children:"جهة الاتصال"}),e.jsx(i,{id:"contactPerson",value:s.contactPerson,onChange:a=>t({...s,contactPerson:a.target.value}),placeholder:"اسم المسؤول","data-testid":"input-contact-person"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone",children:"رقم الهاتف *"}),e.jsx(i,{id:"phone",value:s.phone,onChange:a=>t({...s,phone:a.target.value}),placeholder:"05XXXXXXXX","data-testid":"input-phone"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(i,{id:"email",type:"email",value:s.email,onChange:a=>t({...s,email:a.target.value}),placeholder:"email@example.com","data-testid":"input-email"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"city",children:"المدينة"}),e.jsx(i,{id:"city",value:s.city,onChange:a=>t({...s,city:a.target.value}),placeholder:"الرياض","data-testid":"input-city"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"taxNumber",children:"الرقم الضريبي"}),e.jsx(i,{id:"taxNumber",value:s.taxNumber,onChange:a=>t({...s,taxNumber:a.target.value}),placeholder:"XXXXXXXXX","data-testid":"input-tax-number"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"address",children:"العنوان"}),e.jsx(i,{id:"address",value:s.address,onChange:a=>t({...s,address:a.target.value}),placeholder:"العنوان الكامل","data-testid":"input-address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"paymentTerms",children:"شروط الدفع"}),e.jsx(i,{id:"paymentTerms",value:s.paymentTerms,onChange:a=>t({...s,paymentTerms:a.target.value}),placeholder:"صافي 30 يوم","data-testid":"input-payment-terms"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notes",children:"ملاحظات"}),e.jsx(S,{id:"notes",value:s.notes,onChange:a=>t({...s,notes:a.target.value}),placeholder:"ملاحظات إضافية...","data-testid":"input-notes"})]})]}),e.jsxs(A,{children:[e.jsx(d,{variant:"outline",onClick:()=>h(!1),children:"إلغاء"}),e.jsxs(d,{onClick:()=>u.mutate(s),disabled:u.isPending||!s.code||!s.nameAr||!s.phone,"data-testid":"button-submit-add",children:[u.isPending&&e.jsx(v,{className:"h-4 w-4 ml-2 animate-spin"}),"إضافة"]})]})]})}),e.jsx(E,{open:L,onOpenChange:x,children:e.jsxs(T,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx(P,{children:e.jsx(w,{children:"تعديل المورد"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-code",children:"الكود *"}),e.jsx(i,{id:"edit-code",value:s.code,onChange:a=>t({...s,code:a.target.value}),"data-testid":"input-edit-code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-nameAr",children:"الاسم بالعربي *"}),e.jsx(i,{id:"edit-nameAr",value:s.nameAr,onChange:a=>t({...s,nameAr:a.target.value}),"data-testid":"input-edit-name-ar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-nameEn",children:"الاسم بالإنجليزي"}),e.jsx(i,{id:"edit-nameEn",value:s.nameEn,onChange:a=>t({...s,nameEn:a.target.value}),"data-testid":"input-edit-name-en"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-contactPerson",children:"جهة الاتصال"}),e.jsx(i,{id:"edit-contactPerson",value:s.contactPerson,onChange:a=>t({...s,contactPerson:a.target.value}),"data-testid":"input-edit-contact-person"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-phone",children:"رقم الهاتف *"}),e.jsx(i,{id:"edit-phone",value:s.phone,onChange:a=>t({...s,phone:a.target.value}),"data-testid":"input-edit-phone"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-email",children:"البريد الإلكتروني"}),e.jsx(i,{id:"edit-email",type:"email",value:s.email,onChange:a=>t({...s,email:a.target.value}),"data-testid":"input-edit-email"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-city",children:"المدينة"}),e.jsx(i,{id:"edit-city",value:s.city,onChange:a=>t({...s,city:a.target.value}),"data-testid":"input-edit-city"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-taxNumber",children:"الرقم الضريبي"}),e.jsx(i,{id:"edit-taxNumber",value:s.taxNumber,onChange:a=>t({...s,taxNumber:a.target.value}),"data-testid":"input-edit-tax-number"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-address",children:"العنوان"}),e.jsx(i,{id:"edit-address",value:s.address,onChange:a=>t({...s,address:a.target.value}),"data-testid":"input-edit-address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-paymentTerms",children:"شروط الدفع"}),e.jsx(i,{id:"edit-paymentTerms",value:s.paymentTerms,onChange:a=>t({...s,paymentTerms:a.target.value}),"data-testid":"input-edit-payment-terms"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-notes",children:"ملاحظات"}),e.jsx(S,{id:"edit-notes",value:s.notes,onChange:a=>t({...s,notes:a.target.value}),"data-testid":"input-edit-notes"})]})]}),e.jsxs(A,{children:[e.jsx(d,{variant:"outline",onClick:()=>x(!1),children:"إلغاء"}),e.jsxs(d,{onClick:()=>C&&j.mutate({id:C.id,data:s}),disabled:j.isPending||!s.code||!s.nameAr||!s.phone,"data-testid":"button-submit-edit",children:[j.isPending&&e.jsx(v,{className:"h-4 w-4 ml-2 animate-spin"}),"تحديث"]})]})]})})]})}export{le as default};
