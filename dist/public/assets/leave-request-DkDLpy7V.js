import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r}from"./vendor-react-Bzsngnqy.js";import{c as B,e as O,B as b,A as z,C as f,x as v,y,f as N,L as l,I as w,j as D,a7 as M,r as P}from"./index-CLvpp2UE.js";import{F as $}from"./file-text-QZcL_gux.js";import{C}from"./calendar-MKHPq1ii.js";import{C as H}from"./circle-check-CNDbPLNF.js";import{C as J}from"./circle-alert-CfteRpPO.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";function _(){const[,S]=B(),{toast:n}=O(),[a,o]=r.useState(""),[s,m]=r.useState(""),[c,x]=r.useState(""),[h,u]=r.useState(!1),[p,k]=r.useState([]),[L,R]=r.useState(!0);r.useEffect(()=>{g()},[]);const g=async()=>{try{const t=await fetch("/api/leave-requests",{credentials:"include"});if(t.ok){const i=await t.json();k(i)}}catch(t){console.error("Error fetching leave requests:",t)}finally{R(!1)}},T=()=>{if(!a||!s)return 0;const t=new Date(a),i=new Date(s),j=Math.abs(i.getTime()-t.getTime());return Math.ceil(j/(1e3*60*60*24))+1},A=async t=>{if(t.preventDefault(),!a||!s||!c.trim()){n({title:"خطأ",description:"يرجى ملء جميع الحقول",variant:"destructive"});return}const i=new Date(a);if(new Date(s)<i){n({title:"خطأ",description:"تاريخ الانتهاء يجب أن يكون بعد تاريخ البداية",variant:"destructive"});return}u(!0);try{const d=await fetch("/api/leave-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({startDate:new Date(a),endDate:new Date(s),reason:c}),credentials:"include"}),I=await d.json();if(!d.ok){n({title:"خطأ",description:I.error||"فشل تقديم طلب الاجازة",variant:"destructive"});return}n({title:"نجح",description:"تم تقديم طلب الاجازة بنجاح"}),o(""),m(""),x(""),g()}catch{n({title:"خطأ",description:"حدث خطأ في تقديم الطلب",variant:"destructive"})}finally{u(!1)}},E=t=>{switch(t){case"approved":return"bg-green-500";case"rejected":return"bg-red-500";default:return"bg-yellow-500"}},F=t=>{switch(t){case"approved":return"موافق عليه";case"rejected":return"مرفوض";default:return"قيد الانتظار"}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-primary/5 to-background p-4",dir:"rtl",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>S("/employee/attendance"),className:"text-gray-400 hover:text-accent","data-testid":"button-back-attendance",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-accent",children:"التقديم على اجازة"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"إدارة طلبات الاجازات"})]})]}),e.jsxs(f,{className:"bg-gradient-to-br from-background to-background border-primary/20 mb-6",children:[e.jsx(v,{className:"pb-3",children:e.jsxs(y,{className:"text-accent flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"نموذج تقديم اجازة"]})}),e.jsx(N,{children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"start-date",className:"text-gray-300",children:"تاريخ البداية"}),e.jsx(w,{id:"start-date",type:"date",value:a,onChange:t=>o(t.target.value),className:"bg-primary/30 border-primary/30 text-white","data-testid":"input-start-date"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"end-date",className:"text-gray-300",children:"تاريخ النهاية"}),e.jsx(w,{id:"end-date",type:"date",value:s,onChange:t=>m(t.target.value),className:"bg-primary/30 border-primary/30 text-white","data-testid":"input-end-date"})]}),a&&s&&e.jsx("div",{className:"bg-primary/30 rounded-lg p-3 border border-primary/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:"عدد الأيام"}),e.jsxs(D,{className:"bg-background0/20 text-accent border-primary/30",children:[T()," أيام"]})]})}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"reason",className:"text-gray-300",children:"السبب"}),e.jsx(M,{id:"reason",value:c,onChange:t=>x(t.target.value),placeholder:"اذكر سبب الاجازة...",className:"bg-primary/30 border-primary/30 text-white resize-none h-24","data-testid":"textarea-reason"})]}),e.jsx(b,{type:"submit",disabled:h||!a||!s||!c.trim(),className:"w-full h-11 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white text-lg","data-testid":"button-submit-leave",children:h?"جاري الإرسال...":"تقديم الطلب"})]})})]}),e.jsxs(f,{className:"bg-gradient-to-br from-background to-background border-primary/20",children:[e.jsx(v,{className:"pb-3",children:e.jsxs(y,{className:"text-accent flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"سجل الطلبات"]})}),e.jsx(N,{children:L?e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:"جاري تحميل البيانات..."})}):p.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(C,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد طلبات اجازات"})]}):e.jsx("div",{className:"space-y-3",children:p.map(t=>e.jsxs("div",{className:"bg-primary/20 border border-primary/20 rounded-lg p-4","data-testid":`card-leave-request-${t.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="approved"&&e.jsx(H,{className:"w-5 h-5 text-green-500"}),t.status==="rejected"&&e.jsx(J,{className:"w-5 h-5 text-red-500"}),t.status==="pending"&&e.jsx(P,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"text-gray-300 text-sm",children:new Date(t.createdAt).toLocaleDateString("ar-SA")})]}),e.jsx(D,{className:`${E(t.status)} text-white`,children:F(t.status)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3 text-sm",children:[e.jsxs("div",{className:"text-muted-foreground",children:["من: ",new Date(t.startDate).toLocaleDateString("ar-SA")]}),e.jsxs("div",{className:"text-muted-foreground",children:["إلى: ",new Date(t.endDate).toLocaleDateString("ar-SA")]})]}),e.jsxs("div",{className:"text-xs text-accent mb-2",children:["عدد الأيام: ",t.numberOfDays," أيام"]}),e.jsxs("div",{className:"text-sm text-gray-300 mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"السبب: "}),t.reason]}),t.status==="rejected"&&t.rejectionReason&&e.jsxs("div",{className:"text-xs text-red-400 bg-red-950/20 p-2 rounded mt-2",children:["سبب الرفض: ",t.rejectionReason]})]},t.id))})})]})]})})}export{_ as default};
