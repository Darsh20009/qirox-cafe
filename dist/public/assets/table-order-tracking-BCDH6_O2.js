import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as j}from"./vendor-react-Bzsngnqy.js";import{a as C,e as w,C as a,x as l,y as o,f as d,j as A,B as I,N as k,O as D,r as S}from"./index-61RjstaY.js";import{a as T,b as E}from"./vendor-query-CX8ZYlKb.js";import{A as F,h as q,a as _,b as O,c as R,d as B,e as H,f as M,g as $}from"./alert-dialog-DH0OhHaS.js";import{C as f}from"./circle-x-D9GYVDcC.js";import{C as J}from"./circle-alert-DPdcINna.js";import{C as u}from"./circle-check-big-v7jPXABl.js";import{C as K}from"./chef-hat-D6Gkp1MI.js";import"./vendor-utils-BKCsaWdX.js";function ee(){const[P,g]=C("/table-order-tracking/:orderId"),{toast:i}=w(),n=g?.orderId,m=j.useRef(void 0),{data:s,isLoading:b}=T({queryKey:["/api/orders",n],queryFn:async()=>{const r=await fetch(`/api/orders/${n}`);if(!r.ok)throw new Error("الطلب غير موجود");const t=await r.json();if(t.items&&typeof t.items=="string")try{t.items=JSON.parse(t.items)}catch(x){console.error("Error parsing order items:",x),t.items=[]}return Array.isArray(t.items)||(t.items=[]),t},enabled:!!n,refetchInterval:5e3});j.useEffect(()=>{const r=s?.tableStatus||s?.status;if(s&&r&&m.current&&m.current!==r){const x={payment_confirmed:"تم تأكيد الدفع",preparing:"جاري تحضير طلبك",ready:"طلبك جاهز",delivering_to_table:"طلبك في الطريق",delivered:"تم توصيل طلبك"}[r]||"تم تحديث حالة طلبك";i({title:"تحديث حالة الطلب",description:x,duration:6e3,className:"bg-blue-600 text-white border-blue-700"})}s&&r&&(m.current=r)},[s,i]);const h=E({mutationFn:async()=>{const r=await fetch(`/api/orders/${n}/cancel-by-customer`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({cancellationReason:"طلب الإلغاء من العميل"})});if(!r.ok){const t=await r.json();throw new Error(t.error||"فشل في إلغاء الطلب")}return r.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/orders",n]}),i({title:"تم إلغاء الطلب",description:"تم إلغاء طلبك بنجاح"})},onError:r=>{i({title:"خطأ",description:r.message||"فشل إلغاء الطلب",variant:"destructive"})}}),y=r=>{switch(r){case"pending":return{icon:S,label:"في الانتظار",description:"طلبك في انتظار استلام الكاشير",color:"text-yellow-500"};case"payment_confirmed":return{icon:u,label:"تم تأكيد الدفع",description:"تم استلام طلبك وسيتم تحضيره قريباً",color:"text-blue-500"};case"preparing":return{icon:K,label:"قيد التحضير",description:"طلبك قيد التحضير الآن",color:"text-orange-500"};case"ready":return{icon:u,label:"جاهز للتقديم",description:"طلبك جاهز والآن يتم تقديمه لك",color:"text-green-500"};case"delivered":return{icon:u,label:"تم التقديم",description:"تم تقديم طلبك بنجاح",color:"text-green-500"};case"delivering_to_table":return{icon:D,label:"جاري التوصيل",description:"طلبك في الطريق إلى طاولتك",color:"text-purple-500"};case"cancelled":return{icon:f,label:"ملغي",description:"تم إلغاء الطلب",color:"text-red-500"};default:return{icon:J,label:"غير معروف",description:"حالة الطلب غير معروفة",color:"text-gray-500"}}};if(b)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",dir:"rtl",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-lg",children:"جاري التحميل..."})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",dir:"rtl",children:e.jsxs(a,{className:"max-w-md",children:[e.jsx(l,{children:e.jsx(o,{children:"طلب غير موجود"})}),e.jsx(d,{children:e.jsx("p",{children:"عذراً، لم نتمكن من العثور على هذا الطلب."})})]})});const p=s.tableStatus||s.status,c=y(p),N=c.icon,v=p==="pending";return e.jsx("div",{className:"min-h-screen bg-background p-4",dir:"rtl",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsx(a,{children:e.jsx(l,{children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-2xl",children:"تتبع الطلب"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["رقم الطلب: ",s.orderNumber]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["طاولة: ",s.tableNumber]})]}),e.jsxs(A,{variant:"outline",className:"text-lg px-4 py-2",children:[s.totalAmount.toFixed(2)," ر.س"]})]})})}),e.jsx(a,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-20 h-20 rounded-full bg-muted ${c.color}`,children:e.jsx(N,{className:"w-10 h-10"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:c.label}),e.jsx("p",{className:"text-muted-foreground",children:c.description})]})]})})}),e.jsxs(a,{children:[e.jsx(l,{children:e.jsx(o,{children:"تفاصيل الطلب"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:s&&Array.isArray(s.items)&&s.items.length>0?e.jsxs(e.Fragment,{children:[s.items.map((r,t)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.nameAr}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["الكمية: ",r.quantity]})]}),e.jsxs("p",{className:"font-bold",children:[(r.price*r.quantity).toFixed(2)," ر.س"]})]},t)),e.jsxs("div",{className:"border-t pt-3 flex justify-between items-center font-bold text-lg",children:[e.jsx("span",{children:"الإجمالي"}),e.jsxs("span",{children:[s.totalAmount.toFixed(2)," ر.س"]})]})]}):e.jsx("p",{className:"text-center text-muted-foreground",children:"جاري تحميل تفاصيل الطلب..."})})})]}),s.customerInfo&&e.jsxs(a,{children:[e.jsx(l,{children:e.jsx(o,{children:"معلومات العميل"})}),e.jsxs(d,{children:[e.jsx("p",{className:"font-medium",children:s.customerInfo.customerName}),s.customerInfo.phone&&s.customerInfo.phone!=="guest"&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["الهاتف: ",s.customerInfo.phone]})]})]}),v&&e.jsxs(F,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(I,{variant:"destructive",className:"w-full","data-testid":"button-cancel-order",children:[e.jsx(f,{className:"w-4 h-4 ml-2"}),"إلغاء الطلب"]})}),e.jsxs(_,{dir:"rtl",children:[e.jsxs(O,{children:[e.jsx(R,{children:"هل أنت متأكد؟"}),e.jsx(B,{children:"هل تريد حقاً إلغاء هذا الطلب؟ لا يمكن التراجع عن هذا الإجراء."})]}),e.jsxs(H,{children:[e.jsx(M,{children:"رجوع"}),e.jsx($,{onClick:()=>h.mutate(),disabled:h.isPending,children:"تأكيد الإلغاء"})]})]})]}),e.jsx("div",{className:"text-center text-sm text-muted-foreground",children:"يتم تحديث حالة الطلب تلقائياً"})]})})}export{ee as default};
