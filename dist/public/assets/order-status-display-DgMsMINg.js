import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as l}from"./vendor-react-Bzsngnqy.js";import{a as M}from"./vendor-query-CX8ZYlKb.js";import{l as j,N as h,a6 as O,i as b,j as v,B as g,r as S,q as E,C as T,f as R,o as L,O as I}from"./index-61RjstaY.js";import{u as q}from"./websocket-Bxdgjfcq.js";import{W as z}from"./wifi-DHeSyR6a.js";import{W as D}from"./wifi-off-BmrjbstJ.js";import{R as B}from"./refresh-cw-DWvJTizr.js";import{C as f}from"./circle-check-C68tr6Vl.js";import{B as W}from"./bell-m_o6DJ54.js";import{S as F}from"./store-CdbJ-YqS.js";import"./vendor-utils-BKCsaWdX.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=j("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=j("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]),P=r=>r?r.includes("-")?r.split("-").pop()||"000":r.replace(/\D/g,"").slice(-4).padStart(4,"0"):"000",Q=r=>{const a=r.deliveryType||r.orderType;return a==="dine-in"||a==="dine_in"?{label:"محلي",icon:F,color:"bg-green-500/20 text-green-400 border-green-500/50"}:a==="pickup"||a==="takeaway"?{label:"سفري",icon:L,color:"bg-background0/20 text-accent border-amber-500/50"}:a==="delivery"?{label:"توصيل",icon:I,color:"bg-blue-500/20 text-blue-400 border-blue-500/50"}:{label:"طلب",icon:b,color:"bg-muted text-muted-foreground border-border"}};function p({order:r,isReady:a,isFullscreen:t}){const n=Q(r),c=n.icon,d=P(r.orderNumber);return e.jsx(T,{className:`relative overflow-visible transition-all duration-500 ${a?"border-green-500 bg-green-500/10 shadow-lg shadow-green-500/20":"border-amber-500/30 bg-background0/5"} ${a?"animate-pulse":""}`,"data-testid":`order-card-${r.id}`,children:e.jsxs(R,{className:`text-center ${t?"p-8":"p-6"}`,children:[e.jsx("div",{className:`font-bold mb-3 ${t?"text-8xl":"text-6xl"}`,style:{fontFamily:"monospace"},children:e.jsx("span",{className:a?"text-green-400":"text-accent",children:d})}),e.jsx("div",{className:"flex items-center justify-center gap-2 mb-3",children:e.jsxs(v,{variant:"outline",className:`${n.color} ${t?"text-base px-4 py-1":""}`,children:[e.jsx(c,{className:`${t?"h-5 w-5":"h-4 w-4"} ml-1`}),n.label]})}),e.jsxs("div",{className:`text-muted-foreground ${t?"text-base":"text-sm"}`,children:[r.itemCount||0," عناصر"]}),a&&e.jsx("div",{className:"absolute -top-3 -right-3 z-10",children:e.jsx("div",{className:`bg-green-500 rounded-full animate-bounce ${t?"p-3":"p-2"}`,children:e.jsx(W,{className:`text-white ${t?"h-6 w-6":"h-4 w-4"}`})})})]})})}function re(){const[r,a]=l.useState(new Date),[t,n]=l.useState(!1),c=l.useRef(new Set),d=l.useRef(!0);l.useEffect(()=>{const s=setInterval(()=>{a(new Date)},1e3);return()=>clearInterval(s)},[]);const{data:y,isLoading:N,refetch:w}=M({queryKey:["/api/orders/active-display"],queryFn:async()=>{const s=await fetch("/api/orders/active-display");if(!s.ok)throw new Error("Failed to fetch orders");const o=await s.json();return Array.isArray(o)?o:[]},refetchInterval:15e3}),$=l.useCallback(()=>{h.invalidateQueries({queryKey:["/api/orders/active-display"]})},[]),k=s=>{h.invalidateQueries({queryKey:["/api/orders/active-display"]})},{isConnected:m}=q({clientType:"display",onOrderUpdated:$,onOrderReady:k,enabled:!0}),u=y||[],x=u.filter(s=>s.status==="in_progress"||s.status==="preparing"),i=u.filter(s=>s.status==="ready");l.useEffect(()=>{const s=new Set(i.map(o=>o.id));if(d.current){c.current=s,d.current=!1;return}c.current=s},[i]);const C=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{n(!1)}):document.documentElement.requestFullscreen().then(()=>{n(!0)}).catch(()=>{n(!1)})};return l.useEffect(()=>{const s=()=>{n(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[]),N?e.jsx("div",{dir:"rtl",className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(O,{message:"جاري تحميل الطلبات..."})}):e.jsx("div",{dir:"rtl",className:`min-h-screen bg-background ${t?"p-8":"p-6"}`,children:e.jsxs("div",{className:`mx-auto ${t?"max-w-none":"max-w-7xl"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`bg-primary rounded-full flex items-center justify-center ${t?"w-20 h-20":"w-14 h-14"}`,children:e.jsx(b,{className:`text-primary-foreground ${t?"w-10 h-10":"w-7 h-7"}`})}),e.jsxs("div",{children:[e.jsx("h1",{className:`font-bold text-foreground ${t?"text-5xl":"text-3xl"}`,children:"حالة الطلبات"}),e.jsx("p",{className:`text-muted-foreground ${t?"text-xl":"text-base"}`,children:"متابعة الطلبات الجارية والجاهزة"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs(v,{variant:"outline",className:m?"bg-green-500/10 text-green-500 border-green-500/50":"bg-red-500/10 text-red-500 border-red-500/50","data-testid":"badge-ws-status",children:[m?e.jsx(z,{className:"h-3 w-3 ml-1"}):e.jsx(D,{className:"h-3 w-3 ml-1"}),m?"متصل":"غير متصل"]}),e.jsx("div",{className:`font-mono text-foreground ${t?"text-4xl":"text-2xl"}`,children:r.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),e.jsx(g,{variant:"outline",size:t?"lg":"icon",onClick:C,"data-testid":"button-toggle-fullscreen","aria-label":t?"إلغاء ملء الشاشة":"ملء الشاشة",children:t?e.jsx(K,{className:"h-5 w-5"}):e.jsx(A,{className:"h-5 w-5"})}),e.jsx(g,{variant:"outline",size:t?"lg":"icon",onClick:()=>w(),"data-testid":"button-refresh-orders","aria-label":"تحديث الطلبات",children:e.jsx(B,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:`grid grid-cols-1 ${t?"lg:grid-cols-2 gap-12":"lg:grid-cols-2 gap-8"}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`bg-background0/20 rounded-full flex items-center justify-center ${t?"w-14 h-14":"w-10 h-10"}`,children:e.jsx(S,{className:`text-accent ${t?"h-7 w-7":"h-5 w-5"}`})}),e.jsxs("div",{children:[e.jsx("h2",{className:`font-bold text-accent ${t?"text-3xl":"text-xl"}`,children:"جاري التحضير"}),e.jsxs("p",{className:`text-muted-foreground ${t?"text-lg":"text-sm"}`,children:[x.length," طلب"]})]})]}),e.jsx("div",{className:`grid gap-4 ${t?"grid-cols-2 sm:grid-cols-3 lg:grid-cols-4":"grid-cols-2 sm:grid-cols-3"}`,children:x.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:[e.jsx(E,{className:`mx-auto mb-4 opacity-30 ${t?"h-16 w-16":"h-12 w-12"}`}),e.jsx("p",{className:t?"text-xl":"",children:"لا توجد طلبات قيد التحضير"})]}):x.map(s=>e.jsx(p,{order:s,isReady:!1,isFullscreen:t},s.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`bg-green-500/20 rounded-full flex items-center justify-center ${t?"w-14 h-14":"w-10 h-10"}`,children:e.jsx(f,{className:`text-green-400 ${t?"h-7 w-7":"h-5 w-5"}`})}),e.jsxs("div",{children:[e.jsx("h2",{className:`font-bold text-green-400 ${t?"text-3xl":"text-xl"}`,children:"جاهز للاستلام"}),e.jsxs("p",{className:`text-muted-foreground ${t?"text-lg":"text-sm"}`,children:[i.length," طلب"]})]})]}),e.jsx("div",{className:`grid gap-4 ${t?"grid-cols-2 sm:grid-cols-3 lg:grid-cols-4":"grid-cols-2 sm:grid-cols-3"}`,children:i.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:[e.jsx(f,{className:`mx-auto mb-4 opacity-30 ${t?"h-16 w-16":"h-12 w-12"}`}),e.jsx("p",{className:t?"text-xl":"",children:"لا توجد طلبات جاهزة"})]}):i.map(s=>e.jsx(p,{order:s,isReady:!0,isFullscreen:t},s.id))})]})]}),e.jsx("div",{className:`mt-8 text-center ${t?"text-lg":"text-sm"}`,children:e.jsx("p",{className:"text-muted-foreground",children:"يتم تحديث الشاشة تلقائياً كل 5 ثوانٍ"})})]})})}export{re as default};
