import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as g}from"./vendor-react-Bzsngnqy.js";import{a as E,b as T}from"./vendor-query-CX8ZYlKb.js";import{e as D,c as P,B as o,A as I,C as r,x as L,y as F,Y as p,f as n,I as R,q as x,r as N,j as a}from"./index-61RjstaY.js";import{U as q}from"./users-Btf_-tK9.js";import{C as A}from"./calendar-Cex3TfGh.js";import{C as B}from"./clock-3-ImZ6UTtV.js";import"./vendor-utils-BKCsaWdX.js";function Q(){const{toast:i}=D(),[,b]=P(),[t,v]=g.useState(""),[m,f]=g.useState(!1),{data:l=[],isLoading:c,refetch:h}=E({queryKey:["/api/tables/reservations/customer",t],queryFn:async()=>{if(!t.trim())return[];const s=await fetch(`/api/tables/reservations/customer/${t}`);if(s.ok)return await s.json();throw new Error("فشل البحث عن الحجوزات")},enabled:!1}),d=T({mutationFn:async s=>{const j=await fetch(`/api/tables/${s}/extend-reservation`,{method:"POST"});if(!j.ok)throw new Error("فشل في تمديد الحجز");return j.json()},onSuccess:()=>{i({title:"تم",description:"تم تمديد الحجز لساعة إضافية",className:"bg-green-600 text-white border-green-700"}),h()},onError:s=>{i({title:"خطأ",description:s.message,variant:"destructive"})}}),u=()=>{if(!t.trim()){i({title:"خطأ",description:"الرجاء إدخال رقم جوالك",variant:"destructive"});return}f(!0),h()},w=s=>{switch(s){case"pending":return e.jsx(a,{variant:"outline",className:"bg-yellow-50 text-yellow-800 border-yellow-300",children:"قيد الانتظار"});case"confirmed":return e.jsx(a,{className:"bg-green-600 text-white",children:"مؤكد"});case"cancelled":return e.jsx(a,{variant:"outline",className:"bg-red-50 text-red-800 border-red-300",children:"ملغى"});case"expired":return e.jsx(a,{variant:"outline",className:"bg-gray-50 text-gray-800 border-gray-300",children:"منتهي"});case"completed":return e.jsx(a,{className:"bg-blue-600 text-white",children:"مكتمل"});default:return null}},y=s=>{try{return new Date(s).toLocaleTimeString("ar",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return s}},C=s=>{try{return new Date(s).toLocaleDateString("ar")}catch{return s}},k=s=>["pending","confirmed"].includes(s.status),S=s=>s.status==="confirmed"&&!s.extensionCount;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4",dir:"rtl",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>b("/"),"data-testid":"button-back",children:e.jsx(I,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"حجوزاتي"})]}),e.jsx("p",{className:"text-gray-600 mr-10",children:"ابحث عن حجوزات طاولاتك بنمرة جوالك"})]}),e.jsxs(r,{className:"mb-8 shadow-lg",children:[e.jsx(L,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5"}),"ابحث عن حجزك"]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{placeholder:"رقم الجوال (مثال: 501234567)",value:t,onChange:s=>v(s.target.value),onKeyPress:s=>s.key==="Enter"&&u(),className:"flex-1","data-testid":"input-search-phone"}),e.jsxs(o,{onClick:u,disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white","data-testid":"button-search",children:[c?e.jsx(x,{className:"w-4 h-4 animate-spin"}):e.jsx(p,{className:"w-4 h-4 ml-2"}),"بحث"]})]})})]}),e.jsx("div",{className:"space-y-4",children:c?e.jsx(r,{children:e.jsxs(n,{className:"pt-8 text-center text-gray-500",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx(x,{className:"w-6 h-6 animate-spin"})}),"جاري البحث..."]})}):m&&l.length===0?e.jsx(r,{children:e.jsx(n,{className:"pt-8 text-center text-gray-500",children:"لا توجد حجوزات لهذا الرقم"})}):m&&l.length>0?l.map(s=>e.jsx(r,{className:"shadow-md hover:shadow-lg transition-shadow overflow-hidden",children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:s.tableNumber}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"طاولة رقم"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.reservation.customerName})]})]}),e.jsx("div",{children:w(s.reservation.status)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(q,{className:"w-5 h-5 text-blue-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"عدد الضيوف"}),e.jsxs("p",{className:"font-semibold",children:[s.reservation.numberOfGuests," ضيف"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(A,{className:"w-5 h-5 text-blue-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"الموعد"}),e.jsx("p",{className:"font-semibold",children:C(s.reservation.reservationDate)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(N,{className:"w-5 h-5 text-blue-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"الساعة"}),e.jsx("p",{className:"font-semibold",children:s.reservation.reservationTime})]})]}),k(s.reservation)&&s.reservation.autoExpiryTime&&e.jsxs("div",{className:"flex items-center gap-2 text-orange-700",children:[e.jsx(B,{className:"w-5 h-5 text-orange-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ينتهي في"}),e.jsx("p",{className:"font-semibold text-orange-600",children:y(s.reservation.autoExpiryTime)})]})]})]}),s.reservation.extensionCount>0&&e.jsxs("div",{className:"flex items-center gap-2 text-green-700 pt-2 border-t",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full"}),e.jsx("p",{className:"text-sm",children:"تم تمديد الحجز"})]}),S(s.reservation)&&e.jsx("div",{className:"pt-4 border-t",children:e.jsx(o,{onClick:()=>d.mutate(s.tableId),disabled:d.isPending,className:"w-full bg-blue-600 hover:bg-blue-700 text-white","data-testid":`button-extend-${s.tableId}`,children:d.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري التمديد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 ml-2"}),"تمديد الحجز لساعة إضافية"]})})}),s.reservation.status==="expired"&&e.jsx("div",{className:"pt-4 border-t bg-gray-50 p-3 rounded text-center",children:e.jsx("p",{className:"text-sm text-gray-700",children:"انتهت صلاحية هذا الحجز"})}),s.reservation.status==="cancelled"&&e.jsx("div",{className:"pt-4 border-t bg-red-50 p-3 rounded text-center",children:e.jsx("p",{className:"text-sm text-red-700",children:"تم إلغاء هذا الحجز"})})]})})},s.tableId)):null})]})})}export{Q as default};
