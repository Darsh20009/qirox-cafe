import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as j}from"./vendor-react-Bzsngnqy.js";import{a as x}from"./vendor-query-CX8ZYlKb.js";import{a5 as D,C as d,f as n,L as p,I as u,x as i,y as r,au as L,T as C}from"./index-CLvpp2UE.js";import{D as R}from"./dollar-sign-CFWcU9O3.js";import{T}from"./trending-up-BzxeYQ4e.js";import"./vendor-utils-BKCsaWdX.js";function K(){const[a,g]=j.useState("branch-1"),[o,f]=j.useState(new Date(new Date().setDate(new Date().getDate()-30)).toISOString().split("T")[0]),[c,N]=j.useState(new Date().toISOString().split("T")[0]),{data:y={},isLoading:v}=x({queryKey:[`/api/accounting/daily-snapshot/${a}`],enabled:!!a}),{data:A=[],isLoading:b}=x({queryKey:[`/api/accounting/profit-by-item/${a}`,o,c],enabled:!!a}),{data:m=[],isLoading:w}=x({queryKey:[`/api/accounting/top-items/${a}`,o,c],enabled:!!a}),{data:h=[],isLoading:S}=x({queryKey:[`/api/accounting/waste-report/${a}`,o,c],enabled:!!a});if(v||b||w||S)return e.jsx(D,{});const s=y?.snapshot||{};return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Accounting Dashboard"}),e.jsx(d,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Start Date"}),e.jsx(u,{type:"date",value:o,onChange:t=>f(t.target.value),"data-testid":"input-start-date"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"End Date"}),e.jsx(u,{type:"date",value:c,onChange:t=>N(t.target.value),"data-testid":"input-end-date"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Branch"}),e.jsx(u,{value:a,onChange:t=>g(t.target.value),"data-testid":"input-branch"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(d,{"data-testid":"card-revenue",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(R,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold","data-testid":"text-revenue",children:[s.totalRevenue?.toFixed(2)||"0.00"," SAR"]}),e.jsxs("p",{className:"text-xs text-secondary-foreground",children:[s.itemsSold||0," items sold"]})]})]}),e.jsxs(d,{"data-testid":"card-cogs",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Total COGS"}),e.jsx(T,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold","data-testid":"text-cogs",children:[s.totalCOGS?.toFixed(2)||"0.00"," SAR"]}),e.jsxs("p",{className:"text-xs text-secondary-foreground",children:[(s.totalCOGS/s.totalRevenue*100||0).toFixed(1),"% of revenue"]})]})]}),e.jsxs(d,{"data-testid":"card-profit",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Total Profit"}),e.jsx(L,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600","data-testid":"text-profit",children:[s.totalProfit?.toFixed(2)||"0.00"," SAR"]}),e.jsxs("p",{className:"text-xs text-secondary-foreground",children:[(s.totalProfit/s.totalRevenue*100||0).toFixed(1),"% margin"]})]})]}),e.jsxs(d,{"data-testid":"card-waste",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Total Waste"}),e.jsx(C,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600","data-testid":"text-waste",children:[s.totalWaste?.toFixed(2)||"0.00"," SAR"]}),e.jsxs("p",{className:"text-xs text-secondary-foreground",children:[s.wasteDetails?.length||0," waste items"]})]})]})]}),e.jsxs(d,{"data-testid":"card-top-items",children:[e.jsx(i,{children:e.jsx(r,{children:"Top 10 Profitable Items"})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:m&&m.length>0?m.slice(0,10).map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg","data-testid":`row-top-item-${l}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.nameAr||t.itemId}),e.jsxs("p",{className:"text-sm text-secondary-foreground",children:[t.quantitySold," sold • Profit: ",t.totalProfit?.toFixed(2)," SAR"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-green-600",children:[t.profitMargin?.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-secondary-foreground",children:"margin"})]})]},l)):e.jsx("p",{className:"text-secondary-foreground text-sm",children:"No data available"})})})]}),e.jsxs(d,{"data-testid":"card-waste-report",children:[e.jsx(i,{children:e.jsx(r,{children:"Waste Analysis"})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:h&&h.length>0?h.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-destructive/10 rounded-lg","data-testid":`row-waste-${l}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.itemId}),e.jsxs("p",{className:"text-sm text-secondary-foreground",children:[t.reason||"Unknown"," • ",t.quantity," ",t.unit]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-bold text-destructive",children:[t.cost?.toFixed(2)," SAR"]})})]},l)):e.jsx("p",{className:"text-secondary-foreground text-sm",children:"No waste recorded"})})})]})]})}export{K as default};
