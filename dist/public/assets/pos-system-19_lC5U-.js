var la=Object.defineProperty;var ua=(Ce,M,Pe)=>M in Ce?la(Ce,M,{enumerable:!0,configurable:!0,writable:!0,value:Pe}):Ce[M]=Pe;var Gr=(Ce,M,Pe)=>ua(Ce,typeof M!="symbol"?M+"":M,Pe);import{j as r}from"./vendor-ui-DJm-zmnP.js";import{d as qs,g as da,r as _}from"./vendor-react-Bzsngnqy.js";import{l as Ze,D as ln,E as un,F as dn,H as mn,i as ot,q as Bn,a4 as ma,j as je,k as fn,B as q,M as Mr,P as hn,K as Xr,c as fa,e as ha,aC as pa,N as it,a5 as Ks,A as ya,C as Or,f as Er,r as ys,v as yt,X as xa,I as Ve,a1 as Dr,al as va,am as ga,a6 as xs,_ as ks,p as ba,U as wa,S as ja,ap as Na,$ as Ms,L as Tr,a2 as Js,G as Fs,a0 as Zr,J as vs,T as Rs,au as ka}from"./index-CLvpp2UE.js";import{a as Ln,b as _a}from"./vendor-query-CX8ZYlKb.js";import{S as Sa,a as Ca,b as Pa,c as Aa,d as zs}from"./select-BzAjeBJu.js";import{S as At}from"./separator-bOiezkJy.js";import{S as $n}from"./scroll-area-DK2Y4dAh.js";import{p as on,V as Ia,a as Oa}from"./notification-sounds-C4VBNWg2.js";import{u as Ea}from"./websocket-Bxdgjfcq.js";import{p as gs,a as bs,B as Da,c as Ta}from"./print-utils-uDVQrsY-.js";import{W as qa}from"./wifi-BwJ6pui9.js";import{W as Bs}from"./wifi-off-D42PO9HC.js";import{R as Ka}from"./refresh-cw-BuGj2LMM.js";import{B as Ma}from"./bell-BKcM2vGh.js";import{C as Jr}from"./clipboard-list-C6fMKNlJ.js";import{M as Fa}from"./monitor-smartphone-5TJGBhDy.js";import{R as Ra}from"./receipt-7jFYni-X.js";import{L as za}from"./lock-Dvxo6ahY.js";import{C as ws}from"./circle-play-Bt9DgzFv.js";import{C as qr}from"./circle-check-big-DlXUvwLH.js";import{C as $s}from"./circle-x-B1Jm2Zh7.js";import{S as Ls}from"./shield-BnyrfBf-.js";import{K as Ba}from"./key-round-BfPQAVEt.js";import{P as Vs}from"./percent-CSssf6tt.js";import{N as Xs}from"./navigation-C4sukurV.js";import{P as js}from"./printer-CMPCONS0.js";import{M as $a}from"./message-square-CmUMJD2u.js";import{F as Us}from"./file-text-QZcL_gux.js";import{U as La}from"./users-Ce5vrIiy.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-CqdH-ack.js";import"./html5-qrcode-scanner-BAmOd9U4.js";import"./camera-xRDbuTtR.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=Ze("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=Ze("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=Ze("CandyOff",[["path",{d:"m8.5 8.5-1 1a4.95 4.95 0 0 0 7 7l1-1",key:"1ff4ui"}],["path",{d:"M11.843 6.187A4.947 4.947 0 0 1 16.5 7.5a4.947 4.947 0 0 1 1.313 4.657",key:"1sbrv4"}],["path",{d:"M14 16.5V14",key:"1maf8j"}],["path",{d:"M14 6.5v1.843",key:"1a6u6t"}],["path",{d:"M10 10v7.5",key:"80pj65"}],["path",{d:"m16 7 1-5 1.367.683A3 3 0 0 0 19.708 3H21v1.292a3 3 0 0 0 .317 1.341L22 7l-5 1",key:"11a9mt"}],["path",{d:"m8 17-1 5-1.367-.683A3 3 0 0 0 4.292 21H3v-1.292a3 3 0 0 0-.317-1.341L2 17l5-1",key:"3mjmon"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=Ze("Candy",[["path",{d:"m9.5 7.5-2 2a4.95 4.95 0 1 0 7 7l2-2a4.95 4.95 0 1 0-7-7Z",key:"ue6khb"}],["path",{d:"M14 6.5v10",key:"5xnk7c"}],["path",{d:"M10 7.5v10",key:"1uew51"}],["path",{d:"m16 7 1-5 1.37.68A3 3 0 0 0 19.7 3H21v1.3c0 .46.1.92.32 1.33L22 7l-5 1",key:"b9cp6k"}],["path",{d:"m8 17-1 5-1.37-.68A3 3 0 0 0 4.3 21H3v-1.3a3 3 0 0 0-.32-1.33L2 17l5-1",key:"5lney8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=Ze("CirclePause",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=Ze("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=Ze("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=Ze("Milk",[["path",{d:"M8 2h8",key:"1ssgc1"}],["path",{d:"M9 2v2.789a4 4 0 0 1-.672 2.219l-.656.984A4 4 0 0 0 7 10.212V20a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-9.789a4 4 0 0 0-.672-2.219l-.656-.984A4 4 0 0 1 15 4.788V2",key:"qtp12x"}],["path",{d:"M7 15a6.472 6.472 0 0 1 5 0 6.47 6.47 0 0 0 5 0",key:"ygeh44"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=Ze("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=Ze("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=Ze("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=Ze("SquareSplitVertical",[["path",{d:"M5 8V5c0-1 1-2 2-2h10c1 0 2 1 2 2v3",key:"1pi83i"}],["path",{d:"M19 16v3c0 1-1 2-2 2H7c-1 0-2-1-2-2v-3",key:"ido5k7"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=Ze("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);var ea={exports:{}};(function(Ce,M){(function(Pe,z){Ce.exports=z()})(qs,function(){var Pe=function(e,t){return(Pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(n[a]=s[a])})(e,t)},z=function(){return(z=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function Ue(e,t,n){for(var s,a=0,o=t.length;a<o;a++)!s&&a in t||((s=s||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(s||Array.prototype.slice.call(t))}var le=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:qs,ee=Object.keys,ne=Array.isArray;function se(e,t){return typeof t!="object"||ee(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||le.Promise||(le.Promise=Promise);var ke=Object.getPrototypeOf,L={}.hasOwnProperty;function ce(e,t){return L.call(e,t)}function Ne(e,t){typeof t=="function"&&(t=t(ke(e))),(typeof Reflect>"u"?ee:Reflect.ownKeys)(t).forEach(function(n){me(e,n,t[n])})}var xt=Object.defineProperty;function me(e,t,n,s){xt(e,t,se(n&&ce(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},s))}function re(e){return{from:function(t){return e.prototype=Object.create(t.prototype),me(e.prototype,"constructor",e),{extend:Ne.bind(null,e.prototype)}}}}var et=Object.getOwnPropertyDescriptor,It=[].slice;function Qe(e,t,n){return It.call(e,t,n)}function pn(e,t){return t(e)}function Te(e){if(!e)throw new Error("Assertion Failed")}function yn(e){le.setImmediate?setImmediate(e):setTimeout(e,0)}function qe(e,t){if(typeof t=="string"&&ce(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],s=0,a=t.length;s<a;++s){var o=qe(e,t[s]);n.push(o)}return n}var c=t.indexOf(".");if(c!==-1){var l=e[t.substr(0,c)];return l==null?void 0:qe(l,t.substr(c+1))}}function ge(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Te(typeof n!="string"&&"length"in n);for(var s=0,a=t.length;s<a;++s)ge(e,t[s],n[s])}else{var o,c,l=t.indexOf(".");l!==-1?(o=t.substr(0,l),(c=t.substr(l+1))===""?n===void 0?ne(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n:ge(l=!(l=e[o])||!ce(e,o)?e[o]={}:l,c,n)):n===void 0?ne(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function xn(e){var t,n={};for(t in e)ce(e,t)&&(n[t]=e[t]);return n}var Lt=[].concat;function ct(e){return Lt.apply([],e)}var Nt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ct([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return le[e]}),Ot=new Set(Nt.map(function(e){return le[e]})),be=null;function He(e){return be=new WeakMap,e=function t(n){if(!n||typeof n!="object")return n;var s=be.get(n);if(s)return s;if(ne(n)){s=[],be.set(n,s);for(var a=0,o=n.length;a<o;++a)s.push(t(n[a]))}else if(Ot.has(n.constructor))s=n;else{var c,l=ke(n);for(c in s=l===Object.prototype?{}:Object.create(l),be.set(n,s),n)ce(n,c)&&(s[c]=t(n[c]))}return s}(e),be=null,e}var Vn={}.toString;function Vt(e){return Vn.call(e).slice(8,-1)}var fe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",vn=typeof fe=="symbol"?function(e){var t;return e!=null&&(t=e[fe])&&t.apply(e)}:function(){return null};function Ae(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var P={};function Y(e){var t,n,s,a;if(arguments.length===1){if(ne(e))return e.slice();if(this===P&&typeof e=="string")return[e];if(a=vn(e)){for(n=[];!(s=a.next()).done;)n.push(s.value);return n}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var U=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Et=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],at=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Et),we={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ke(e,t){this.name=e,this.message=t}function X(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,s,a){return a.indexOf(n)===s}).join(`
`)}function Me(e,t,n,s){this.failures=t,this.failedKeys=s,this.successCount=n,this.message=X(e,t)}function vt(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=X(e,this.failures)}re(Ke).from(Error).extend({toString:function(){return this.name+": "+this.message}}),re(Me).from(Ke),re(vt).from(Ke);var gt=at.reduce(function(e,t){return e[t]=t+"Error",e},{}),tt=Ke,F=at.reduce(function(e,t){var n=t+"Error";function s(a,o){this.name=n,a?typeof a=="string"?(this.message="".concat(a).concat(o?`
 `+o:""),this.inner=o||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=we[t]||n,this.inner=null)}return re(s).from(tt),e[t]=s,e},{});F.Syntax=SyntaxError,F.Type=TypeError,F.Range=RangeError;var gn=Et.reduce(function(e,t){return e[t+"Error"]=F[t],e},{}),Ut=at.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=F[t]),e},{});function W(){}function bt(e){return e}function We(e,t){return e==null||e===bt?t:function(n){return t(e(n))}}function wt(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Fe(e,t){return e===W?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var s=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?wt(s,this.onsuccess):s),a&&(this.onerror=this.onerror?wt(a,this.onerror):a),o!==void 0?o:n}}function yr(e,t){return e===W?t:function(){e.apply(this,arguments);var n=this.onsuccess,s=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?wt(n,this.onsuccess):n),s&&(this.onerror=this.onerror?wt(s,this.onerror):s)}}function es(e,t){return e===W?t:function(n){var s=e.apply(this,arguments);se(n,s);var a=this.onsuccess,o=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?wt(a,this.onsuccess):a),o&&(this.onerror=this.onerror?wt(o,this.onerror):o),s===void 0?n===void 0?void 0:n:se(s,n)}}function Un(e,t){return e===W?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Qn(e,t){return e===W?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var s=this,a=arguments.length,o=new Array(a);a--;)o[a]=arguments[a];return n.then(function(){return t.apply(s,o)})}return t.apply(this,arguments)}}Ut.ModifyError=Me,Ut.DexieError=Ke,Ut.BulkError=vt;var Ye=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Fr(e){Ye=e}var jt={},xr=100,Nt=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,ke(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,ke(t),e]}(),Et=Nt[0],at=Nt[1],Nt=Nt[2],at=at&&at.then,lt=Et&&Et.constructor,Dt=!!Nt,Qt=function(e,t){jn.push([e,t]),Wt&&(queueMicrotask(gr),Wt=!1)},Ht=!0,Wt=!0,Yt=[],bn=[],wn=bt,ut={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:W,pgp:!1,env:{},finalize:W},R=ut,jn=[],he=0,Nn=[];function T(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=R;if(typeof e!="function"){if(e!==jt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&zr(this,this._value))}this._state=null,this._value=null,++t.ref,function n(s,a){try{a(function(o){if(s._state===null){if(o===s)throw new TypeError("A promise cannot be resolved with itself.");var c=s._lib&&kt();o&&typeof o.then=="function"?n(s,function(l,d){o instanceof T?o._then(l,d):o.then(l,d)}):(s._state=!0,s._value=o,Q(s)),c&&_n()}},zr.bind(null,s))}catch(o){zr(s,o)}}(this,e)}var kn={get:function(){var e=R,t=Tt;function n(s,a){var o=this,c=!e.global&&(e!==R||t!==Tt),l=c&&!Kt(),d=new T(function(m,y){vr(o,new Rr(mt(s,e,c,l),mt(a,e,c,l),m,y,e))});return this._consoleTask&&(d._consoleTask=this._consoleTask),d}return n.prototype=jt,n},set:function(e){me(this,"then",e&&e.prototype===jt?kn:{get:function(){return e},set:kn.set})}};function Rr(e,t,n,s,a){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=s,this.psd=a}function zr(e,t){var n,s;bn.push(t),e._state===null&&(n=e._lib&&kt(),t=wn(t),e._state=!1,e._value=t,s=e,Yt.some(function(a){return a._value===s._value})||Yt.push(s),Q(e),n&&_n())}function Q(e){var t=e._listeners;e._listeners=[];for(var n=0,s=t.length;n<s;++n)vr(e,t[n]);var a=e._PSD;--a.ref||a.finalize(),he===0&&(++he,Qt(function(){--he==0&&br()},[]))}function vr(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++he,Qt(ts,[n,e,t])}else e._listeners.push(t)}function ts(e,t,n){try{var s,a=t._value;!t._state&&bn.length&&(bn=[]),s=Ye&&t._consoleTask?t._consoleTask.run(function(){return e(a)}):e(a),t._state||bn.indexOf(a)!==-1||function(o){for(var c=Yt.length;c;)if(Yt[--c]._value===o._value)return Yt.splice(c,1)}(t),n.resolve(s)}catch(o){n.reject(o)}finally{--he==0&&br(),--n.psd.ref||n.psd.finalize()}}function gr(){_t(ut,function(){kt()&&_n()})}function kt(){var e=Ht;return Wt=Ht=!1,e}function _n(){var e,t,n;do for(;0<jn.length;)for(e=jn,jn=[],n=e.length,t=0;t<n;++t){var s=e[t];s[0].apply(null,s[1])}while(0<jn.length);Wt=Ht=!0}function br(){var e=Yt;Yt=[],e.forEach(function(s){s._PSD.onunhandled.call(null,s._value,s)});for(var t=Nn.slice(0),n=t.length;n;)t[--n]()}function Hn(e){return new T(jt,!1,e)}function oe(e,t){var n=R;return function(){var s=kt(),a=R;try{return dt(n,!0),e.apply(this,arguments)}catch(o){t&&t(o)}finally{dt(a,!1),s&&_n()}}}Ne(T.prototype,{then:kn,_then:function(e,t){vr(this,new Rr(null,null,e,t,R))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t=="function"?this.then(null,function(s){return(s instanceof t?n:Hn)(s)}):this.then(null,function(s){return(s&&s.name===t?n:Hn)(s)})},finally:function(e){return this.then(function(t){return T.resolve(e()).then(function(){return t})},function(t){return T.resolve(e()).then(function(){return Hn(t)})})},timeout:function(e,t){var n=this;return e<1/0?new T(function(s,a){var o=setTimeout(function(){return a(new F.Timeout(t))},e);n.then(s,a).finally(clearTimeout.bind(null,o))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&me(T.prototype,Symbol.toStringTag,"Dexie.Promise"),ut.env=nt(),Ne(T,{all:function(){var e=Y.apply(null,arguments).map(Gt);return new T(function(t,n){e.length===0&&t([]);var s=e.length;e.forEach(function(a,o){return T.resolve(a).then(function(c){e[o]=c,--s||t(e)},n)})})},resolve:function(e){return e instanceof T?e:e&&typeof e.then=="function"?new T(function(t,n){e.then(t,n)}):new T(jt,!0,e)},reject:Hn,race:function(){var e=Y.apply(null,arguments).map(Gt);return new T(function(t,n){e.map(function(s){return T.resolve(s).then(t,n)})})},PSD:{get:function(){return R},set:function(e){return R=e}},totalEchoes:{get:function(){return Tt}},newPSD:pe,usePSD:_t,scheduler:{get:function(){return Qt},set:function(e){Qt=e}},rejectionMapper:{get:function(){return wn},set:function(e){wn=e}},follow:function(e,t){return new T(function(n,s){return pe(function(a,o){var c=R;c.unhandleds=[],c.onunhandled=o,c.finalize=wt(function(){var l,d=this;l=function(){d.unhandleds.length===0?a():o(d.unhandleds[0])},Nn.push(function m(){l(),Nn.splice(Nn.indexOf(m),1)}),++he,Qt(function(){--he==0&&br()},[])},c.finalize),e()},t,n,s)})}}),lt&&(lt.allSettled&&me(T,"allSettled",function(){var e=Y.apply(null,arguments).map(Gt);return new T(function(t){e.length===0&&t([]);var n=e.length,s=new Array(n);e.forEach(function(a,o){return T.resolve(a).then(function(c){return s[o]={status:"fulfilled",value:c}},function(c){return s[o]={status:"rejected",reason:c}}).then(function(){return--n||t(s)})})})}),lt.any&&typeof AggregateError<"u"&&me(T,"any",function(){var e=Y.apply(null,arguments).map(Gt);return new T(function(t,n){e.length===0&&n(new AggregateError([]));var s=e.length,a=new Array(s);e.forEach(function(o,c){return T.resolve(o).then(function(l){return t(l)},function(l){a[c]=l,--s||n(new AggregateError(a))})})})}),lt.withResolvers&&(T.withResolvers=lt.withResolvers));var te={awaits:0,echoes:0,id:0},ns=0,Be=[],Wn=0,Tt=0,rs=0;function pe(e,t,n,s){var a=R,o=Object.create(a);return o.parent=a,o.ref=0,o.global=!1,o.id=++rs,ut.env,o.env=Dt?{Promise:T,PromiseProp:{value:T,configurable:!0,writable:!0},all:T.all,race:T.race,allSettled:T.allSettled,any:T.any,resolve:T.resolve,reject:T.reject}:{},t&&se(o,t),++a.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()},s=_t(o,e,n,s),o.ref===0&&o.finalize(),s}function qt(){return te.id||(te.id=++ns),++te.awaits,te.echoes+=xr,te.id}function Kt(){return!!te.awaits&&(--te.awaits==0&&(te.id=0),te.echoes=te.awaits*xr,!0)}function Gt(e){return te.echoes&&e&&e.constructor===lt?(qt(),e.then(function(t){return Kt(),t},function(t){return Kt(),ue(t)})):e}function wr(){var e=Be[Be.length-1];Be.pop(),dt(e,!1)}function dt(e,t){var n,s=R;(t?!te.echoes||Wn++&&e===R:!Wn||--Wn&&e===R)||queueMicrotask(t?function(a){++Tt,te.echoes&&--te.echoes!=0||(te.echoes=te.awaits=te.id=0),Be.push(R),dt(a,!0)}.bind(null,e):wr),e!==R&&(R=e,s===ut&&(ut.env=nt()),Dt&&(n=ut.env.Promise,t=e.env,(s.global||e.global)&&(Object.defineProperty(le,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function nt(){var e=le.Promise;return Dt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(le,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function _t(e,t,n,s,a){var o=R;try{return dt(e,!0),t(n,s,a)}finally{dt(o,!1)}}function mt(e,t,n,s){return typeof e!="function"?e:function(){var a=R;n&&qt(),dt(t,!0);try{return e.apply(this,arguments)}finally{dt(a,!1),s&&queueMicrotask(Kt)}}}function Yn(e){Promise===lt&&te.echoes===0?Wn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+at).indexOf("[native code]")===-1&&(qt=Kt=W);var ue=T.reject,St="ï¿¿",ft="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Sn="String expected.",rt=[],Mt="__dbnames",Gn="readonly",Jn="readwrite";function Ct(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var jr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Cn(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=He(t))[e],t}}function Xn(){throw F.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function $(e,t){try{var n=Nr(e),s=Nr(t);if(n!==s)return n==="Array"?1:s==="Array"?-1:n==="binary"?1:s==="binary"?-1:n==="string"?1:s==="string"?-1:n==="Date"?1:s!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(a,o){for(var c=a.length,l=o.length,d=c<l?c:l,m=0;m<d;++m)if(a[m]!==o[m])return a[m]<o[m]?-1:1;return c===l?0:c<l?-1:1}(ht(e),ht(t));case"Array":return function(a,o){for(var c=a.length,l=o.length,d=c<l?c:l,m=0;m<d;++m){var y=$(a[m],o[m]);if(y!==0)return y}return c===l?0:c<l?-1:1}(e,t)}}catch{}return NaN}function Nr(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=Vt(e),e==="ArrayBuffer"?"binary":e)}function ht(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Zn(e,t,n){var s=e.schema.yProps;return s?(t&&0<n.numFailures&&(t=t.filter(function(a,o){return!n.failures[o]})),Promise.all(s.map(function(a){return a=a.updatesTable,t?e.db.table(a).where("k").anyOf(t).delete():e.db.table(a).clear()})).then(function(){return n})):n}var Pn=(kr.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var n=t.add;if(ne(n))return Ue(Ue([],ne(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(t.remove!==void 0){var s=t.remove;if(ne(s))return ne(e)?e.filter(function(a){return!s.includes(a)}).sort():[];if(typeof s=="number")return Number(e)-s;if(typeof s=="bigint")try{return BigInt(e)-s}catch{return BigInt(0)-s}throw new TypeError("Invalid subtrahend ".concat(s))}return n=(n=t.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e},kr);function kr(e){this["@@propmod"]=e}function Ie(e,t){for(var n=ee(t),s=n.length,a=!1,o=0;o<s;++o){var c=n[o],l=t[c],d=qe(e,c);l instanceof Pn?(ge(e,c,l.execute(d)),a=!0):d!==l&&(ge(e,c,l),a=!0)}return a}var An=(ie.prototype._trans=function(e,t,n){var s=this._tx||R.trans,a=this.name,o=Ye&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function c(m,y,u){if(!u.schema[a])throw new F.NotFound("Table "+a+" not part of transaction");return t(u.idbtrans,u)}var l=kt();try{var d=s&&s.db._novip===this.db._novip?s===R.trans?s._promise(e,c,n):pe(function(){return s._promise(e,c,n)},{trans:s,transless:R.transless||R}):function m(y,u,v,f){if(y.idbdb&&(y._state.openComplete||R.letThrough||y._vip)){var h=y._createTransaction(u,v,y._dbSchema);try{h.create(),y._state.PR1398_maxLoop=3}catch(p){return p.name===gt.InvalidState&&y.isOpen()&&0<--y._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),y.close({disableAutoOpen:!1}),y.open().then(function(){return m(y,u,v,f)})):ue(p)}return h._promise(u,function(p,x){return pe(function(){return R.trans=h,f(p,x,h)})}).then(function(p){if(u==="readwrite")try{h.idbtrans.commit()}catch{}return u==="readonly"?p:h._completion.then(function(){return p})})}if(y._state.openComplete)return ue(new F.DatabaseClosed(y._state.dbOpenError));if(!y._state.isBeingOpened){if(!y._state.autoOpen)return ue(new F.DatabaseClosed);y.open().catch(W)}return y._state.dbReadyPromise.then(function(){return m(y,u,v,f)})}(this.db,e,[this.name],c);return o&&(d._consoleTask=o,d=d.catch(function(m){return console.trace(m),ue(m)})),d}finally{l&&_n()}},ie.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?ue(new F.Type("Invalid argument to Table.get()")):this._trans("readonly",function(s){return n.core.get({trans:s,key:e}).then(function(a){return n.hook.reading.fire(a)})}).then(t)},ie.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ne(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=ee(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(l){if(l.compound&&t.every(function(m){return 0<=l.keyPath.indexOf(m)})){for(var d=0;d<t.length;++d)if(t.indexOf(l.keyPath[d])===-1)return!1;return!0}return!1}).sort(function(l,d){return l.keyPath.length-d.keyPath.length})[0];if(n&&this.db._maxKey!==St){var o=n.keyPath.slice(0,t.length);return this.where(o).equals(o.map(function(d){return e[d]}))}!n&&Ye&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var s=this.schema.idxByName;function a(l,d){return $(l,d)===0}var c=t.reduce(function(u,d){var m=u[0],y=u[1],u=s[d],v=e[d];return[m||u,m||!u?Ct(y,u&&u.multi?function(f){return f=qe(f,d),ne(f)&&f.some(function(h){return a(v,h)})}:function(f){return a(v,qe(f,d))}):y]},[null,null]),o=c[0],c=c[1];return o?this.where(o.name).equals(e[o.keyPath]).filter(c):n?this.filter(c):this.where(t).equals("")},ie.prototype.filter=function(e){return this.toCollection().and(e)},ie.prototype.count=function(e){return this.toCollection().count(e)},ie.prototype.offset=function(e){return this.toCollection().offset(e)},ie.prototype.limit=function(e){return this.toCollection().limit(e)},ie.prototype.each=function(e){return this.toCollection().each(e)},ie.prototype.toArray=function(e){return this.toCollection().toArray(e)},ie.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ie.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,ne(e)?"[".concat(e.join("+"),"]"):e))},ie.prototype.reverse=function(){return this.toCollection().reverse()},ie.prototype.mapToClass=function(e){var t,n=this.db,s=this.name;function a(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Xn&&(function(d,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function y(){this.constructor=d}Pe(d,m),d.prototype=m===null?Object.create(m):(y.prototype=m.prototype,new y)}(a,t=e),Object.defineProperty(a.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),a.prototype.table=function(){return s},e=a);for(var o=new Set,c=e.prototype;c;c=ke(c))Object.getOwnPropertyNames(c).forEach(function(d){return o.add(d)});function l(d){if(!d)return d;var m,y=Object.create(e.prototype);for(m in d)if(!o.has(m))try{y[m]=d[m]}catch{}return y}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=l,this.hook("reading",l),e},ie.prototype.defineClass=function(){return this.mapToClass(function(e){se(this,e)})},ie.prototype.add=function(e,t){var n=this,s=this.schema.primKey,a=s.auto,o=s.keyPath,c=e;return o&&a&&(c=Cn(o)(e)),this._trans("readwrite",function(l){return n.core.mutate({trans:l,type:"add",keys:t!=null?[t]:null,values:[c]})}).then(function(l){return l.numFailures?T.reject(l.failures[0]):l.lastResult}).then(function(l){if(o)try{ge(e,o,l)}catch{}return l})},ie.prototype.upsert=function(e,t){var n=this,s=this.schema.primKey.keyPath;return this._trans("readwrite",function(a){return n.core.get({trans:a,key:e}).then(function(o){var c=o??{};return Ie(c,t),s&&ge(c,s,e),n.core.mutate({trans:a,type:"put",values:[c],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(l){return l.numFailures?T.reject(l.failures[0]):!!o})})})},ie.prototype.update=function(e,t){return typeof e!="object"||ne(e)?this.where(":id").equals(e).modify(t):(e=qe(e,this.schema.primKey.keyPath),e===void 0?ue(new F.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},ie.prototype.put=function(e,t){var n=this,s=this.schema.primKey,a=s.auto,o=s.keyPath,c=e;return o&&a&&(c=Cn(o)(e)),this._trans("readwrite",function(l){return n.core.mutate({trans:l,type:"put",values:[c],keys:t!=null?[t]:null})}).then(function(l){return l.numFailures?T.reject(l.failures[0]):l.lastResult}).then(function(l){if(o)try{ge(e,o,l)}catch{}return l})},ie.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(s){return Zn(t,[e],s)}).then(function(s){return s.numFailures?T.reject(s.failures[0]):void 0})})},ie.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:jr}).then(function(n){return Zn(e,null,n)})}).then(function(t){return t.numFailures?T.reject(t.failures[0]):void 0})},ie.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(s){return s.map(function(a){return t.hook.reading.fire(a)})})})},ie.prototype.bulkAdd=function(e,t,n){var s=this,a=Array.isArray(t)?t:void 0,o=(n=n||(a?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(c){var m=s.schema.primKey,l=m.auto,m=m.keyPath;if(m&&a)throw new F.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new F.InvalidArgument("Arguments objects and keys must have the same length");var d=e.length,m=m&&l?e.map(Cn(m)):e;return s.core.mutate({trans:c,type:"add",keys:a,values:m,wantResults:o}).then(function(h){var u=h.numFailures,v=h.results,f=h.lastResult,h=h.failures;if(u===0)return o?v:f;throw new vt("".concat(s.name,".bulkAdd(): ").concat(u," of ").concat(d," operations failed"),h)})})},ie.prototype.bulkPut=function(e,t,n){var s=this,a=Array.isArray(t)?t:void 0,o=(n=n||(a?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(c){var m=s.schema.primKey,l=m.auto,m=m.keyPath;if(m&&a)throw new F.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new F.InvalidArgument("Arguments objects and keys must have the same length");var d=e.length,m=m&&l?e.map(Cn(m)):e;return s.core.mutate({trans:c,type:"put",keys:a,values:m,wantResults:o}).then(function(h){var u=h.numFailures,v=h.results,f=h.lastResult,h=h.failures;if(u===0)return o?v:f;throw new vt("".concat(s.name,".bulkPut(): ").concat(u," of ").concat(d," operations failed"),h)})})},ie.prototype.bulkUpdate=function(e){var t=this,n=this.core,s=e.map(function(c){return c.key}),a=e.map(function(c){return c.changes}),o=[];return this._trans("readwrite",function(c){return n.getMany({trans:c,keys:s,cache:"clone"}).then(function(l){var d=[],m=[];e.forEach(function(u,v){var f=u.key,h=u.changes,p=l[v];if(p){for(var x=0,g=Object.keys(h);x<g.length;x++){var w=g[x],N=h[w];if(w===t.schema.primKey.keyPath){if($(N,f)!==0)throw new F.Constraint("Cannot update primary key in bulkUpdate()")}else ge(p,w,N)}o.push(v),d.push(f),m.push(p)}});var y=d.length;return n.mutate({trans:c,type:"put",keys:d,values:m,updates:{keys:s,changeSpecs:a}}).then(function(u){var v=u.numFailures,f=u.failures;if(v===0)return y;for(var h=0,p=Object.keys(f);h<p.length;h++){var x,g=p[h],w=o[Number(g)];w!=null&&(x=f[g],delete f[g],f[w]=x)}throw new vt("".concat(t.name,".bulkUpdate(): ").concat(v," of ").concat(y," operations failed"),f)})})})},ie.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(s){return t.core.mutate({trans:s,type:"delete",keys:e}).then(function(a){return Zn(t,e,a)})}).then(function(c){var a=c.numFailures,o=c.lastResult,c=c.failures;if(a===0)return o;throw new vt("".concat(t.name,".bulkDelete(): ").concat(a," of ").concat(n," operations failed"),c)})},ie);function ie(){}function Jt(e){function t(c,l){if(l){for(var d=arguments.length,m=new Array(d-1);--d;)m[d-1]=arguments[d];return n[c].subscribe.apply(null,m),e}if(typeof c=="string")return n[c]}var n={};t.addEventType=o;for(var s=1,a=arguments.length;s<a;++s)o(arguments[s]);return t;function o(c,l,d){if(typeof c!="object"){var m;l=l||Un;var y={subscribers:[],fire:d=d||W,subscribe:function(u){y.subscribers.indexOf(u)===-1&&(y.subscribers.push(u),y.fire=l(y.fire,u))},unsubscribe:function(u){y.subscribers=y.subscribers.filter(function(v){return v!==u}),y.fire=y.subscribers.reduce(l,d)}};return n[c]=t[c]=y}ee(m=c).forEach(function(u){var v=m[u];if(ne(v))o(u,m[u][0],m[u][1]);else{if(v!=="asap")throw new F.InvalidArgument("Invalid event config");var f=o(u,bt,function(){for(var h=arguments.length,p=new Array(h);h--;)p[h]=arguments[h];f.subscribers.forEach(function(x){yn(function(){x.apply(null,p)})})})}})}}function In(e,t){return re(t).from({prototype:e}),t}function Ft(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function er(e,t){e.filter=Ct(e.filter,t)}function tr(e,t,n){var s=e.replayFilter;e.replayFilter=s?function(){return Ct(s(),t())}:t,e.justLimit=n&&!s}function _r(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new F.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function nr(e,t,n){var s=_r(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:s,range:e.range}})}function rr(e,t,n,s){var a=e.replayFilter?Ct(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},c=function(l,d,m){var y,u;a&&!a(d,m,function(v){return d.stop(v)},function(v){return d.fail(v)})||((u=""+(y=d.primaryKey))=="[object ArrayBuffer]"&&(u=""+new Uint8Array(y)),ce(o,u)||(o[u]=!0,t(l,d,m)))};return Promise.all([e.or._iterate(c,n),On(nr(e,s,n),e.algorithm,c,!e.keysOnly&&e.valueMapper)])}return On(nr(e,s,n),Ct(e.algorithm,a),t,!e.keysOnly&&e.valueMapper)}function On(e,t,n,s){var a=oe(s?function(o,c,l){return n(s(o),c,l)}:n);return e.then(function(o){if(o)return o.start(function(){var c=function(){return o.continue()};t&&!t(o,function(l){return c=l},function(l){o.stop(l),c=W},function(l){o.fail(l),c=W})||a(o.value,o,function(l){return c=l}),c()})})}var ss=(Z.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,ue.bind(null,n.error)):n.table._trans("readonly",e).then(t)},Z.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,ue.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},Z.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Ct(t.algorithm,e)},Z.prototype._iterate=function(e,t){return rr(this._ctx,e,t,this._ctx.table.core)},Z.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&se(n,e),t._ctx=n,t},Z.prototype.raw=function(){return this._ctx.valueMapper=null,this},Z.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return rr(t,e,n,t.table.core)})},Z.prototype.count=function(e){var t=this;return this._read(function(n){var s=t._ctx,a=s.table.core;if(Ft(s,!0))return a.count({trans:n,query:{index:_r(s,a.schema),range:s.range}}).then(function(c){return Math.min(c,s.limit)});var o=0;return rr(s,function(){return++o,!1},n,a).then(function(){return o})}).then(e)},Z.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),s=n[0],a=n.length-1;function o(d,m){return m?o(d[n[m]],m-1):d[s]}var c=this._ctx.dir==="next"?1:-1;function l(d,m){return $(o(d,a),o(m,a))*c}return this.toArray(function(d){return d.sort(l)}).then(t)},Z.prototype.toArray=function(e){var t=this;return this._read(function(n){var s=t._ctx;if(s.dir==="next"&&Ft(s,!0)&&0<s.limit){var a=s.valueMapper,o=_r(s,s.table.core.schema);return s.table.core.query({trans:n,limit:s.limit,values:!0,query:{index:o,range:s.range}}).then(function(l){return l=l.result,a?l.map(a):l})}var c=[];return rr(s,function(l){return c.push(l)},n,s.table.core).then(function(){return c})},e)},Z.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Ft(t)?tr(t,function(){var n=e;return function(s,a){return n===0||(n===1?--n:a(function(){s.advance(n),n=0}),!1)}}):tr(t,function(){var n=e;return function(){return--n<0}})),this},Z.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),tr(this._ctx,function(){var t=e;return function(n,s,a){return--t<=0&&s(a),0<=t}},!0),this},Z.prototype.until=function(e,t){return er(this._ctx,function(n,s,a){return!e(n.value)||(s(a),t)}),this},Z.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},Z.prototype.last=function(e){return this.reverse().first(e)},Z.prototype.filter=function(e){var t;return er(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=Ct(t.isMatch,e),this},Z.prototype.and=function(e){return this.filter(e)},Z.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Z.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Z.prototype.desc=function(){return this.reverse()},Z.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,s){e(s.key,s)})},Z.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Z.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,s){e(s.primaryKey,s)})},Z.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(s,a){n.push(a.key)}).then(function(){return n}).then(e)},Z.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Ft(t,!0)&&0<t.limit)return this._read(function(s){var a=_r(t,t.table.core.schema);return t.table.core.query({trans:s,values:!1,limit:t.limit,query:{index:a,range:t.range}})}).then(function(s){return s.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(s,a){n.push(a.primaryKey)}).then(function(){return n}).then(e)},Z.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Z.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},Z.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Z.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return er(this._ctx,function(a){var s=a.primaryKey.toString(),a=ce(t,s);return t[s]=!0,!a}),this},Z.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(s){var a=typeof e=="function"?e:function(p){return Ie(p,e)},o=n.table.core,m=o.schema.primaryKey,c=m.outbound,l=m.extractKey,d=200,m=t.db._options.modifyChunkSize;m&&(d=typeof m=="object"?m[o.name]||m["*"]||200:m);function y(p,w){var g=w.failures,w=w.numFailures;v+=p-w;for(var N=0,k=ee(g);N<k.length;N++){var C=k[N];u.push(g[C])}}var u=[],v=0,f=[],h=e===En;return t.clone().primaryKeys().then(function(p){function x(w){var N=Math.min(d,p.length-w),k=p.slice(w,w+N);return(h?Promise.resolve([]):o.getMany({trans:s,keys:k,cache:"immutable"})).then(function(C){var E=[],S=[],A=c?[]:null,D=h?k:[];if(!h)for(var O=0;O<N;++O){var K=C[O],H={value:He(K),primKey:p[w+O]};a.call(H,H.value,H)!==!1&&(H.value==null?D.push(p[w+O]):c||$(l(K),l(H.value))===0?(S.push(H.value),c&&A.push(p[w+O])):(D.push(p[w+O]),E.push(H.value)))}return Promise.resolve(0<E.length&&o.mutate({trans:s,type:"add",values:E}).then(function(G){for(var J in G.failures)D.splice(parseInt(J),1);y(E.length,G)})).then(function(){return(0<S.length||g&&typeof e=="object")&&o.mutate({trans:s,type:"put",keys:A,values:S,criteria:g,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<w}).then(function(G){return y(S.length,G)})}).then(function(){return(0<D.length||g&&h)&&o.mutate({trans:s,type:"delete",keys:D,criteria:g,isAdditionalChunk:0<w}).then(function(G){return Zn(n.table,D,G)}).then(function(G){return y(D.length,G)})}).then(function(){return p.length>w+N&&x(w+d)})})}var g=Ft(n)&&n.limit===1/0&&(typeof e!="function"||h)&&{index:n.index,range:n.range};return x(0).then(function(){if(0<u.length)throw new Me("Error modifying one or more objects",u,v,f);return p.length})})})},Z.prototype.delete=function(){var e=this._ctx,t=e.range;return!Ft(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(En):this._write(function(n){var s=e.table.core.schema.primaryKey,a=t;return e.table.core.count({trans:n,query:{index:s,range:a}}).then(function(o){return e.table.core.mutate({trans:n,type:"deleteRange",range:a}).then(function(d){var l=d.failures,d=d.numFailures;if(d)throw new Me("Could not delete some values",Object.keys(l).map(function(m){return l[m]}),o-d);return o-d})})})},Z);function Z(){}var En=function(e,t){return t.value=null};function sr(e,t){return e<t?-1:e===t?0:1}function Xt(e,t){return t<e?-1:e===t?0:1}function _e(e,t,n){return e=e instanceof Dn?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function ye(e){return new e.Collection(e,function(){return ar("")}).limit(0)}function $e(e,t,n,s){var a,o,c,l,d,m,y,u=n.length;if(!n.every(function(h){return typeof h=="string"}))return _e(e,Sn);function v(h){a=h==="next"?function(x){return x.toUpperCase()}:function(x){return x.toLowerCase()},o=h==="next"?function(x){return x.toLowerCase()}:function(x){return x.toUpperCase()},c=h==="next"?sr:Xt;var p=n.map(function(x){return{lower:o(x),upper:a(x)}}).sort(function(x,g){return c(x.lower,g.lower)});l=p.map(function(x){return x.upper}),d=p.map(function(x){return x.lower}),y=(m=h)==="next"?"":s}v("next"),e=new e.Collection(e,function(){return Oe(l[0],d[u-1]+s)}),e._ondirectionchange=function(h){v(h)};var f=0;return e._addAlgorithm(function(h,p,x){var g=h.key;if(typeof g!="string")return!1;var w=o(g);if(t(w,d,f))return!0;for(var N=null,k=f;k<u;++k){var C=function(E,S,A,D,O,K){for(var H=Math.min(E.length,D.length),G=-1,J=0;J<H;++J){var Xe=S[J];if(Xe!==D[J])return O(E[J],A[J])<0?E.substr(0,J)+A[J]+A.substr(J+1):O(E[J],D[J])<0?E.substr(0,J)+D[J]+A.substr(J+1):0<=G?E.substr(0,G)+S[G]+A.substr(G+1):null;O(E[J],Xe)<0&&(G=J)}return H<D.length&&K==="next"?E+A.substr(E.length):H<E.length&&K==="prev"?E.substr(0,A.length):G<0?null:E.substr(0,G)+D[G]+A.substr(G+1)}(g,w,l[k],d[k],c,m);C===null&&N===null?f=k+1:(N===null||0<c(N,C))&&(N=C)}return p(N!==null?function(){h.continue(N+y)}:x),!1}),e}function Oe(e,t,n,s){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:s}}function ar(e){return{type:1,lower:e,upper:e}}var Dn=(Object.defineProperty(xe.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),xe.prototype.between=function(e,t,n,s){n=n!==!1,s=s===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||s)&&(!n||!s)?ye(this):new this.Collection(this,function(){return Oe(e,t,!n,!s)})}catch{return _e(this,ft)}},xe.prototype.equals=function(e){return e==null?_e(this,ft):new this.Collection(this,function(){return ar(e)})},xe.prototype.above=function(e){return e==null?_e(this,ft):new this.Collection(this,function(){return Oe(e,void 0,!0)})},xe.prototype.aboveOrEqual=function(e){return e==null?_e(this,ft):new this.Collection(this,function(){return Oe(e,void 0,!1)})},xe.prototype.below=function(e){return e==null?_e(this,ft):new this.Collection(this,function(){return Oe(void 0,e,!1,!0)})},xe.prototype.belowOrEqual=function(e){return e==null?_e(this,ft):new this.Collection(this,function(){return Oe(void 0,e)})},xe.prototype.startsWith=function(e){return typeof e!="string"?_e(this,Sn):this.between(e,e+St,!0,!0)},xe.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):$e(this,function(t,n){return t.indexOf(n[0])===0},[e],St)},xe.prototype.equalsIgnoreCase=function(e){return $e(this,function(t,n){return t===n[0]},[e],"")},xe.prototype.anyOfIgnoreCase=function(){var e=Y.apply(P,arguments);return e.length===0?ye(this):$e(this,function(t,n){return n.indexOf(t)!==-1},e,"")},xe.prototype.startsWithAnyOfIgnoreCase=function(){var e=Y.apply(P,arguments);return e.length===0?ye(this):$e(this,function(t,n){return n.some(function(s){return t.indexOf(s)===0})},e,St)},xe.prototype.anyOf=function(){var e=this,t=Y.apply(P,arguments),n=this._cmp;try{t.sort(n)}catch{return _e(this,ft)}if(t.length===0)return ye(this);var s=new this.Collection(this,function(){return Oe(t[0],t[t.length-1])});s._ondirectionchange=function(o){n=o==="next"?e._ascending:e._descending,t.sort(n)};var a=0;return s._addAlgorithm(function(o,c,l){for(var d=o.key;0<n(d,t[a]);)if(++a===t.length)return c(l),!1;return n(d,t[a])===0||(c(function(){o.continue(t[a])}),!1)}),s},xe.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},xe.prototype.noneOf=function(){var e=Y.apply(P,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return _e(this,ft)}var t=e.reduce(function(n,s){return n?n.concat([[n[n.length-1][1],s]]):[[-1/0,s]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},xe.prototype.inAnyRange=function(g,t){var n=this,s=this._cmp,a=this._ascending,o=this._descending,c=this._min,l=this._max;if(g.length===0)return ye(this);if(!g.every(function(w){return w[0]!==void 0&&w[1]!==void 0&&a(w[0],w[1])<=0}))return _e(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",F.InvalidArgument);var d=!t||t.includeLowers!==!1,m=t&&t.includeUppers===!0,y,u=a;function v(w,N){return u(w[0],N[0])}try{(y=g.reduce(function(w,N){for(var k=0,C=w.length;k<C;++k){var E=w[k];if(s(N[0],E[1])<0&&0<s(N[1],E[0])){E[0]=c(E[0],N[0]),E[1]=l(E[1],N[1]);break}}return k===C&&w.push(N),w},[])).sort(v)}catch{return _e(this,ft)}var f=0,h=m?function(w){return 0<a(w,y[f][1])}:function(w){return 0<=a(w,y[f][1])},p=d?function(w){return 0<o(w,y[f][0])}:function(w){return 0<=o(w,y[f][0])},x=h,g=new this.Collection(this,function(){return Oe(y[0][0],y[y.length-1][1],!d,!m)});return g._ondirectionchange=function(w){u=w==="next"?(x=h,a):(x=p,o),y.sort(v)},g._addAlgorithm(function(w,N,k){for(var C,E=w.key;x(E);)if(++f===y.length)return N(k),!1;return!h(C=E)&&!p(C)||(n._cmp(E,y[f][1])===0||n._cmp(E,y[f][0])===0||N(function(){u===a?w.continue(y[f][0]):w.continue(y[f][1])}),!1)}),g},xe.prototype.startsWithAnyOf=function(){var e=Y.apply(P,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?ye(this):this.inAnyRange(e.map(function(t){return[t,t+St]})):_e(this,"startsWithAnyOf() only works with strings")},xe);function xe(){}function Le(e){return oe(function(t){return Pt(t),e(t.target.error),!1})}function Pt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Zt="storagemutated",Tn="x-storagemutated-1",pt=Jt(null,Zt),as=(Ge.prototype._lock=function(){return Te(!R.global),++this._reculock,this._reculock!==1||R.global||(R.lockOwnerFor=this),this},Ge.prototype._unlock=function(){if(Te(!R.global),--this._reculock==0)for(R.global||(R.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{_t(e[1],e[0])}catch{}}return this},Ge.prototype._locked=function(){return this._reculock&&R.lockOwnerFor!==this},Ge.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,s=this.db._state.dbOpenError;if(Te(!this.idbtrans),!e&&!n)switch(s&&s.name){case"DatabaseClosedError":throw new F.DatabaseClosed(s);case"MissingAPIError":throw new F.MissingAPI(s.message,s);default:throw new F.OpenFailed(s)}if(!this.active)throw new F.TransactionInactive;return Te(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=oe(function(a){Pt(a),t._reject(e.error)}),e.onabort=oe(function(a){Pt(a),t.active&&t._reject(new F.Abort(e.error)),t.active=!1,t.on("abort").fire(a)}),e.oncomplete=oe(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&pt.storagemutated.fire(e.mutatedParts)}),this},Ge.prototype._promise=function(e,t,n){var s=this;if(e==="readwrite"&&this.mode!=="readwrite")return ue(new F.ReadOnly("Transaction is readonly"));if(!this.active)return ue(new F.TransactionInactive);if(this._locked())return new T(function(o,c){s._blockedFuncs.push([function(){s._promise(e,t,n).then(o,c)},R])});if(n)return pe(function(){var o=new T(function(c,l){s._lock();var d=t(c,l,s);d&&d.then&&d.then(c,l)});return o.finally(function(){return s._unlock()}),o._lib=!0,o});var a=new T(function(o,c){var l=t(o,c,s);l&&l.then&&l.then(o,c)});return a._lib=!0,a},Ge.prototype._root=function(){return this.parent?this.parent._root():this},Ge.prototype.waitFor=function(e){var t,n=this._root(),s=T.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return s}):(n._waitingFor=s,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=o)}());var a=n._waitingFor;return new T(function(o,c){s.then(function(l){return n._waitingQueue.push(oe(o.bind(null,l)))},function(l){return n._waitingQueue.push(oe(c.bind(null,l)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},Ge.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new F.Abort))},Ge.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(ce(t,e))return t[e];var n=this.schema[e];if(!n)throw new F.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},Ge);function Ge(){}function ir(e,t,n,s,a,o,c,l){return{name:e,keyPath:t,unique:n,multi:s,auto:a,compound:o,src:(n&&!c?"&":"")+(s?"*":"")+(a?"++":"")+Br(t),type:l}}function Br(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function en(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(s=function(a){return[a.name,a]},n.reduce(function(a,o,c){return c=s(o,c),c&&(a[c[0]]=c[1]),a},{}))};var s}var st=function(e){try{return e.only([[]]),st=function(){return[[]]},[[]]}catch{return st=function(){return St},St}};function tn(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return qe(n,t)}:function(n){return qe(n,e)};var t}function or(e){return[].slice.call(e)}var $r=0;function qn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function is(e,t,d){function s(x){if(x.type===3)return null;if(x.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var f=x.lower,h=x.upper,p=x.lowerOpen,x=x.upperOpen;return f===void 0?h===void 0?null:t.upperBound(h,!!x):h===void 0?t.lowerBound(f,!!p):t.bound(f,h,!!p,!!x)}function a(v){var f,h=v.name;return{name:h,schema:v,mutate:function(p){var x=p.trans,g=p.type,w=p.keys,N=p.values,k=p.range;return new Promise(function(C,E){C=oe(C);var S=x.objectStore(h),A=S.keyPath==null,D=g==="put"||g==="add";if(!D&&g!=="delete"&&g!=="deleteRange")throw new Error("Invalid operation type: "+g);var O,K=(w||N||{length:1}).length;if(w&&N&&w.length!==N.length)throw new Error("Given keys array must have same length as given values array.");if(K===0)return C({numFailures:0,failures:{},results:[],lastResult:void 0});function H(ze){++Xe,Pt(ze)}var G=[],J=[],Xe=0;if(g==="deleteRange"){if(k.type===4)return C({numFailures:Xe,failures:J,results:[],lastResult:void 0});k.type===3?G.push(O=S.clear()):G.push(O=S.delete(s(k)))}else{var A=D?A?[N,w]:[N,null]:[w,null],V=A[0],Ee=A[1];if(D)for(var De=0;De<K;++De)G.push(O=Ee&&Ee[De]!==void 0?S[g](V[De],Ee[De]):S[g](V[De])),O.onerror=H;else for(De=0;De<K;++De)G.push(O=S[g](V[De])),O.onerror=H}function Yr(ze){ze=ze.target.result,G.forEach(function(zn,ps){return zn.error!=null&&(J[ps]=zn.error)}),C({numFailures:Xe,failures:J,results:g==="delete"?w:G.map(function(zn){return zn.result}),lastResult:ze})}O.onerror=function(ze){H(ze),Yr(ze)},O.onsuccess=Yr})},getMany:function(p){var x=p.trans,g=p.keys;return new Promise(function(w,N){w=oe(w);for(var k,C=x.objectStore(h),E=g.length,S=new Array(E),A=0,D=0,O=function(G){G=G.target,S[G._pos]=G.result,++D===A&&w(S)},K=Le(N),H=0;H<E;++H)g[H]!=null&&((k=C.get(g[H]))._pos=H,k.onsuccess=O,k.onerror=K,++A);A===0&&w(S)})},get:function(p){var x=p.trans,g=p.key;return new Promise(function(w,N){w=oe(w);var k=x.objectStore(h).get(g);k.onsuccess=function(C){return w(C.target.result)},k.onerror=Le(N)})},query:(f=m,function(p){return new Promise(function(x,g){x=oe(x);var w,N,k,A=p.trans,C=p.values,E=p.limit,O=p.query,S=E===1/0?void 0:E,D=O.index,O=O.range,A=A.objectStore(h),D=D.isPrimaryKey?A:A.index(D.name),O=s(O);if(E===0)return x({result:[]});f?((S=C?D.getAll(O,S):D.getAllKeys(O,S)).onsuccess=function(K){return x({result:K.target.result})},S.onerror=Le(g)):(w=0,N=!C&&"openKeyCursor"in D?D.openKeyCursor(O):D.openCursor(O),k=[],N.onsuccess=function(K){var H=N.result;return H?(k.push(C?H.value:H.primaryKey),++w===E?x({result:k}):void H.continue()):x({result:k})},N.onerror=Le(g))})}),openCursor:function(p){var x=p.trans,g=p.values,w=p.query,N=p.reverse,k=p.unique;return new Promise(function(C,E){C=oe(C);var D=w.index,S=w.range,A=x.objectStore(h),A=D.isPrimaryKey?A:A.index(D.name),D=N?k?"prevunique":"prev":k?"nextunique":"next",O=!g&&"openKeyCursor"in A?A.openKeyCursor(s(S),D):A.openCursor(s(S),D);O.onerror=Le(E),O.onsuccess=oe(function(K){var H,G,J,Xe,V=O.result;V?(V.___id=++$r,V.done=!1,H=V.continue.bind(V),G=(G=V.continuePrimaryKey)&&G.bind(V),J=V.advance.bind(V),Xe=function(){throw new Error("Cursor not stopped")},V.trans=x,V.stop=V.continue=V.continuePrimaryKey=V.advance=function(){throw new Error("Cursor not started")},V.fail=oe(E),V.next=function(){var Ee=this,De=1;return this.start(function(){return De--?Ee.continue():Ee.stop()}).then(function(){return Ee})},V.start=function(Ee){function De(){if(O.result)try{Ee()}catch(ze){V.fail(ze)}else V.done=!0,V.start=function(){throw new Error("Cursor behind last entry")},V.stop()}var Yr=new Promise(function(ze,zn){ze=oe(ze),O.onerror=Le(zn),V.fail=zn,V.stop=function(ps){V.stop=V.continue=V.continuePrimaryKey=V.advance=Xe,ze(ps)}});return O.onsuccess=oe(function(ze){O.onsuccess=De,De()}),V.continue=H,V.continuePrimaryKey=G,V.advance=J,De(),Yr},C(V)):C(null)},E)})},count:function(p){var x=p.query,g=p.trans,w=x.index,N=x.range;return new Promise(function(k,C){var E=g.objectStore(h),S=w.isPrimaryKey?E:E.index(w.name),E=s(N),S=E?S.count(E):S.count();S.onsuccess=oe(function(A){return k(A.target.result)}),S.onerror=Le(C)})}}}var o,c,l,y=(c=d,l=or((o=e).objectStoreNames),{schema:{name:o.name,tables:l.map(function(v){return c.objectStore(v)}).map(function(v){var f=v.keyPath,x=v.autoIncrement,h=ne(f),p={},x={name:v.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:f==null,compound:h,keyPath:f,autoIncrement:x,unique:!0,extractKey:tn(f)},indexes:or(v.indexNames).map(function(g){return v.index(g)}).map(function(k){var w=k.name,N=k.unique,C=k.multiEntry,k=k.keyPath,C={name:w,compound:ne(k),keyPath:k,unique:N,multiEntry:C,extractKey:tn(k)};return p[qn(k)]=C}),getIndexByKeyPath:function(g){return p[qn(g)]}};return p[":id"]=x.primaryKey,f!=null&&(p[qn(f)]=x.primaryKey),x})},hasGetAll:0<l.length&&"getAll"in c.objectStore(l[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),d=y.schema,m=y.hasGetAll,y=d.tables.map(a),u={};return y.forEach(function(v){return u[v.name]=v}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(v){if(!u[v])throw new Error("Table '".concat(v,"' not found"));return u[v]},MIN_KEY:-1/0,MAX_KEY:st(t),schema:d}}function os(e,t,n,s){var a=n.IDBKeyRange;return n.indexedDB,{dbcore:(s=is(t,a,s),e.dbcore.reduce(function(o,c){return c=c.create,z(z({},o),c(o))},s))}}function cr(e,s){var n=s.db,s=os(e._middlewares,n,e._deps,s);e.core=s.dbcore,e.tables.forEach(function(a){var o=a.name;e.core.schema.tables.some(function(c){return c.name===o})&&(a.core=e.core.table(o),e[o]instanceof e.Table&&(e[o].core=a.core))})}function Kn(e,t,n,s){n.forEach(function(a){var o=s[a];t.forEach(function(c){var l=function d(m,y){return et(m,y)||(m=ke(m))&&d(m,y)}(c,a);(!l||"value"in l&&l.value===void 0)&&(c===e.Transaction.prototype||c instanceof e.Transaction?me(c,a,{get:function(){return this.table(a)},set:function(d){xt(this,a,{value:d,writable:!0,configurable:!0,enumerable:!0})}}):c[a]=new e.Table(a,o))})})}function Sr(e,t){t.forEach(function(n){for(var s in n)n[s]instanceof e.Table&&delete n[s]})}function Rt(e,t){return e._cfg.version-t._cfg.version}function lr(e,t,n,s){var a=e._dbSchema;n.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=en("$meta",Pr("")[0],[]),e._storeNames.push("$meta"));var o=e._createTransaction("readwrite",e._storeNames,a);o.create(n),o._completion.catch(s);var c=o._reject.bind(o),l=R.transless||R;pe(function(){return R.trans=o,R.transless=l,t!==0?(cr(e,n),m=t,((d=o).storeNames.includes("$meta")?d.table("$meta").get("version").then(function(y){return y??m}):T.resolve(m)).then(function(y){return v=y,f=o,h=n,p=[],y=(u=e)._versions,x=u._dbSchema=dr(0,u.idbdb,h),(y=y.filter(function(g){return g._cfg.version>=v})).length!==0?(y.forEach(function(g){p.push(function(){var w=x,N=g._cfg.dbschema;mr(u,w,h),mr(u,N,h),x=u._dbSchema=N;var k=Je(w,N);k.add.forEach(function(D){Cr(h,D[0],D[1].primKey,D[1].indexes)}),k.change.forEach(function(D){if(D.recreate)throw new F.Upgrade("Not yet support for changing primary key");var O=h.objectStore(D.name);D.add.forEach(function(K){return ur(O,K)}),D.change.forEach(function(K){O.deleteIndex(K.name),ur(O,K)}),D.del.forEach(function(K){return O.deleteIndex(K)})});var C=g._cfg.contentUpgrade;if(C&&g._cfg.version>v){cr(u,h),f._memoizedTables={};var E=xn(N);k.del.forEach(function(D){E[D]=w[D]}),Sr(u,[u.Transaction.prototype]),Kn(u,[u.Transaction.prototype],ee(E),E),f.schema=E;var S,A=U(C);return A&&qt(),k=T.follow(function(){var D;(S=C(f))&&A&&(D=Kt.bind(null,null),S.then(D,D))}),S&&typeof S.then=="function"?T.resolve(S):k.then(function(){return S})}}),p.push(function(w){var N,k,C=g._cfg.dbschema;N=C,k=w,[].slice.call(k.db.objectStoreNames).forEach(function(E){return N[E]==null&&k.db.deleteObjectStore(E)}),Sr(u,[u.Transaction.prototype]),Kn(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),f.schema=u._dbSchema}),p.push(function(w){u.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(u.idbdb.version/10)===g._cfg.version?(u.idbdb.deleteObjectStore("$meta"),delete u._dbSchema.$meta,u._storeNames=u._storeNames.filter(function(N){return N!=="$meta"})):w.objectStore("$meta").put(g._cfg.version,"version"))})}),function g(){return p.length?T.resolve(p.shift()(f.idbtrans)).then(g):T.resolve()}().then(function(){Lr(x,h)})):T.resolve();var u,v,f,h,p,x}).catch(c)):(ee(a).forEach(function(y){Cr(n,y,a[y].primKey,a[y].indexes)}),cr(e,n),void T.follow(function(){return e.on.populate.fire(o)}).catch(c));var d,m})}function zt(e,t){Lr(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=dr(0,e.idbdb,t);mr(e,e._dbSchema,t);for(var s=0,a=Je(n,e._dbSchema).change;s<a.length;s++){var o=function(c){if(c.change.length||c.recreate)return console.warn("Unable to patch indexes of table ".concat(c.name," because it has changes on the type of index or primary key.")),{value:void 0};var l=t.objectStore(c.name);c.add.forEach(function(d){Ye&&console.debug("Dexie upgrade patch: Creating missing index ".concat(c.name,".").concat(d.src)),ur(l,d)})}(a[s]);if(typeof o=="object")return o.value}}function Je(e,t){var n,s={del:[],add:[],change:[]};for(n in e)t[n]||s.del.push(n);for(n in t){var a=e[n],o=t[n];if(a){var c={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||a.primKey.auto!==o.primKey.auto)c.recreate=!0,s.change.push(c);else{var l=a.idxByName,d=o.idxByName,m=void 0;for(m in l)d[m]||c.del.push(m);for(m in d){var y=l[m],u=d[m];y?y.src!==u.src&&c.change.push(u):c.add.push(u)}(0<c.del.length||0<c.add.length||0<c.change.length)&&s.change.push(c)}}else s.add.push([n,o])}return s}function Cr(e,t,n,s){var a=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return s.forEach(function(o){return ur(a,o)}),a}function Lr(e,t){ee(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(Ye&&console.debug("Dexie: Creating missing table",n),Cr(t,n,e[n].primKey,e[n].indexes))})}function ur(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function dr(e,t,n){var s={};return Qe(t.objectStoreNames,0).forEach(function(a){for(var o=n.objectStore(a),c=ir(Br(m=o.keyPath),m||"",!0,!1,!!o.autoIncrement,m&&typeof m!="string",!0),l=[],d=0;d<o.indexNames.length;++d){var y=o.index(o.indexNames[d]),m=y.keyPath,y=ir(y.name,m,!!y.unique,!!y.multiEntry,!1,m&&typeof m!="string",!1);l.push(y)}s[a]=en(a,c,l)}),s}function mr(e,t,n){for(var s=n.db.objectStoreNames,a=0;a<s.length;++a){var o=s[a],c=n.objectStore(o);e._hasGetAll="getAll"in c;for(var l=0;l<c.indexNames.length;++l){var d=c.indexNames[l],m=c.index(d).keyPath,y=typeof m=="string"?m:"["+Qe(m).join("+")+"]";!t[o]||(m=t[o].idxByName[y])&&(m.name=d,delete t[o].idxByName[y],t[o].idxByName[d]=m)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&le.WorkerGlobalScope&&le instanceof le.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Pr(e){return e.split(",").map(function(t,n){var o=t.split(":"),s=(a=o[1])===null||a===void 0?void 0:a.trim(),a=(t=o[0].trim()).replace(/([&*]|\+\+)/g,""),o=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return ir(a,o||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),ne(o),n===0,s)})}var cs=(nn.prototype._createTableSchema=en,nn.prototype._parseIndexSyntax=Pr,nn.prototype._parseStoresSpec=function(e,t){var n=this;ee(e).forEach(function(s){if(e[s]!==null){var a=n._parseIndexSyntax(e[s]),o=a.shift();if(!o)throw new F.Schema("Invalid schema for table "+s+": "+e[s]);if(o.unique=!0,o.multi)throw new F.Schema("Primary key cannot be multiEntry*");a.forEach(function(c){if(c.auto)throw new F.Schema("Only primary key can be marked as autoIncrement (++)");if(!c.keyPath)throw new F.Schema("Index must have a name and cannot be an empty string")}),a=n._createTableSchema(s,o,a),t[s]=a}})},nn.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?se(this._cfg.storesSource,n):n;var n=t._versions,s={},a={};return n.forEach(function(o){se(s,o._cfg.storesSource),a=o._cfg.dbschema={},o._parseStoresSpec(s,a)}),t._dbSchema=a,Sr(t,[t._allTables,t,t.Transaction.prototype]),Kn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],ee(a),a),t._storeNames=ee(a),this},nn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Qn(this._cfg.contentUpgrade||W,e),this},nn);function nn(){}function Mn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new $t(Mt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Ar(e){return e&&typeof e.databases=="function"}function Ir(e){return pe(function(){return R.letThrough=!0,e()})}function Bt(e){return!("from"in e)}var Se=function(e,t){if(!this){var n=new Se;return e&&"d"in e&&se(n,e),n}se(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Fn(e,t,n){var s=$(t,n);if(!isNaN(s)){if(0<s)throw RangeError();if(Bt(e))return se(e,{from:t,to:n,d:1});var a=e.l,s=e.r;if($(n,e.from)<0)return a?Fn(a,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Ur(e);if(0<$(t,e.to))return s?Fn(s,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Ur(e);$(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),0<$(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,a&&!e.l&&rn(e,a),s&&n&&rn(e,s)}}function rn(e,t){Bt(t)||function n(s,d){var o=d.from,c=d.to,l=d.l,d=d.r;Fn(s,o,c),l&&n(s,l),d&&n(s,d)}(e,t)}function Vr(e,t){var n=fr(t),s=n.next();if(s.done)return!1;for(var a=s.value,o=fr(e),c=o.next(a.from),l=c.value;!s.done&&!c.done;){if($(l.from,a.to)<=0&&0<=$(l.to,a.from))return!0;$(a.from,l.from)<0?a=(s=n.next(l.from)).value:l=(c=o.next(a.from)).value}return!1}function fr(e){var t=Bt(e)?null:{s:0,n:e};return{next:function(n){for(var s=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,s)for(;t.n.l&&$(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!s||$(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Ur(e){var t,n,s=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),a=1<s?"r":s<-1?"l":"";a&&(t=a=="r"?"l":"r",n=z({},e),s=e[a],e.from=s.from,e.to=s.to,e[a]=s[a],n[a]=s[t],(e[t]=n).d=i(n)),e.d=i(e)}function i(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function b(e,t){return ee(t).forEach(function(n){e[n]?rn(e[n],t[n]):e[n]=function s(a){var o,c,l={};for(o in a)ce(a,o)&&(c=a[o],l[o]=!c||typeof c!="object"||Ot.has(c.constructor)?c:s(c));return l}(t[n])}),e}function j(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&Vr(t[n],e[n])})}Ne(Se.prototype,((at={add:function(e){return rn(this,e),this},addKey:function(e){return Fn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return Fn(t,n,n)}),this},hasKey:function(e){var t=fr(this).next(e).value;return t&&$(t.from,e)<=0&&0<=$(t.to,e)}})[fe]=function(){return fr(this)},at));var I={},B={},ae=!1;function de(e){b(B,e),ae||(ae=!0,setTimeout(function(){ae=!1,Re(B,!(B={}))},0))}function Re(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var s=0,a=Object.values(I);s<a.length;s++)sn(c=a[s],e,n,t);else for(var o in e){var c,l=/^idb\:\/\/(.*)\/(.*)\//.exec(o);l&&(o=l[1],l=l[2],(c=I["idb://".concat(o,"/").concat(l)])&&sn(c,e,n,t))}n.forEach(function(d){return d()})}function sn(e,t,n,s){for(var a=[],o=0,c=Object.entries(e.queries.query);o<c.length;o++){for(var l=c[o],d=l[0],m=[],y=0,u=l[1];y<u.length;y++){var v=u[y];j(t,v.obsSet)?v.subscribers.forEach(function(x){return n.add(x)}):s&&m.push(v)}s&&a.push([d,m])}if(s)for(var f=0,h=a;f<h.length;f++){var p=h[f],d=p[0],m=p[1];e.queries.query[d]=m}}function hr(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?ue(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var s=t.openCanceller,a=Math.round(10*e.verno),o=!1;function c(){if(t.openCanceller!==s)throw new F.DatabaseClosed("db.open() was cancelled")}function l(){return new T(function(v,f){if(c(),!n)throw new F.MissingAPI;var h=e.name,p=t.autoSchema||!a?n.open(h):n.open(h,a);if(!p)throw new F.MissingAPI;p.onerror=Le(f),p.onblocked=oe(e._fireOnBlocked),p.onupgradeneeded=oe(function(x){var g;y=p.transaction,t.autoSchema&&!e._options.allowEmptyDB?(p.onerror=Pt,y.abort(),p.result.close(),(g=n.deleteDatabase(h)).onsuccess=g.onerror=oe(function(){f(new F.NoSuchDatabase("Database ".concat(h," doesnt exist")))})):(y.onerror=Le(f),x=x.oldVersion>Math.pow(2,62)?0:x.oldVersion,u=x<1,e.idbdb=p.result,o&&zt(e,y),lr(e,x/10,y,f))},f),p.onsuccess=oe(function(){y=null;var x,g,w,N,k,C=e.idbdb=p.result,E=Qe(C.objectStoreNames);if(0<E.length)try{var S=C.transaction((N=E).length===1?N[0]:N,"readonly");if(t.autoSchema)g=C,w=S,(x=e).verno=g.version/10,w=x._dbSchema=dr(0,g,w),x._storeNames=Qe(g.objectStoreNames,0),Kn(x,[x._allTables],ee(w),w);else if(mr(e,e._dbSchema,S),((k=Je(dr(0,(k=e).idbdb,S),k._dbSchema)).add.length||k.change.some(function(A){return A.add.length||A.change.length}))&&!o)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),C.close(),a=C.version+1,o=!0,v(l());cr(e,S)}catch{}rt.push(e),C.onversionchange=oe(function(A){t.vcFired=!0,e.on("versionchange").fire(A)}),C.onclose=oe(function(){e.close({disableAutoOpen:!1})}),u&&(k=e._deps,S=h,C=k.indexedDB,k=k.IDBKeyRange,Ar(C)||S===Mt||Mn(C,k).put({name:S}).catch(W)),v()},f)}).catch(function(v){switch(v?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l();break;case"VersionError":if(0<a)return a=0,l()}return T.reject(v)})}var d,m=t.dbReadyResolve,y=null,u=!1;return T.race([s,(typeof navigator>"u"?T.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(v){function f(){return indexedDB.databases().finally(v)}d=setInterval(f,100),f()}).finally(function(){return clearInterval(d)}):Promise.resolve()).then(l)]).then(function(){return c(),t.onReadyBeingFired=[],T.resolve(Ir(function(){return e.on.ready.fire(e.vip)})).then(function v(){if(0<t.onReadyBeingFired.length){var f=t.onReadyBeingFired.reduce(Qn,W);return t.onReadyBeingFired=[],T.resolve(Ir(function(){return f(e.vip)})).then(v)}})}).finally(function(){t.openCanceller===s&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(v){t.dbOpenError=v;try{y&&y.abort()}catch{}return s===t.openCanceller&&e._close(),ue(v)}).finally(function(){t.openComplete=!0,m()}).then(function(){var v;return u&&(v={},e.tables.forEach(function(f){f.schema.indexes.forEach(function(h){h.name&&(v["idb://".concat(e.name,"/").concat(f.name,"/").concat(h.name)]=new Se(-1/0,[[[]]]))}),v["idb://".concat(e.name,"/").concat(f.name,"/")]=v["idb://".concat(e.name,"/").concat(f.name,"/:dels")]=new Se(-1/0,[[[]]])}),pt(Zt).fire(v),Re(v,!0)),e})}function ls(e){function t(o){return e.next(o)}var n=a(t),s=a(function(o){return e.throw(o)});function a(o){return function(d){var l=o(d),d=l.value;return l.done?d:d&&typeof d.then=="function"?d.then(n,s):ne(d)?Promise.all(d).then(n,s):n(d)}}return a(t)()}function Qr(e,t,n){for(var s=ne(e)?e.slice():[e],a=0;a<n;++a)s.push(t);return s}var ta={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return z(z({},e),{table:function(t){var n=e.table(t),s=n.schema,a={},o=[];function c(u,v,f){var h=qn(u),p=a[h]=a[h]||[],x=u==null?0:typeof u=="string"?1:u.length,g=0<v,g=z(z({},f),{name:g?"".concat(h,"(virtual-from:").concat(f.name,")"):f.name,lowLevelIndex:f,isVirtual:g,keyTail:v,keyLength:x,extractKey:tn(u),unique:!g&&f.unique});return p.push(g),g.isPrimaryKey||o.push(g),1<x&&c(x===2?u[0]:u.slice(0,x-1),v+1,f),p.sort(function(w,N){return w.keyTail-N.keyTail}),g}t=c(s.primaryKey.keyPath,0,s.primaryKey),a[":id"]=[t];for(var l=0,d=s.indexes;l<d.length;l++){var m=d[l];c(m.keyPath,0,m)}function y(u){var v,f=u.query.index;return f.isVirtual?z(z({},u),{query:{index:f.lowLevelIndex,range:(v=u.query.range,f=f.keyTail,{type:v.type===1?2:v.type,lower:Qr(v.lower,v.lowerOpen?e.MAX_KEY:e.MIN_KEY,f),lowerOpen:!0,upper:Qr(v.upper,v.upperOpen?e.MIN_KEY:e.MAX_KEY,f),upperOpen:!0})}}):u}return z(z({},n),{schema:z(z({},s),{primaryKey:t,indexes:o,getIndexByKeyPath:function(u){return(u=a[qn(u)])&&u[0]}}),count:function(u){return n.count(y(u))},query:function(u){return n.query(y(u))},openCursor:function(u){var v=u.query.index,f=v.keyTail,h=v.isVirtual,p=v.keyLength;return h?n.openCursor(y(u)).then(function(g){return g&&x(g)}):n.openCursor(u);function x(g){return Object.create(g,{continue:{value:function(w){w!=null?g.continue(Qr(w,u.reverse?e.MAX_KEY:e.MIN_KEY,f)):u.unique?g.continue(g.key.slice(0,p).concat(u.reverse?e.MIN_KEY:e.MAX_KEY,f)):g.continue()}},continuePrimaryKey:{value:function(w,N){g.continuePrimaryKey(Qr(w,e.MAX_KEY,f),N)}},primaryKey:{get:function(){return g.primaryKey}},key:{get:function(){var w=g.key;return p===1?w[0]:w.slice(0,p)}},value:{get:function(){return g.value}}})}}})}})}};function us(e,t,n,s){return n=n||{},s=s||"",ee(e).forEach(function(a){var o,c,l;ce(t,a)?(o=e[a],c=t[a],typeof o=="object"&&typeof c=="object"&&o&&c?(l=Vt(o))!==Vt(c)?n[s+a]=t[a]:l==="Object"?us(o,c,n,s+a+"."):o!==c&&(n[s+a]=t[a]):o!==c&&(n[s+a]=t[a])):n[s+a]=void 0}),ee(t).forEach(function(a){ce(e,a)||(n[s+a]=t[a])}),n}function ds(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var na={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return z(z({},e),{table:function(t){var n=e.table(t),s=n.schema.primaryKey;return z(z({},n),{mutate:function(a){var o=R.trans,c=o.table(t).hook,l=c.deleting,d=c.creating,m=c.updating;switch(a.type){case"add":if(d.fire===W)break;return o._promise("readwrite",function(){return y(a)},!0);case"put":if(d.fire===W&&m.fire===W)break;return o._promise("readwrite",function(){return y(a)},!0);case"delete":if(l.fire===W)break;return o._promise("readwrite",function(){return y(a)},!0);case"deleteRange":if(l.fire===W)break;return o._promise("readwrite",function(){return function u(v,f,h){return n.query({trans:v,values:!1,query:{index:s,range:f},limit:h}).then(function(p){var x=p.result;return y({type:"delete",keys:x,trans:v}).then(function(g){return 0<g.numFailures?Promise.reject(g.failures[0]):x.length<h?{failures:[],numFailures:0,lastResult:void 0}:u(v,z(z({},f),{lower:x[x.length-1],lowerOpen:!0}),h)})})}(a.trans,a.range,1e4)},!0)}return n.mutate(a);function y(u){var v,f,h,p=R.trans,x=u.keys||ds(s,u);if(!x)throw new Error("Keys missing");return(u=u.type==="add"||u.type==="put"?z(z({},u),{keys:x}):z({},u)).type!=="delete"&&(u.values=Ue([],u.values)),u.keys&&(u.keys=Ue([],u.keys)),v=n,h=x,((f=u).type==="add"?Promise.resolve([]):v.getMany({trans:f.trans,keys:h,cache:"immutable"})).then(function(g){var w=x.map(function(N,k){var C,E,S,A=g[k],D={onerror:null,onsuccess:null};return u.type==="delete"?l.fire.call(D,N,A,p):u.type==="add"||A===void 0?(C=d.fire.call(D,N,u.values[k],p),N==null&&C!=null&&(u.keys[k]=N=C,s.outbound||ge(u.values[k],s.keyPath,N))):(C=us(A,u.values[k]),(E=m.fire.call(D,C,N,A,p))&&(S=u.values[k],Object.keys(E).forEach(function(O){ce(S,O)?S[O]=E[O]:ge(S,O,E[O])}))),D});return n.mutate(u).then(function(N){for(var k=N.failures,C=N.results,E=N.numFailures,N=N.lastResult,S=0;S<x.length;++S){var A=(C||x)[S],D=w[S];A==null?D.onerror&&D.onerror(k[S]):D.onsuccess&&D.onsuccess(u.type==="put"&&g[S]?u.values[S]:A)}return{failures:k,results:C,numFailures:E,lastResult:N}}).catch(function(N){return w.forEach(function(k){return k.onerror&&k.onerror(N)}),Promise.reject(N)})})}}})}})}};function Cs(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var s=[],a=0,o=0;a<t.keys.length&&o<e.length;++a)$(t.keys[a],e[o])===0&&(s.push(n?He(t.values[a]):t.values[a]),++o);return s.length===e.length?s:null}catch{return null}}var ra={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return z(z({},n),{getMany:function(s){if(!s.cache)return n.getMany(s);var a=Cs(s.keys,s.trans._cache,s.cache==="clone");return a?T.resolve(a):n.getMany(s).then(function(o){return s.trans._cache={keys:s.keys,values:s.cache==="clone"?He(o):o},o})},mutate:function(s){return s.type!=="add"&&(s.trans._cache=null),n.mutate(s)}})}}}};function Ps(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function As(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var sa={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new Se(e.MIN_KEY,e.MAX_KEY);return z(z({},e),{transaction:function(s,a,o){if(R.subscr&&a!=="readonly")throw new F.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(R.querier));return e.transaction(s,a,o)},table:function(s){var a=e.table(s),o=a.schema,c=o.primaryKey,u=o.indexes,l=c.extractKey,d=c.outbound,m=c.autoIncrement&&u.filter(function(f){return f.compound&&f.keyPath.includes(c.keyPath)}),y=z(z({},a),{mutate:function(f){function h(O){return O="idb://".concat(t,"/").concat(s,"/").concat(O),N[O]||(N[O]=new Se)}var p,x,g,w=f.trans,N=f.mutatedParts||(f.mutatedParts={}),k=h(""),C=h(":dels"),E=f.type,D=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[ds(c,f).filter(function(O){return O}),f.values]:[],S=D[0],A=D[1],D=f.trans._cache;return ne(S)?(k.addKeys(S),(D=E==="delete"||S.length===A.length?Cs(S,D):null)||C.addKeys(S),(D||A)&&(p=h,x=D,g=A,o.indexes.forEach(function(O){var K=p(O.name||"");function H(J){return J!=null?O.extractKey(J):null}function G(J){return O.multiEntry&&ne(J)?J.forEach(function(Xe){return K.addKey(Xe)}):K.addKey(J)}(x||g).forEach(function(J,Ee){var V=x&&H(x[Ee]),Ee=g&&H(g[Ee]);$(V,Ee)!==0&&(V!=null&&G(V),Ee!=null&&G(Ee))})}))):S?(A={from:(A=S.lower)!==null&&A!==void 0?A:e.MIN_KEY,to:(A=S.upper)!==null&&A!==void 0?A:e.MAX_KEY},C.add(A),k.add(A)):(k.add(n),C.add(n),o.indexes.forEach(function(O){return h(O.name).add(n)})),a.mutate(f).then(function(O){return!S||f.type!=="add"&&f.type!=="put"||(k.addKeys(O.results),m&&m.forEach(function(K){for(var H=f.values.map(function(V){return K.extractKey(V)}),G=K.keyPath.findIndex(function(V){return V===c.keyPath}),J=0,Xe=O.results.length;J<Xe;++J)H[J][G]=O.results[J];h(K.name).addKeys(H)})),w.mutatedParts=b(w.mutatedParts||{},N),O})}}),u=function(h){var p=h.query,h=p.index,p=p.range;return[h,new Se((h=p.lower)!==null&&h!==void 0?h:e.MIN_KEY,(p=p.upper)!==null&&p!==void 0?p:e.MAX_KEY)]},v={get:function(f){return[c,new Se(f.key)]},getMany:function(f){return[c,new Se().addKeys(f.keys)]},count:u,query:u,openCursor:u};return ee(v).forEach(function(f){y[f]=function(h){var p=R.subscr,x=!!p,g=Ps(R,a)&&As(f,h)?h.obsSet={}:p;if(x){var w=function(A){return A="idb://".concat(t,"/").concat(s,"/").concat(A),g[A]||(g[A]=new Se)},N=w(""),k=w(":dels"),p=v[f](h),x=p[0],p=p[1];if((f==="query"&&x.isPrimaryKey&&!h.values?k:w(x.name||"")).add(p),!x.isPrimaryKey){if(f!=="count"){var C=f==="query"&&d&&h.values&&a.query(z(z({},h),{values:!1}));return a[f].apply(this,arguments).then(function(A){if(f==="query"){if(d&&h.values)return C.then(function(H){return H=H.result,N.addKeys(H),A});var D=h.values?A.result.map(l):A.result;(h.values?N:k).addKeys(D)}else if(f==="openCursor"){var O=A,K=h.values;return O&&Object.create(O,{key:{get:function(){return k.addKey(O.primaryKey),O.key}},primaryKey:{get:function(){var H=O.primaryKey;return k.addKey(H),H}},value:{get:function(){return K&&N.addKey(O.primaryKey),O.value}}})}return A})}k.add(n)}}return a[f].apply(this,arguments)}}),y}})}};function Is(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var s=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return n.numFailures===s?null:(t=z({},t),ne(t.keys)&&(t.keys=t.keys.filter(function(a,o){return!(o in n.failures)})),"values"in t&&ne(t.values)&&(t.values=t.values.filter(function(a,o){return!(o in n.failures)})),t)}function ms(e,t){return n=e,((s=t).lower===void 0||(s.lowerOpen?0<$(n,s.lower):0<=$(n,s.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?$(e,t.upper)<0:$(e,t.upper)<=0));var n,s}function Os(e,t,v,s,a,o){if(!v||v.length===0)return e;var c=t.query.index,l=c.multiEntry,d=t.query.range,m=s.schema.primaryKey.extractKey,y=c.extractKey,u=(c.lowLevelIndex||c).extractKey,v=v.reduce(function(f,h){var p=f,x=[];if(h.type==="add"||h.type==="put")for(var g=new Se,w=h.values.length-1;0<=w;--w){var N,k=h.values[w],C=m(k);g.hasKey(C)||(N=y(k),(l&&ne(N)?N.some(function(O){return ms(O,d)}):ms(N,d))&&(g.addKey(C),x.push(k)))}switch(h.type){case"add":var E=new Se().addKeys(t.values?f.map(function(K){return m(K)}):f),p=f.concat(t.values?x.filter(function(K){return K=m(K),!E.hasKey(K)&&(E.addKey(K),!0)}):x.map(function(K){return m(K)}).filter(function(K){return!E.hasKey(K)&&(E.addKey(K),!0)}));break;case"put":var S=new Se().addKeys(h.values.map(function(K){return m(K)}));p=f.filter(function(K){return!S.hasKey(t.values?m(K):K)}).concat(t.values?x:x.map(function(K){return m(K)}));break;case"delete":var A=new Se().addKeys(h.keys);p=f.filter(function(K){return!A.hasKey(t.values?m(K):K)});break;case"deleteRange":var D=h.range;p=f.filter(function(K){return!ms(m(K),D)})}return p},e);return v===e?e:(v.sort(function(f,h){return $(u(f),u(h))||$(m(f),m(h))}),t.limit&&t.limit<1/0&&(v.length>t.limit?v.length=t.limit:e.length===t.limit&&v.length<t.limit&&(a.dirty=!0)),o?Object.freeze(v):v)}function Es(e,t){return $(e.lower,t.lower)===0&&$(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function aa(e,t){return function(n,s,a,o){if(n===void 0)return s!==void 0?-1:0;if(s===void 0)return 1;if((s=$(n,s))===0){if(a&&o)return 0;if(a)return 1;if(o)return-1}return s}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(n,s,a,o){if(n===void 0)return s!==void 0?1:0;if(s===void 0)return-1;if((s=$(n,s))===0){if(a&&o)return 0;if(a)return-1;if(o)return 1}return s}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function ia(e,t,n,s){e.subscribers.add(n),s.addEventListener("abort",function(){var a,o;e.subscribers.delete(n),e.subscribers.size===0&&(a=e,o=t,setTimeout(function(){a.subscribers.size===0&&Ae(o,a)},3e3))})}var oa={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return z(z({},e),{transaction:function(n,s,a){var o,c,l=e.transaction(n,s,a);return s==="readwrite"&&(c=(o=new AbortController).signal,a=function(d){return function(){if(o.abort(),s==="readwrite"){for(var m=new Set,y=0,u=n;y<u.length;y++){var v=u[y],f=I["idb://".concat(t,"/").concat(v)];if(f){var h=e.table(v),p=f.optimisticOps.filter(function(K){return K.trans===l});if(l._explicit&&d&&l.mutatedParts)for(var x=0,g=Object.values(f.queries.query);x<g.length;x++)for(var w=0,N=(E=g[x]).slice();w<N.length;w++)j((S=N[w]).obsSet,l.mutatedParts)&&(Ae(E,S),S.subscribers.forEach(function(K){return m.add(K)}));else if(0<p.length){f.optimisticOps=f.optimisticOps.filter(function(K){return K.trans!==l});for(var k=0,C=Object.values(f.queries.query);k<C.length;k++)for(var E,S,A,D=0,O=(E=C[k]).slice();D<O.length;D++)(S=O[D]).res!=null&&l.mutatedParts&&(d&&!S.dirty?(A=Object.isFrozen(S.res),A=Os(S.res,S.req,p,h,S,A),S.dirty?(Ae(E,S),S.subscribers.forEach(function(K){return m.add(K)})):A!==S.res&&(S.res=A,S.promise=T.resolve({result:A}))):(S.dirty&&Ae(E,S),S.subscribers.forEach(function(K){return m.add(K)})))}}}m.forEach(function(K){return K()})}}},l.addEventListener("abort",a(!1),{signal:c}),l.addEventListener("error",a(!1),{signal:c}),l.addEventListener("complete",a(!0),{signal:c})),l},table:function(n){var s=e.table(n),a=s.schema.primaryKey;return z(z({},s),{mutate:function(o){var c=R.trans;if(a.outbound||c.db._options.cache==="disabled"||c.explicit||c.idbtrans.mode!=="readwrite")return s.mutate(o);var l=I["idb://".concat(t,"/").concat(n)];return l?(c=s.mutate(o),o.type!=="add"&&o.type!=="put"||!(50<=o.values.length||ds(a,o).some(function(d){return d==null}))?(l.optimisticOps.push(o),o.mutatedParts&&de(o.mutatedParts),c.then(function(d){0<d.numFailures&&(Ae(l.optimisticOps,o),(d=Is(0,o,d))&&l.optimisticOps.push(d),o.mutatedParts&&de(o.mutatedParts))}),c.catch(function(){Ae(l.optimisticOps,o),o.mutatedParts&&de(o.mutatedParts)})):c.then(function(d){var m=Is(0,z(z({},o),{values:o.values.map(function(y,u){var v;return d.failures[u]?y:(y=(v=a.keyPath)!==null&&v!==void 0&&v.includes(".")?He(y):z({},y),ge(y,a.keyPath,d.results[u]),y)})}),d);l.optimisticOps.push(m),queueMicrotask(function(){return o.mutatedParts&&de(o.mutatedParts)})}),c):s.mutate(o)},query:function(o){if(!Ps(R,s)||!As("query",o))return s.query(o);var c=((m=R.trans)===null||m===void 0?void 0:m.db._options.cache)==="immutable",u=R,l=u.requery,d=u.signal,m=function(h,p,x,g){var w=I["idb://".concat(h,"/").concat(p)];if(!w)return[];if(!(p=w.queries[x]))return[null,!1,w,null];var N=p[(g.query?g.query.index.name:null)||""];if(!N)return[null,!1,w,null];switch(x){case"query":var k=N.find(function(C){return C.req.limit===g.limit&&C.req.values===g.values&&Es(C.req.query.range,g.query.range)});return k?[k,!0,w,N]:[N.find(function(C){return("limit"in C.req?C.req.limit:1/0)>=g.limit&&(!g.values||C.req.values)&&aa(C.req.query.range,g.query.range)}),!1,w,N];case"count":return k=N.find(function(C){return Es(C.req.query.range,g.query.range)}),[k,!!k,w,N]}}(t,n,"query",o),y=m[0],u=m[1],v=m[2],f=m[3];return y&&u?y.obsSet=o.obsSet:(u=s.query(o).then(function(h){var p=h.result;if(y&&(y.res=p),c){for(var x=0,g=p.length;x<g;++x)Object.freeze(p[x]);Object.freeze(p)}else h.result=He(p);return h}).catch(function(h){return f&&y&&Ae(f,y),Promise.reject(h)}),y={obsSet:o.obsSet,promise:u,subscribers:new Set,type:"query",req:o,dirty:!1},f?f.push(y):(f=[y],(v=v||(I["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[o.query.index.name||""]=f)),ia(y,f,l,d),y.promise.then(function(h){return{result:Os(h.result,o,v?.optimisticOps,s,y,c)}})}})}})}};function Hr(e,t){return new Proxy(e,{get:function(n,s,a){return s==="db"?t:Reflect.get(n,s,a)}})}var $t=(ve.prototype.version=function(e){if(isNaN(e)||e<.1)throw new F.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new F.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(s){return s._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(Rt),n.stores({}),this._state.autoSchema=!1,n)},ve.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||R.letThrough||this._vip)?e():new T(function(n,s){if(t._state.openComplete)return s(new F.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void s(new F.DatabaseClosed);t.open().catch(W)}t._state.dbReadyPromise.then(n,s)}).then(e)},ve.prototype.use=function(e){var t=e.stack,n=e.create,s=e.level,a=e.name;return a&&this.unuse({stack:t,name:a}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:s??10,name:a}),e.sort(function(o,c){return o.level-c.level}),this},ve.prototype.unuse=function(e){var t=e.stack,n=e.name,s=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(a){return s?a.create!==s:!!n&&a.name!==n})),this},ve.prototype.open=function(){var e=this;return _t(ut,function(){return hr(e)})},ve.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=rt.indexOf(this);if(0<=t&&rt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new T(function(n){e.dbReadyResolve=n}),e.openCanceller=new T(function(n,s){e.cancelOpen=s}))},ve.prototype.close=function(n){var t=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new F.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new F.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},ve.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",s=this._state;return new T(function(a,o){function c(){t.close(e);var l=t._deps.indexedDB.deleteDatabase(t.name);l.onsuccess=oe(function(){var d,m,y;d=t._deps,m=t.name,y=d.indexedDB,d=d.IDBKeyRange,Ar(y)||m===Mt||Mn(y,d).delete(m).catch(W),a()}),l.onerror=Le(o),l.onblocked=t._fireOnBlocked}if(n)throw new F.InvalidArgument("Invalid closeOptions argument to db.delete()");s.isBeingOpened?s.dbReadyPromise.then(c):c()})},ve.prototype.backendDB=function(){return this.idbdb},ve.prototype.isOpen=function(){return this.idbdb!==null},ve.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},ve.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ve.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ve.prototype,"tables",{get:function(){var e=this;return ee(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),ve.prototype.transaction=function(){var e=function(t,n,s){var a=arguments.length;if(a<2)throw new F.InvalidArgument("Too few arguments");for(var o=new Array(a-1);--a;)o[a-1]=arguments[a];return s=o.pop(),[t,ct(o),s]}.apply(this,arguments);return this._transaction.apply(this,e)},ve.prototype._transaction=function(e,t,n){var s=this,a=R.trans;a&&a.db===this&&e.indexOf("!")===-1||(a=null);var o,c,l=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(c=t.map(function(m){if(m=m instanceof s.Table?m.name:m,typeof m!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return m}),e=="r"||e===Gn)o=Gn;else{if(e!="rw"&&e!=Jn)throw new F.InvalidArgument("Invalid transaction mode: "+e);o=Jn}if(a){if(a.mode===Gn&&o===Jn){if(!l)throw new F.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&c.forEach(function(m){if(a&&a.storeNames.indexOf(m)===-1){if(!l)throw new F.SubTransaction("Table "+m+" not included in parent transaction.");a=null}}),l&&a&&!a.active&&(a=null)}}catch(m){return a?a._promise(null,function(y,u){u(m)}):ue(m)}var d=function m(y,u,v,f,h){return T.resolve().then(function(){var p=R.transless||R,x=y._createTransaction(u,v,y._dbSchema,f);if(x.explicit=!0,p={trans:x,transless:p},f)x.idbtrans=f.idbtrans;else try{x.create(),x.idbtrans._explicit=!0,y._state.PR1398_maxLoop=3}catch(N){return N.name===gt.InvalidState&&y.isOpen()&&0<--y._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),y.close({disableAutoOpen:!1}),y.open().then(function(){return m(y,u,v,null,h)})):ue(N)}var g,w=U(h);return w&&qt(),p=T.follow(function(){var N;(g=h.call(x,x))&&(w?(N=Kt.bind(null,null),g.then(N,N)):typeof g.next=="function"&&typeof g.throw=="function"&&(g=ls(g)))},p),(g&&typeof g.then=="function"?T.resolve(g).then(function(N){return x.active?N:ue(new F.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):p.then(function(){return g})).then(function(N){return f&&x._resolve(),x._completion.then(function(){return N})}).catch(function(N){return x._reject(N),ue(N)})})}.bind(null,this,o,c,a,n);return a?a._promise(o,d,"lock"):R.trans?_t(R.transless,function(){return s._whenReady(d)}):this._whenReady(d)},ve.prototype.table=function(e){if(!ce(this._allTables,e))throw new F.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},ve);function ve(e,t){var n=this;this._middlewares={},this.verno=0;var s=ve.dependencies;this._options=t=z({addons:ve.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},s=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a,o,c,l,d,m={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:W,dbReadyPromise:null,cancelOpen:W,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};m.dbReadyPromise=new T(function(u){m.dbReadyResolve=u}),m.openCanceller=new T(function(u,v){m.cancelOpen=v}),this._state=m,this.name=e,this.on=Jt(this,"populate","blocked","versionchange","close",{ready:[Qn,W]}),this.once=function(u,v){var f=function(){for(var h=[],p=0;p<arguments.length;p++)h[p]=arguments[p];n.on(u).unsubscribe(f),v.apply(n,h)};return n.on(u,f)},this.on.ready.subscribe=pn(this.on.ready.subscribe,function(u){return function(v,f){ve.vip(function(){var h,p=n._state;p.openComplete?(p.dbOpenError||T.resolve().then(v),f&&u(v)):p.onReadyBeingFired?(p.onReadyBeingFired.push(v),f&&u(v)):(u(v),h=n,f||u(function x(){h.on.ready.unsubscribe(v),h.on.ready.unsubscribe(x)}))})}}),this.Collection=(a=this,In(ss.prototype,function(g,x){this.db=a;var f=jr,h=null;if(x)try{f=x()}catch(w){h=w}var p=g._ctx,x=p.table,g=x.hook.reading.fire;this._ctx={table:x,index:p.index,isPrimKey:!p.index||x.schema.primKey.keyPath&&p.index===x.schema.primKey.name,range:f,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:p.or,valueMapper:g!==bt?g:null}})),this.Table=(o=this,In(An.prototype,function(u,v,f){this.db=o,this._tx=f,this.name=u,this.schema=v,this.hook=o._allTables[u]?o._allTables[u].hook:Jt(null,{creating:[Fe,W],reading:[We,bt],updating:[es,W],deleting:[yr,W]})})),this.Transaction=(c=this,In(as.prototype,function(u,v,f,h,p){var x=this;u!=="readonly"&&v.forEach(function(g){g=(g=f[g])===null||g===void 0?void 0:g.yProps,g&&(v=v.concat(g.map(function(w){return w.updatesTable})))}),this.db=c,this.mode=u,this.storeNames=v,this.schema=f,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=Jt(this,"complete","error","abort"),this.parent=p||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new T(function(g,w){x._resolve=g,x._reject=w}),this._completion.then(function(){x.active=!1,x.on.complete.fire()},function(g){var w=x.active;return x.active=!1,x.on.error.fire(g),x.parent?x.parent._reject(g):w&&x.idbtrans&&x.idbtrans.abort(),ue(g)})})),this.Version=(l=this,In(cs.prototype,function(u){this.db=l,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(d=this,In(Dn.prototype,function(u,v,f){if(this.db=d,this._ctx={table:u,index:v===":id"?null:v,or:f},this._cmp=this._ascending=$,this._descending=function(h,p){return $(p,h)},this._max=function(h,p){return 0<$(h,p)?h:p},this._min=function(h,p){return $(h,p)<0?h:p},this._IDBKeyRange=d._deps.IDBKeyRange,!this._IDBKeyRange)throw new F.MissingAPI})),this.on("versionchange",function(u){0<u.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(u){!u.newVersion||u.newVersion<u.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(u.oldVersion/10))}),this._maxKey=st(t.IDBKeyRange),this._createTransaction=function(u,v,f,h){return new n.Transaction(u,v,f,n._options.chromeTransactionDurability,h)},this._fireOnBlocked=function(u){n.on("blocked").fire(u),rt.filter(function(v){return v.name===n.name&&v!==n&&!v._state.vcFired}).map(function(v){return v.on("versionchange").fire(u)})},this.use(ra),this.use(oa),this.use(sa),this.use(ta),this.use(na);var y=new Proxy(this,{get:function(u,v,f){if(v==="_vip")return!0;if(v==="table")return function(p){return Hr(n.table(p),y)};var h=Reflect.get(u,v,f);return h instanceof An?Hr(h,y):v==="tables"?h.map(function(p){return Hr(p,y)}):v==="_createTransaction"?function(){return Hr(h.apply(this,arguments),y)}:h}});this.vip=y,s.forEach(function(u){return u(n)})}var Wr,at=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",ca=(fs.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},fs.prototype[at]=function(){return this},fs);function fs(e){this._subscribe=e}try{Wr={indexedDB:le.indexedDB||le.mozIndexedDB||le.webkitIndexedDB||le.msIndexedDB,IDBKeyRange:le.IDBKeyRange||le.webkitIDBKeyRange}}catch{Wr={indexedDB:null,IDBKeyRange:null}}function Ds(e){var t,n=!1,s=new ca(function(a){var o=U(e),c,l=!1,d={},m={},y={get closed(){return l},unsubscribe:function(){l||(l=!0,c&&c.abort(),u&&pt.storagemutated.unsubscribe(f))}};a.start&&a.start(y);var u=!1,v=function(){return Yn(h)},f=function(p){b(d,p),j(m,d)&&v()},h=function(){var p,x,g;!l&&Wr.indexedDB&&(d={},p={},c&&c.abort(),c=new AbortController,g=function(w){var N=kt();try{o&&qt();var k=pe(e,w);return k=o?k.finally(Kt):k}finally{N&&_n()}}(x={subscr:p,signal:c.signal,requery:v,querier:e,trans:null}),Promise.resolve(g).then(function(w){n=!0,t=w,l||x.signal.aborted||(d={},function(N){for(var k in N)if(ce(N,k))return;return 1}(m=p)||u||(pt(Zt,f),u=!0),Yn(function(){return!l&&a.next&&a.next(w)}))},function(w){n=!1,["DatabaseClosedError","AbortError"].includes(w?.name)||l||Yn(function(){l||a.error&&a.error(w)})}))};return setTimeout(v,0),y});return s.hasValue=function(){return n},s.getValue=function(){return t},s}var Rn=$t;function hs(e){var t=an;try{an=!0,pt.storagemutated.fire(e),Re(e,!0)}finally{an=t}}Ne(Rn,z(z({},Ut),{delete:function(e){return new Rn(e,{addons:[]}).delete()},exists:function(e){return new Rn(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Rn.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(Ar(n)?Promise.resolve(n.databases()).then(function(s){return s.map(function(a){return a.name}).filter(function(a){return a!==Mt})}):Mn(n,t).toCollection().primaryKeys()).then(e)}catch{return ue(new F.MissingAPI)}var t,n},defineClass:function(){return function(e){se(this,e)}},ignoreTransaction:function(e){return R.trans?_t(R.transless,e):e()},vip:Ir,async:function(e){return function(){try{var t=ls(e.apply(this,arguments));return t&&typeof t.then=="function"?t:T.resolve(t)}catch(n){return ue(n)}}},spawn:function(e,t,n){try{var s=ls(e.apply(n,t||[]));return s&&typeof s.then=="function"?s:T.resolve(s)}catch(a){return ue(a)}},currentTransaction:{get:function(){return R.trans||null}},waitFor:function(e,t){return t=T.resolve(typeof e=="function"?Rn.ignoreTransaction(e):e).timeout(t||6e4),R.trans?R.trans.waitFor(t):t},Promise:T,debug:{get:function(){return Ye},set:function(e){Fr(e)}},derive:re,extend:se,props:Ne,override:pn,Events:Jt,on:pt,liveQuery:Ds,extendObservabilitySet:b,getByKeyPath:qe,setByKeyPath:ge,delByKeyPath:function(e,t){typeof t=="string"?ge(e,t,void 0):"length"in t&&[].map.call(t,function(n){ge(e,n,void 0)})},shallowClone:xn,deepClone:He,getObjectDiff:us,cmp:$,asap:yn,minKey:-1/0,addons:[],connections:rt,errnames:gt,dependencies:Wr,cache:I,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),Rn.maxKey=st(Rn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(pt(Zt,function(e){an||(e=new CustomEvent(Tn,{detail:e}),an=!0,dispatchEvent(e),an=!1)}),addEventListener(Tn,function(e){e=e.detail,an||hs(e)}));var pr,an=!1,Ts=function(){};return typeof BroadcastChannel<"u"&&((Ts=function(){(pr=new BroadcastChannel(Tn)).onmessage=function(e){return e.data&&hs(e.data)}})(),typeof pr.unref=="function"&&pr.unref(),pt(Zt,function(e){an||pr.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!$t.disableBfCache&&e.persisted){Ye&&console.debug("Dexie: handling persisted pagehide"),pr?.close();for(var t=0,n=rt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!$t.disableBfCache&&e.persisted&&(Ye&&console.debug("Dexie: handling persisted pageshow"),Ts(),hs({all:new Se(-1/0,[[]])}))})),T.rejectionMapper=function(e,t){return!e||e instanceof Ke||e instanceof TypeError||e instanceof SyntaxError||!e.name||!gn[e.name]?e:(t=new gn[e.name](t||e.message,e),"stack"in e&&me(t,"stack",{get:function(){return this.inner.stack}}),t)},Fr(Ye),z($t,Object.freeze({__proto__:null,Dexie:$t,liveQuery:Ds,Entity:Xn,cmp:$,PropModification:Pn,replacePrefix:function(e,t){return new Pn({replacePrefix:[e,t]})},add:function(e){return new Pn({add:e})},remove:function(e){return new Pn({remove:e})},default:$t,RangeSet:Se,mergeRanges:rn,rangesOverlap:Vr}),{default:$t}),$t})})(ea);var Za=ea.exports;const _s=da(Za),Ws=Symbol.for("Dexie"),Ss=globalThis[Ws]||(globalThis[Ws]=_s);if(_s.semVer!==Ss.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${_s.semVer} and ${Ss.semVer}`);class ei extends Ss{constructor(){super("CLUNY CAFEDB");Gr(this,"products");Gr(this,"invoices");Gr(this,"syncQueue");this.version(1).stores({products:"id, nameAr, category, tenantId, updatedAt",invoices:"++id, tempId, status, tenantId, branchId, createdAt",syncQueue:"++id, type, status, createdAt"})}}const Kr=new ei,Ys={sugar:{name:"Ø§ÙØ³ÙØ±",icon:Qa,description:"Ø§Ø®ØªØ± ÙØ³ØªÙÙ Ø§ÙØ³ÙØ±"},milk:{name:"Ø§ÙØ­ÙÙØ¨",icon:Ya,description:"Ø§Ø®ØªØ± ÙÙØ¹ Ø§ÙØ­ÙÙØ¨"},shot:{name:"Ø´ÙØª Ø§ÙÙÙÙØ©",icon:ot,description:"Ø¥Ø¶Ø§ÙØ© Ø´ÙØª Ø¥Ø³Ø¨Ø±ÙØ³Ù"},syrup:{name:"Ø§ÙÙÙÙØ§Øª",icon:Wa,description:"Ø¥Ø¶Ø§ÙØ© ÙÙÙØ©"},topping:{name:"Ø§ÙØ¥Ø¶Ø§ÙØ§Øª",icon:hn,description:"Ø¥Ø¶Ø§ÙØ§Øª Ø¥Ø¶Ø§ÙÙØ©"},size:{name:"Ø§ÙØ­Ø¬Ù",icon:ot,description:"Ø§Ø®ØªØ± Ø§ÙØ­Ø¬Ù"},other:{name:"Ø£Ø®Ø±Ù",icon:hn,description:"Ø®ÙØ§Ø±Ø§Øª Ø£Ø®Ø±Ù"}};function ti({coffeeItem:Ce,variants:M=[],open:Pe,onClose:z,onConfirm:Ue,initialCustomization:le,initialQuantity:ee=1}){const[ne,se]=_.useState(ee),[ke,L]=_.useState(new Map),[ce,Ne]=_.useState(""),[xt,me]=_.useState(Ce),re=xt||Ce,[et,It]=_.useState(null);_.useEffect(()=>{if(re?.availableSizes&&re.availableSizes.length>0){const P=re.availableSizes[0];It(P.nameAr)}},[re]);const{data:Qe=[],isLoading:pn}=Ln({queryKey:["/api/product-addons"],queryFn:async()=>{try{const P=await fetch("/api/product-addons");return P.ok?P.json():[]}catch{return[]}}}),{data:Te=[],isLoading:yn}=Ln({queryKey:["/api/coffee-items",re?.id,"addons"],enabled:!!re?.id,queryFn:async()=>{if(!re?.id)return[];try{const P=await fetch(`/api/coffee-items/${re.id}/addons`);return P.ok?P.json():[]}catch{return[]}}});_.useEffect(()=>{if(le?.selectedAddons){const P=new Map;le.selectedAddons.forEach(Y=>{P.set(Y.addonId,Y)}),L(P),Ne(le.notes||"")}else if(Te.length>0&&Qe.length>0){const P=new Map;Te.forEach(Y=>{if(Y.isDefault===1){const U=Qe.find(we=>we.id===Y.addonId);U&&P.set(U.id,{addonId:U.id,nameAr:U.nameAr,quantity:1,price:U.price,category:U.category,rawItemId:U.rawItemId,quantityPerUnit:U.quantityPerUnit,unit:U.unit})}}),L(P)}},[Te,Qe,le]),_.useEffect(()=>{se(ee)},[ee]);const qe=Qe.filter(P=>P.isAvailable===1&&Te.some(Y=>Y.addonId===P.id)),ge=qe.reduce((P,Y)=>{const U=Y.category;return P[U]||(P[U]=[]),P[U].push(Y),P},{}),xn=P=>Te.find(Y=>Y.addonId===P),Lt=(P,Y)=>{const U=new Map(ke);Y&&qe.filter(we=>we.category===P.category).forEach(we=>U.delete(we.id)),ke.has(P.id)&&!Y?U.delete(P.id):U.set(P.id,{addonId:P.id,nameAr:P.nameAr,quantity:1,price:P.price,category:P.category,rawItemId:P.rawItemId,quantityPerUnit:P.quantityPerUnit,unit:P.unit}),L(U)},ct=(P,Y)=>{const U=ke.get(P),we=xn(P);if(!U||!we)return;const Ke=U.quantity+Y;if(Ke<we.minQuantity){const X=new Map(ke);X.delete(P),L(X)}else if(Ke<=we.maxQuantity){const X=new Map(ke);X.set(P,{...U,quantity:Ke}),L(X)}},Ot=()=>{let P=0;return ke.forEach(Y=>{P+=Y.price*Y.quantity}),P},be=()=>{z()},He=()=>{const P={selectedSize:et||void 0,selectedAddons:Array.from(ke.values()),totalAddonsPrice:Ot(),notes:ce.trim()||void 0};if(et){const Y=re?.availableSizes?.find(U=>U.nameAr===et);Y&&(P.notes=`${P.notes?P.notes+" - ":""}Ø§ÙØ­Ø¬Ù: ${Y.nameAr}`)}Ue(P,ne,re||void 0),setTimeout(()=>{z()},100)},Vn=()=>{const P=new Map;Te.forEach(Y=>{if(Y.isDefault===1){const U=Qe.find(we=>we.id===Y.addonId);U&&P.set(U.id,{addonId:U.id,nameAr:U.nameAr,quantity:1,price:U.price,category:U.category,rawItemId:U.rawItemId,quantityPerUnit:U.quantityPerUnit,unit:U.unit})}}),L(P),Ne("")},Vt=Number(et?re?.availableSizes?.find(P=>P.nameAr===et)?.price||re?.price||0:re?.price||0),fe=Ot(),vn=(Vt+fe)*ne,Ae=pn||yn;return re?r.jsx(ln,{open:Pe,onOpenChange:z,children:r.jsxs(un,{className:"max-w-lg max-h-[90vh] overflow-hidden flex flex-col","data-testid":"dialog-customization",children:[r.jsx(dn,{children:r.jsxs(mn,{className:"flex items-center gap-2 text-right",children:[r.jsx(ot,{className:"w-5 h-5"}),"ØªØ®ØµÙØµ ",re.nameAr]})}),Ae?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(Bn,{className:"w-6 h-6 animate-spin"})}):r.jsx($n,{className:"flex-1 max-h-[50vh]",children:r.jsxs("div",{className:"space-y-4 p-1",children:[M.length>1&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[r.jsx(ma,{className:"w-4 h-4"}),r.jsx("span",{children:"Ø§ÙÙÙØ¹"}),r.jsx(je,{variant:"outline",className:"text-xs",children:"Ø§Ø®ØªØ± ÙØ§Ø­Ø¯"})]}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:M.map(P=>r.jsx("div",{className:`relative rounded-md border p-3 cursor-pointer transition-all ${re.id===P.id?"border-primary bg-primary/10":"border-border hover-elevate"}`,onClick:()=>me(P),"data-testid":`variant-${P.id}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium",children:P.nameAr}),r.jsxs("p",{className:"text-xs text-primary",children:[P.price," Ø±.Ø³"]})]}),re.id===P.id&&r.jsx(fn,{className:"w-4 h-4 text-primary"})]})},P.id))}),r.jsx(At,{className:"mt-3"})]}),re.availableSizes&&re.availableSizes.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[r.jsx(ot,{className:"w-4 h-4"}),r.jsx("span",{children:"Ø§ÙØ­Ø¬Ù"}),r.jsx(je,{variant:"outline",className:"text-xs",children:"Ø§Ø®ØªØ± ÙØ§Ø­Ø¯"})]}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:re.availableSizes.map(P=>r.jsx("div",{className:`relative rounded-md border p-3 cursor-pointer transition-all ${et===P.nameAr?"border-primary bg-primary/10":"border-border hover-elevate"}`,onClick:()=>It(P.nameAr),"data-testid":`size-${P.nameAr}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium",children:P.nameAr}),r.jsxs("p",{className:"text-xs text-primary",children:[P.price," Ø±.Ø³"]})]}),et===P.nameAr&&r.jsx(fn,{className:"w-4 h-4 text-primary"})]})},P.nameAr))}),r.jsx(At,{className:"mt-3"})]}),Object.entries(ge).map(([P,Y])=>{const U=Ys[P]||Ys.other,we=P==="sugar"||P==="milk"||P==="size"||P.toLowerCase()==="size",Ke=U.icon;return r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[r.jsx(Ke,{className:"w-4 h-4"}),r.jsx("span",{children:U.name}),we&&r.jsx(je,{variant:"outline",className:"text-xs",children:"Ø§Ø®ØªØ± ÙØ§Ø­Ø¯"})]}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:Y.map(X=>{const Me=ke.has(X.id),vt=ke.get(X.id),gt=xn(X.id),tt=gt&&gt.maxQuantity>1&&!we;return r.jsx("div",{className:`relative rounded-md border p-3 cursor-pointer transition-all ${Me?"border-primary bg-primary/10":"border-border hover-elevate"}`,onClick:()=>!tt&&Lt(X,we),"data-testid":`addon-${X.id}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium",children:X.nameAr}),X.price>0&&r.jsxs("p",{className:"text-xs text-primary",children:["+",X.price," Ø±.Ø³"]})]}),Me&&!tt&&r.jsx(fn,{className:"w-4 h-4 text-primary"}),tt&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(q,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:F=>{F.stopPropagation(),Me&&ct(X.id,-1)},"data-testid":`button-decrease-${X.id}`,children:r.jsx(Mr,{className:"w-3 h-3"})}),r.jsx("span",{className:"w-6 text-center text-sm font-medium",children:vt?.quantity||0}),r.jsx(q,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:F=>{F.stopPropagation(),Me?ct(X.id,1):Lt(X,!1)},"data-testid":`button-increase-${X.id}`,children:r.jsx(hn,{className:"w-3 h-3"})})]})]})},X.id)})}),r.jsx(At,{className:"mt-3"})]},P)}),Object.keys(ge).length===0&&r.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[r.jsx(Ua,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"ÙØ§ ØªÙØ¬Ø¯ Ø®ÙØ§Ø±Ø§Øª ØªØ®ØµÙØµ ÙØªØ§Ø­Ø© ÙÙØ°Ø§ Ø§ÙÙØ´Ø±ÙØ¨"})]})]})}),r.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Ø§ÙÙÙÙØ©"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(q,{size:"icon",variant:"outline",onClick:()=>se(Math.max(1,ne-1)),"data-testid":"button-decrease-quantity",children:r.jsx(Mr,{className:"w-4 h-4"})}),r.jsx("span",{className:"w-8 text-center font-semibold","data-testid":"text-quantity",children:ne}),r.jsx(q,{size:"icon",variant:"outline",onClick:()=>se(ne+1),"data-testid":"button-increase-quantity",children:r.jsx(hn,{className:"w-4 h-4"})})]})]}),r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Ø³Ø¹Ø± Ø§ÙÙØ´Ø±ÙØ¨"}),r.jsxs("span",{children:[Vt.toFixed(2)," Ø±.Ø³"]})]}),fe>0&&r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Ø§ÙØ¥Ø¶Ø§ÙØ§Øª"}),r.jsxs("span",{className:"text-primary",children:["+",fe.toFixed(2)," Ø±.Ø³"]})]}),r.jsx(At,{}),r.jsxs("div",{className:"flex items-center justify-between font-semibold",children:[r.jsx("span",{children:"Ø§ÙØ¥Ø¬ÙØ§ÙÙ"}),r.jsxs("span",{className:"text-lg","data-testid":"text-total-price",children:[vn.toFixed(2)," Ø±.Ø³"]})]})]}),r.jsxs(Xr,{className:"flex flex-row flex-wrap justify-between gap-2",children:[r.jsxs(q,{variant:"ghost",onClick:Vn,className:"gap-1","data-testid":"button-reset-default",children:[r.jsx(Zs,{className:"w-4 h-4"}),"Ø¥Ø¹Ø§Ø¯Ø© ÙÙØ§ÙØªØ±Ø§Ø¶Ù"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(q,{variant:"outline",onClick:be,"data-testid":"button-cancel",children:"Ø¥ÙØºØ§Ø¡"}),r.jsx(q,{onClick:He,"data-testid":"button-confirm",children:"Ø¥Ø¶Ø§ÙØ© ÙÙØ·ÙØ¨"})]})]})]})}):null}const ni=()=>`line-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,cn=[{id:"cash",name:"ÙÙØ¯Ù",nameEn:"Cash",icon:Js,color:"text-primary",bgColor:"bg-primary",enabled:!0},{id:"pos-network",name:"Ø¨Ø·Ø§ÙØ© ØµØ±Ø§Ù",nameEn:"Bank Card",icon:Zr,color:"text-primary",bgColor:"bg-primary",enabled:!0},{id:"pos",name:"Ø¨Ø·Ø§ÙØ© ÙÙÙÙÙ",nameEn:"Cluny Card",icon:Zr,color:"text-primary",bgColor:"bg-primary",enabled:!0}],Gs=[{id:"dine_in",name:"ÙØ­ÙÙ",nameEn:"Dine-in",icon:La,color:"text-primary",bgColor:"bg-primary"},{id:"takeaway",name:"Ø³ÙØ±Ù",nameEn:"Takeaway",icon:ks,color:"text-primary",bgColor:"bg-primary"},{id:"delivery",name:"ØªÙØµÙÙ",nameEn:"Delivery",icon:ka,color:"text-primary",bgColor:"bg-primary"},{id:"car_pickup",name:"Ø§Ø³ØªÙØ§Ù ÙÙ Ø§ÙØ³ÙØ§Ø±Ø©",nameEn:"Car Pick-up",icon:Xs,color:"text-primary",bgColor:"bg-primary"}];function Mi(){const[,Ce]=fa(),{toast:M}=ha();pa();const[Pe,z]=_.useState(""),[Ue,le]=_.useState("all"),[ee,ne]=_.useState("dine_in"),[se,ke]=_.useState(null),[L,ce]=_.useState([]),[Ne,xt]=_.useState(""),[me,re]=_.useState(""),[et,It]=_.useState(""),[Qe,pn]=_.useState(""),[Te,yn]=_.useState(""),[qe,ge]=_.useState(""),[xn,Lt]=_.useState(null),[ct,Ot]=_.useState(0),[be,He]=_.useState(null),[Vn,Vt]=_.useState(null);_.useState(!1),_.useState(!1);const[fe,vn]=_.useState(""),[Ae,P]=_.useState(navigator.onLine),[Y,U]=_.useState(!1);_.useState(null);const[we,Ke]=_.useState(!0),[X,Me]=_.useState([]),[vt,gt]=_.useState(!1),[tt,F]=_.useState(0),[gn,Ut]=_.useState("percentage"),[W,bt]=_.useState(null),[We,wt]=_.useState(!1),[Fe,yr]=_.useState([]),[es,Un]=_.useState(!1),[Qn,Ye]=_.useState(""),[Fr,jt]=_.useState(!1),[xr,Et]=_.useState(null),[Nt,lt]=_.useState(0),[Dt,Qt]=_.useState("percentage"),[Ht,Wt]=_.useState(""),[Yt,bn]=_.useState(!1),[wn,ut]=_.useState(0),[R,jn]=_.useState("cash"),[he,Nn]=_.useState("cash"),[T,kn]=_.useState(0),[Rr,zr]=_.useState(0),[Q,vr]=_.useState(null),[ts,gr]=_.useState(!1);_.useState(!1);const[kt,_n]=_.useState(()=>localStorage.getItem("pos_auto_print")==="true");_.useEffect(()=>{localStorage.setItem("pos_auto_print",String(kt))},[kt]);const[br]=_.useState(new Audio("/notification.mp3")),[Hn,oe]=_.useState(!1),[te,ns]=_.useState(()=>localStorage.getItem("pos_sound_enabled")!=="false"),[Be,Wn]=_.useState(()=>localStorage.getItem("pos_alerts_enabled")!=="false"),[Tt,rs]=_.useState(!1),[pe,qt]=_.useState(null),[Kt,Gt]=_.useState(0),[wr,dt]=_.useState([]),[nt,_t]=_.useState(0),[mt,Yn]=_.useState(!1),[ue,St]=_.useState(""),[ft,Sn]=_.useState(!1),[rt,Mt]=_.useState(""),[Gn,Jn]=_.useState(!1),[Ct,jr]=_.useState(!1),[Cn,Xn]=_.useState(null),[$,Nr]=_.useState(0),ht=i=>i/100*5,Zn=async()=>{if(!$||$<=0){M({title:"Ø®Ø·Ø£",description:"ÙØ±Ø¬Ù Ø¥Ø¯Ø®Ø§Ù Ø¹Ø¯Ø¯ Ø§ÙÙÙØ§Ø·",variant:"destructive"});return}if(!me){M({title:"Ø®Ø·Ø£",description:"ÙØ±Ø¬Ù Ø¥Ø¯Ø®Ø§Ù Ø±ÙÙ ÙØ§ØªÙ Ø§ÙØ¹ÙÙÙ",variant:"destructive"});return}Jn(!0);try{const i=await yt("POST","/api/loyalty/points/request-code",{phone:me,points:$,requestedBy:"employee"}),b=await i.json();i.ok&&b.success?(Sn(!0),b.devCode&&Xn(b.devCode),M({title:"ØªÙ Ø¥Ø±Ø³Ø§Ù Ø§ÙØ±ÙØ²",description:b.maskedEmail?`ØªÙ Ø§ÙØ¥Ø±Ø³Ø§Ù Ø¥ÙÙ ${b.maskedEmail}`:"ØªÙ Ø¥ÙØ´Ø§Ø¡ Ø§ÙØ±ÙØ²"})):M({title:"Ø®Ø·Ø£",description:b.error||"Ø­Ø¯Ø« Ø®Ø·Ø£",variant:"destructive"})}catch{M({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙ Ø¥Ø±Ø³Ø§Ù Ø§ÙØ±ÙØ²",variant:"destructive"})}finally{Jn(!1)}},Pn=async()=>{if(!rt.trim()||rt.length<4){M({title:"Ø®Ø·Ø£",description:"Ø£Ø¯Ø®Ù Ø±ÙØ² ØµØ­ÙØ­ ÙÙ 4 Ø£Ø±ÙØ§Ù",variant:"destructive"});return}jr(!0);try{const i=await yt("POST","/api/loyalty/points/verify-code",{phone:me,code:rt.trim()}),b=await i.json();i.ok&&b.verified?(Yn(!0),_t(b.points),St(b.verificationToken),Sn(!1),Mt(""),Xn(null),M({title:"ØªÙ Ø§ÙØªØ­ÙÙ Ø¨ÙØ¬Ø§Ø­!",description:`Ø³ÙØªÙ Ø®ØµÙ ${ht(b.points).toFixed(2)} Ø±ÙØ§Ù`})):M({title:"Ø®Ø·Ø£",description:b.error||"Ø§ÙØ±ÙØ² ØºÙØ± ØµØ­ÙØ­",variant:"destructive"})}catch{M({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙ Ø§ÙØªØ­ÙÙ",variant:"destructive"})}finally{jr(!1)}},kr=()=>{Yn(!1),_t(0),St(""),Nr(0),Mt(""),Xn(null)},{data:Ie=[]}=Ln({queryKey:["/api/orders/live"],queryFn:async()=>{const i=await fetch("/api/orders");return i.ok?i.json():[]},refetchInterval:5e3});_.useEffect(()=>()=>{},[te,Ie,br]);const[An,ie]=_.useState(0);_.useEffect(()=>{const i=Array.isArray(Ie)?Ie:[];if(i.length>An&&An>0){const b=i.length-An;Gt(j=>j+b),te&&on("newOrder",.7),Be&&M({title:"Ø·ÙØ¨ Ø¬Ø¯ÙØ¯!",description:`ÙØµÙ ${b>1?b+" Ø·ÙØ¨Ø§Øª Ø¬Ø¯ÙØ¯Ø©":"Ø·ÙØ¨ Ø¬Ø¯ÙØ¯"} Ø¥ÙÙ Ø§ÙÙØ¸Ø§Ù`,className:"bg-primary text-primary-foreground"})}ie(i.length)},[Ie,An,M,te,Be]);const{isConnected:Jt}=Ea({clientType:"pos",branchId:se?.branchId,onNewOrder:i=>{dt(b=>[...b,i]),te&&on("newOrder",.9),Be&&M({title:"Ø·ÙØ¨ Ø¬Ø¯ÙØ¯!",description:`Ø·ÙØ¨ #${i?.orderNumber||"Ø¬Ø¯ÙØ¯"} - ${i?.customerInfo?.customerName||"Ø¹ÙÙÙ"}`,className:"bg-primary text-primary-foreground"}),Gt(b=>b+1),it.invalidateQueries({queryKey:["/api/orders/live"]})},onOrderUpdated:()=>{it.invalidateQueries({queryKey:["/api/orders/live"]})},enabled:!!se?.branchId});_.useEffect(()=>{localStorage.setItem("pos_sound_enabled",String(te))},[te]),_.useEffect(()=>{localStorage.setItem("pos_alerts_enabled",String(Be))},[Be]);const[In,Ft]=_.useState(!1),[er,tr]=_.useState(!1),[_r,nr]=_.useState(!1);_.useState(!1);const[rr,On]=_.useState(!1),[ss,Z]=_.useState(!1),[En,sr]=_.useState(null),[Xt,_e]=_.useState(null),[ye,$e]=_.useState(0),[Oe,ar]=_.useState([]),[Dn,xe]=_.useState(0),Le=6;_.useEffect(()=>{(async()=>{const b=localStorage.getItem("currentEmployee");if(b)try{const j=JSON.parse(b);if(!j.branchId){const I=await fetch("/api/verify-session");if(I.ok){const B=await I.json();B.employee?.branchId&&(j.branchId=B.employee.branchId,localStorage.setItem("currentEmployee",JSON.stringify(j)))}}ke(j)}catch(j){console.error("Error parsing employee:",j),Ce("/employee/gateway")}else Ce("/employee/gateway")})();try{const b=localStorage.getItem("parkedOrders");b&&Me(JSON.parse(b));const j=localStorage.getItem("offlineOrders");j&&ar(JSON.parse(j))}catch(b){console.error("Error loading saved data:",b)}},[Ce]);const[Pt,Zt]=_.useState(!1);_.useState(!navigator.onLine);const Tn=_.useCallback(async()=>{if(!(Oe.length===0||Pt)){Zt(!0);try{if(!(await fetch("/api/verify-session",{credentials:"include"})).ok){M({title:"ÙØ±Ø¬Ù ØªØ³Ø¬ÙÙ Ø§ÙØ¯Ø®ÙÙ",description:"Ø³ÙØªÙ ÙØ²Ø§ÙÙØ© Ø§ÙØ·ÙØ¨Ø§Øª Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙÙ Ø§ÙØ¯Ø®ÙÙ",variant:"destructive"});return}const b=[],j=[];for(const I of Oe)try{(await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(I)})).ok?b.push(I.offlineId):j.push(I)}catch(B){console.error("Failed to sync order:",B),j.push(I)}j.length>0?(ar(j),localStorage.setItem("offlineOrders",JSON.stringify(j)),M({title:"ÙØ²Ø§ÙÙØ© Ø¬Ø²Ø¦ÙØ©",description:`ØªÙ Ø±ÙØ¹ ${b.length} Ø·ÙØ¨Ø ${j.length} Ø·ÙØ¨ ÙØ´Ù`,variant:"destructive"})):(ar([]),localStorage.removeItem("offlineOrders"),M({title:"ØªÙØª Ø§ÙÙØ²Ø§ÙÙØ©",description:`ØªÙ Ø±ÙØ¹ ${b.length} Ø·ÙØ¨ ÙØ­ÙÙØ¸`,className:"bg-green-600 text-white"}))}finally{Zt(!1)}}},[Oe,Pt,M]);_.useEffect(()=>{const i=()=>{P(!0),M({title:"ØªÙ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§ÙØ§ØªØµØ§Ù",description:"Ø¬Ø§Ø±Ù ÙØ²Ø§ÙÙØ© Ø§ÙØ·ÙØ¨Ø§Øª Ø§ÙÙØ­ÙÙØ¸Ø©...",className:"bg-green-600 text-white"}),Tn()},b=()=>{P(!1),M({title:"Ø§ÙÙØ·Ø¹ Ø§ÙØ§ØªØµØ§Ù",description:"Ø§ÙÙØ¸Ø§Ù ÙØ¹ÙÙ ÙÙ ÙØ¶Ø¹ Ø¹Ø¯Ù Ø§ÙØ§ØªØµØ§Ù",variant:"destructive"})};return window.addEventListener("online",i),window.addEventListener("offline",b),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",b)}},[M,Tn]),_.useEffect(()=>{const i=async()=>{try{const j=await fetch("/api/pos/status",{method:"GET"});if(j.ok){const I=await j.json();Ke(I.connected===!0)}}catch{Ke(!1)}};i();const b=setInterval(i,3e4);return()=>clearInterval(b)},[]),_.useEffect(()=>{localStorage.setItem("parkedOrders",JSON.stringify(X))},[X]);const{data:pt,isLoading:as}=Ln({queryKey:["/api/coffee-items"],staleTime:1e3*60*5,gcTime:1e3*60*10,queryFn:async()=>{try{const i=await fetch("/api/coffee-items",{headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const b=await i.json(),j=Array.isArray(b)?b.filter(I=>I&&I.id):[];if(j.length>0)try{await Kr.products.clear();const I=j.map(B=>({id:String(B.id),nameAr:B.nameAr||"ÙÙØªØ¬ Ø¨Ø¯ÙÙ Ø§Ø³Ù",price:Number(B.price)||0,category:B.category||"general",imageUrl:B.imageUrl,isAvailable:B.isAvailable??1,tenantId:B.tenantId,availableSizes:B.availableSizes||[],updatedAt:Date.now()}));await Kr.products.bulkAdd(I)}catch(I){console.error("Dexie update error:",I)}return j}catch(i){return console.error("POS Query Error:",i),[]}}}),{data:Ge}=Ln({queryKey:["offline-products"],queryFn:async()=>await Kr.products.toArray(),enabled:Ae===!1}),{data:ir=[]}=Ln({queryKey:["/api/tables"],queryFn:async()=>{const i=await fetch("/api/tables");return i.ok?(await i.json()).filter(j=>j.isActive===!0||j.isActive===1):[]},staleTime:1e3*30}),{data:Br}=Ln({queryKey:["/api/settings/order-suspension"],queryFn:async()=>{try{const i=await fetch("/api/settings/order-suspension");return i.ok?i.json():{suspended:!1}}catch{return{suspended:!1}}},staleTime:1e3*10}),en=Br?.suspended||!1,st=_.useMemo(()=>{try{const i=Ae?pt||[]:Ge||[];return Array.isArray(i)?i:[]}catch(i){return console.error("Error computing coffeeItems:",i),[]}},[pt,Ge,Ae]),tn=_.useMemo(()=>{try{const i=Array.isArray(st)?st:[],b=Array.from(new Set(i.map(j=>j?.categoryAr||j?.category||"Ø£Ø®Ø±Ù")));return[{id:"all",name:"Ø§ÙÙÙ",icon:ot,color:"text-primary"},...b.map(j=>({id:j,name:j,icon:ot,color:"text-primary"}))]}catch(i){return console.error("Error computing categories:",i),[{id:"all",name:"Ø§ÙÙÙ",icon:ot,color:"text-primary"}]}},[st]),or=_.useMemo(()=>{try{return(Array.isArray(st)?st:[]).filter(b=>{if(!b)return!1;const j=b.nameAr?.toLowerCase().includes(Pe.toLowerCase())||b.nameEn?.toLowerCase().includes(Pe.toLowerCase()),I=Ue==="all"||b.categoryAr===Ue||b.category===Ue;return j&&I})}catch(i){return console.error("Error filtering items:",i),[]}},[st,Pe,Ue]),$r=_.useCallback(async i=>{if(i.length===9&&i.startsWith("5")){Ft(!0);try{const b=await fetch("/api/customers/lookup-by-phone",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:i})});if(b.ok){const j=await b.json();j.found&&j.customer?(xt(j.customer.name),It(j.customer.email||""),Ot(j.customer.points||0),Lt(j.customer.id),He(j.loyaltyCard||null),nr(!1),M({title:"Ø¹ÙÙÙ ÙØ³Ø¬Ù",description:`ÙØ±Ø­Ø¨Ø§Ù ${j.customer.name}! ÙØ¯ÙÙ ${j.customer.points||0} ÙÙØ·Ø©`,className:"bg-green-600 text-white"})):nr(!0)}}catch(b){console.error("Error checking customer:",b)}finally{Ft(!1)}}},[M]);_.useEffect(()=>{const i=setTimeout(()=>$r(me),500);return()=>clearTimeout(i)},[me,$r]),_.useEffect(()=>{const i=he==="qahwa-card"||We&&Fe.some(b=>b.method==="qahwa-card");if(i&&be){const b=Math.max(0,(be.freeCupsEarned||0)-(be.freeCupsRedeemed||0)),j=L.reduce((B,ae)=>B+ae.quantity,0),I=Math.min(b,j);ye>I&&$e(I)}else!i&&ye>0&&$e(0)},[L,be,he,We,Fe,ye]);const qn=_.useCallback(i=>{if(i.found){if(i.card){re(i.card.phoneNumber||""),xt(i.card.customerName||i.customer?.name||""),He(i.card),Ot(i.customer?.points||i.card.points||0),i.customer?.id&&Lt(i.customer.id),i.customer?.email&&It(i.customer.email);const b=Math.max(0,(i.card.freeCupsEarned||0)-(i.card.freeCupsRedeemed||0));M({title:"ØªÙ Ø§ÙØ¹Ø«ÙØ± Ø¹ÙÙ Ø§ÙØ¹ÙÙÙ",description:`ÙØ±Ø­Ø¨Ø§Ù ${i.card.customerName}! ${b>0?`ÙØ¯ÙÙ ${b} ÙØ´Ø±ÙØ¨ ÙØ¬Ø§ÙÙ`:`${i.card.stamps%6}/6 Ø£Ø®ØªØ§Ù`}`,className:"bg-green-600 text-white"})}On(!1)}},[M]),is=i=>{i&&(sr(i),_e(null),Z(!0))},os=i=>{!i||!i.coffeeItem||(sr(i.coffeeItem),_e(i.lineItemId),Z(!0))},cr=(i,b)=>{if(En){if(Xt)ce(L.map(j=>j.lineItemId===Xt?{...j,customization:i,quantity:b}:j));else{const j=L.findIndex(I=>{if(I.coffeeItem.id!==En.id||I.customization?.selectedSize!==i.selectedSize)return!1;const B=I.customization?.selectedAddons||[],ae=i.selectedAddons||[];return B.length!==ae.length?!1:B.every(de=>ae.some(Re=>Re.addonId===de.addonId&&Re.quantity===de.quantity))});j>=0?ce(L.map((I,B)=>B===j?{...I,quantity:I.quantity+b}:I)):ce([...L,{lineItemId:ni(),coffeeItem:En,quantity:b,customization:i}])}Z(!1),sr(null),_e(null)}},Kn=(i,b)=>{i&&(b<=0?ce(L.filter(j=>j&&j.lineItemId!==i)):ce(L.map(j=>j&&j.lineItemId===i?{...j,quantity:b}:j)))},Sr=(i,b,j)=>{ce(L.map(I=>{if(I.lineItemId===i){let B=Number(I.coffeeItem.price);if(I.customization?.selectedSize){const sn=I.coffeeItem.availableSizes?.find(hr=>hr.nameAr===I.customization?.selectedSize||hr.nameEn===I.customization?.selectedSize);sn&&(B=Number(sn.price))}const ae=I.customization?.totalAddonsPrice||0,de=(B+ae)*I.quantity,Re=j==="percentage"?de*b/100:b;return{...I,itemDiscount:Math.min(Re,de),discountType:j}}return I})),Et(null),lt(0),jt(!1)},Rt=()=>L.reduce((i,b)=>{if(!b||!b.coffeeItem)return i;let j=Number(b.coffeeItem.price);if(b.customization?.selectedSize){const de=b.coffeeItem.availableSizes?.find(Re=>Re.nameAr===b.customization?.selectedSize||Re.nameEn===b.customization?.selectedSize);de&&(j=Number(de.price))}const I=b.customization?.totalAddonsPrice||0,B=(j+I)*b.quantity,ae=b.itemDiscount||0;return i+B-ae},0),lr=()=>W?Rt()*W.percentage/100:0,zt=()=>{if(tt<=0)return 0;const i=Rt()-lr();return gn==="percentage"?i*tt/100:Math.min(tt,i)},Je=()=>{const i=Rt(),b=lr(),j=zt(),I=i-b-j;return Math.max(0,I).toFixed(2)},Cr=async()=>{if(Ht.trim()){tr(!0);try{const i=await fetch("/api/discount-codes/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:Ht})}),b=await i.json();i.ok&&b.valid?(bt({code:b.code,percentage:b.discountPercentage,reason:b.reason}),M({title:"ØªÙ ØªØ·Ø¨ÙÙ Ø§ÙØ®ØµÙ",description:`${b.reason} - ${b.discountPercentage}%`,className:"bg-green-600 text-white"})):M({title:"ÙÙØ¯ ØºÙØ± ØµØ§ÙØ­",description:b.error||"Ø§ÙÙÙØ¯ ØºÙØ± ØµØ­ÙØ­ Ø£Ù ÙÙØªÙÙ",variant:"destructive"})}catch{M({title:"Ø®Ø·Ø£",description:"ÙØ´Ù Ø§ÙØªØ­ÙÙ ÙÙ Ø§ÙÙÙØ¯",variant:"destructive"})}finally{tr(!1)}}},Lr=()=>{if(L.length===0){M({title:"Ø®Ø·Ø£",description:"ÙØ§ ØªÙØ¬Ø¯ Ø¹ÙØ§ØµØ± ÙØªØ¹ÙÙÙÙØ§",variant:"destructive"});return}const i={id:`park-${Date.now()}`,name:Ne||`Ø·ÙØ¨ ÙØ¹ÙÙ #${X.length+1}`,items:[...L],customerName:Ne,customerPhone:me,customerEmail:et,tableNumber:fe,createdAt:new Date().toISOString(),note:Qn,priority:"normal",appliedDiscount:W,invoiceDiscount:tt};Me([...X,i]),Mn(),Un(!1),Ye(""),M({title:"ØªÙ ØªØ¹ÙÙÙ Ø§ÙØ·ÙØ¨",description:`ØªÙ Ø­ÙØ¸ Ø§ÙØ·ÙØ¨: ${i.name}`,className:"bg-blue-600 text-white"})},ur=i=>{ce(i.items),xt(i.customerName),re(i.customerPhone),It(i.customerEmail||""),vn(i.tableNumber||""),bt(i.appliedDiscount||null),F(i.invoiceDiscount||0),Me(X.filter(b=>b.id!==i.id)),gt(!1),M({title:"ØªÙ Ø§Ø³ØªØ¦ÙØ§Ù Ø§ÙØ·ÙØ¨",description:i.name})},dr=i=>{Me(X.filter(b=>b.id!==i)),M({title:"ØªÙ Ø­Ø°Ù Ø§ÙØ·ÙØ¨ Ø§ÙÙØ¹ÙÙ"})},mr=(i,b)=>{Me(X.map(j=>j.id===i?{...j,priority:b}:j))},Pr=async()=>{try{(await fetch("/api/pos/cash-drawer/open",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?(bn(!0),setTimeout(()=>bn(!1),3e3),M({title:"ØªÙ ÙØªØ­ Ø§ÙØ®Ø²Ø§ÙØ©",className:"bg-green-600 text-white"})):M({title:"ÙØ´Ù ÙØªØ­ Ø§ÙØ®Ø²Ø§ÙØ©",variant:"destructive"})}catch{M({title:"Ø®Ø·Ø£ ÙÙ Ø§ÙØ§ØªØµØ§Ù Ø¨Ø§ÙØ®Ø²Ø§ÙØ©",variant:"destructive"})}},cs=async()=>{if(!Q){M({title:"Ø®Ø·Ø£",description:"ÙØ§ ÙÙØ¬Ø¯ Ø·ÙØ¨ ÙÙØ·Ø¨Ø§Ø¹Ø©",variant:"destructive"});return}try{await fetch("/api/pos/print-receipt",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderNumber:Q.orderNumber,receiptData:Q})})}catch(i){console.error("Error sending to printer:",i)}try{await gs({orderNumber:Q.orderNumber,customerName:Q.customerName,customerPhone:Q.customerPhone,items:Q.items,subtotal:Q.subtotal,discount:Q.discount,invoiceDiscount:Q.invoiceDiscount,total:Q.total,paymentMethod:Q.paymentMethod,employeeName:Q.employeeName,tableNumber:Q.tableNumber,orderType:Q.orderType,orderTypeName:Q.orderTypeName,date:Q.date}),M({title:"ØªÙ ÙØªØ­ ÙØ§ÙØ°Ø© Ø§ÙØ·Ø¨Ø§Ø¹Ø©",className:"bg-green-600 text-white"})}catch(i){console.error("Error printing receipt:",i),M({title:"Ø®Ø·Ø£ ÙÙ Ø§ÙØ·Ø¨Ø§Ø¹Ø©",variant:"destructive"})}},nn=async()=>{if(!Q){M({title:"Ø®Ø·Ø£",description:"ÙØ§ ÙÙØ¬Ø¯ Ø·ÙØ¨ ÙÙØ·Ø¨Ø§Ø¹Ø©",variant:"destructive"});return}try{await fetch("/api/pos/print-receipt",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderNumber:Q.orderNumber,receiptData:{...Q,isTaxInvoice:!0}})})}catch(i){console.error("Error sending tax invoice to printer:",i)}try{await bs({orderNumber:Q.orderNumber,customerName:Q.customerName,customerPhone:Q.customerPhone,items:Q.items,subtotal:Q.subtotal,discount:Q.discount,invoiceDiscount:Q.invoiceDiscount,total:Q.total,paymentMethod:Q.paymentMethod,employeeName:Q.employeeName,tableNumber:Q.tableNumber,orderType:Q.orderType,orderTypeName:Q.orderTypeName,date:Q.date}),M({title:"ØªÙ ÙØªØ­ ÙØ§ÙØ°Ø© Ø§ÙÙØ§ØªÙØ±Ø© Ø§ÙØ¶Ø±ÙØ¨ÙØ©",className:"bg-green-600 text-white"})}catch(i){console.error("Error printing tax invoice:",i),M({title:"Ø®Ø·Ø£ ÙÙ Ø§ÙØ·Ø¨Ø§Ø¹Ø©",variant:"destructive"})}},Mn=()=>{ce([]),xt(""),re(""),It(""),Ot(0),Lt(null),He(null),vn(""),Nn("cash"),ne("dine_in"),Wt(""),bt(null),F(0),Ut("fixed"),nr(!1),yr([]),wt(!1),$e(0),pn(""),yn(""),ge(""),kr()},Ar=()=>{if(wn<=0)return;const i=parseFloat(Je())-Fe.reduce((j,I)=>j+I.amount,0),b=Math.min(wn,i);yr([...Fe,{method:R,amount:b}]),ut(0)},Ir=i=>{yr(Fe.filter((b,j)=>j!==i))},Bt=()=>{const i=parseFloat(Je()),b=Fe.reduce((j,I)=>j+I.amount,0);return Math.max(0,i-b)},Se=async i=>{try{await bs({orderNumber:i.orderNumber,customerName:Ne||i.customerInfo?.customerName||"Ø¹ÙÙÙ",customerPhone:me||i.customerInfo?.customerPhone||"",items:L.length>0?L:i.items,subtotal:Rt()||i.subtotal?.toString()||"0",total:Je()||i.totalAmount?.toString()||"0",paymentMethod:cn.find(b=>b.id===he)?.name||i.paymentMethod,employeeName:se?.fullName||"",tableNumber:fe||i.tableNumber,orderType:ee==="car_pickup"?"takeaway":ee,date:new Date().toISOString()}),await Ta({orderNumber:i.orderNumber,tableNumber:fe||i.tableNumber,items:L.length>0?L:i.items,timestamp:new Date().toLocaleString("ar-SA")})}catch(b){console.error("Failed to print receipts:",b)}},Fn=_a({mutationFn:async i=>{if(!Ae){const j=`offline-${Date.now()}-${Math.random().toString(36).substring(2,7)}`;return{...i,createdAt:new Date().toISOString()},await Kr.invoices.add({tempId:j,items:i.items,totalAmount:Number(i.totalAmount),paymentMethod:i.paymentMethod,createdAt:Date.now(),status:"pending",tenantId:se?.tenantId||"demo-tenant",branchId:se?.branchId||""}),await Kr.syncQueue.add({type:"CREATE_ORDER",payload:i,status:"pending",retryCount:0,createdAt:Date.now()}),{orderNumber:j,totalAmount:i.totalAmount,offline:!0}}const b=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!b.ok)throw new Error("Failed to create order");return b.json()},onSuccess:async i=>{const b=We&&Fe.length>0?Fe.map(B=>`${cn.find(ae=>ae.id===B.method)?.name}: ${B.amount.toFixed(2)}`).join(" + "):cn.find(B=>B.id===he)?.name||he,j=Gs.find(B=>B.id===ee),I={orderNumber:i.orderNumber,customerName:Ne||"Ø¹ÙÙÙ",customerPhone:me||"",items:L,subtotal:Rt().toFixed(2),discount:W?{code:W.code,percentage:W.percentage,amount:lr().toFixed(2)}:void 0,invoiceDiscount:zt()>0?zt().toFixed(2):void 0,total:i.totalAmount,paymentMethod:b,employeeName:se?.fullName||"",tableNumber:fe||void 0,orderType:ee,orderTypeName:j?.name||ee,date:new Date().toISOString(),offline:i.offline};vr(I),kt&&!i.offline&&Se(i),gr(!0),(he==="cash"||Fe.some(B=>B.method==="cash"))&&Pr(),M({title:i.offline?"ØªÙ Ø­ÙØ¸ Ø§ÙØ·ÙØ¨ ÙØ­ÙÙØ§Ù":"ØªÙ Ø¥ÙØ´Ø§Ø¡ Ø§ÙØ·ÙØ¨ Ø¨ÙØ¬Ø§Ø­",description:i.offline?"Ø³ÙØªÙ Ø§ÙÙØ²Ø§ÙÙØ© Ø¹ÙØ¯ Ø¹ÙØ¯Ø© Ø§ÙØ¥ÙØªØ±ÙØª":`Ø±ÙÙ Ø§ÙØ·ÙØ¨: ${i.orderNumber}`,className:"bg-green-600 text-white"}),await it.invalidateQueries({queryKey:["/api/orders"]}),Mn()},onError:i=>{console.error("Order creation error:",i);const b=i?.message||i?.response?.data?.error||"ÙØ´Ù Ø¥ÙØ´Ø§Ø¡ Ø§ÙØ·ÙØ¨. ÙØ±Ø¬Ù Ø§ÙÙØ­Ø§ÙÙØ© ÙØ±Ø© Ø£Ø®Ø±Ù";M({title:"Ø®Ø·Ø£ ÙÙ Ø¥ÙØ´Ø§Ø¡ Ø§ÙØ·ÙØ¨",description:b,variant:"destructive"})}}),rn=i=>{if(L.length===0){M({title:"Ø®Ø·Ø£",description:"ÙØ±Ø¬Ù Ø¥Ø¶Ø§ÙØ© Ø¹ÙØ§ØµØ± ÙÙØ·ÙØ¨",variant:"destructive"});return}if(!se?.branchId){M({title:"Ø®Ø·Ø£",description:"ÙØ¹ÙÙÙØ§Øª Ø§ÙÙØ±Ø¹ ØºÙØ± ÙØªÙÙØ±Ø©",variant:"destructive"});return}if(We&&Bt()>.01){M({title:"Ø®Ø·Ø£",description:"ÙØ±Ø¬Ù Ø¥ÙÙØ§Ù Ø§ÙØ¯ÙØ¹ Ø§ÙÙÙØ³Ù",variant:"destructive"});return}let b=typeof i=="string"?i:"in_progress";b==="in_progress"&&he!=="cash"&&!We&&(b="payment_confirmed"),b==="in_progress"&&(b="confirmed");const j=Vn?.id,I=(j||fe)&&b==="pending",B={items:L.map(ae=>{let de=Number(ae.coffeeItem.price);const Re=ae.customization?.selectedSize;if(Re){const sn=ae.coffeeItem.availableSizes?.find(hr=>hr.nameAr===Re);sn&&(de=sn.price)}return{coffeeItemId:ae.coffeeItem.id,quantity:ae.quantity,price:de+(ae.customization?.totalAddonsPrice||0),itemDiscount:ae.itemDiscount||0,customization:ae.customization?{selectedSize:Re,selectedAddons:ae.customization.selectedAddons,totalAddonsPrice:ae.customization.totalAddonsPrice,notes:ae.customization.notes}:void 0}}),totalAmount:mt?Math.max(0,parseFloat(Je())-ht(nt)).toFixed(2):Je(),paymentMethod:I?"cash":We?"split":he,splitPayments:!I&&We?Fe:void 0,customerInfo:{customerName:Ne||"Ø¹ÙÙÙ",phoneNumber:me||void 0,customerEmail:et||void 0},customerId:xn||void 0,employeeId:se?.id,branchId:se.branchId,orderType:j||fe?"dine-in":ee,deliveryType:ee==="car_pickup"?"car_pickup":ee==="delivery"?"delivery":ee==="dine_in"?"dine-in":"pickup",tableNumber:fe||void 0,tableId:Vn?.id||void 0,discountCode:W?.code,invoiceDiscount:zt()>0?zt():void 0,usedFreeDrinks:!I&&(he==="qahwa-card"||We&&Fe.some(ae=>ae.method==="qahwa-card"))?ye:0,...ee==="car_pickup"?{carType:Qe,carColor:Te,plateNumber:qe}:{},pointsRedeemed:mt?nt:0,pointsValue:mt?ht(nt):0,pointsVerificationToken:mt?ue:void 0,status:I?"open":b,tableStatus:I?"open":"pending",isOpenTab:I};Fn.mutate(B)},Vr=()=>{if(L.length===0)return;const i={orderNumber:"DRAFT-"+Date.now().toString().slice(-6),customerName:Ne||"Ø¹ÙÙÙ",customerPhone:me||"",items:L,total:Je(),subtotal:Rt(),tableNumber:fe,date:new Date().toISOString(),isDraft:!0,paymentMethod:he,employeeName:se?.fullName||""};gs(i),M({title:"ÙØ§ØªÙØ±Ø© ÙØ¨Ø¯Ø¦ÙØ©",description:"ØªÙ Ø¥Ø±Ø³Ø§Ù Ø§ÙÙØ§ØªÙØ±Ø© Ø§ÙÙØ¨Ø¯Ø¦ÙØ© ÙÙØ·Ø¨Ø§Ø¹Ø©"})};if(!se)return r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",dir:"rtl",children:r.jsx(Ks,{message:"Ø¬Ø§Ø±Ù Ø§ÙØªØ­ÙÙÙ..."})});const fr=Array.isArray(tn)?tn.slice(Dn*Le,(Dn+1)*Le):[{id:"all",name:"Ø§ÙÙÙ",icon:ot,color:"text-primary"}],Ur=Array.isArray(tn)?Math.ceil(tn.length/Le):1;return r.jsxs("div",{className:"min-h-screen bg-background text-foreground flex flex-col",dir:"rtl",children:[r.jsx("div",{className:"flex flex-col lg:flex-row h-screen gap-0",children:r.jsxs("div",{className:"flex-1 flex flex-col min-h-0 lg:min-h-screen",children:[r.jsx("header",{className:"bg-card/80 backdrop-blur-sm border-b border-border px-3 sm:px-6 py-3 sm:py-4 flex-shrink-0",children:r.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[r.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 min-w-0",children:[r.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-primary rounded-xl flex-shrink-0 flex items-center justify-center shadow-lg",children:r.jsx(ot,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary-foreground"})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground truncate",children:"ÙØ¸Ø§Ù ÙÙØ§Ø· Ø§ÙØ¨ÙØ¹"}),r.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground truncate",children:se.fullName})]})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[r.jsx("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-background/50 rounded-full border border-border",children:Ae?r.jsxs(r.Fragment,{children:[r.jsx(qa,{className:"w-4 h-4 text-green-500"}),r.jsx("span",{className:"text-xs font-medium",children:"ÙØªØµÙ"}),Y&&r.jsx(Bn,{className:"w-3 h-3 animate-spin text-primary ml-1"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Bs,{className:"w-4 h-4 text-destructive"}),r.jsx("span",{className:"text-xs font-medium",children:"ÙØ¶Ø¹ Ø§ÙØ£ÙÙÙØ§ÙÙ"})]})}),Oe.length>0&&r.jsxs(je,{variant:"destructive",className:"flex items-center gap-1 px-2 sm:px-3 py-1 sm:py-1.5 animate-pulse text-xs sm:text-sm",children:[r.jsx(Qs,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),r.jsx("span",{className:"hidden sm:inline",children:"ÙÙØ§ØªÙØ± ÙØ¹ÙÙØ©"}),r.jsx("span",{className:"bg-red-700 px-1.5 sm:px-2 py-0.5 rounded-full text-xs font-bold",children:Oe.length})]}),Oe.length>0&&Ae&&r.jsxs(q,{variant:"outline",size:"sm",onClick:Tn,disabled:Pt,className:"text-xs sm:text-sm",children:[Pt?r.jsx(Bn,{className:"w-3 h-3 sm:w-4 sm:h-4 animate-spin"}):r.jsx(Ka,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsxs("span",{className:"hidden sm:inline ml-1 sm:mr-2",children:["ÙØ²Ø§ÙÙØ© (",Oe.length,")"]})]}),r.jsx(q,{variant:te?"outline":"secondary",size:"icon",onClick:()=>ns(!te),className:"h-9 w-9",title:te?"Ø¥ÙÙØ§Ù Ø§ÙØµÙØª":"ØªØ´ØºÙÙ Ø§ÙØµÙØª","data-testid":"button-toggle-sound",children:te?r.jsx(Ia,{className:"w-4 h-4"}):r.jsx(Oa,{className:"w-4 h-4"})}),r.jsx(q,{variant:Be?"outline":"secondary",size:"icon",onClick:()=>Wn(!Be),className:"h-9 w-9",title:Be?"Ø¥ÙÙØ§Ù Ø§ÙØªÙØ¨ÙÙØ§Øª":"ØªØ´ØºÙÙ Ø§ÙØªÙØ¨ÙÙØ§Øª","data-testid":"button-toggle-alerts",children:Be?r.jsx(Ma,{className:"w-4 h-4"}):r.jsx(Va,{className:"w-4 h-4"})}),r.jsxs(q,{variant:"outline",size:"sm",onClick:()=>{oe(!0),Gt(0),dt([])},className:"text-xs sm:text-sm relative","data-testid":"button-live-orders",children:[r.jsx(Jr,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1 sm:ml-2 flex-shrink-0"}),r.jsx("span",{className:"hidden sm:inline",children:"Ø§ÙØ·ÙØ¨Ø§Øª"}),wr.length>0&&r.jsx(je,{variant:"destructive",className:"absolute -top-2 -left-2 h-5 w-5 p-0 flex items-center justify-center text-xs animate-pulse",children:wr.length>9?"9+":wr.length})]}),r.jsxs(q,{variant:Tt?"default":"outline",size:"sm",onClick:()=>rs(!Tt),className:"text-xs sm:text-sm","data-testid":"button-split-view",children:[r.jsx(Ha,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1 sm:ml-2 flex-shrink-0"}),r.jsx("span",{className:"hidden sm:inline",children:Tt?"Ø¹Ø±Ø¶ ÙØ§ÙÙ":"Ø¹Ø±Ø¶ ÙÙØ³Ù"})]}),r.jsxs(je,{variant:we?"default":"secondary",className:"flex items-center gap-1 px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm",children:[r.jsx(Fa,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),r.jsx("span",{className:"hidden sm:inline",children:we?"ÙØªØµÙ":"ØºÙØ± ÙØªØµÙ"})]}),r.jsxs(q,{variant:"outline",size:"sm",onClick:()=>gt(!0),className:`text-xs sm:text-sm ${X.length>0?"animate-pulse":""}`,"data-testid":"button-parked-orders",children:[r.jsx(Ns,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1 sm:ml-2 flex-shrink-0"}),r.jsx("span",{className:"hidden sm:inline",children:"ÙØ¹ÙÙ"}),X.length>0&&r.jsx(je,{variant:"secondary",className:"text-xs mr-1 sm:mr-2 ml-0.5",children:X.length})]}),r.jsxs(q,{variant:"outline",size:"sm",onClick:Pr,className:"text-xs sm:text-sm","data-testid":"button-open-drawer",children:[r.jsx(Ra,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1 sm:ml-2 flex-shrink-0"}),r.jsx("span",{className:"hidden sm:inline",children:"ÙØªØ­"})]}),r.jsx(q,{variant:"ghost",size:"icon",onClick:()=>Ce("/employee/dashboard"),className:"h-9 w-9 sm:h-10 sm:w-10","data-testid":"button-back",children:r.jsx(ya,{className:"w-4 h-4 sm:w-5 sm:h-5 text-muted-foreground"})})]})]})}),en&&r.jsxs("div",{className:"bg-destructive/10 border-b border-destructive/30 px-4 py-3 flex items-center justify-center gap-3",children:[r.jsx(za,{className:"w-5 h-5 text-destructive"}),r.jsx("span",{className:"text-destructive font-bold text-lg",children:"Ø§ÙØ·ÙØ¨Ø§Øª ÙØ¹ÙÙØ© ÙØ¤ÙØªØ§Ù - ÙØ§ ÙÙÙÙ Ø¥ÙØ´Ø§Ø¡ Ø·ÙØ¨Ø§Øª Ø¬Ø¯ÙØ¯Ø©"})]}),r.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden gap-0",children:[Tt&&r.jsxs("div",{className:"w-full lg:w-[340px] xl:w-[380px] bg-card/50 border-l border-border flex flex-col overflow-hidden",children:[r.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Jr,{className:"w-4 h-4 text-primary"}),r.jsx("span",{className:"font-bold text-sm",children:"Ø§ÙØ·ÙØ¨Ø§Øª Ø§ÙÙØ¨Ø§Ø´Ø±Ø©"}),Jt&&r.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),r.jsx(je,{variant:"secondary",className:"text-xs",children:(Array.isArray(Ie)?Ie:[]).filter(i=>i.status!=="completed"&&i.status!=="cancelled").length})]}),r.jsx($n,{className:"flex-1",children:r.jsxs("div",{className:"p-2 space-y-2",children:[(Array.isArray(Ie)?Ie:[]).filter(i=>i.status!=="completed"&&i.status!=="cancelled").map(i=>{const b={pending:"border-r-4 border-r-orange-500",payment_confirmed:"border-r-4 border-r-yellow-500",confirmed:"border-r-4 border-r-blue-400",in_progress:"border-r-4 border-r-blue-500",ready:"border-r-4 border-r-green-500",open:"border-r-4 border-r-purple-500"},j={pending:"ÙÙ Ø§ÙØ§ÙØªØ¸Ø§Ø±",payment_confirmed:"ØªÙ Ø§ÙØ¯ÙØ¹",confirmed:"ÙØ¤ÙØ¯",in_progress:"ÙÙØ¯ Ø§ÙØªØ¬ÙÙØ²",ready:"Ø¬Ø§ÙØ²",open:"Ø·Ø§ÙÙØ© ÙÙØªÙØ­Ø©"};return r.jsx(Or,{className:`overflow-hidden ${b[i.status]||""}`,children:r.jsxs(Er,{className:"p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(je,{variant:"outline",className:"text-xs font-bold px-1.5 py-0",children:["#",i.orderNumber]}),i.tableNumber&&r.jsxs(je,{variant:"secondary",className:"text-[9px] px-1 py-0",children:["T",i.tableNumber]}),r.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[80px]",children:i.customerInfo?.customerName||"Ø¹ÙÙÙ"})]}),r.jsx(je,{variant:i.status==="pending"||i.status==="payment_confirmed"?"destructive":i.status==="ready"?"default":"secondary",className:"text-[10px] px-1.5",children:j[i.status]||i.status})]}),r.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-2",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(ys,{className:"w-3 h-3"}),new Date(i.createdAt).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})]}),r.jsxs("span",{className:"font-bold text-foreground",children:[Number(i.totalAmount).toFixed(2)," Ø±.Ø³"]})]}),r.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.status==="pending"&&r.jsxs(q,{size:"sm",variant:"outline",className:"h-6 text-[10px] px-2",onClick:async()=>{await yt("PATCH",`/api/orders/${i.id}/status`,{status:"in_progress"}),te&&on("statusChange",.3),it.invalidateQueries({queryKey:["/api/orders/live"]})},children:[r.jsx(ws,{className:"w-3 h-3 ml-0.5"}),"Ø¨Ø¯Ø¡"]}),i.status==="in_progress"&&r.jsxs(q,{size:"sm",variant:"outline",className:"h-6 text-[10px] px-2",onClick:async()=>{await yt("PATCH",`/api/orders/${i.id}/status`,{status:"ready"}),te&&on("success",.5),it.invalidateQueries({queryKey:["/api/orders/live"]})},children:[r.jsx(fn,{className:"w-3 h-3 ml-0.5"}),"Ø¬Ø§ÙØ²"]}),(i.status==="ready"||i.status==="in_progress")&&r.jsxs(q,{size:"sm",className:"h-6 text-[10px] px-2",onClick:async()=>{await yt("PATCH",`/api/orders/${i.id}/status`,{status:"completed"}),te&&on("success",.5),it.invalidateQueries({queryKey:["/api/orders/live"]}),M({title:"ØªÙ Ø¥ÙÙØ§Ù Ø§ÙØ·ÙØ¨",description:`Ø·ÙØ¨ #${i.orderNumber}`})},children:[r.jsx(qr,{className:"w-3 h-3 ml-0.5"}),"Ø¥ÙÙØ§Ù"]}),r.jsxs(q,{size:"sm",variant:"ghost",className:"h-6 text-[10px] px-2 text-destructive",onClick:async()=>{confirm("ÙÙ Ø£ÙØª ÙØªØ£ÙØ¯ ÙÙ Ø¥ÙØºØ§Ø¡ ÙØ°Ø§ Ø§ÙØ·ÙØ¨Ø")&&(await yt("PATCH",`/api/orders/${i.id}/status`,{status:"cancelled"}),it.invalidateQueries({queryKey:["/api/orders/live"]}),M({title:"ØªÙ Ø¥ÙØºØ§Ø¡ Ø§ÙØ·ÙØ¨",variant:"destructive"}))},children:[r.jsx($s,{className:"w-3 h-3 ml-0.5"}),"Ø¥ÙØºØ§Ø¡"]})]})]})},i.id)}),(Array.isArray(Ie)?Ie:[]).filter(i=>i.status!=="completed"&&i.status!=="cancelled").length===0&&r.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[r.jsx(Jr,{className:"w-10 h-10 mx-auto mb-2 opacity-30"}),r.jsx("p",{className:"text-sm",children:"ÙØ§ ØªÙØ¬Ø¯ Ø·ÙØ¨Ø§Øª ÙØ´Ø·Ø©"}),r.jsx("p",{className:"text-xs",children:"Ø³ØªØ¸ÙØ± Ø§ÙØ·ÙØ¨Ø§Øª Ø§ÙØ¬Ø¯ÙØ¯Ø© ÙÙØ§ ØªÙÙØ§Ø¦ÙØ§Ù"})]})]})})]}),r.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-6 overflow-hidden min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 mb-4 sm:mb-6 flex-wrap",children:[r.jsxs("div",{className:"relative flex-1 min-w-0",children:[r.jsx(xa,{className:"absolute right-3 sm:right-4 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-muted-foreground flex-shrink-0"}),r.jsx(Ve,{placeholder:"Ø¨Ø­Ø«...",value:Pe,onChange:i=>z(i.target.value),className:"pr-10 sm:pr-12 h-10 sm:h-12 text-sm sm:text-lg rounded-xl","data-testid":"input-search"})]}),Pe&&r.jsx(q,{variant:"ghost",size:"icon",onClick:()=>z(""),className:"h-10 w-10 sm:h-12 sm:w-12 flex-shrink-0",children:r.jsx(Dr,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),r.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-4 sm:mb-6 overflow-x-auto pb-2",children:[Dn>0&&r.jsx(q,{variant:"ghost",size:"icon",onClick:()=>xe(i=>i-1),className:"shrink-0 h-10 w-10 sm:h-14 sm:w-auto",children:r.jsx(va,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),r.jsx("div",{className:"flex gap-1 sm:gap-2 flex-1 min-w-0 overflow-x-auto pb-1",children:fr.map(i=>r.jsxs(q,{variant:Ue===i.id?"default":"outline",onClick:()=>le(i.id),size:"sm",className:`shrink-0 h-10 sm:h-14 text-xs sm:text-base rounded-xl transition-all ${Ue===i.id?`${i.color} shadow-lg`:""}`,"data-testid":`button-category-${i.id}`,children:[r.jsx(i.icon,{className:"w-3 h-3 sm:w-5 sm:h-5 ml-0.5 sm:ml-2"}),r.jsx("span",{className:"hidden sm:inline font-medium",children:i.name})]},i.id))}),Dn<Ur-1&&r.jsx(q,{variant:"ghost",size:"icon",onClick:()=>xe(i=>i+1),className:"shrink-0 h-10 w-10 sm:h-14 sm:w-auto",children:r.jsx(ga,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),r.jsx($n,{className:"flex-1 -mx-2 sm:-mx-2 px-2 sm:px-2",children:as?r.jsx(Ks,{message:"Ø¬Ø§Ø±Ù ØªØ­ÙÙÙ Ø§ÙÙÙØªØ¬Ø§Øª..."}):!Array.isArray(or)||or.length===0?r.jsx(xs,{title:"ÙØ§ ØªÙØ¬Ø¯ ÙÙØªØ¬Ø§Øª ÙØ·Ø§Ø¨ÙØ©",description:"Ø¬Ø±Ø¨ Ø§ÙØ¨Ø­Ø« Ø¨ÙÙÙØ§Øª Ø£Ø®Ø±Ù",icon:r.jsx(ot,{className:"w-10 h-10 text-muted-foreground"})}):r.jsx("div",{className:"grid grid-cols-2 xs:grid-cols-3 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2 sm:gap-4",children:or.map(i=>{if(!i||!i.id)return null;const b=L.find(j=>j.coffeeItem&&j.coffeeItem.id===i.id);return r.jsxs(Or,{className:`relative cursor-pointer transition-all duration-200 hover:scale-[1.02] hover:shadow-xl rounded-xl overflow-hidden group hover-elevate ${b?"ring-2 ring-primary":""}`,onClick:()=>is(i),"data-testid":`card-item-${i.id}`,children:[b&&r.jsx("div",{className:"absolute top-2 left-2 z-10 bg-primary text-primary-foreground w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold shadow-lg",children:b.quantity}),r.jsxs(Er,{className:"p-4",children:[r.jsxs("div",{className:"aspect-square bg-muted rounded-xl mb-3 flex items-center justify-center transition-all overflow-hidden",children:[i.imageUrl?r.jsx("img",{src:i.imageUrl,alt:i.nameAr,className:"w-full h-full object-cover rounded-xl group-hover:scale-110 transition-transform duration-300",onError:j=>{j.currentTarget.style.display="none",j.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,r.jsx(ot,{className:`w-12 h-12 text-primary/60 group-hover:text-primary/80 transition-all ${i.imageUrl?"hidden":""}`})]}),r.jsx("h3",{className:"text-sm font-semibold text-foreground truncate mb-1",children:i.nameAr}),i.nameEn&&r.jsx("p",{className:"text-xs text-muted-foreground truncate mb-2",children:i.nameEn}),r.jsxs("p",{className:"text-xl font-bold text-foreground",children:[Number(i.price).toFixed(2)," ",r.jsx("span",{className:"text-sm text-muted-foreground",children:"Ø±.Ø³"})]})]})]},i.id)})})})]}),r.jsxs("div",{className:"w-full lg:w-[420px] bg-card/90 backdrop-blur-sm border-t lg:border-r lg:border-t-0 border-border flex flex-col max-h-[50vh] lg:max-h-none",children:[r.jsxs("div",{className:"p-5 border-b border-border",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-xl font-bold text-foreground flex items-center gap-2",children:[r.jsx(ks,{className:"w-5 h-5"}),"Ø§ÙÙØ§ØªÙØ±Ø©"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(q,{variant:"ghost",size:"icon",onClick:()=>Un(!0),disabled:L.length===0,"data-testid":"button-park-order",children:r.jsx(Ns,{className:"w-5 h-5"})}),r.jsx(q,{variant:"ghost",size:"icon",onClick:Mn,"data-testid":"button-clear-order",children:r.jsx(Zs,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx(ba,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),r.jsx(Ve,{placeholder:"5xxxxxxxx",value:me,onChange:i=>re(i.target.value.replace(/\D/g,"").slice(0,9)),className:"pr-10 rounded-lg","data-testid":"input-phone"})]}),r.jsx(q,{size:"icon",variant:"outline",onClick:()=>On(!0),title:"ÙØ³Ø­ Ø¨Ø·Ø§ÙØ© Ø§ÙÙÙØ§Ø¡","data-testid":"button-scan-loyalty-card",children:r.jsx(Ja,{className:"w-4 h-4"})}),In&&r.jsx(Bn,{className:"w-5 h-5 animate-spin text-primary self-center"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{className:"relative",children:[r.jsx(wa,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),r.jsx(Ve,{placeholder:"Ø§Ø³Ù Ø§ÙØ¹ÙÙÙ",value:Ne,onChange:i=>xt(i.target.value),className:"pr-10 rounded-lg","data-testid":"input-customer-name"})]}),r.jsxs(Sa,{value:fe,onValueChange:i=>{vn(i);const b=ir.find(j=>j.tableNumber===i);b&&Vt(b)},children:[r.jsxs(Ca,{className:"rounded-lg","data-testid":"select-table",children:[r.jsx(Hs,{className:"w-4 h-4 ml-2 text-muted-foreground"}),r.jsx(Pa,{placeholder:"Ø§Ø®ØªØ± Ø·Ø§ÙÙØ©"})]}),r.jsxs(Aa,{children:[r.jsx(zs,{value:"none",children:"Ø¨Ø¯ÙÙ Ø·Ø§ÙÙØ©"}),ir.map(i=>r.jsxs(zs,{value:i.tableNumber,children:["Ø·Ø§ÙÙØ© ",i.tableNumber," (",i.capacity||i.seats," ÙÙØ§Ø¹Ø¯)"]},i.id))]})]})]}),be&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 bg-primary/10 rounded-lg p-2 border border-primary/20",children:[r.jsx(ot,{className:"w-4 h-4 text-primary"}),r.jsxs("span",{className:"text-sm text-primary",children:[be.stamps||0," Ø£Ø®ØªØ§Ù | ",ct," ÙÙØ·Ø©"]})]}),ct>0&&r.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/30 rounded-lg p-3 border border-blue-200 dark:border-blue-800 space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(ja,{className:"w-4 h-4 text-blue-600"}),r.jsx("span",{className:"text-xs font-semibold text-blue-700 dark:text-blue-400",children:"Ø®ØµÙ Ø¨Ø§ÙÙÙØ§Ø·"})]}),r.jsxs("span",{className:"text-xs text-blue-600",children:["â ",ht(ct).toFixed(2)," Ø±.Ø³"]})]}),mt?r.jsxs("div",{className:"flex items-center justify-between gap-2 bg-green-50 dark:bg-green-950/30 rounded p-2 border border-green-200 dark:border-green-800 flex-wrap",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(Ls,{className:"w-3 h-3 text-green-600"}),r.jsxs("span",{className:"text-xs text-green-700 dark:text-green-400 font-semibold",children:["ØªÙ Ø§ÙØªØ­ÙÙ - ",nt," ÙÙØ·Ø© = ",ht(nt).toFixed(2)," Ø±.Ø³"]})]}),r.jsx(q,{variant:"destructive",size:"sm",onClick:kr,"data-testid":"button-pos-cancel-points",children:r.jsx(Dr,{className:"w-3 h-3"})})]}):r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ve,{type:"number",min:0,max:ct,value:$||"",onChange:i=>Nr(Math.min(Number(i.target.value),ct)),placeholder:"Ø¹Ø¯Ø¯ Ø§ÙÙÙØ§Ø·",className:"h-8 text-xs bg-white dark:bg-background","data-testid":"input-pos-points"}),r.jsxs(q,{size:"sm",onClick:Zn,disabled:Gn||!$||$<=0,"data-testid":"button-pos-send-code",children:[Gn?r.jsx(Bn,{className:"w-3 h-3 animate-spin"}):r.jsx(Ba,{className:"w-3 h-3"}),r.jsx("span",{className:"mr-1 text-xs",children:"Ø¥Ø±Ø³Ø§Ù Ø±ÙØ²"})]})]}),!mt&&r.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Ø³ÙØ¸ÙØ± Ø§ÙØ±ÙØ² ÙÙØ¹ÙÙÙ ÙÙ ÙÙØ­Ø© Ø§ÙØªØ­ÙÙ Ø§ÙØ®Ø§ØµØ© Ø¨Ù"})]})]})]})]}),r.jsx($n,{className:"flex-1 p-5",children:L.length===0?r.jsxs("div",{className:"text-center text-muted-foreground py-12",children:[r.jsx(ks,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),r.jsx("p",{className:"text-lg",children:"Ø§Ø¶ØºØ· Ø¹ÙÙ Ø§ÙÙÙØªØ¬Ø§Øª ÙØ¥Ø¶Ø§ÙØªÙØ§"})]}):r.jsxs("div",{className:"space-y-3",children:[L.map((i,b)=>{if(!i||!i.coffeeItem)return null;const j=Number(i.coffeeItem.price||0),I=i.customization?.totalAddonsPrice||0,ae=(j+I)*i.quantity-(i.itemDiscount||0);return r.jsxs("div",{className:"bg-muted/50 rounded-xl p-4 border border-border","data-testid":`order-item-${i.lineItemId}`,children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-foreground",children:i.coffeeItem.nameAr}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[j.toFixed(2)," Ø±.Ø³",I>0&&r.jsxs("span",{className:"text-primary",children:[" +",I.toFixed(2)]})," Ã ",i.quantity]}),i.customization?.selectedAddons&&i.customization.selectedAddons.length>0&&r.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:i.customization.selectedAddons.map(de=>r.jsxs(je,{variant:"outline",className:"text-xs",children:[de.nameAr," ",de.quantity>1&&`Ã${de.quantity}`]},de.addonId))}),i.itemDiscount&&i.itemDiscount>0&&r.jsxs(je,{variant:"secondary",className:"mt-1",children:["Ø®ØµÙ: ",i.itemDiscount.toFixed(2)," Ø±.Ø³"]})]}),r.jsxs("div",{className:"flex items-center gap-1 bg-background rounded-lg p-1",children:[r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>Kn(i.lineItemId,i.quantity-1),"data-testid":`button-decrease-${i.lineItemId}`,children:r.jsx(Mr,{className:"w-4 h-4"})}),r.jsx("span",{className:"w-8 text-center font-bold text-lg",children:i.quantity}),r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>Kn(i.lineItemId,i.quantity+1),"data-testid":`button-increase-${i.lineItemId}`,children:r.jsx(hn,{className:"w-4 h-4"})})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-lg font-bold text-foreground",children:[ae.toFixed(2)," Ø±.Ø³"]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>os(i),"data-testid":`button-edit-${i.lineItemId}`,children:r.jsx(Ga,{className:"w-4 h-4"})}),r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>{Et(i.lineItemId),jt(!0)},"data-testid":`button-item-discount-${i.lineItemId}`,children:r.jsx(Na,{className:"w-4 h-4"})}),r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>ce(L.filter(de=>de.lineItemId!==i.lineItemId)),"data-testid":`button-remove-${i.lineItemId}`,children:r.jsx(Ms,{className:"w-4 h-4"})})]})]})]},i.lineItemId)}),r.jsx(At,{className:"my-4"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Ve,{placeholder:"ÙÙØ¯ Ø§ÙØ®ØµÙ",value:Ht,onChange:i=>Wt(i.target.value),className:"rounded-lg","data-testid":"input-discount-code"}),r.jsx(q,{onClick:Cr,disabled:er||!Ht.trim(),"data-testid":"button-apply-discount",children:er?r.jsx(Bn,{className:"w-4 h-4 animate-spin"}):r.jsx(fn,{className:"w-4 h-4"})})]}),W&&r.jsxs("div",{className:"flex items-center justify-between bg-accent/50 rounded-lg px-4 py-2 border border-border",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Vs,{className:"w-4 h-4 text-primary"}),r.jsxs("span",{className:"text-sm text-foreground",children:[W.reason," (",W.percentage,"%)"]})]}),r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>{bt(null),Wt("")},children:r.jsx(Dr,{className:"w-3 h-3"})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Ve,{type:"number",placeholder:"Ø®ØµÙ Ø¹ÙÙ Ø§ÙÙØ§ØªÙØ±Ø©",value:tt||"",onChange:i=>F(parseFloat(i.target.value)||0),className:"rounded-lg","data-testid":"input-invoice-discount"}),r.jsx(q,{variant:gn==="fixed"?"default":"outline",size:"icon",onClick:()=>Ut("fixed"),children:r.jsx("span",{className:"text-xs font-bold",children:"Ø±.Ø³"})}),r.jsx(q,{variant:gn==="percentage"?"default":"outline",size:"icon",onClick:()=>Ut("percentage"),children:r.jsx(Vs,{className:"w-4 h-4"})})]}),r.jsx(At,{className:"my-4"}),r.jsxs("div",{className:"space-y-2 text-sm bg-muted/50 rounded-lg p-3",children:[r.jsxs("div",{className:"flex justify-between text-muted-foreground",children:[r.jsx("span",{children:"Ø§ÙÙØ¬ÙÙØ¹ Ø§ÙÙØ±Ø¹Ù:"}),r.jsxs("span",{className:"text-foreground font-medium",children:[Rt().toFixed(2)," Ø±.Ø³"]})]}),W&&r.jsxs("div",{className:"flex justify-between text-primary",children:[r.jsxs("span",{children:["Ø®ØµÙ Ø§ÙÙÙØ¯ (",W.percentage,"%):"]}),r.jsxs("span",{children:["-",lr().toFixed(2)," Ø±.Ø³"]})]}),zt()>0&&r.jsxs("div",{className:"flex justify-between text-primary",children:[r.jsxs("span",{children:["Ø®ØµÙ Ø§ÙÙØ§ØªÙØ±Ø©",gn==="percentage"?` (${tt}%)`:"",":"]}),r.jsxs("span",{children:["-",zt().toFixed(2)," Ø±.Ø³"]})]}),mt&&nt>0&&r.jsxs("div",{className:"flex justify-between text-sm text-green-600 gap-2 flex-wrap",children:[r.jsxs("span",{children:["Ø®ØµÙ Ø§ÙÙÙØ§Ø· (",nt," ÙÙØ·Ø©):"]}),r.jsxs("span",{children:["-",ht(nt).toFixed(2)," Ø±.Ø³"]})]}),r.jsx(At,{className:"my-2"}),r.jsxs("div",{className:"flex justify-between text-xl font-bold text-primary",children:[r.jsx("span",{children:"Ø§ÙØ¥Ø¬ÙØ§ÙÙ:"}),r.jsxs("span",{children:[mt?Math.max(0,parseFloat(Je())-ht(nt)).toFixed(2):Je()," Ø±.Ø³"]})]})]}),r.jsxs("div",{className:"space-y-3 mt-6 pt-4 border-t border-border",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"ÙÙØ¹ Ø§ÙØ·ÙØ¨"}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:Gs.map(i=>r.jsxs(q,{variant:ee===i.id?"default":"outline",size:"sm",onClick:()=>ne(i.id),className:`flex items-center justify-center gap-1.5 h-11 font-bold text-xs ${ee===i.id?"shadow-lg":""}`,"data-testid":`button-order-type-${i.id}`,children:[r.jsx(i.icon,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:i.name}),r.jsx("span",{className:"sm:hidden",children:i.nameEn})]},i.id))})]}),ee==="car_pickup"&&r.jsxs("div",{className:"space-y-2 p-3 rounded-lg bg-purple-500/10 border border-purple-500/20",children:[r.jsxs("span",{className:"text-sm font-medium text-purple-600 dark:text-purple-400 flex items-center gap-1.5",children:[r.jsx(Xs,{className:"w-4 h-4"}),"Ø¨ÙØ§ÙØ§Øª Ø§ÙØ³ÙØ§Ø±Ø©"]}),r.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[r.jsx(Ve,{placeholder:"ÙÙØ¹ Ø§ÙØ³ÙØ§Ø±Ø©",value:Qe,onChange:i=>pn(i.target.value),className:"h-9 text-sm","data-testid":"input-car-type"}),r.jsx(Ve,{placeholder:"ÙÙÙ Ø§ÙØ³ÙØ§Ø±Ø©",value:Te,onChange:i=>yn(i.target.value),className:"h-9 text-sm","data-testid":"input-car-color"}),r.jsx(Ve,{placeholder:"Ø±ÙÙ Ø§ÙÙÙØ­Ø©",value:qe,onChange:i=>ge(i.target.value),className:"h-9 text-sm","data-testid":"input-plate-number"})]})]}),r.jsx(At,{}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"Ø·Ø±ÙÙØ© Ø§ÙØ¯ÙØ¹"}),r.jsxs(q,{variant:"ghost",size:"sm",onClick:()=>wt(!We),className:"h-7 px-2 text-xs",children:[r.jsx(Xa,{className:"w-3 h-3 ml-1"}),We?"Ø¥ÙØºØ§Ø¡":"ØªÙØ³ÙÙ"]})]}),We?r.jsxs("div",{className:"space-y-2",children:[Fe.map((i,b)=>r.jsxs("div",{className:"flex items-center justify-between bg-muted/50 rounded-lg p-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[cn.find(j=>j.id===i.method)?.icon&&r.jsx("div",{className:"w-7 h-7 rounded-lg bg-primary flex items-center justify-center",children:(()=>{const j=cn.find(I=>I.id===i.method)?.icon;return j?r.jsx(j,{className:"w-3.5 h-3.5 text-primary-foreground"}):null})()}),r.jsx("span",{className:"text-xs",children:cn.find(j=>j.id===i.method)?.name})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"font-bold text-sm",children:[i.amount.toFixed(2)," Ø±.Ø³"]}),r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>Ir(b),children:r.jsx(Dr,{className:"w-3 h-3"})})]})]},b)),Bt()>0&&r.jsxs("div",{className:"flex gap-1.5",children:[r.jsx("select",{value:R,onChange:i=>jn(i.target.value),className:"bg-background border border-border text-foreground rounded-lg px-2 py-1.5 text-xs flex-1",children:cn.map(i=>r.jsx("option",{value:i.id,children:i.name},i.id))}),r.jsx(Ve,{type:"number",placeholder:`${Bt().toFixed(2)}`,value:wn||"",onChange:i=>ut(parseFloat(i.target.value)||0),className:"h-8 text-xs flex-1"}),r.jsx(q,{onClick:Ar,size:"sm",children:r.jsx(hn,{className:"w-3.5 h-3.5"})})]}),r.jsxs("div",{className:"text-center py-1.5 bg-muted/30 rounded-lg",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:"Ø§ÙÙØªØ¨ÙÙ: "}),r.jsxs("span",{className:`font-bold text-sm ${Bt()>0?"text-destructive":"text-primary"}`,children:[Bt().toFixed(2)," Ø±.Ø³"]})]}),Fe.some(i=>i.method==="qahwa-card")&&be&&(()=>{const i=Math.max(0,(be.freeCupsEarned||0)-(be.freeCupsRedeemed||0)),b=L.reduce((I,B)=>I+B.quantity,0),j=Math.min(i,b);return i<=0?null:r.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-xs font-medium text-green-700 dark:text-green-400",children:[r.jsx(Fs,{className:"w-3 h-3 inline ml-1"}),"ÙØ¬Ø§ÙÙ: ",i]}),r.jsxs("div",{className:"flex items-center gap-1 bg-background rounded p-0.5",children:[r.jsx(q,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>$e(Math.max(0,ye-1)),disabled:ye<=0,children:r.jsx(Mr,{className:"w-3 h-3"})}),r.jsx("span",{className:"w-6 text-center font-bold text-sm",children:ye}),r.jsx(q,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>$e(Math.min(j,ye+1)),disabled:ye>=j,children:r.jsx(hn,{className:"w-3 h-3"})})]})]})})})()]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"grid grid-cols-4 gap-1.5",children:cn.map(i=>r.jsx(q,{variant:he===i.id?"default":"outline",size:"sm",onClick:()=>{Nn(i.id),i.id!=="qahwa-card"&&$e(0)},className:`flex flex-col h-14 gap-0.5 p-1 ${i.id==="apple_pay"?"bg-black text-white hover:bg-black/90 border-0":""}`,"data-testid":`button-payment-${i.id}`,children:i.id==="apple_pay"?r.jsx("div",{className:"flex flex-col items-center justify-center",children:r.jsx("span",{className:"text-[10px] font-black tracking-tighter",children:"ï£¿ Pay"})}):r.jsxs(r.Fragment,{children:[r.jsx(i.icon,{className:"w-4 h-4"}),r.jsx("span",{className:"text-[9px] leading-tight text-center",children:i.name})]})},i.id))}),he==="cash"&&r.jsxs("div",{className:"space-y-4 mt-2 p-3 bg-muted/30 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx(Tr,{className:"text-xs font-bold mb-1 block text-right",children:"Ø§ÙÙØ¨ÙØº Ø§ÙÙØ³ØªÙÙ"}),r.jsxs("div",{className:"relative",children:[r.jsx(Js,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),r.jsx(Ve,{type:"number",value:T||"",onChange:i=>kn(parseFloat(i.target.value)||0),className:"pr-10 h-10 text-lg font-bold text-center",placeholder:"0.00"})]})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx(Tr,{className:"text-xs font-bold mb-1 block text-right",children:"Ø§ÙÙØ¨ÙØº Ø§ÙÙØªØ¨ÙÙ"}),r.jsx("div",{className:"h-10 flex items-center justify-center bg-primary/10 rounded-lg border border-primary/20",children:r.jsxs("span",{className:"text-lg font-bold text-primary",children:[Rr.toFixed(2)," Ø±.Ø³"]})})]})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[[10,20,50,100,200,500].map(i=>r.jsxs(q,{variant:"outline",size:"sm",onClick:()=>kn((T||0)+i),className:"h-8 text-[10px] font-bold",children:["+",i]},i)),r.jsx(q,{variant:"destructive",size:"sm",onClick:()=>kn(0),className:"h-8 text-[10px] font-bold col-span-3",children:"ÙØ³Ø­ Ø§ÙÙØ¨ÙØº"})]})]}),he==="qahwa-card"&&be&&(()=>{const i=Math.max(0,(be.freeCupsEarned||0)-(be.freeCupsRedeemed||0)),b=L.reduce((I,B)=>I+B.quantity,0),j=Math.min(i,b);return i<=0?r.jsx("div",{className:"p-2 bg-muted rounded-lg text-center text-sm text-muted-foreground",children:"ÙØ§ ÙÙØ¬Ø¯ ÙØ´Ø±ÙØ¨Ø§Øª ÙØ¬Ø§ÙÙØ© ÙØªØ§Ø­Ø©"}):r.jsxs("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg space-y-2",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("span",{className:"text-sm font-medium text-green-700 dark:text-green-400",children:[r.jsx(Fs,{className:"w-4 h-4 inline ml-1"}),"ÙØ´Ø±ÙØ¨Ø§Øª ÙØ¬Ø§ÙÙØ© ÙØªØ§Ø­Ø©: ",i]})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:"Ø§Ø³ØªØ®Ø¯Ø§Ù:"}),r.jsxs("div",{className:"flex items-center gap-1 bg-background rounded-lg p-1",children:[r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>$e(Math.max(0,ye-1)),disabled:ye<=0,"data-testid":"button-decrease-free-drinks",children:r.jsx(Mr,{className:"w-4 h-4"})}),r.jsx("span",{className:"w-8 text-center font-bold",children:ye}),r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>$e(Math.min(j,ye+1)),disabled:ye>=j,"data-testid":"button-increase-free-drinks",children:r.jsx(hn,{className:"w-4 h-4"})})]}),r.jsxs(q,{size:"sm",variant:"outline",onClick:()=>$e(j),className:"text-xs","data-testid":"button-use-all-free",children:["Ø§Ø³ØªØ®Ø¯Ø§Ù Ø§ÙÙÙ (",j,")"]})]})]})})()]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-auto pt-4 border-t border-border",children:[r.jsxs(q,{variant:"outline",className:"h-14 text-lg font-bold rounded-xl flex items-center justify-center gap-2",onClick:Vr,disabled:L.length===0||en,children:[r.jsx(js,{className:"w-5 h-5"}),"ÙØ§ØªÙØ±Ø© ÙØ¨Ø¯Ø¦ÙØ©"]}),r.jsxs(q,{className:"h-14 text-lg font-bold bg-primary hover:bg-primary/90 text-primary-foreground rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-primary/20",onClick:()=>rn("pending"),disabled:L.length===0||en,"data-testid":"button-submit-order",children:[r.jsx(qr,{className:"w-5 h-5"}),"Ø¥Ø±Ø³Ø§Ù ÙÙÙØ·Ø¨Ø®"]})]}),r.jsx("div",{className:"grid grid-cols-1 gap-3 mt-3",children:r.jsxs(q,{className:"h-16 text-xl font-bold bg-accent hover:bg-accent/90 text-white rounded-xl flex items-center justify-center gap-3 shadow-xl shadow-accent/20 transition-all active:scale-[0.98]",onClick:()=>rn("in_progress"),disabled:L.length===0||en,"data-testid":"button-checkout",children:[r.jsx(Zr,{className:"w-6 h-6"}),"Ø¯ÙØ¹ ÙØ¥ØºÙØ§Ù Ø§ÙÙØ§ØªÙØ±Ø©"]})})]})]})})]})]})]})}),r.jsx(ln,{open:vt,onOpenChange:gt,children:r.jsxs(un,{className:"max-w-2xl",children:[r.jsxs(dn,{children:[r.jsxs(mn,{className:"flex items-center gap-2 text-xl",children:[r.jsx(Qs,{className:"w-6 h-6"}),"Ø§ÙØ·ÙØ¨Ø§Øª Ø§ÙÙØ¹ÙÙØ© (",X.length,")"]}),r.jsx(vs,{children:"ÙÙÙÙÙ Ø§Ø³ØªØ¦ÙØ§Ù Ø£Ù Ø·ÙØ¨ ÙØ¹ÙÙ Ø£Ù Ø­Ø°ÙÙ"})]}),r.jsx($n,{className:"max-h-[60vh]",children:X.length===0?r.jsx(xs,{title:"ÙØ§ ØªÙØ¬Ø¯ Ø·ÙØ¨Ø§Øª ÙØ¹ÙÙØ©",icon:r.jsx(ys,{className:"w-10 h-10 text-muted-foreground"})}):r.jsx("div",{className:"space-y-3",children:X.sort((i,b)=>i.priority==="urgent"&&b.priority!=="urgent"?-1:b.priority==="urgent"&&i.priority!=="urgent"?1:new Date(b.createdAt).getTime()-new Date(i.createdAt).getTime()).map(i=>r.jsx(Or,{className:i.priority==="urgent"?"border-destructive/50":"",children:r.jsxs(Er,{className:"p-4",children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h4",{className:"font-semibold text-foreground",children:i.name}),i.priority==="urgent"&&r.jsxs(je,{variant:"destructive",className:"text-xs",children:[r.jsx(Rs,{className:"w-3 h-3 ml-1"}),"Ø¹Ø§Ø¬Ù"]})]}),r.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[r.jsxs("span",{children:[i.items.length," Ø¹ÙØµØ±"]}),r.jsxs("span",{children:[i.items.reduce((b,j)=>b+j.quantity,0)," ÙØ·Ø¹Ø©"]}),i.tableNumber&&r.jsxs("span",{children:["Ø·Ø§ÙÙØ© ",i.tableNumber]})]}),i.note&&r.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[r.jsx($a,{className:"w-3 h-3"}),i.note]})]}),r.jsxs("div",{className:"text-left",children:[r.jsx(je,{variant:"secondary",className:"text-xs",children:new Date(i.createdAt).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}),r.jsxs("p",{className:"text-lg font-bold text-foreground mt-1",children:[i.items.reduce((b,j)=>b+(Number(j.coffeeItem.price)*j.quantity-(j.itemDiscount||0)),0).toFixed(2)," Ø±.Ø³"]})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(q,{size:"sm",onClick:()=>ur(i),className:"flex-1","data-testid":`button-resume-${i.id}`,children:[r.jsx(ws,{className:"w-4 h-4 ml-1"}),"Ø§Ø³ØªØ¦ÙØ§Ù"]}),r.jsx(q,{size:"sm",variant:"outline",onClick:()=>mr(i.id,i.priority==="urgent"?"normal":"urgent"),children:r.jsx(Rs,{className:`w-4 h-4 ${i.priority==="urgent"?"text-destructive":""}`})}),r.jsx(q,{size:"sm",variant:"destructive",onClick:()=>dr(i.id),"data-testid":`button-delete-parked-${i.id}`,children:r.jsx(Ms,{className:"w-4 h-4"})})]})]})},i.id))})})]})}),r.jsx(ln,{open:es,onOpenChange:Un,children:r.jsxs(un,{children:[r.jsx(dn,{children:r.jsx(mn,{children:"ØªØ¹ÙÙÙ Ø§ÙØ·ÙØ¨"})}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(Tr,{children:"ÙÙØ§Ø­Ø¸Ø© (Ø§Ø®ØªÙØ§Ø±Ù)"}),r.jsx(Ve,{value:Qn,onChange:i=>Ye(i.target.value),placeholder:"Ø£Ø¶Ù ÙÙØ§Ø­Ø¸Ø© ÙÙØ·ÙØ¨ Ø§ÙÙØ¹ÙÙ...",className:"mt-2","data-testid":"input-park-note"})]}),r.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Ø³ÙØªÙ Ø­ÙØ¸:"}),r.jsxs("ul",{className:"text-sm text-foreground mt-2 space-y-1",children:[r.jsxs("li",{children:[L.length," ÙÙØªØ¬"]}),r.jsxs("li",{children:["Ø§ÙÙØ¬ÙÙØ¹: ",Je()," Ø±.Ø³"]}),Ne&&r.jsxs("li",{children:["Ø§ÙØ¹ÙÙÙ: ",Ne]}),fe&&r.jsxs("li",{children:["Ø·Ø§ÙÙØ©: ",fe]})]})]})]}),r.jsxs(Xr,{children:[r.jsx(q,{variant:"outline",onClick:()=>Un(!1),children:"Ø¥ÙØºØ§Ø¡"}),r.jsxs(q,{onClick:Lr,"data-testid":"button-confirm-park",children:[r.jsx(Ns,{className:"w-4 h-4 ml-1"}),"ØªØ¹ÙÙÙ Ø§ÙØ·ÙØ¨"]})]})]})}),r.jsx(ln,{open:Fr,onOpenChange:jt,children:r.jsxs(un,{children:[r.jsx(dn,{children:r.jsx(mn,{children:"Ø®ØµÙ Ø¹ÙÙ Ø§ÙÙÙØªØ¬"})}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(Tr,{children:"ÙÙØ¹ Ø§ÙØ®ØµÙ"}),r.jsxs("div",{className:"flex gap-2 mt-2",children:[r.jsx(q,{variant:Dt==="fixed"?"default":"outline",onClick:()=>Qt("fixed"),className:"flex-1",children:"ÙØ¨ÙØº Ø«Ø§Ø¨Øª (Ø±.Ø³)"}),r.jsx(q,{variant:Dt==="percentage"?"default":"outline",onClick:()=>Qt("percentage"),className:"flex-1",children:"ÙØ³Ø¨Ø© ÙØ¦ÙÙØ© (%)"})]})]}),r.jsxs("div",{children:[r.jsxs(Tr,{children:["ÙÙÙØ© Ø§ÙØ®ØµÙ ",Dt==="percentage"?"(%)":"(Ø±.Ø³)"]}),r.jsx(Ve,{type:"number",value:Nt,onChange:i=>lt(parseFloat(i.target.value)||0),placeholder:"0",className:"mt-2 text-xl text-center","data-testid":"input-item-discount-amount"})]}),Dt==="percentage"&&r.jsx("div",{className:"grid grid-cols-4 gap-2",children:[5,10,15,20,25,30,50,100].map(i=>r.jsxs(q,{variant:"outline",size:"sm",onClick:()=>lt(i),children:[i,"%"]},i))})]}),r.jsxs(Xr,{children:[r.jsx(q,{variant:"outline",onClick:()=>{jt(!1),Et(null)},children:"Ø¥ÙØºØ§Ø¡"}),r.jsxs(q,{onClick:()=>{xr&&Sr(xr,Nt,Dt)},"data-testid":"button-confirm-item-discount",children:[r.jsx(fn,{className:"w-4 h-4 ml-1"}),"ØªØ·Ø¨ÙÙ Ø§ÙØ®ØµÙ"]})]})]})}),r.jsx(ln,{open:Hn,onOpenChange:oe,children:r.jsxs(un,{className:"max-w-5xl h-[85vh] flex flex-col",children:[r.jsxs(dn,{children:[r.jsxs(mn,{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Jr,{className:"w-6 h-6 text-primary"}),"Ø¥Ø¯Ø§Ø±Ø© Ø§ÙØ·ÙØ¨Ø§Øª Ø§ÙÙØ¨Ø§Ø´Ø±Ø©",Jt&&r.jsxs(je,{variant:"outline",className:"text-xs",children:[r.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full ml-1 animate-pulse"}),"ÙØ¨Ø§Ø´Ø±"]})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs(je,{variant:"secondary",children:[Ie.filter(i=>i.status!=="completed"&&i.status!=="cancelled").length," Ø·ÙØ¨ ÙØ´Ø·"]})})]}),r.jsx(vs,{children:"ÙØªØ§Ø¨Ø¹Ø© ÙØªØ­ÙÙ ÙÙ Ø§ÙØ·ÙØ¨Ø§Øª Ø§ÙÙØ´Ø·Ø© ÙÙ Ø§ÙÙØ¸Ø§Ù - Ø§Ø¶ØºØ· Ø¹ÙÙ Ø§ÙØ·ÙØ¨ ÙØ¹Ø±Ø¶ Ø§ÙØªÙØ§ØµÙÙ"})]}),r.jsxs("div",{className:"flex gap-4 flex-1 min-h-0 mt-4",children:[r.jsx($n,{className:"flex-1",children:r.jsxs("div",{className:"space-y-3 pr-4",children:[Ie.filter(i=>i.status!=="completed"&&i.status!=="cancelled").map(i=>{const b={pending:"border-r-4 border-r-orange-500",in_progress:"border-r-4 border-r-blue-500",ready:"border-r-4 border-r-green-500",open:"border-r-4 border-r-purple-500"},j={pending:"ÙÙ Ø§ÙØ§ÙØªØ¸Ø§Ø±",in_progress:"ÙÙØ¯ Ø§ÙØªØ¬ÙÙØ²",ready:"Ø¬Ø§ÙØ² ÙÙØ§Ø³ØªÙØ§Ù",open:"Ø·Ø§ÙÙØ© ÙÙØªÙØ­Ø©"};return r.jsx(Or,{className:`overflow-hidden cursor-pointer hover-elevate ${b[i.status]||""} ${pe?.id===i.id?"ring-2 ring-primary":""}`,onClick:()=>qt(i),children:r.jsxs(Er,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs(je,{variant:"outline",className:"text-base font-bold px-2 py-0.5",children:["#",i.orderNumber]}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-foreground text-sm",children:i.customerInfo?.customerName||"Ø¹ÙÙÙ"}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[r.jsx(ys,{className:"w-3 h-3"}),new Date(i.createdAt).toLocaleTimeString("ar-SA"),i.tableNumber&&r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"mx-1",children:"â¢"}),r.jsx(Hs,{className:"w-3 h-3"}),"Ø·Ø§ÙÙØ© ",i.tableNumber]})]})]})]}),r.jsxs("div",{className:"flex flex-col items-end gap-1",children:[r.jsx(je,{variant:i.status==="pending"?"destructive":i.status==="ready"?"default":"secondary",children:j[i.status]||i.status}),r.jsxs("p",{className:"font-bold text-primary text-sm",children:[Number(i.totalAmount).toFixed(2)," Ø±.Ø³"]})]})]}),r.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-3",children:[i.status==="pending"&&r.jsxs(q,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:async I=>{I.stopPropagation(),await yt("PATCH",`/api/orders/${i.id}/status`,{status:"in_progress"}),te&&on("statusChange",.3),it.invalidateQueries({queryKey:["/api/orders/live"]})},children:[r.jsx(ws,{className:"w-3 h-3 ml-1"}),"Ø¨Ø¯Ø¡ Ø§ÙØªØ¬ÙÙØ²"]}),i.status==="in_progress"&&r.jsxs(q,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:async I=>{I.stopPropagation(),await yt("PATCH",`/api/orders/${i.id}/status`,{status:"ready"}),te&&on("success",.5),it.invalidateQueries({queryKey:["/api/orders/live"]})},children:[r.jsx(fn,{className:"w-3 h-3 ml-1"}),"Ø¬Ø§ÙØ²"]}),(i.status==="ready"||i.status==="in_progress")&&r.jsxs(q,{size:"sm",className:"h-7 text-xs",onClick:async I=>{I.stopPropagation(),await yt("PATCH",`/api/orders/${i.id}/status`,{status:"completed"}),te&&on("success",.5),it.invalidateQueries({queryKey:["/api/orders/live"]}),M({title:"ØªÙ Ø¥ÙÙØ§Ù Ø§ÙØ·ÙØ¨",description:`Ø·ÙØ¨ #${i.orderNumber}`})},children:[r.jsx(qr,{className:"w-3 h-3 ml-1"}),"Ø¥ÙÙØ§Ù"]}),r.jsxs(q,{size:"sm",variant:"ghost",className:"h-7 text-xs text-destructive hover:bg-destructive/10",onClick:async I=>{I.stopPropagation(),confirm("ÙÙ Ø£ÙØª ÙØªØ£ÙØ¯ ÙÙ Ø¥ÙØºØ§Ø¡ ÙØ°Ø§ Ø§ÙØ·ÙØ¨Ø")&&(await yt("PATCH",`/api/orders/${i.id}/status`,{status:"cancelled"}),it.invalidateQueries({queryKey:["/api/orders/live"]}),M({title:"ØªÙ Ø¥ÙØºØ§Ø¡ Ø§ÙØ·ÙØ¨",variant:"destructive"}))},children:[r.jsx($s,{className:"w-3 h-3 ml-1"}),"Ø¥ÙØºØ§Ø¡"]})]})]})},i.id)}),Ie.filter(i=>i.status!=="completed"&&i.status!=="cancelled").length===0&&r.jsx(xs,{title:"ÙØ§ ØªÙØ¬Ø¯ Ø·ÙØ¨Ø§Øª ÙØ´Ø·Ø©",description:"Ø³ØªØ¸ÙØ± Ø§ÙØ·ÙØ¨Ø§Øª Ø§ÙØ¬Ø¯ÙØ¯Ø© ÙÙØ§ ØªÙÙØ§Ø¦ÙØ§Ù"})]})}),pe&&r.jsx(Or,{className:"w-80 flex-shrink-0 flex flex-col",children:r.jsxs(Er,{className:"p-4 flex-1 flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"font-bold text-lg",children:"ØªÙØ§ØµÙÙ Ø§ÙØ·ÙØ¨"}),r.jsx(q,{size:"icon",variant:"ghost",onClick:()=>qt(null),children:r.jsx(Dr,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-3 flex-1",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Ø±ÙÙ Ø§ÙØ·ÙØ¨:"}),r.jsxs("span",{className:"font-bold",children:["#",pe.orderNumber]})]}),r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Ø§ÙØ¹ÙÙÙ:"}),r.jsx("span",{children:pe.customerInfo?.customerName||"Ø¹ÙÙÙ"})]}),pe.customerInfo?.phoneNumber&&r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Ø§ÙÙØ§ØªÙ:"}),r.jsx("span",{dir:"ltr",children:pe.customerInfo.phoneNumber})]}),pe.tableNumber&&r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Ø§ÙØ·Ø§ÙÙØ©:"}),r.jsxs("span",{children:["Ø·Ø§ÙÙØ© ",pe.tableNumber]})]}),r.jsx(At,{className:"my-2"}),r.jsx("div",{className:"text-sm font-medium mb-2",children:"Ø§ÙØ£ØµÙØ§Ù:"}),r.jsx($n,{className:"h-40",children:r.jsx("div",{className:"space-y-2",children:pe.items?.map((i,b)=>r.jsxs("div",{className:"flex justify-between text-sm bg-muted/30 rounded p-2",children:[r.jsxs("span",{children:[i.quantity,"x ",i.name||i.coffeeItem?.name||"ØµÙÙ"]}),r.jsx("span",{className:"font-medium",children:Number(i.price*i.quantity).toFixed(2)})]},b))})}),r.jsx(At,{className:"my-2"}),r.jsxs("div",{className:"flex justify-between font-bold",children:[r.jsx("span",{children:"Ø§ÙØ¥Ø¬ÙØ§ÙÙ:"}),r.jsxs("span",{className:"text-primary",children:[Number(pe.totalAmount).toFixed(2)," Ø±.Ø³"]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4 pt-4 border-t",children:[r.jsxs(q,{variant:"outline",size:"sm",onClick:()=>{gs(pe),M({title:"Ø¬Ø§Ø±Ù Ø§ÙØ·Ø¨Ø§Ø¹Ø©..."})},children:[r.jsx(js,{className:"w-4 h-4 ml-1"}),"Ø·Ø¨Ø§Ø¹Ø©"]}),r.jsxs(q,{variant:"outline",size:"sm",onClick:()=>{bs(pe),M({title:"Ø¬Ø§Ø±Ù Ø·Ø¨Ø§Ø¹Ø© Ø§ÙÙØ§ØªÙØ±Ø©..."})},children:[r.jsx(Us,{className:"w-4 h-4 ml-1"}),"ÙØ§ØªÙØ±Ø©"]})]})]})})]})]})}),r.jsx(ln,{open:ts&&!!Q,onOpenChange:gr,children:r.jsxs(un,{className:"max-w-md",children:[r.jsx(dn,{children:r.jsxs(mn,{className:"flex items-center gap-2",children:[r.jsx(qr,{className:"w-6 h-6 text-primary"}),"ØªÙ Ø¥ÙØ´Ø§Ø¡ Ø§ÙØ·ÙØ¨ Ø¨ÙØ¬Ø§Ø­"]})}),Q&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-muted/50 rounded-xl p-6 text-center",children:[r.jsx("p",{className:"text-muted-foreground text-sm mb-1",children:"Ø±ÙÙ Ø§ÙØ·ÙØ¨"}),r.jsx("p",{className:"text-3xl font-bold text-primary",children:Q.orderNumber.split("-").pop()}),r.jsxs("p",{className:"text-2xl font-bold text-foreground mt-3",children:[Q.total," Ø±.Ø³"]}),Q.offline&&r.jsxs(je,{variant:"secondary",className:"mt-2",children:[r.jsx(Bs,{className:"w-3 h-3 ml-1"}),"ÙØ­ÙÙØ¸ ÙØ­ÙÙØ§Ù"]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[r.jsxs(q,{className:"h-14",variant:"outline",onClick:async()=>{try{await yt("POST","/api/orders/mark-all-completed",{}),it.invalidateQueries({queryKey:["/api/orders/live"]}),M({title:"ØªÙ Ø§ÙØªØ­Ø¯ÙØ«",description:"ØªÙ ØªØ­Ø¯ÙØ« Ø¬ÙÙØ¹ Ø§ÙØ·ÙØ¨Ø§Øª Ø¥ÙÙ ÙÙØªÙÙ"})}catch{M({title:"Ø®Ø·Ø£",description:"ÙØ´Ù ØªØ­Ø¯ÙØ« Ø§ÙØ·ÙØ¨Ø§Øª",variant:"destructive"})}},"data-testid":"button-mark-all-completed",children:[r.jsx(qr,{className:"w-5 h-5 ml-2"}),"Ø¥ÙÙØ§Ù Ø§ÙÙÙ"]}),r.jsxs(q,{onClick:cs,className:"h-14","data-testid":"button-print-receipt",children:[r.jsx(js,{className:"w-5 h-5 ml-2"}),"Ø·Ø¨Ø§Ø¹Ø© Ø§ÙØ¥ÙØµØ§Ù"]})]}),r.jsxs(q,{onClick:nn,variant:"outline",className:"h-14 w-full mt-3","data-testid":"button-print-tax",children:[r.jsx(Us,{className:"w-5 h-5 ml-2"}),"ÙØ§ØªÙØ±Ø© Ø¶Ø±ÙØ¨ÙØ©"]}),r.jsx(q,{onClick:()=>gr(!1),variant:"ghost",className:"w-full","data-testid":"button-close-receipt",children:"Ø¥ØºÙØ§Ù"})]})]})}),r.jsx(ln,{open:rr,onOpenChange:On,children:r.jsxs(un,{className:"max-w-lg",children:[r.jsx(dn,{children:r.jsxs(mn,{className:"flex items-center gap-2",children:[r.jsx(Zr,{className:"w-5 h-5"}),"ÙØ³Ø­ Ø¨Ø·Ø§ÙØ© Ø§ÙÙÙØ§Ø¡"]})}),r.jsx(Da,{onCustomerFound:qn,onClose:()=>On(!1),showManualInput:!0})]})}),r.jsx(ti,{coffeeItem:En,open:ss,onClose:()=>{Z(!1),sr(null),_e(null)},onConfirm:cr,initialCustomization:Xt?L.find(i=>i.lineItemId===Xt)?.customization:void 0,initialQuantity:Xt&&L.find(i=>i.lineItemId===Xt)?.quantity||1}),r.jsx(ln,{open:ft,onOpenChange:Sn,children:r.jsxs(un,{className:"sm:max-w-md",children:[r.jsxs(dn,{children:[r.jsxs(mn,{className:"flex items-center gap-2",children:[r.jsx(Ls,{className:"w-5 h-5 text-primary"}),"Ø§ÙØªØ­ÙÙ ÙÙ Ø±ÙØ² Ø§ÙÙÙØ§Ø·"]}),r.jsx(vs,{children:"Ø£Ø¯Ø®Ù Ø§ÙØ±ÙØ² Ø§ÙÙÙÙÙ ÙÙ 4 Ø£Ø±ÙØ§Ù Ø§ÙØ°Ù Ø£Ø±Ø³Ù Ø¥ÙÙ Ø¨Ø±ÙØ¯ Ø§ÙØ¹ÙÙÙ"})]}),r.jsxs("div",{className:"space-y-4",children:[Cn&&r.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:r.jsxs("p",{className:"text-xs text-yellow-700 dark:text-yellow-400 font-mono",children:["[ÙØ¶Ø¹ Ø§ÙØªØ·ÙÙØ±] Ø§ÙØ±ÙØ²: ",r.jsx("strong",{children:Cn})]})}),r.jsxs("div",{className:"flex flex-col items-center gap-3",children:[r.jsx(Ve,{type:"text",inputMode:"numeric",maxLength:4,value:rt,onChange:i=>Mt(i.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"0000",className:"text-center text-2xl tracking-[0.5em] font-mono w-48",autoFocus:!0,"data-testid":"input-pos-verification-code"}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ø§ÙÙÙØ§Ø·: ",$," = ",ht($).toFixed(2)," Ø±.Ø³"]})]})]}),r.jsxs(Xr,{className:"gap-2",children:[r.jsx(q,{variant:"outline",onClick:()=>{Sn(!1),Mt("")},children:"Ø¥ÙØºØ§Ø¡"}),r.jsxs(q,{onClick:Pn,disabled:Ct||rt.length<4,"data-testid":"button-pos-verify-code",children:[Ct?r.jsx(Bn,{className:"w-4 h-4 animate-spin ml-1"}):r.jsx(fn,{className:"w-4 h-4 ml-1"}),"ØªØ£ÙÙØ¯ Ø§ÙØ±ÙØ²"]})]})]})})]})}export{Mi as default};
