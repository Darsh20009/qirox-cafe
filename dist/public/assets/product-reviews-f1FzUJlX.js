import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as h}from"./vendor-react-Bzsngnqy.js";import{a as u,b as p}from"./vendor-query-CX8ZYlKb.js";import{a4 as n,a7 as j,B as b,C as g,v as N,N as f}from"./index-CLvpp2UE.js";import{M as y}from"./message-square-CmUMJD2u.js";import"./vendor-utils-BKCsaWdX.js";function q({productId:l}){const[i,c]=h.useState(0),[d,m]=h.useState(""),{data:a}=u({queryKey:["/api/reviews",l],queryFn:async()=>(await fetch(`/api/reviews?productId=${l}`)).json()}),r=p({mutationFn:async s=>N("POST","/api/reviews",s),onSuccess:()=>{f.invalidateQueries({queryKey:["/api/reviews",l]}),c(0),m("")}}),o=a?.length?(a.reduce((s,t)=>s+t.rating,0)/a.length).toFixed(1):0;return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"bg-card rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"التقييمات والآراء"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-3xl font-bold",children:o}),e.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((s,t)=>e.jsx(n,{className:`w-5 h-5 ${t<Math.round(Number(o))?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},t))}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["(",a?.length||0," تقييم)"]})]})]}),e.jsxs("div",{className:"bg-card rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"أضف تقييمك"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm mb-2 block",children:"التقييم (1-5)"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>c(s),"data-testid":`button-rate-${s}`,className:"p-1",children:e.jsx(n,{className:`w-6 h-6 ${i>=s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm mb-2 block",children:"التعليق (اختياري)"}),e.jsx(j,{value:d,onChange:s=>m(s.target.value),placeholder:"شارك رأيك عن المنتج...","data-testid":"input-review-comment",className:"min-h-20"})]}),e.jsx(b,{onClick:()=>r.mutate({productId:l,rating:i,comment:d}),disabled:!i||r.isPending,"data-testid":"button-submit-review",className:"w-full",children:r.isPending?"جاري الإرسال...":"إرسال التقييم"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"التقييمات الأخيرة"}),a?.map(s=>e.jsxs(g,{className:"p-4","data-testid":`card-review-${s.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((t,x)=>e.jsx(n,{className:`w-4 h-4 ${x<s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},x))}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString("ar-SA")})]}),s.comment&&e.jsx("p",{className:"text-sm mb-3",children:s.comment}),s.adminReply&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-2 rounded text-sm",children:[e.jsxs("p",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-1 flex gap-2",children:[e.jsx(y,{className:"w-4 h-4"})," رد الإدارة:"]}),e.jsx("p",{children:s.adminReply})]})]},s.id))]})]})}export{q as default};
