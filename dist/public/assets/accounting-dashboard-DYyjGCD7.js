const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-DC5GMwbl.js","assets/index-CLvpp2UE.js","assets/vendor-ui-DJm-zmnP.js","assets/vendor-react-Bzsngnqy.js","assets/vendor-query-CX8ZYlKb.js","assets/vendor-utils-BKCsaWdX.js","assets/index-ZwtrkEfO.css"])))=>i.map(i=>d[i]);
import{l as Ve,c as is,e as ds,B as N,g as cs,P as xs,aa as os,ab as hs,ac as Q,ai as U,q as k,C as c,f as x,x as j,y as u,V as q,a0 as we,Z as le,af as ke,j as S,k as ms,R as js,D as Fe,E as Ce,F as Pe,H as Te,am as us,J as ps,L as R,I as ie,a7 as gs,K as fs,v as De,N as W,ah as Ee}from"./index-CLvpp2UE.js";import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as $}from"./vendor-react-Bzsngnqy.js";import{a as A,b as Me}from"./vendor-query-CX8ZYlKb.js";import{S as Y,a as Z,b as J,c as X,d as f}from"./select-BzAjeBJu.js";import{T as y,a as b,b as d,c as n,d as v,e as r}from"./table-DVDQb40v.js";import{S as Ns}from"./scroll-area-DK2Y4dAh.js";import{E as ee}from"./eye-cZNGFzyE.js";import{T as de}from"./trending-up-BzxeYQ4e.js";import{P as $e}from"./package-B_dGuXgn.js";import{T as ys}from"./trending-down-By0t33Hr.js";import{P as Se}from"./piggy-bank-f6kkxB0t.js";import{D as ce}from"./dollar-sign-CFWcU9O3.js";import{C as xe}from"./chart-column-CfkHrk5y.js";import{R as P,C as L,X as K,Y as O,T,L as oe,B as se,N as D,a as Re}from"./BarChart-C-BXurcz.js";import{A as Ae,a as he}from"./AreaChart-EwIn2y1e.js";import{C as bs}from"./calendar-MKHPq1ii.js";import{P as Le,a as Ke}from"./PieChart-CcImm4lT.js";import{R as Oe}from"./receipt-7jFYni-X.js";import{P as _e}from"./percent-CSssf6tt.js";import{F as vs}from"./file-text-QZcL_gux.js";import{P as ws}from"./printer-CMPCONS0.js";import{L as ks}from"./layout-dashboard-CDiioM3e.js";import{B as Fs}from"./briefcase-Bs7q7b7l.js";import{f as w}from"./vendor-utils-BKCsaWdX.js";import{a as _}from"./ar-CeWsqWSX.js";import"./chevron-down-CqdH-ack.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=Ve("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=Ve("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),B=[{value:"inventory",label:"المخزون والمواد الخام"},{value:"salaries",label:"الرواتب والأجور"},{value:"rent",label:"الإيجار"},{value:"utilities",label:"المرافق (كهرباء/ماء)"},{value:"marketing",label:"التسويق والإعلان"},{value:"maintenance",label:"الصيانة"},{value:"supplies",label:"المستلزمات"},{value:"other",label:"أخرى"}],V={pending:{label:"قيد الانتظار",variant:"secondary"},approved:{label:"معتمد",variant:"default"},rejected:{label:"مرفوض",variant:"destructive"},paid:{label:"مدفوع",variant:"default"}},qe={cash:"نقدي",pos:"شبكة",bank_transfer:"تحويل بنكي",stc:"STC Pay",alinma:"Alinma Pay"},te=["#f59e0b","#10b981","#3b82f6","#8b5cf6","#ef4444","#ec4899"],Be={today:"اليوم",week:"هذا الأسبوع",month:"هذا الشهر",year:"هذه السنة"};function et(){const[,ze]=is(),{toast:F}=ds(),[Ge,He]=$.useState("overview"),[p,Qe]=$.useState("today"),[o,Ue]=$.useState("all"),[We,z]=$.useState(!1),[h,E]=$.useState({category:"",subcategory:"",description:"",amount:"",vatAmount:"",paymentMethod:"cash",notes:""}),[m,me]=$.useState(null),[ae,je]=$.useState(!1),{data:ue=[]}=A({queryKey:["/api/branches"]}),{data:t,isLoading:pe}=A({queryKey:["/api/accounting/dashboard",p,o],queryFn:async()=>{const s=new URLSearchParams({period:p});o!=="all"&&s.append("branchId",o);const a=await fetch(`/api/accounting/dashboard?${s}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch dashboard");const l=await a.json();return{totalRevenue:l.summary?.totalRevenue||0,totalVat:l.summary?.totalVatCollected||0,totalExpenses:l.summary?.totalExpenses||0,totalCogs:l.summary?.totalCogs||0,grossProfit:l.summary?.grossProfit||0,netProfit:l.summary?.netProfit||0,orderCount:l.summary?.orderCount||0,invoiceCount:l.summary?.invoiceCount||0,profitMargin:l.summary?.profitMargin||0,expensesByCategory:l.expensesByCategory||{},revenueByPayment:l.revenueByPayment||{},dailyTrend:l.dailyTrend||[],weeklyTrend:l.weeklyTrend||[],topSellingItems:l.topSellingItems||[]}}}),{data:C,isLoading:ge}=A({queryKey:["/api/accounting/expenses",p,o],queryFn:async()=>{const s=new URLSearchParams({limit:"50",period:p});o!=="all"&&s.append("branchId",o);const a=await fetch(`/api/accounting/expenses?${s}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch expenses");return a.json()}}),{data:re,isLoading:Ye}=A({queryKey:["/api/accounting/revenue",p,o],queryFn:async()=>{const s=new URLSearchParams({limit:"50",period:p});o!=="all"&&s.append("branchId",o);const a=await fetch(`/api/accounting/revenue?${s}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch revenues");return a.json()}}),{data:G,isLoading:fe}=A({queryKey:["/api/orders",p,o],queryFn:async()=>{const s=new URLSearchParams({limit:"100",period:p});o!=="all"&&s.append("branchId",o);const a=await fetch(`/api/orders?${s}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch orders");const l=await a.json();return{orders:Array.isArray(l)?l:[]}},enabled:ae&&(m==="revenue"||m==="cogs"||m==="orders")}),{data:Ze,isLoading:Je}=A({queryKey:["/api/inventory/stock-movements",p,o],queryFn:async()=>{const s=new URLSearchParams({limit:"50",period:p});o!=="all"&&s.append("branchId",o);const a=await fetch(`/api/inventory/stock-movements?${s}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch stock movements");return{movements:(await a.json()).movements||[]}},enabled:ae&&m==="cogs"}),H=s=>{me(s),je(!0)},Ne=()=>{je(!1),me(null)},ne=Me({mutationFn:async s=>De("POST","/api/accounting/expenses",s),onSuccess:()=>{W.invalidateQueries({queryKey:["/api/accounting/expenses"]}),W.invalidateQueries({queryKey:["/api/accounting/dashboard"]}),z(!1),E({category:"",subcategory:"",description:"",amount:"",vatAmount:"",paymentMethod:"cash",notes:""}),F({title:"تم إضافة المصروف بنجاح"})},onError:()=>{F({title:"فشل في إضافة المصروف",variant:"destructive"})}}),ye=Me({mutationFn:async s=>De("PATCH",`/api/accounting/expenses/${s}/approve`),onSuccess:()=>{W.invalidateQueries({queryKey:["/api/accounting/expenses"]}),W.invalidateQueries({queryKey:["/api/accounting/dashboard"]}),F({title:"تم اعتماد المصروف بنجاح"})},onError:()=>{F({title:"فشل في اعتماد المصروف",variant:"destructive"})}}),Xe=()=>{const s=parseFloat(h.amount),a=parseFloat(h.vatAmount||"0");ne.mutate({branchId:o!=="all"?o:void 0,date:new Date().toISOString(),category:h.category,subcategory:h.subcategory,description:h.description,amount:s,vatAmount:a,totalAmount:s+a,paymentMethod:h.paymentMethod,notes:h.notes})},es=s=>ue.find(l=>l.id===s)?.nameAr||"غير محدد",ss=s=>s.map(a=>{const l={};return Object.keys(a).forEach(i=>{!i.startsWith("_")&&i!=="__v"&&i!=="password"&&i!=="token"&&(l[i]=a[i])}),l}),be=(s,a,l)=>{Ee(()=>import("./xlsx-62rwurJE.js"),[]).then(i=>{const g=ss(s),ls=i.utils.json_to_sheet(g),ve=i.utils.book_new();i.utils.book_append_sheet(ve,ls,"تقرير"),i.writeFile(ve,`${a}_${w(new Date,"yyyy-MM-dd")}.xlsx`),F({title:"تم تصدير التقرير بنجاح",description:"تم حفظ الملف بصيغة Excel"})}).catch(()=>{F({title:"فشل التصدير",variant:"destructive"})})},ts=(s,a)=>{Ee(async()=>{const{jsPDF:l}=await import("./jspdf.es.min-DC5GMwbl.js").then(i=>i.j);return{jsPDF:l}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({jsPDF:l})=>{const i=new l({orientation:"portrait"});i.setFont("helvetica"),i.setFontSize(18),i.text(s,105,20,{align:"center"}),i.setFontSize(12),i.text(`الفترة: ${Be[p]}`,105,30,{align:"center"}),i.text(`التاريخ: ${w(new Date,"yyyy/MM/dd")}`,105,38,{align:"center"});let g=55;a.summary&&(i.setFontSize(14),i.text("ملخص الأداء المالي",105,g,{align:"center"}),g+=12,i.setFontSize(11),i.text(`إجمالي الإيرادات: ${a.summary.totalRevenue?.toFixed(2)||0} ر.س`,20,g),g+=8,i.text(`تكلفة المكونات: ${a.summary.totalCogs?.toFixed(2)||0} ر.س`,20,g),g+=8,i.text(`المصروفات: ${a.summary.totalExpenses?.toFixed(2)||0} ر.س`,20,g),g+=8,i.text(`صافي الربح: ${a.summary.netProfit?.toFixed(2)||0} ر.س`,20,g),g+=8,i.text(`هامش الربح: ${a.summary.profitMargin?.toFixed(1)||0}%`,20,g)),i.save(`${s}_${w(new Date,"yyyy-MM-dd")}.pdf`),F({title:"تم تصدير التقرير بنجاح",description:"تم حفظ الملف بصيغة PDF"})}).catch(()=>{F({title:"فشل التصدير",variant:"destructive"})})},as=()=>{if(!t)return;const s=[{البند:"إجمالي الإيرادات",القيمة:t.totalRevenue},{البند:"ضريبة القيمة المضافة",القيمة:t.totalVat},{البند:"تكلفة المكونات (COGS)",القيمة:t.totalCogs},{البند:"إجمالي الربح",القيمة:t.grossProfit},{البند:"المصروفات التشغيلية",القيمة:t.totalExpenses},{البند:"صافي الربح",القيمة:t.netProfit},{البند:"هامش الربح %",القيمة:t.profitMargin},{البند:"عدد الطلبات",القيمة:t.orderCount}];be(s,"ملخص_محاسبي")},rs=()=>{if(!C?.expenses)return;const s=C.expenses.map(a=>({التاريخ:w(new Date(a.date),"yyyy/MM/dd"),الفئة:B.find(l=>l.value===a.category)?.label||a.category,الوصف:a.description,المبلغ:a.amount,الضريبة:a.vatAmount,الإجمالي:a.totalAmount,الحالة:V[a.status]?.label||a.status}));be(s,"سجل_المصروفات")},ns=()=>{t&&ts("التقرير المالي الشامل",{summary:{totalRevenue:t.totalRevenue,totalCogs:t.totalCogs,totalExpenses:t.totalExpenses,netProfit:t.netProfit,profitMargin:t.profitMargin}})},M=t?.revenueByPayment?Object.entries(t.revenueByPayment).map(([s,a])=>({name:qe[s]||s,value:a})):[],I=t?.expensesByCategory?Object.entries(t.expensesByCategory).map(([s,a])=>({name:B.find(l=>l.value===s)?.label||s,value:a})):[];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-primary/5 to-yellow-50 dark:from-background dark:via-primary/5 dark:to-background",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto p-4 md:p-6 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-6",children:[e.jsxs(N,{variant:"ghost",onClick:()=>ze("/employee/dashboard"),className:"text-accent dark:text-accent","data-testid":"button-back",children:[e.jsx(cs,{className:"w-4 h-4 ml-2"}),"العودة"]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-accent dark:text-accent",children:"نظام المحاسبة المتكامل"}),e.jsx("div",{className:"w-20"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsxs(Y,{value:p,onValueChange:Qe,children:[e.jsx(Z,{className:"w-40","data-testid":"select-period",children:e.jsx(J,{placeholder:"الفترة"})}),e.jsxs(X,{children:[e.jsx(f,{value:"today",children:"اليوم"}),e.jsx(f,{value:"week",children:"هذا الأسبوع"}),e.jsx(f,{value:"month",children:"هذا الشهر"}),e.jsx(f,{value:"year",children:"هذه السنة"})]})]}),e.jsxs(Y,{value:o,onValueChange:Ue,children:[e.jsx(Z,{className:"w-48","data-testid":"select-branch",children:e.jsx(J,{placeholder:"الفرع"})}),e.jsxs(X,{children:[e.jsx(f,{value:"all",children:"جميع الفروع"}),ue.map(s=>e.jsx(f,{value:s.id,children:s.nameAr},s.id))]})]}),e.jsxs(N,{onClick:()=>z(!0),className:"bg-primary hover:bg-primary","data-testid":"button-add-expense",children:[e.jsx(xs,{className:"w-4 h-4 ml-2"}),"إضافة مصروف"]})]}),e.jsxs(os,{value:Ge,onValueChange:He,className:"space-y-6",children:[e.jsxs(hs,{className:"grid w-full grid-cols-4 bg-primary dark:bg-primary/30",children:[e.jsx(Q,{value:"overview","data-testid":"tab-overview",children:"نظرة عامة"}),e.jsx(Q,{value:"expenses","data-testid":"tab-expenses",children:"المصروفات"}),e.jsx(Q,{value:"revenues","data-testid":"tab-revenues",children:"الإيرادات"}),e.jsx(Q,{value:"reports","data-testid":"tab-reports",children:"التقارير"})]}),e.jsx(U,{value:"overview",className:"space-y-6",children:pe?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-accent"})}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(c,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white cursor-pointer transition-transform hover:scale-[1.02]",onClick:()=>H("revenue"),"data-testid":"card-revenue-drilldown",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-green-100 text-sm flex items-center gap-1",children:["إجمالي الإيرادات",e.jsx(ee,{className:"w-3 h-3"})]}),e.jsx("p",{className:"text-3xl font-bold mt-1","data-testid":"text-total-revenue",children:t.totalRevenue.toFixed(2)}),e.jsx("p",{className:"text-green-200 text-xs mt-1",children:"ريال سعودي - انقر للتفاصيل"})]}),e.jsx(de,{className:"w-12 h-12 text-green-200"})]})})}),e.jsx(c,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white cursor-pointer transition-transform hover:scale-[1.02]",onClick:()=>H("cogs"),"data-testid":"card-cogs-drilldown",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-accent text-sm flex items-center gap-1",children:["تكلفة المكونات (COGS)",e.jsx(ee,{className:"w-3 h-3"})]}),e.jsx("p",{className:"text-3xl font-bold mt-1","data-testid":"text-total-cogs",children:t.totalCogs.toFixed(2)}),e.jsx("p",{className:"text-accent text-xs mt-1",children:"ريال سعودي - انقر للتفاصيل"})]}),e.jsx($e,{className:"w-12 h-12 text-accent"})]})})}),e.jsx(c,{className:"bg-gradient-to-br from-red-500 to-red-600 text-white cursor-pointer transition-transform hover:scale-[1.02]",onClick:()=>H("expenses"),"data-testid":"card-expenses-drilldown",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-red-100 text-sm flex items-center gap-1",children:["المصروفات الشهرية",e.jsx(ee,{className:"w-3 h-3"})]}),e.jsx("p",{className:"text-3xl font-bold mt-1","data-testid":"text-total-expenses",children:t.totalExpenses.toFixed(2)}),e.jsx("p",{className:"text-red-200 text-xs mt-1",children:"ريال سعودي - انقر للتفاصيل"})]}),e.jsx(ys,{className:"w-12 h-12 text-red-200"})]})})}),e.jsx(c,{className:`bg-gradient-to-br ${t.netProfit>=0?"from-blue-500 to-blue-600":"from-red-600 to-red-700"} text-white cursor-pointer transition-transform hover:scale-[1.02]`,onClick:()=>H("orders"),"data-testid":"card-profit-drilldown",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:`${t.netProfit>=0?"text-blue-100":"text-red-100"} text-sm flex items-center gap-1`,children:["صافي الربح",e.jsx(ee,{className:"w-3 h-3"})]}),e.jsx("p",{className:"text-3xl font-bold mt-1","data-testid":"text-net-profit",children:t.netProfit.toFixed(2)}),e.jsx("p",{className:`${t.netProfit>=0?"text-blue-200":"text-red-200"} text-xs mt-1`,children:"ريال سعودي - انقر للتفاصيل"})]}),e.jsx(Se,{className:`w-12 h-12 ${t.netProfit>=0?"text-blue-200":"text-red-200"}`})]})})})]}),e.jsxs(c,{children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-green-600"}),"تحليل الأرباح التفصيلي"]}),e.jsx(q,{children:"تفاصيل حسابات الأرباح وهوامش الربح"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg text-center",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"إجمالي الربح"}),e.jsx("p",{className:"text-2xl font-bold text-green-600","data-testid":"text-gross-profit",children:t.grossProfit.toFixed(2)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ر.س"})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"هامش الربح الإجمالي"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[t.totalRevenue>0?(t.grossProfit/t.totalRevenue*100).toFixed(1):"0","%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"من الإيرادات"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-center",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"صافي الربح"}),e.jsx("p",{className:`text-2xl font-bold ${t.netProfit>=0?"text-purple-600":"text-red-600"}`,children:t.netProfit.toFixed(2)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ر.س"})]}),e.jsxs("div",{className:"p-4 bg-background dark:bg-primary/20 rounded-lg text-center",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"هامش صافي الربح"}),e.jsxs("p",{className:`text-2xl font-bold ${t.profitMargin>=0?"text-accent":"text-red-600"}`,children:[t.profitMargin.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"من الإيرادات"})]})]}),e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"إجمالي الإيرادات"}),e.jsxs("span",{className:"font-medium text-green-600",children:["+",t.totalRevenue.toFixed(2)," ر.س"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ضريبة القيمة المضافة"}),e.jsxs("span",{className:"font-medium text-accent",children:["-",t.totalVat.toFixed(2)," ر.س"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"تكلفة المكونات (COGS)"}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",t.totalCogs.toFixed(2)," ر.س"]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"font-medium",children:"= إجمالي الربح"}),e.jsxs("span",{className:"font-bold text-green-600",children:[t.grossProfit.toFixed(2)," ر.س"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"المصروفات التشغيلية"}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",t.totalExpenses.toFixed(2)," ر.س"]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 border-primary",children:[e.jsx("span",{className:"font-bold",children:"= صافي الربح"}),e.jsxs("span",{className:`font-bold text-lg ${t.netProfit>=0?"text-green-600":"text-red-600"}`,children:[t.netProfit.toFixed(2)," ر.س"]})]})]})})]})]}),e.jsxs(c,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-accent"}),"صافي الربح اليومي (آخر 7 أيام)"]})}),e.jsx(x,{children:t.dailyTrend&&t.dailyTrend.length>0?e.jsx("div",{className:"h-[300px]",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(Ae,{data:t.dailyTrend,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"date",tickFormatter:s=>{const a=new Date(s);return`${a.getDate()}/${a.getMonth()+1}`}}),e.jsx(O,{}),e.jsx(T,{formatter:s=>[`${s.toFixed(2)} ر.س`],labelFormatter:s=>{const a=new Date(s);return w(a,"EEEE dd/MM/yyyy",{locale:_})}}),e.jsx(oe,{}),e.jsx(he,{type:"monotone",dataKey:"revenue",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.6,name:"الإيرادات"}),e.jsx(he,{type:"monotone",dataKey:"netProfit",stackId:"2",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6,name:"صافي الربح"})]})})}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد بيانات كافية لعرض الرسم البياني"})})]}),e.jsxs(c,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-5 h-5 text-purple-600"}),"صافي الربح الأسبوعي (آخر 4 أسابيع)"]})}),e.jsx(x,{children:t.weeklyTrend&&t.weeklyTrend.length>0?e.jsx("div",{className:"h-[300px]",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(se,{data:t.weeklyTrend,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"week"}),e.jsx(O,{}),e.jsx(T,{formatter:s=>[`${s.toFixed(2)} ر.س`]}),e.jsx(oe,{}),e.jsx(D,{dataKey:"revenue",fill:"#10b981",name:"الإيرادات"}),e.jsx(D,{dataKey:"cogs",fill:"#f97316",name:"تكلفة المكونات"}),e.jsx(D,{dataKey:"expenses",fill:"#ef4444",name:"المصروفات"}),e.jsx(D,{dataKey:"netProfit",fill:"#3b82f6",name:"صافي الربح"})]})})}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد بيانات كافية لعرض الرسم البياني"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-green-600"}),"الإيرادات حسب طريقة الدفع"]})}),e.jsx(x,{children:M.length>0?e.jsx("div",{className:"h-[250px]",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(Le,{children:[e.jsx(Ke,{data:M,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,fill:"#8884d8",paddingAngle:5,dataKey:"value",label:({name:s,percent:a})=>`${s} (${(a*100).toFixed(0)}%)`,children:M.map((s,a)=>e.jsx(Re,{fill:te[a%te.length]},`cell-${a}`))}),e.jsx(T,{formatter:s=>[`${s.toFixed(2)} ر.س`]})]})})}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد بيانات"})})]}),e.jsxs(c,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-red-600"}),"المصروفات حسب الفئة"]})}),e.jsx(x,{children:I.length>0?e.jsx("div",{className:"h-[250px]",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(se,{data:I,layout:"vertical",children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(K,{type:"number"}),e.jsx(O,{type:"category",dataKey:"name",width:120}),e.jsx(T,{formatter:s=>[`${s.toFixed(2)} ر.س`]}),e.jsx(D,{dataKey:"value",fill:"#ef4444"})]})})}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد مصروفات"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary dark:bg-primary/30 rounded-full",children:e.jsx(ke,{className:"w-6 h-6 text-accent"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"عدد الطلبات"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-order-count",children:t.orderCount})]})]})})}),e.jsx(c,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-full",children:e.jsx(Oe,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"عدد الفواتير"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-invoice-count",children:t.invoiceCount})]})]})})}),e.jsx(c,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-full",children:e.jsx(_e,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"متوسط قيمة الطلب"}),e.jsx("p",{className:"text-2xl font-bold",children:t.orderCount>0?(t.totalRevenue/t.orderCount).toFixed(2):"0"})]})]})})}),e.jsx(c,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-full",children:e.jsx(ce,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"ضريبة القيمة المضافة"}),e.jsx("p",{className:"text-2xl font-bold",children:t.totalVat.toFixed(2)})]})]})})})]}),t.topSellingItems&&t.topSellingItems.length>0&&e.jsxs(c,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-accent"}),"المنتجات الأكثر مبيعاً"]})}),e.jsx(x,{children:e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"المنتج"}),e.jsx(n,{className:"text-right",children:"الكمية المباعة"}),e.jsx(n,{className:"text-right",children:"الإيرادات"})]})}),e.jsx(v,{children:t.topSellingItems.map((s,a)=>e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",children:a+1}),s.name]})}),e.jsx(r,{children:s.quantity}),e.jsxs(r,{className:"font-bold text-green-600",children:[s.revenue.toFixed(2)," ر.س"]})]},s.id))})]})})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"لا توجد بيانات متاحة"})})}),e.jsx(U,{value:"expenses",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"سجل المصروفات"}),e.jsx(q,{children:"جميع المصروفات المسجلة في النظام"})]}),e.jsx(x,{children:ge?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-accent"})}):e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"التاريخ"}),e.jsx(n,{className:"text-right",children:"الفئة"}),e.jsx(n,{className:"text-right",children:"الوصف"}),e.jsx(n,{className:"text-right",children:"المبلغ"}),e.jsx(n,{className:"text-right",children:"الضريبة"}),e.jsx(n,{className:"text-right",children:"الإجمالي"}),e.jsx(n,{className:"text-right",children:"الحالة"}),e.jsx(n,{className:"text-right",children:"إجراءات"})]})}),e.jsxs(v,{children:[C?.expenses?.map(s=>e.jsxs(d,{children:[e.jsx(r,{children:w(new Date(s.date),"yyyy/MM/dd",{locale:_})}),e.jsx(r,{children:B.find(a=>a.value===s.category)?.label||s.category}),e.jsx(r,{children:s.description}),e.jsx(r,{children:s.amount.toFixed(2)}),e.jsx(r,{children:s.vatAmount.toFixed(2)}),e.jsx(r,{className:"font-bold",children:s.totalAmount.toFixed(2)}),e.jsx(r,{children:e.jsx(S,{variant:V[s.status]?.variant||"secondary",children:V[s.status]?.label||s.status})}),e.jsx(r,{children:s.status==="pending"&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>ye.mutate(s.id),disabled:ye.isPending,"data-testid":`button-approve-expense-${s.id}`,children:e.jsx(ms,{className:"w-4 h-4"})})})]},s.id)),(!C?.expenses||C.expenses.length===0)&&e.jsx(d,{children:e.jsx(r,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"لا توجد مصروفات مسجلة"})})]})]})})]})}),e.jsx(U,{value:"revenues",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"سجل الإيرادات"}),e.jsx(q,{children:"جميع الإيرادات المسجلة في النظام"})]}),e.jsx(x,{children:Ye?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-accent"})}):e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"التاريخ"}),e.jsx(n,{className:"text-right",children:"الفرع"}),e.jsx(n,{className:"text-right",children:"الفئة"}),e.jsx(n,{className:"text-right",children:"الوصف"}),e.jsx(n,{className:"text-right",children:"المبلغ"}),e.jsx(n,{className:"text-right",children:"الضريبة"}),e.jsx(n,{className:"text-right",children:"الإجمالي"}),e.jsx(n,{className:"text-right",children:"طريقة الدفع"})]})}),e.jsxs(v,{children:[re?.revenues?.map(s=>e.jsxs(d,{children:[e.jsx(r,{children:w(new Date(s.date),"yyyy/MM/dd",{locale:_})}),e.jsx(r,{children:es(s.branchId)}),e.jsx(r,{children:s.category}),e.jsx(r,{children:s.description}),e.jsx(r,{children:s.amount.toFixed(2)}),e.jsx(r,{children:s.vatAmount.toFixed(2)}),e.jsx(r,{className:"font-bold text-green-600",children:s.totalAmount.toFixed(2)}),e.jsx(r,{children:qe[s.paymentMethod]||s.paymentMethod})]},s.id)),(!re?.revenues||re.revenues.length===0)&&e.jsx(d,{children:e.jsx(r,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"لا توجد إيرادات مسجلة"})})]})]})})]})}),e.jsx(U,{value:"reports",className:"space-y-6",children:pe?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-accent"})}):t?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"bg-gradient-to-l from-amber-50 to-background dark:from-amber-900/20 dark:to-orange-900/20 border-primary dark:border-primary",children:e.jsx(j,{children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(u,{className:"flex items-center gap-2 text-accent dark:text-accent",children:[e.jsx(vs,{className:"w-6 h-6"}),"مركز التقارير المالية"]}),e.jsxs(q,{className:"mt-1",children:["تقارير شاملة للفترة: ",e.jsx(S,{variant:"outline",children:Be[p]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:as,className:"border-green-500 text-green-700 hover:bg-green-50",children:[e.jsx(Ie,{className:"w-4 h-4 ml-2"}),"تصدير Excel"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:ns,className:"border-red-500 text-red-700 hover:bg-red-50",children:[e.jsx(js,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>window.print(),className:"border-blue-500 text-blue-700 hover:bg-blue-50",children:[e.jsx(ws,{className:"w-4 h-4 ml-2"}),"طباعة"]})]})]})})}),e.jsxs(c,{children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-5 h-5 text-blue-600"}),"ملخص الأداء المالي"]}),e.jsx(q,{children:"تقرير شامل للوضع المالي للفترة المحددة"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-900/20 rounded-xl border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(de,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-400 font-medium",children:"الإيرادات"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-800 dark:text-green-300",children:t.totalRevenue.toFixed(2)}),e.jsx("p",{className:"text-xs text-green-600",children:"ر.س"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/30 dark:to-orange-900/20 rounded-xl border border-accent dark:border-accent",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($e,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"text-sm text-accent dark:text-accent font-medium",children:"تكلفة المكونات"})]}),e.jsx("p",{className:"text-2xl font-bold text-accent dark:text-accent",children:t.totalCogs.toFixed(2)}),e.jsx("p",{className:"text-xs text-accent",children:"ر.س"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-900/20 rounded-xl border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-400 font-medium",children:"المصروفات"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-800 dark:text-red-300",children:t.totalExpenses.toFixed(2)}),e.jsx("p",{className:"text-xs text-red-600",children:"ر.س"})]}),e.jsxs("div",{className:`p-4 rounded-xl border ${t.netProfit>=0?"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-900/20 border-blue-200 dark:border-blue-800":"bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-900/20 border-red-200 dark:border-red-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:`w-5 h-5 ${t.netProfit>=0?"text-blue-600":"text-red-600"}`}),e.jsx("span",{className:`text-sm font-medium ${t.netProfit>=0?"text-blue-700 dark:text-blue-400":"text-red-700 dark:text-red-400"}`,children:"صافي الربح"})]}),e.jsx("p",{className:`text-2xl font-bold ${t.netProfit>=0?"text-blue-800 dark:text-blue-300":"text-red-800 dark:text-red-300"}`,children:t.netProfit.toFixed(2)}),e.jsx("p",{className:`text-xs ${t.netProfit>=0?"text-blue-600":"text-red-600"}`,children:"ر.س"})]})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"تفصيل العمليات المالية"]}),e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"البند"}),e.jsx(n,{className:"text-right",children:"القيمة"}),e.jsx(n,{className:"text-right",children:"النسبة من الإيرادات"})]})}),e.jsxs(v,{children:[e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:"إجمالي الإيرادات"}),e.jsxs(r,{className:"text-green-600 font-bold",children:[t.totalRevenue.toFixed(2)," ر.س"]}),e.jsx(r,{children:"100%"})]}),e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:"ضريبة القيمة المضافة (المحصلة)"}),e.jsxs(r,{className:"text-accent",children:[t.totalVat.toFixed(2)," ر.س"]}),e.jsxs(r,{children:[t.totalRevenue>0?(t.totalVat/t.totalRevenue*100).toFixed(1):0,"%"]})]}),e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:"تكلفة المكونات (COGS)"}),e.jsxs(r,{className:"text-accent",children:[t.totalCogs.toFixed(2)," ر.س"]}),e.jsxs(r,{children:[t.totalRevenue>0?(t.totalCogs/t.totalRevenue*100).toFixed(1):0,"%"]})]}),e.jsxs(d,{className:"bg-green-50/50 dark:bg-green-900/20",children:[e.jsx(r,{className:"font-bold",children:"= إجمالي الربح"}),e.jsxs(r,{className:"text-green-700 font-bold",children:[t.grossProfit.toFixed(2)," ر.س"]}),e.jsxs(r,{className:"font-medium",children:[t.totalRevenue>0?(t.grossProfit/t.totalRevenue*100).toFixed(1):0,"%"]})]}),e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:"المصروفات التشغيلية"}),e.jsxs(r,{className:"text-red-600",children:[t.totalExpenses.toFixed(2)," ر.س"]}),e.jsxs(r,{children:[t.totalRevenue>0?(t.totalExpenses/t.totalRevenue*100).toFixed(1):0,"%"]})]}),e.jsxs(d,{className:`${t.netProfit>=0?"bg-blue-50/50 dark:bg-blue-900/20":"bg-red-50/50 dark:bg-red-900/20"}`,children:[e.jsx(r,{className:"font-bold text-lg",children:"= صافي الربح"}),e.jsxs(r,{className:`font-bold text-lg ${t.netProfit>=0?"text-blue-700":"text-red-700"}`,children:[t.netProfit.toFixed(2)," ر.س"]}),e.jsxs(r,{className:"font-bold",children:[t.profitMargin.toFixed(1),"%"]})]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"w-5 h-5 text-green-600"}),"تطور الإيرادات اليومية"]})}),e.jsx(x,{children:t.dailyTrend&&t.dailyTrend.length>0?e.jsx("div",{className:"h-[300px]",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(Ae,{data:t.dailyTrend,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"date",tickFormatter:s=>{const a=new Date(s);return`${a.getDate()}/${a.getMonth()+1}`}}),e.jsx(O,{}),e.jsx(T,{formatter:s=>[`${s.toFixed(2)} ر.س`],labelFormatter:s=>{const a=new Date(s);return w(a,"EEEE dd/MM/yyyy",{locale:_})}}),e.jsx(he,{type:"monotone",dataKey:"revenue",stroke:"#10b981",fill:"#10b981",fillOpacity:.3,name:"الإيرادات"})]})})}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد بيانات"})})]}),e.jsxs(c,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-purple-600"}),"مقارنة الأرباح والمصروفات"]})}),e.jsx(x,{children:t.weeklyTrend&&t.weeklyTrend.length>0?e.jsx("div",{className:"h-[300px]",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(se,{data:t.weeklyTrend,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"week"}),e.jsx(O,{}),e.jsx(T,{formatter:s=>[`${s.toFixed(2)} ر.س`]}),e.jsx(oe,{}),e.jsx(D,{dataKey:"netProfit",fill:"#10b981",name:"صافي الربح"}),e.jsx(D,{dataKey:"expenses",fill:"#ef4444",name:"المصروفات"})]})})}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد بيانات"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(j,{className:"flex flex-row items-center justify-between",children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-green-600"}),"تحليل طرق الدفع"]})}),e.jsx(x,{children:M.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-[200px] mb-4",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(Le,{children:[e.jsx(Ke,{data:M,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,fill:"#8884d8",paddingAngle:5,dataKey:"value",label:({name:s,percent:a})=>`${s} (${(a*100).toFixed(0)}%)`,children:M.map((s,a)=>e.jsx(Re,{fill:te[a%te.length]},`cell-${a}`))}),e.jsx(T,{formatter:s=>[`${s.toFixed(2)} ر.س`]})]})})}),e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"طريقة الدفع"}),e.jsx(n,{className:"text-right",children:"المبلغ"}),e.jsx(n,{className:"text-right",children:"النسبة"})]})}),e.jsx(v,{children:M.map((s,a)=>e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:s.name}),e.jsxs(r,{children:[s.value.toFixed(2)," ر.س"]}),e.jsxs(r,{children:[t.totalRevenue>0?(s.value/t.totalRevenue*100).toFixed(1):0,"%"]})]},a))})]})]}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد بيانات"})})]}),e.jsxs(c,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-red-600"}),"تحليل فئات المصروفات"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:rs,children:[e.jsx(Ie,{className:"w-4 h-4 ml-1"}),"تصدير"]})]}),e.jsx(x,{children:I.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-[200px] mb-4",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(se,{data:I,layout:"vertical",children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(K,{type:"number"}),e.jsx(O,{type:"category",dataKey:"name",width:100}),e.jsx(T,{formatter:s=>[`${s.toFixed(2)} ر.س`]}),e.jsx(D,{dataKey:"value",fill:"#ef4444"})]})})}),e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"الفئة"}),e.jsx(n,{className:"text-right",children:"المبلغ"}),e.jsx(n,{className:"text-right",children:"النسبة"})]})}),e.jsx(v,{children:I.map((s,a)=>e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:s.name}),e.jsxs(r,{className:"text-red-600",children:[s.value.toFixed(2)," ر.س"]}),e.jsxs(r,{children:[t.totalExpenses>0?(s.value/t.totalExpenses*100).toFixed(1):0,"%"]})]},a))})]})]}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد مصروفات"})})]})]}),e.jsxs(c,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-accent"}),"مؤشرات الأداء الرئيسية (KPIs)"]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx(ke,{className:"w-8 h-8 mx-auto mb-2 text-accent"}),e.jsx("p",{className:"text-2xl font-bold",children:t.orderCount}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"عدد الطلبات"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx(Oe,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),e.jsx("p",{className:"text-2xl font-bold",children:t.invoiceCount}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"عدد الفواتير"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx(ce,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),e.jsx("p",{className:"text-2xl font-bold",children:t.orderCount>0?(t.totalRevenue/t.orderCount).toFixed(2):"0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"متوسط قيمة الطلب"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx(_e,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),e.jsxs("p",{className:`text-2xl font-bold ${t.profitMargin>=0?"text-green-600":"text-red-600"}`,children:[t.profitMargin.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هامش الربح الصافي"})]})]})})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"لا توجد بيانات متاحة"})})})]}),e.jsx(Fe,{open:ae,onOpenChange:Ne,children:e.jsxs(Ce,{className:"max-w-4xl max-h-[80vh]",children:[e.jsxs(Pe,{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:Ne,children:e.jsx(us,{className:"w-4 h-4"})}),m==="revenue"&&"تفاصيل الإيرادات",m==="cogs"&&"تفاصيل تكلفة المكونات (COGS)",m==="expenses"&&"تفاصيل المصروفات",m==="orders"&&"تفاصيل الطلبات والأرباح"]}),e.jsxs(ps,{children:[m==="revenue"&&"جميع الطلبات المساهمة في الإيرادات",m==="cogs"&&"تكلفة المكونات المستخدمة في الطلبات",m==="expenses"&&"جميع المصروفات التشغيلية",m==="orders"&&"تفصيل الطلبات مع هوامش الربح"]})]}),e.jsxs(Ns,{className:"h-[60vh]",children:[(m==="revenue"||m==="orders")&&(fe?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-accent"})}):e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"رقم الطلب"}),e.jsx(n,{className:"text-right",children:"العميل"}),e.jsx(n,{className:"text-right",children:"الإجمالي"}),e.jsx(n,{className:"text-right",children:"التكلفة"}),e.jsx(n,{className:"text-right",children:"الربح"}),e.jsx(n,{className:"text-right",children:"الحالة"}),e.jsx(n,{className:"text-right",children:"التاريخ"})]})}),e.jsxs(v,{children:[G?.orders?.filter(s=>s.status!=="cancelled").map(s=>{const a=s.totalAmount-(s.costOfGoods||0);return e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:s.orderNumber}),e.jsx(r,{children:s.customerName||"عميل"}),e.jsxs(r,{className:"text-green-600 font-medium",children:[s.totalAmount?.toFixed(2)," ر.س"]}),e.jsxs(r,{className:"text-accent",children:[(s.costOfGoods||0).toFixed(2)," ر.س"]}),e.jsxs(r,{className:a>=0?"text-blue-600 font-medium":"text-red-600",children:[a.toFixed(2)," ر.س"]}),e.jsx(r,{children:e.jsx(S,{variant:s.status==="completed"?"default":"secondary",children:s.status==="completed"?"مكتمل":s.status==="pending"?"قيد الانتظار":s.status})}),e.jsx(r,{children:w(new Date(s.createdAt),"yyyy/MM/dd HH:mm",{locale:_})})]},s.id)}),(!G?.orders||G.orders.length===0)&&e.jsx(d,{children:e.jsx(r,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"لا توجد طلبات"})})]})]})),m==="cogs"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"تكلفة المكونات حسب الطلب"}),fe?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(k,{className:"w-6 h-6 animate-spin text-accent"})}):e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"رقم الطلب"}),e.jsx(n,{className:"text-right",children:"الإجمالي"}),e.jsx(n,{className:"text-right",children:"تكلفة المكونات"}),e.jsx(n,{className:"text-right",children:"هامش الربح"})]})}),e.jsx(v,{children:G?.orders?.filter(s=>s.costOfGoods&&s.costOfGoods>0).map(s=>{const a=s.totalAmount>0?(s.totalAmount-(s.costOfGoods||0))/s.totalAmount*100:0;return e.jsxs(d,{children:[e.jsx(r,{className:"font-medium",children:s.orderNumber}),e.jsxs(r,{children:[s.totalAmount?.toFixed(2)," ر.س"]}),e.jsxs(r,{className:"text-accent font-medium",children:[s.costOfGoods?.toFixed(2)," ر.س"]}),e.jsxs(r,{className:a>=50?"text-green-600":a>=30?"text-accent":"text-red-600",children:[a.toFixed(1),"%"]})]},s.id)})})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"حركات المخزون"}),Je?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(k,{className:"w-6 h-6 animate-spin text-accent"})}):e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"المادة"}),e.jsx(n,{className:"text-right",children:"النوع"}),e.jsx(n,{className:"text-right",children:"الكمية"}),e.jsx(n,{className:"text-right",children:"الرصيد السابق"}),e.jsx(n,{className:"text-right",children:"الرصيد الجديد"}),e.jsx(n,{className:"text-right",children:"ملاحظات"})]})}),e.jsx(v,{children:Ze?.movements?.slice(0,20).map(s=>e.jsxs(d,{children:[e.jsx(r,{children:s.rawItemName||"مادة"}),e.jsx(r,{children:e.jsx(S,{variant:s.movementType==="sale"?"destructive":s.movementType==="purchase"?"default":"secondary",children:s.movementType==="sale"?"بيع":s.movementType==="purchase"?"شراء":s.movementType})}),e.jsx(r,{className:s.quantity<0?"text-red-600":"text-green-600",children:s.quantity.toFixed(3)}),e.jsx(r,{children:s.previousQuantity.toFixed(3)}),e.jsx(r,{children:s.newQuantity.toFixed(3)}),e.jsx(r,{className:"text-muted-foreground text-sm max-w-[200px] truncate",children:s.notes})]},s.id))})]})]})]}),m==="expenses"&&(ge?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-accent"})}):e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(d,{children:[e.jsx(n,{className:"text-right",children:"التاريخ"}),e.jsx(n,{className:"text-right",children:"الفئة"}),e.jsx(n,{className:"text-right",children:"الوصف"}),e.jsx(n,{className:"text-right",children:"المبلغ"}),e.jsx(n,{className:"text-right",children:"الضريبة"}),e.jsx(n,{className:"text-right",children:"الإجمالي"}),e.jsx(n,{className:"text-right",children:"الحالة"})]})}),e.jsxs(v,{children:[C?.expenses?.map(s=>e.jsxs(d,{children:[e.jsx(r,{children:w(new Date(s.date),"yyyy/MM/dd",{locale:_})}),e.jsx(r,{children:B.find(a=>a.value===s.category)?.label||s.category}),e.jsx(r,{children:s.description}),e.jsxs(r,{children:[s.amount.toFixed(2)," ر.س"]}),e.jsxs(r,{children:[s.vatAmount.toFixed(2)," ر.س"]}),e.jsxs(r,{className:"font-bold text-red-600",children:[s.totalAmount.toFixed(2)," ر.س"]}),e.jsx(r,{children:e.jsx(S,{variant:V[s.status]?.variant||"secondary",children:V[s.status]?.label||s.status})})]},s.id)),(!C?.expenses||C.expenses.length===0)&&e.jsx(d,{children:e.jsx(r,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"لا توجد مصروفات"})})]})]}))]})]})}),e.jsx(Fe,{open:We,onOpenChange:z,children:e.jsxs(Ce,{className:"max-w-md",children:[e.jsx(Pe,{children:e.jsx(Te,{children:"إضافة مصروف جديد"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"الفئة"}),e.jsxs(Y,{value:h.category,onValueChange:s=>E(a=>({...a,category:s})),children:[e.jsx(Z,{"data-testid":"select-expense-category",children:e.jsx(J,{placeholder:"اختر الفئة"})}),e.jsx(X,{children:B.map(s=>e.jsx(f,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"الوصف"}),e.jsx(ie,{value:h.description,onChange:s=>E(a=>({...a,description:s.target.value})),placeholder:"وصف المصروف","data-testid":"input-expense-description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"المبلغ"}),e.jsx(ie,{type:"number",value:h.amount,onChange:s=>E(a=>({...a,amount:s.target.value})),placeholder:"0.00","data-testid":"input-expense-amount"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"الضريبة"}),e.jsx(ie,{type:"number",value:h.vatAmount,onChange:s=>E(a=>({...a,vatAmount:s.target.value})),placeholder:"0.00","data-testid":"input-expense-vat"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"طريقة الدفع"}),e.jsxs(Y,{value:h.paymentMethod,onValueChange:s=>E(a=>({...a,paymentMethod:s})),children:[e.jsx(Z,{"data-testid":"select-expense-payment",children:e.jsx(J,{})}),e.jsxs(X,{children:[e.jsx(f,{value:"cash",children:"نقدي"}),e.jsx(f,{value:"bank_transfer",children:"تحويل بنكي"}),e.jsx(f,{value:"credit_card",children:"بطاقة ائتمان"}),e.jsx(f,{value:"check",children:"شيك"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"ملاحظات"}),e.jsx(gs,{value:h.notes,onChange:s=>E(a=>({...a,notes:s.target.value})),placeholder:"ملاحظات إضافية (اختياري)","data-testid":"input-expense-notes"})]})]}),e.jsxs(fs,{children:[e.jsx(N,{variant:"outline",onClick:()=>z(!1),children:"إلغاء"}),e.jsx(N,{onClick:Xe,disabled:!h.category||!h.description||!h.amount||ne.isPending,className:"bg-primary hover:bg-primary","data-testid":"button-submit-expense",children:ne.isPending?e.jsx(k,{className:"w-4 h-4 animate-spin"}):"إضافة"})]})]})})]})})}export{et as default};
