import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as I}from"./vendor-react-Bzsngnqy.js";import{a as j}from"./vendor-query-CX8ZYlKb.js";import{C as f}from"./CustomerLayout-CdXUKo9S.js";import{t as C,c as v,s as k,e as $,S as d,B as o,A as q,C as l,f as m,G as x,r as A,j as O,x as S,y as L,w as T,i as U,a5 as B}from"./index-61RjstaY.js";import{P as M}from"./percent-gcOuF4JK.js";import{T as P}from"./trending-up-CK4Nk2TF.js";import"./customer-footer-DgAPx-ud.js";import"./clipboard-list-BeoGODTJ.js";import"./vendor-utils-BKCsaWdX.js";function V(){const{customer:a}=C(),[,r]=v(),{card:u}=k(),{toast:g}=$(),y=t=>{T.setActiveOffer({id:t.id,title:t.title,description:t.description,discount:t.discount,type:t.type,coffeeItemId:t.coffeeItemId,expiresAt:new Date(Date.now()+24*60*60*1e3).toISOString()}),g({title:"تم تفعيل العرض!",description:`${t.title} - سيتم تطبيقه عند الدفع`}),r("/menu")},{data:i=[]}=j({queryKey:["/api/coffee-items"]}),{data:p=[]}=j({queryKey:["/api/orders/customer",a?.phone],enabled:!!a?.phone}),h=I.useMemo(()=>{const t=[],s=u?.points||0,n=p.length;if(s>=100&&t.push({id:"points-discount",title:"خصم نقاطك!",description:`لديك ${s} نقطة يمكنك استخدامها للحصول على خصم ${(s/20).toFixed(0)} ريال`,discount:Math.floor(s/20),type:"loyalty"}),n===0&&t.push({id:"first-order",title:"عرض الترحيب!",description:"احصل على خصم 15% على طلبك الأول كعميل جديد",discount:15,type:"new",expiresIn:"7 أيام"}),n>0&&n<5&&t.push({id:"comeback",title:"اشتقنا لك!",description:"احصل على خصم 10% على طلبك القادم",discount:10,type:"comeback",expiresIn:"3 أيام"}),n>=5&&t.push({id:"frequent",title:"عميل مميز!",description:"كمكافأة لولائك، احصل على خصم 20% على أي مشروب",discount:20,type:"frequent"}),i.length>0){const w=(a?.phone?.length||0)%i.length,c=i[w];c&&t.push({id:"special-drink",title:"عرض خاص على مشروبك المفضل",description:`خصم 25% على ${c.nameAr}`,discount:25,type:"frequent",coffeeItemId:c.id,coffeeItem:c,expiresIn:"اليوم فقط"})}return s>=50&&s<100&&t.push({id:"almost-there",title:"اقتربت من المكافأة!",description:`تحتاج ${100-s} نقطة إضافية للحصول على خصم 5 ريال`,discount:0,type:"loyalty"}),t},[u?.points,p.length,i,a?.phone]),N=t=>{switch(t){case"loyalty":return e.jsx(B,{className:"w-5 h-5"});case"comeback":return e.jsx(U,{className:"w-5 h-5"});case"birthday":return e.jsx(x,{className:"w-5 h-5"});case"frequent":return e.jsx(P,{className:"w-5 h-5"});case"new":return e.jsx(d,{className:"w-5 h-5"});default:return e.jsx(M,{className:"w-5 h-5"})}},b=t=>{switch(t){case"loyalty":return"from-amber-500 to-orange-500";case"comeback":return"from-blue-500 to-cyan-500";case"birthday":return"from-pink-500 to-rose-500";case"frequent":return"from-green-500 to-emerald-500";case"new":return"from-purple-500 to-violet-500";default:return"from-primary to-accent"}};return a?e.jsx(f,{children:e.jsxs("div",{className:"container max-w-lg mx-auto p-4 pb-24",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>r("/menu"),"data-testid":"button-back",children:e.jsx(q,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(d,{className:"w-6 h-6 text-primary"}),"عروضك الخاصة"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"عروض مخصصة لك بناءً على تفضيلاتك"})]})]}),h.length===0?e.jsx(l,{className:"text-center p-8",children:e.jsxs(m,{children:[e.jsx(x,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-foreground",children:"لا توجد عروض حالياً"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"استمر في الطلب لفتح عروض خاصة بك"}),e.jsx(o,{onClick:()=>r("/menu"),className:"mt-4","data-testid":"button-explore-menu",children:"استكشف القائمة"})]})}):e.jsx("div",{className:"space-y-4",children:h.map(t=>e.jsxs(l,{className:"overflow-hidden border-0 shadow-lg","data-testid":`offer-card-${t.id}`,children:[e.jsx("div",{className:`bg-gradient-to-r ${b(t.type)} p-4`,children:e.jsxs("div",{className:"flex items-center gap-3 text-white",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:N(t.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:t.title}),t.expiresIn&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/80 mt-1",children:[e.jsx(A,{className:"w-3 h-3"}),e.jsxs("span",{children:["ينتهي خلال ",t.expiresIn]})]})]}),t.discount>0&&e.jsx(O,{className:"bg-white text-foreground font-bold text-lg px-3 py-1",children:t.type==="loyalty"?`${t.discount} ر.س`:`${t.discount}%`})]})}),e.jsxs(m,{className:"p-4",children:[e.jsx("p",{className:"text-foreground",children:t.description}),t.coffeeItem&&e.jsxs("div",{className:"mt-3 flex items-center gap-3 bg-muted/50 rounded-lg p-3",children:[t.coffeeItem.imageUrl&&e.jsx("img",{src:t.coffeeItem.imageUrl,alt:t.coffeeItem.nameAr,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:t.coffeeItem.nameAr}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"line-through",children:[t.coffeeItem.price," ر.س"]}),e.jsxs("span",{className:"text-primary font-bold mr-2",children:[(t.coffeeItem.price*(1-t.discount/100)).toFixed(2)," ر.س"]})]})]})]}),e.jsx(o,{className:"w-full mt-4",onClick:()=>y(t),disabled:t.discount===0,"data-testid":`button-use-offer-${t.id}`,children:t.discount>0?"استخدم العرض":"استمر في جمع النقاط"})]})]},t.id))}),e.jsxs(l,{className:"mt-6 bg-gradient-to-r from-primary/10 to-accent/10 border-primary/20",children:[e.jsx(S,{children:e.jsxs(L,{className:"text-sm flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-primary"}),"كيف تحصل على المزيد من العروض؟"]})}),e.jsxs(m,{className:"text-sm text-muted-foreground space-y-2",children:[e.jsx("p",{children:"• اطلب بانتظام لفتح عروض العملاء المميزين"}),e.jsx("p",{children:"• اجمع النقاط واستبدلها بخصومات"}),e.jsx("p",{children:"• ادعُ أصدقاءك واحصل على 50 نقطة لكل صديق"})]})]})]})}):e.jsx(f,{children:e.jsxs("div",{className:"container max-w-lg mx-auto p-4 flex flex-col items-center justify-center min-h-[50vh] space-y-4",children:[e.jsx(d,{className:"w-12 h-12 text-primary"}),e.jsx("p",{className:"font-ibm-arabic text-muted-foreground text-center",children:"سجل دخولك لاكتشاف عروضك الخاصة"}),e.jsx(o,{onClick:()=>r("/auth"),"data-testid":"button-login",children:"تسجيل الدخول"})]})})}export{V as default};
