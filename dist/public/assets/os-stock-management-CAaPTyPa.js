import{j as e}from"./vendor-ui-DJm-zmnP.js";import{a as o,b as A}from"./vendor-query-CX8ZYlKb.js";import{r as x}from"./vendor-react-Bzsngnqy.js";import{e as B,C as m,x as h,y as u,V as b,f as j,L as g,I as E,B as H,q as f,P as O,T as R,v as D,N as w}from"./index-CLvpp2UE.js";import{S as T,a as C,b as S,c as I,d as n}from"./select-BzAjeBJu.js";import{T as F,a as W,b as q,c as t,d as z,e as a}from"./table-DVDQb40v.js";import{T as G}from"./trending-down-By0t33Hr.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-CqdH-ack.js";function te(){const{toast:i}=B(),[p,M]=x.useState("in"),[l,v]=x.useState(""),[c,y]=x.useState(""),{data:Q=[],isLoading:k}=o({queryKey:["/api/ingredients"]}),{data:K=[]}=o({queryKey:["/api/inventory/movements"]}),{data:N=[]}=o({queryKey:["/api/inventory/alerts"]}),d=A({mutationFn:async s=>(await D("POST","/api/inventory/movements",s)).json(),onSuccess:()=>{i({title:"تم بنجاح",description:"تم تسجيل حركة المخزون"}),w.invalidateQueries({queryKey:["/api/inventory/movements"]}),w.invalidateQueries({queryKey:["/api/ingredients"]}),v(""),y("")},onError:s=>{i({title:"خطأ",description:s.message,variant:"destructive"})}}),L=()=>{if(!l||!c){i({title:"خطأ",description:"يرجى ملء جميع الحقول",variant:"destructive"});return}d.mutate({rawItemId:l,movementType:p,quantity:parseFloat(c)})},P=s=>{switch(s){case"in":return"text-green-600";case"out":return"text-red-600";case"waste":return"text-accent";case"adjustment":return"text-blue-600";default:return"text-muted-foreground"}},V=s=>({in:"إدخال",out:"إخراج",waste:"هدر",adjustment:"تعديل"})[s]||s;return e.jsxs("div",{className:"p-6 space-y-6 bg-background min-h-screen text-right",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"إدارة حركات المخزون"}),e.jsx(G,{className:"w-8 h-8 text-primary"})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"تسجيل حركة مخزون جديدة"}),e.jsx(b,{children:"أضف إدخال، إخراج، هدر، أو تعديل للمخزون"})]}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"نوع الحركة"}),e.jsxs(T,{value:p,onValueChange:s=>M(s),children:[e.jsx(C,{children:e.jsx(S,{})}),e.jsxs(I,{children:[e.jsx(n,{value:"in",children:"إدخال (In)"}),e.jsx(n,{value:"out",children:"إخراج (Out)"}),e.jsx(n,{value:"waste",children:"هدر (Waste)"}),e.jsx(n,{value:"adjustment",children:"تعديل (Adjustment)"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{children:"المادة الخام"}),e.jsxs(T,{value:l,onValueChange:v,children:[e.jsx(C,{children:e.jsx(S,{placeholder:"اختر"})}),e.jsx(I,{children:Q.map(s=>e.jsx(n,{value:s.id,children:s.nameAr},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(g,{children:"الكمية"}),e.jsx(E,{type:"number",placeholder:"0",value:c,onChange:s=>y(s.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(H,{onClick:L,disabled:d.isPending,className:"w-full",children:[d.isPending?e.jsx(f,{className:"animate-spin"}):e.jsx(O,{className:"ml-2 w-4 h-4"}),"تسجيل"]})})]})})]}),N.length>0&&e.jsxs(m,{className:"border-orange-200 bg-background dark:bg-accent/20",children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-accent"}),"تنبيهات المخزون المنخفض"]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-2",children:N.slice(0,5).map((s,r)=>e.jsxs("div",{className:"p-3 bg-white dark:bg-card rounded border border-orange-200",children:[e.jsx("p",{className:"font-medium",children:s.rawItemName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["المخزون الحالي: ",s.currentQuantity," - الحد الأدنى: ",s.thresholdQuantity]})]},r))})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"حركات المخزون الأخيرة"}),e.jsx(b,{children:"آخر 20 حركة في النظام"})]}),e.jsx(j,{children:k?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(f,{className:"animate-spin w-8 h-8"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(F,{children:[e.jsx(W,{children:e.jsxs(q,{children:[e.jsx(t,{className:"text-right",children:"المادة"}),e.jsx(t,{className:"text-right",children:"النوع"}),e.jsx(t,{className:"text-right",children:"الكمية"}),e.jsx(t,{className:"text-right",children:"السابق"}),e.jsx(t,{className:"text-right",children:"الحالي"}),e.jsx(t,{className:"text-right",children:"الملاحظات"})]})}),e.jsx(z,{children:K.slice(0,50).map((s,r)=>e.jsxs(q,{children:[e.jsx(a,{className:"font-medium",children:s.rawItemName||s.rawItemId}),e.jsx(a,{children:e.jsx("span",{className:P(s.movementType),children:V(s.movementType)})}),e.jsx(a,{children:s.quantity}),e.jsx(a,{children:s.previousQuantity}),e.jsx(a,{className:"font-semibold",children:s.newQuantity}),e.jsx(a,{className:"text-sm text-muted-foreground",children:s.notes})]},r))})]})})})]})]})}export{te as default};
