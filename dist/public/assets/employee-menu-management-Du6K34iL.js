import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as c}from"./vendor-react-Bzsngnqy.js";import{c as St,e as Ct,i as xe,D as ue,Z as kt,B as u,P as he,E as ge,F as pe,H as be,g as Le,L as m,I as p,a8 as Ge,a9 as Ve,j as R,a2 as je,T as Ft,A as _e,C as At,x as Pt,y as Et,f as qt,h as Ke,S as Dt,a0 as $t,aa as Me,v as N}from"./index-61RjstaY.js";import{u as Rt,a as T,b as P}from"./vendor-query-CX8ZYlKb.js";import{S as Tt}from"./switch-BuAF3IBh.js";import{S as O,a as U,b as z,c as L,d as l}from"./select-BgcBxbEj.js";import{A as Qe,a as Be,b as He,c as Je,d as We,e as Xe,f as Ze,g as Ye}from"./alert-dialog-DH0OhHaS.js";import{C as fe}from"./checkbox-BrbnGsFy.js";import{F as E}from"./flask-conical-xGACSBqW.js";import{C as Ot}from"./circle-check-big-v7jPXABl.js";import{C as et}from"./circle-x-D9GYVDcC.js";import{P as Ut}from"./pen-DpqiHEKk.js";import"./vendor-utils-BKCsaWdX.js";import"./chevron-down-BsuQiE4E.js";const zt=["food","bakery","desserts","cake","croissant","sandwiches"],Lt=["hot","cold","specialty","drinks","basic","additional_drinks"];function sa(){const[,G]=St(),[f,tt]=c.useState(null),y=(new URLSearchParams(window.location.search).get("type")==="food"?"food":"drinks")==="food",[at,Y]=c.useState(!1),[st,V]=c.useState(!1),[j,ee]=c.useState(null),[w,q]=c.useState([]),[I,D]=c.useState([]),[te,_]=c.useState(null),[ye,ve]=c.useState(null),[Ne,we]=c.useState(null),[K,M]=c.useState(!1),[Ie,Se]=c.useState(null),[Ce,ke]=c.useState(null),Q=c.useRef(null),B=c.useRef(null),{toast:x}=Ct(),v=Rt(),[ae,se]=c.useState([]),[d,h]=c.useState([]),[it,H]=c.useState(!1),[S,J]=c.useState(null),[ie,C]=c.useState(1),[re,W]=c.useState(new URLSearchParams(window.location.search).get("type")==="food"?"food":"hot"),[Fe,X]=c.useState("classic"),[$,Z]=c.useState([]),[rt,ne]=c.useState(!1),[r,k]=c.useState(null);c.useState({}),c.useState({}),c.useState({}),c.useState({}),c.useState({}),c.useEffect(()=>{const t=localStorage.getItem("currentEmployee");t?tt(JSON.parse(t)):G("/employee/gateway")},[G]);const{data:nt=[],isLoading:lt,refetch:le}=T({queryKey:["/api/coffee-items"],staleTime:0,gcTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0});T({queryKey:["/api/ingredients"]});const{data:F=[]}=T({queryKey:["/api/inventory/raw-items"],enabled:f?.role==="manager"}),{data:Ae=[]}=T({queryKey:["/api/inventory/all-recipes"],enabled:f?.role==="manager"}),{data:Pe=[]}=T({queryKey:["/api/branches"],enabled:f?.role==="manager"}),Ee=t=>{if(t.length===0)return{totalCost:0,breakdown:[]};const s=[];let a=0;for(const i of t){const n=F.find(o=>o.id===i.rawItemId);if(n){const o=i.unit.toLowerCase(),g=n.unit.toLowerCase();let b=i.quantity;g==="kg"&&o==="g"?b=i.quantity/1e3:g==="g"&&o==="kg"?b=i.quantity*1e3:(g==="liter"||g==="l")&&o==="ml"?b=i.quantity/1e3:g==="ml"&&(o==="liter"||o==="l")&&(b=i.quantity*1e3);const ze=b*n.unitCost;a+=ze,s.push({name:n.nameAr,quantity:i.quantity,unit:i.unit,unitCost:n.unitCost,cost:ze})}}return{totalCost:a,breakdown:s}},qe=t=>Ae.filter(s=>s.coffeeItemId===t).length,A=P({mutationFn:async t=>{const{itemData:s,ingredientsList:a,recipeList:i}=t,o=await(await N("POST","/api/coffee-items",s)).json(),g=o.id;if(g&&i&&i.length>0&&await N("POST","/api/inventory/recipes/bulk",{coffeeItemId:g,items:i.map(b=>({rawItemId:b.rawItemId,quantity:b.quantity,unit:b.unit})),clearExisting:!0}),g&&a.length>0)for(const b of a)await N("POST",`/api/coffee-items/${g}/ingredients`,{ingredientId:b.ingredientId,quantity:b.quantity,unit:b.unit});return o},onSuccess:async()=>{await Promise.all([v.invalidateQueries({queryKey:["/api/coffee-items"]}),v.invalidateQueries({queryKey:["/api/inventory/all-recipes"]}),le()]),Y(!1),se([]),h([]),Z([]),me(),C(1),k(null),W("hot"),X("classic"),x({title:"تم إضافة المشروب",description:"تم إضافة المشروب بنجاح إلى القائمة"})},onError:t=>{x({variant:"destructive",title:"فشل إضافة المشروب",description:t.message||"حدث خطأ أثناء إضافة المشروب"})}}),ce=P({mutationFn:async t=>await(await N("POST","/api/inventory/recipes/bulk",{coffeeItemId:t.coffeeItemId,items:t.items.map(a=>({rawItemId:a.rawItemId,quantity:a.quantity,unit:a.unit})),clearExisting:t.clearExisting??!0})).json(),onSuccess:()=>{v.invalidateQueries({queryKey:["/api/inventory/all-recipes"]}),H(!1),J(null),h([]),x({title:"تم حفظ الوصفة",description:"تم حفظ مكونات الوصفة بنجاح"})},onError:t=>{x({variant:"destructive",title:"فشل حفظ الوصفة",description:t.message||"حدث خطأ أثناء حفظ الوصفة"})}}),De=P({mutationFn:async({id:t,isAvailable:s,availabilityStatus:a})=>{const i=f?.branchId,n=await fetch(`/api/coffee-items/${t}/availability`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({isAvailable:s,availabilityStatus:a,branchId:i})});if(!n.ok)throw new Error("Failed to update availability");return n.json()},onSuccess:()=>{v.invalidateQueries({queryKey:["/api/coffee-items"]}),x({title:"تم التحديث بنجاح",description:"تم تحديث حالة توفر المشروب"})},onError:()=>{x({title:"خطأ",description:"فشل تحديث حالة توفر المشروب",variant:"destructive"})}}),de=P({mutationFn:async t=>await(await N("PUT",`/api/coffee-items/${t.id}`,t.updates)).json(),onSuccess:()=>{v.invalidateQueries({queryKey:["/api/coffee-items"]}),V(!1),ee(null),x({title:"تم التحديث",description:"تم تحديث المشروب بنجاح"})},onError:t=>{x({variant:"destructive",title:"فشل التحديث",description:t.message||"حدث خطأ أثناء تحديث المشروب"})}}),oe=P({mutationFn:async t=>{const s=await N("DELETE",`/api/coffee-items/${t}`);if(!s.ok){const a=await s.json();throw new Error(a.error||"فشل في حذف المشروب")}return await s.json()},onSuccess:async()=>{await v.invalidateQueries({queryKey:["/api/coffee-items"]}),typeof le=="function"&&await le(),_(null),x({title:"تم الحذف",description:"تم حذف المشروب بنجاح"})},onError:t=>{_(null),x({variant:"destructive",title:"فشل الحذف",description:t.message||"حدث خطأ أثناء حذف المشروب. قد يكون المشروب مرتبطاً بطلبات حالية."})}}),$e=P({mutationFn:async({id:t,isNewProduct:s})=>await(await N("PUT",`/api/coffee-items/${t}`,{isNewProduct:s})).json(),onSuccess:()=>{v.invalidateQueries({queryKey:["/api/coffee-items"]}),x({title:"تم التحديث",description:"تم تحديث حالة المنتج الجديد"})},onError:t=>{x({variant:"destructive",title:"فشل التحديث",description:t.message||"حدث خطأ أثناء التحديث"})}}),ct=(t,s)=>{De.mutate({id:t,availabilityStatus:s})},dt=async t=>{t.preventDefault();const s=new FormData(t.currentTarget),a=s.get("nameAr"),i=s.get("price");if(!a||!re||!i){x({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}let n;if(ye){M(!0);const o=await Te(ye);if(M(!1),o)n=o;else{x({title:"خطأ",description:"فشل رفع الصورة، يرجى المحاولة مرة أخرى",variant:"destructive"});return}}k({nameAr:a,nameEn:s.get("nameEn")||"",description:s.get("description")||"",category:re,price:i,oldPrice:s.get("oldPrice")||"",coffeeStrength:Fe,imageUrl:n||r?.imageUrl,branchAvailability:$.length>0?$:void 0,isGiftable:!1,availableSizes:r?.availableSizes||[],addons:r?.addons||[]}),C(2)},ot=(t,s)=>{Z(s?[...$,{branchId:t,isAvailable:1}]:$.filter(a=>a.branchId!==t))},mt=()=>{ne(!1),Re()},Re=()=>{if(!r)return;const s={id:Me(10),nameAr:r.nameAr,nameEn:r.nameEn||void 0,description:r.description,price:parseFloat(r.price),oldPrice:r.oldPrice?parseFloat(r.oldPrice):void 0,category:r.category,coffeeStrength:r.coffeeStrength||"classic",imageUrl:r.imageUrl,isAvailable:1,availabilityStatus:"available",isNewProduct:0,isGiftable:r.isGiftable||!1,availableSizes:r.availableSizes||[],addons:r.addons||[],branchAvailability:r.branchAvailability,hasRecipe:0,requiresRecipe:0};A.mutate({itemData:s,ingredientsList:[],recipeList:[]})},xt=()=>{if(!r)return;const t=Me(10),s=d.length>0||ae.length>0,a={id:t,nameAr:r.nameAr,nameEn:r.nameEn||void 0,description:r.description,price:parseFloat(r.price),oldPrice:r.oldPrice?parseFloat(r.oldPrice):void 0,category:r.category,coffeeStrength:r.coffeeStrength||"classic",imageUrl:r.imageUrl,isAvailable:1,availabilityStatus:"available",isNewProduct:0,isGiftable:r.isGiftable||!1,availableSizes:r.availableSizes||[],addons:r.addons||[],branchAvailability:r.branchAvailability,hasRecipe:s?1:0,requiresRecipe:1};A.mutate({itemData:a,ingredientsList:ae.map(i=>({ingredientId:i.ingredientId,quantity:i.quantity,unit:i.unit})),recipeList:d})},ut=()=>{if(r){if(f?.role==="manager"){ne(!0);return}Re()}},ht=t=>{J(t);const s=Ae.filter(a=>a.coffeeItemId===t.id);h(s.map(a=>{const i=F.find(n=>n.id===a.rawItemId);return{rawItemId:a.rawItemId,rawItem:i,quantity:a.quantity,unit:a.unit||i?.unit||"g"}})),H(!0)},gt=()=>{if(S){if(d.length===0){x({title:"خطأ",description:"يجب إضافة مكون واحد على الأقل للوصفة",variant:"destructive"});return}ce.mutate({coffeeItemId:S.id,items:d,clearExisting:!0})}},pt=async t=>{if(t.preventDefault(),!j)return;const s=new FormData(t.currentTarget);let a=j.imageUrl;if(Ie){M(!0);const n=await Te(Ie);if(M(!1),n)a=n;else{x({title:"خطأ",description:"فشل رفع الصورة، يرجى المحاولة مرة أخرى",variant:"destructive"});return}}const i={nameAr:s.get("nameAr"),nameEn:s.get("nameEn")||void 0,description:s.get("description"),price:parseFloat(s.get("price")),oldPrice:s.get("oldPrice")?parseFloat(s.get("oldPrice")):void 0,category:s.get("category"),imageUrl:a,availableSizes:w,addons:I};de.mutate({id:j.id,updates:i}),Oe()},bt=t=>{ee(t),q(t.availableSizes||[]),D(t.addons||[]),V(!0)},jt=t=>{_(t)},ft=()=>{te&&oe.mutate(te)},yt=t=>{const s=t.isNewProduct===1?0:1;$e.mutate({id:t.id,isNewProduct:s})},vt=t=>{const s=t.target.files?.[0];if(s){if(!s.type.startsWith("image/")){x({title:"خطأ",description:"يرجى اختيار ملف صورة فقط",variant:"destructive"});return}if(s.size>5*1024*1024){x({title:"خطأ",description:"حجم الصورة يجب أن يكون أقل من 5 ميجابايت",variant:"destructive"});return}ve(s);const a=new FileReader;a.onloadend=()=>{we(a.result)},a.readAsDataURL(s)}},Nt=t=>{const s=t.target.files?.[0];if(s){if(!s.type.startsWith("image/")){x({title:"خطأ",description:"يرجى اختيار ملف صورة فقط",variant:"destructive"});return}if(s.size>5*1024*1024){x({title:"خطأ",description:"حجم الصورة يجب أن يكون أقل من 5 ميجابايت",variant:"destructive"});return}Se(s);const a=new FileReader;a.onloadend=()=>{ke(a.result)},a.readAsDataURL(s)}},Te=async t=>{try{const s=new FormData;s.append("image",t);const a=await fetch("/api/upload-drink-image",{method:"POST",body:s,credentials:"include"});if(!a.ok)throw new Error("فشل رفع الصورة");return(await a.json()).url}catch(s){return console.error("Error uploading image:",s),null}},me=()=>{ve(null),we(null),Q.current&&(Q.current.value="")},Oe=()=>{Se(null),ke(null),B.current&&(B.current.value="")},Ue={basic:"قهوة أساسية",hot:"قهوة ساخنة",cold:"قهوة باردة",specialty:"مشروبات إضافية",drinks:"المشروبات",desserts:"الحلويات",food:"المأكولات",bakery:"المخبوزات"},wt=y?zt:Lt,It=nt.filter(t=>wt.includes(t.category)).reduce((t,s)=>(t[s.category]||(t[s.category]=[]),t[s.category].push(s),t),{});return f?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-primary/5 to-background p-4",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-amber-700 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(xe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-accent",children:y?"إدارة المأكولات":"إدارة المشروبات"}),e.jsx("p",{className:"text-gray-400 text-sm",children:y?"تحديث حالة توفر المأكولات":"تحديث حالة توفر المشروبات"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[f?.role==="manager"&&e.jsxs(ue,{open:at,onOpenChange:t=>{Y(t),t?(k({nameAr:"",nameEn:"",description:"",category:y?"food":"hot",price:"0",oldPrice:"0",coffeeStrength:"classic",availableSizes:[],addons:[],isGiftable:!1}),C(1)):(C(1),k(null),se([]),me(),W(y?"food":"hot"),X("classic"))},children:[e.jsx(kt,{asChild:!0,children:e.jsxs(u,{className:"bg-gradient-to-r from-green-500 to-green-700 hover:from-green-600 hover:to-green-800","data-testid":"button-add-item",children:[e.jsx(he,{className:"w-4 h-4 ml-2"}),y?"إضافة صنف جديد":"إضافة مشروب جديد"]})}),e.jsxs(ge,{className:"bg-[#2d1f1a] border-primary/20 text-white max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(pe,{children:e.jsx(be,{className:"text-accent",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("span",{children:"إضافة مشروب جديد"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-normal",children:[e.jsx("span",{className:`px-3 py-1 rounded-full ${ie===1?"bg-background0 text-white":"bg-gray-600 text-gray-300"}`,children:"1. المعلومات الأساسية"}),e.jsx(Le,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:`px-3 py-1 rounded-full ${ie===2?"bg-background0 text-white":"bg-gray-600 text-gray-300"}`,children:"2. المكونات والوصفة"})]})]})})}),ie===1?e.jsxs("form",{onSubmit:dt,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"nameAr",className:"text-gray-300",children:"الاسم بالعربية *"}),e.jsx(p,{id:"nameAr",name:"nameAr",required:!0,defaultValue:r?.nameAr||"",className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-name-ar"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"nameEn",className:"text-gray-300",children:"الاسم بالإنجليزية"}),e.jsx(p,{id:"nameEn",name:"nameEn",defaultValue:r?.nameEn||"",className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-name-en"})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",className:"text-gray-300",children:"الوصف *"}),e.jsx(Ge,{id:"description",name:"description",required:!0,defaultValue:r?.description||"",className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"category",className:"text-gray-300",children:"القسم *"}),e.jsxs(O,{value:re,onValueChange:W,children:[e.jsx(U,{className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"select-category",children:e.jsx(z,{placeholder:"اختر القسم"})}),e.jsx(L,{className:"bg-[#2d1f1a] border-primary/20 text-white",children:y?e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"food",children:"السندوتشات والمأكولات"}),e.jsx(l,{value:"bakery",children:"المخبوزات والكرواسون"}),e.jsx(l,{value:"cake",children:"الكيك"}),e.jsx(l,{value:"desserts",children:"الحلويات"})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"hot",children:"قهوة ساخنة"}),e.jsx(l,{value:"cold",children:"قهوة باردة"}),e.jsx(l,{value:"specialty",children:"مشروبات مميزة"}),e.jsx(l,{value:"drinks",children:"المشروبات"}),e.jsx(l,{value:"additional_drinks",children:"مشروبات إضافية"}),e.jsx(l,{value:"basic",children:"قهوة كلاسيك"})]})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse pt-8",children:[e.jsx(Tt,{id:"isGiftable",checked:r?.isGiftable||!1,onCheckedChange:t=>k(s=>({...s||{},isGiftable:t}))}),e.jsx(m,{htmlFor:"isGiftable",className:"text-gray-300",children:"قابل للإهداء"})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"price",className:"text-gray-300",children:"السعر (ريال) *"}),e.jsx(p,{id:"price",name:"price",type:"number",step:"0.01",min:"0",required:!0,defaultValue:r?.price||"",className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-price"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"oldPrice",className:"text-gray-300",children:"السعر القديم (ريال)"}),e.jsx(p,{id:"oldPrice",name:"oldPrice",type:"number",step:"0.01",min:"0",defaultValue:r?.oldPrice||"",className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-old-price"})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-gray-300",children:"صورة المشروب"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{ref:Q,type:"file",accept:"image/*",onChange:vt,className:"hidden","data-testid":"input-image-file"}),e.jsx("div",{onClick:()=>Q.current?.click(),className:"border-2 border-dashed border-primary/30 rounded-lg p-4 text-center cursor-pointer hover:border-primary/60 transition-colors",children:Ne?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Ne,alt:"Preview",className:"w-full h-32 object-cover rounded-lg"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg opacity-0 hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-sm",children:"انقر لتغيير الصورة"})})]}):e.jsxs("div",{className:"py-4",children:[e.jsx(Ve,{className:"w-8 h-8 text-accent/50 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"انقر لرفع صورة"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"PNG, JPG حتى 5 ميجابايت"})]})})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"coffeeStrength",className:"text-gray-300",children:"قوة القهوة"}),e.jsxs(O,{value:Fe,onValueChange:X,children:[e.jsx(U,{className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"select-coffee-strength",children:e.jsx(z,{placeholder:"اختر قوة القهوة"})}),e.jsxs(L,{className:"bg-[#2d1f1a] border-primary/20 text-white",children:[e.jsx(l,{value:"mild",children:"خفيفة (1-4)"}),e.jsx(l,{value:"classic",children:"كلاسيكية/العادي"}),e.jsx(l,{value:"medium",children:"متوسطة (4-8)"}),e.jsx(l,{value:"strong",children:"قوية (8-12)"})]})]})]}),f?.role==="manager"&&Pe.length>0&&e.jsxs("div",{children:[e.jsx(m,{className:"text-gray-300",children:"متوفر في الفروع"}),e.jsx("p",{className:"text-gray-500 text-xs mb-2",children:"اختر الفروع التي سيتوفر فيها هذا المنتج (اتركه فارغاً للتوفر في جميع الفروع)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-32 overflow-y-auto bg-[#1a1410] p-3 rounded-lg border border-primary/20",children:Pe.filter(t=>t.isActive===1||t.isActive==="1").map(t=>{const s=t.id,a=$.some(i=>i.branchId===s);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{id:`branch-${s}`,checked:a,onCheckedChange:i=>ot(s,!!i),className:"border-primary/50","data-testid":`checkbox-branch-${s}`}),e.jsx("label",{htmlFor:`branch-${s}`,className:"text-gray-300 text-sm cursor-pointer",children:t.nameAr})]},s)})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>{Y(!1),me(),se([]),h([]),Z([]),C(1),k(null),W("hot"),X("classic")},className:"border-gray-600 text-gray-300","data-testid":"button-cancel",children:"إلغاء"}),e.jsxs(u,{type:"submit",disabled:K,className:"bg-gradient-to-r from-amber-500 to-amber-700","data-testid":"button-next",children:[K?"جاري رفع الصورة...":"التالي: إضافة المكونات",e.jsx(Le,{className:"w-4 h-4 mr-2"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#1a1410] p-4 rounded-lg border border-primary/20",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"المشروب:"}),e.jsx("p",{className:"text-accent font-bold text-lg",children:r?.nameAr}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[r?.category&&Ue[r.category]," • ",r?.price," ريال"]})]}),e.jsxs("div",{className:"border-t border-primary/20 pt-4",children:[e.jsxs(m,{className:"text-gray-300 text-lg flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"وصفة المنتج (المواد الخام)"]}),e.jsx("p",{className:"text-gray-500 text-sm mb-3",children:"اختر المواد الخام اللازمة لتحضير المشروب مع الكميات"}),f?.role==="manager"&&F.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto mb-3",children:F.filter(t=>t.isActive===1).map(t=>{const s=d.some(i=>i.rawItemId===t.id),a=d.find(i=>i.rawItemId===t.id);return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-[#1a1410] rounded-lg border border-primary/10",children:[e.jsx(fe,{id:`raw-step2-${t.id}`,checked:s,onCheckedChange:i=>{h(i?[...d,{rawItemId:t.id,rawItem:t,quantity:10,unit:t.unit}]:d.filter(n=>n.rawItemId!==t.id))},className:"border-primary/50","data-testid":`checkbox-raw-${t.id}`}),e.jsxs("label",{htmlFor:`raw-step2-${t.id}`,className:"text-gray-300 flex-1 cursor-pointer",children:[e.jsx("span",{children:t.nameAr}),e.jsxs("span",{className:"text-gray-500 text-xs mr-2",children:["(",t.unitCost.toFixed(2)," ريال/",t.unit,")"]})]}),s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{type:"number",min:"0.1",step:"0.1",value:a?.quantity||10,onChange:i=>{h(d.map(n=>n.rawItemId===t.id?{...n,quantity:parseFloat(i.target.value)||0}:n))},className:"w-20 bg-[#2d1f1a] border-primary/30 text-white text-center","data-testid":`input-qty-raw-${t.id}`}),e.jsxs(O,{value:a?.unit||t.unit,onValueChange:i=>{h(d.map(n=>n.rawItemId===t.id?{...n,unit:i}:n))},children:[e.jsx(U,{className:"w-20 bg-[#2d1f1a] border-primary/30 text-white","data-testid":`select-unit-raw-${t.id}`,children:e.jsx(z,{})}),e.jsxs(L,{className:"bg-[#2d1f1a] border-primary/20 text-white",children:[e.jsx(l,{value:"g",children:"جرام"}),e.jsx(l,{value:"ml",children:"مل"}),e.jsx(l,{value:"kg",children:"كجم"}),e.jsx(l,{value:"liter",children:"لتر"}),e.jsx(l,{value:"piece",children:"قطعة"})]})]})]})]},t.id)})}),d.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:d.map(t=>{const s=F.find(a=>a.id===t.rawItemId);return e.jsxs(R,{className:"bg-green-500/20 text-green-400 border border-green-500/30",children:[s?.nameAr,": ",t.quantity," ",t.unit,e.jsx("button",{type:"button",onClick:()=>h(d.filter(a=>a.rawItemId!==t.rawItemId)),className:"mr-1 hover:text-red-400",children:e.jsx(je,{className:"w-3 h-3"})})]},t.rawItemId)})}),d.length>0&&e.jsx("div",{className:"bg-gradient-to-r from-background to-background p-4 rounded-lg border border-green-500/30 mt-3","data-testid":"recipe-cost-preview",children:(()=>{const{totalCost:t,breakdown:s}=Ee(d),a=r?.price?parseFloat(r.price):0,i=a-t,n=a>0?i/a*100:0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("span",{className:"text-gray-300 font-medium flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-green-400"}),"تكلفة الوصفة التقديرية"]})}),s.length>0&&e.jsx("div",{className:"space-y-1 mb-3 text-sm",children:s.map((o,g)=>e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsxs("span",{children:[o.name," (",o.quantity," ",o.unit,")"]}),e.jsxs("span",{children:[o.cost.toFixed(2)," ريال"]})]},g))}),e.jsxs("div",{className:"border-t border-green-500/20 pt-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"تكلفة الوصفة (COGS):"}),e.jsxs("span",{className:"text-green-400 font-bold","data-testid":"text-recipe-cost",children:[t.toFixed(2)," ريال"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"سعر البيع:"}),e.jsxs("span",{className:"text-white font-bold",children:[a.toFixed(2)," ريال"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"هامش الربح:"}),e.jsxs("span",{className:`font-bold ${i>=0?"text-green-500":"text-red-500"}`,"data-testid":"text-profit-margin",children:[i.toFixed(2)," ريال (",n.toFixed(1),"%)"]})]})]})]})})()}),d.length===0&&e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(Ft,{className:"w-5 h-5 text-yellow-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-400 text-sm font-medium",children:"تنبيه: لم يتم إضافة وصفة"}),e.jsx("p",{className:"text-yellow-500/80 text-xs",children:"المنتجات بدون وصفة لن يتم خصمها من المخزون عند البيع."})]})]})]}):e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"الوصفات متاحة للمديرين فقط"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"أو لا توجد مواد خام متاحة"})]})]}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsxs(u,{type:"button",variant:"outline",onClick:()=>C(1),className:"border-primary/30 text-accent","data-testid":"button-back-step",children:[e.jsx(_e,{className:"w-4 h-4 ml-2"}),"السابق"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:ut,disabled:A.isPending,className:"border-gray-600 text-gray-300","data-testid":"button-skip",children:A.isPending?"جاري الإضافة...":"تخطي المكونات"}),e.jsx(u,{type:"button",onClick:xt,disabled:A.isPending||d.length===0&&ae.length===0,className:"bg-gradient-to-r from-green-500 to-green-700","data-testid":"button-submit",children:A.isPending?"جاري الإضافة...":"إضافة المشروب"})]})]})]})]})]}),e.jsx(u,{variant:"outline",onClick:()=>G("/employee/ingredients"),className:"border-primary/50 text-accent hover:bg-background0 hover:text-white","data-testid":"button-ingredients",children:"إدارةالمكونات"}),e.jsxs(u,{variant:"outline",onClick:()=>G("/employee/dashboard"),className:"border-primary/50 text-accent hover:bg-background0 hover:text-white","data-testid":"button-back",children:[e.jsx(_e,{className:"w-4 h-4 ml-2"}),"العودةللوحةالتحكم"]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:lt?e.jsxs("div",{className:"text-center text-accent py-12",children:[e.jsx(xe,{className:"w-12 h-12 animate-spin mx-auto mb-4"}),e.jsx("p",{children:y?"جاري تحميل المأكولات...":"جاري تحميل المشروبات..."})]}):Object.entries(It).map(([t,s])=>e.jsxs(At,{className:"bg-[#2d1f1a] border-primary/20",children:[e.jsx(Pt,{children:e.jsx(Et,{className:"text-accent text-right text-xl",children:Ue[t]||t})}),e.jsx(qt,{className:"space-y-3",children:s.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#1a1410] rounded-lg border border-primary/10 hover:border-primary/30 transition-all","data-testid":`item-${a.id}`,children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("img",{src:a.imageUrl?a.imageUrl.startsWith("/")?a.imageUrl:`/${a.imageUrl}`:Ke(a.id),alt:a.nameAr,className:"w-16 h-16 rounded-lg object-cover",onError:i=>{i.currentTarget.src=Ke(a.id)},"data-testid":`img-${a.id}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-accent","data-testid":`text-name-${a.id}`,children:a.nameAr}),e.jsx("p",{className:"text-gray-400 text-sm",children:a.nameEn}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-accent font-bold","data-testid":`text-price-${a.id}`,children:[parseFloat(String(a.price)).toFixed(2)," ريال"]}),a.coffeeStrength&&a.coffeeStrength!=="classic"&&e.jsxs(R,{variant:"outline",className:"text-xs border-primary/30 text-gray-400",children:[a.coffeeStrength==="strong"&&"قوي",a.coffeeStrength==="medium"&&"متوسط",a.coffeeStrength==="mild"&&"خفيف"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right flex flex-col gap-2",children:[e.jsxs(R,{className:a.availabilityStatus==="available"?"bg-green-500":a.availabilityStatus==="out_of_stock"?"bg-red-500":a.availabilityStatus==="coming_soon"?"bg-blue-500":"bg-background0","data-testid":`badge-status-${a.id}`,children:[a.availabilityStatus==="available"&&e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"w-4 h-4 ml-1"}),"متوفر"]}),a.availabilityStatus==="out_of_stock"&&e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 ml-1"}),"نفذت الكمية"]}),a.availabilityStatus==="coming_soon"&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 ml-1"}),"قريباً"]}),a.availabilityStatus==="temporarily_unavailable"&&e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 ml-1"}),"غير متوفر مؤقتاً"]})]}),e.jsxs("select",{value:a.availabilityStatus||"available",onChange:i=>ct(a.id,i.target.value),disabled:De.isPending,className:"bg-[#1a1410] border border-primary/30 rounded-lg px-3 py-1 text-sm text-accent","data-testid":`select-status-${a.id}`,children:[e.jsx("option",{value:"available",children:" متوفر"}),e.jsx("option",{value:"out_of_stock",children:" نفذت الكمية "}),e.jsx("option",{value:"temporarily_unavailable",children:"⏸ غير متوفر مؤقتاً"}),e.jsx("option",{value:"coming_soon",children:" قريباً"})]})]}),f?.role==="manager"&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:qe(a.id)>0?e.jsxs(R,{className:"bg-green-600/20 text-green-400 border-green-500/30 text-xs",children:[e.jsx(E,{className:"w-3 h-3 ml-1"}),qe(a.id)," مكون"]}):e.jsx(R,{variant:"outline",className:"border-yellow-500/30 text-yellow-400 text-xs",children:"بدون وصفة"})}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>yt(a),className:`${a.isNewProduct===1?"bg-yellow-500 border-yellow-500 text-white":"border-primary/30 text-accent"}`,disabled:$e.isPending,"data-testid":`button-toggle-new-${a.id}`,children:[e.jsx(Dt,{className:"w-4 h-4 ml-1"}),a.isNewProduct===1?"منتج جديد":"جديد؟"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>ht(a),className:"border-green-500/30 text-green-400 hover:bg-green-600 hover:text-white flex-1","data-testid":`button-recipe-${a.id}`,children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>bt(a),className:"border-blue-500/30 text-blue-500 hover:bg-blue-500 hover:text-white flex-1","data-testid":`button-edit-${a.id}`,children:e.jsx(Ut,{className:"w-4 h-4"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>jt(a.id),className:"border-red-500/30 text-red-500 hover:bg-red-500 hover:text-white flex-1","data-testid":`button-delete-${a.id}`,children:e.jsx($t,{className:"w-4 h-4"})})]})]})]})]},a.id))})]},t))}),e.jsx(ue,{open:st,onOpenChange:V,children:e.jsxs(ge,{className:"bg-[#2d1f1a] border-primary/20 text-white max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(pe,{children:e.jsx(be,{className:"text-accent",children:"تعديل المشروب"})}),j&&e.jsxs("form",{onSubmit:pt,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-nameAr",className:"text-gray-300",children:"الاسم بالعربية *"}),e.jsx(p,{id:"edit-nameAr",name:"nameAr",defaultValue:j.nameAr,required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-edit-name-ar"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-nameEn",className:"text-gray-300",children:"الاسم بالإنجليزية"}),e.jsx(p,{id:"edit-nameEn",name:"nameEn",defaultValue:j.nameEn,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-edit-name-en"})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-description",className:"text-gray-300",children:"الوصف *"}),e.jsx(Ge,{id:"edit-description",name:"description",defaultValue:j.description,required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-edit-description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-category",className:"text-gray-300",children:"القسم *"}),e.jsxs(O,{name:"category",defaultValue:j.category,required:!0,children:[e.jsx(U,{className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"select-edit-category",children:e.jsx(z,{placeholder:"اختر القسم"})}),e.jsx(L,{className:"bg-[#2d1f1a] border-primary/20 text-white",children:y?e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"food",children:"المأكولات"}),e.jsx(l,{value:"bakery",children:"المخبوزات"}),e.jsx(l,{value:"desserts",children:"الحلويات"})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"basic",children:"قهوة أساسية"}),e.jsx(l,{value:"hot",children:"قهوة ساخنة"}),e.jsx(l,{value:"cold",children:"قهوة باردة"}),e.jsx(l,{value:"specialty",children:"مشروبات إضافية"}),e.jsx(l,{value:"drinks",children:"المشروبات"})]})})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-price",className:"text-gray-300",children:"السعر (ريال) *"}),e.jsx(p,{id:"edit-price",name:"price",type:"number",step:"0.01",min:"0",defaultValue:j.price,required:!0,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-edit-price"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-oldPrice",className:"text-gray-300",children:"السعر القديم (ريال)"}),e.jsx(p,{id:"edit-oldPrice",name:"oldPrice",type:"number",step:"0.01",min:"0",defaultValue:j.oldPrice,className:"bg-[#1a1410] border-primary/30 text-white","data-testid":"input-edit-old-price"})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-gray-300",children:"صورة المشروب"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{ref:B,type:"file",accept:"image/*",onChange:Nt,className:"hidden","data-testid":"input-edit-image-file"}),e.jsx("div",{onClick:()=>B.current?.click(),className:"border-2 border-dashed border-primary/30 rounded-lg p-4 text-center cursor-pointer hover:border-primary/60 transition-colors",children:Ce?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Ce,alt:"Preview",className:"w-full h-32 object-cover rounded-lg"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg opacity-0 hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-sm",children:"انقر لتغيير الصورة"})})]}):j.imageUrl?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:j.imageUrl,alt:"Current",className:"w-full h-32 object-cover rounded-lg"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg opacity-0 hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-sm",children:"انقر لتغيير الصورة"})})]}):e.jsxs("div",{className:"py-4",children:[e.jsx(Ve,{className:"w-8 h-8 text-accent/50 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"انقر لرفع صورة"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"PNG, JPG حتى 5 ميجابايت"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-gray-300",children:"الأحجام المتاحة"}),e.jsx("div",{className:"space-y-2",children:w.map((t,s)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(p,{type:"text",placeholder:"اسم الحجم",value:t.nameAr,onChange:a=>{const i=[...w];i[s].nameAr=a.target.value,q(i)},className:"bg-[#1a1410] border-primary/30 text-white flex-1","data-testid":`input-edit-size-name-${s}`}),e.jsx(p,{type:"number",placeholder:"السعر",value:t.price,onChange:a=>{const i=[...w];i[s].price=parseFloat(a.target.value)||0,q(i)},className:"bg-[#1a1410] border-primary/30 text-white w-24","data-testid":`input-edit-size-price-${s}`}),e.jsx(u,{type:"button",size:"sm",variant:"outline",onClick:()=>q(w.filter((a,i)=>i!==s)),className:"border-red-500/30 text-red-500","data-testid":`button-delete-size-${s}`,children:e.jsx(je,{className:"w-4 h-4"})})]},s))}),e.jsxs(u,{type:"button",size:"sm",variant:"outline",onClick:()=>q([...w,{nameAr:"",price:0}]),className:"border-green-500/30 text-green-400 w-full","data-testid":"button-add-edit-size",children:[e.jsx(he,{className:"w-4 h-4 ml-1"}),"إضافة حجم"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-gray-300",children:"الإضافات المتاحة"}),e.jsx("div",{className:"space-y-2",children:I.map((t,s)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(p,{type:"text",placeholder:"اسم الإضافة",value:t.nameAr,onChange:a=>{const i=[...I];i[s].nameAr=a.target.value,D(i)},className:"bg-[#1a1410] border-primary/30 text-white flex-1","data-testid":`input-edit-addon-name-${s}`}),e.jsx(p,{type:"number",placeholder:"السعر",value:t.price,onChange:a=>{const i=[...I];i[s].price=parseFloat(a.target.value)||0,D(i)},className:"bg-[#1a1410] border-primary/30 text-white w-24","data-testid":`input-edit-addon-price-${s}`}),e.jsx(u,{type:"button",size:"sm",variant:"outline",onClick:()=>D(I.filter((a,i)=>i!==s)),className:"border-red-500/30 text-red-500","data-testid":`button-delete-addon-${s}`,children:e.jsx(je,{className:"w-4 h-4"})})]},s))}),e.jsxs(u,{type:"button",size:"sm",variant:"outline",onClick:()=>D([...I,{nameAr:"",price:0,category:"other"}]),className:"border-green-500/30 text-green-400 w-full","data-testid":"button-add-edit-addon",children:[e.jsx(he,{className:"w-4 h-4 ml-1"}),"إضافة إضافة"]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>{V(!1),ee(null),Oe()},className:"border-gray-600 text-gray-300","data-testid":"button-edit-cancel",children:"إلغاء"}),e.jsx(u,{type:"submit",disabled:de.isPending||K,className:"bg-gradient-to-r from-blue-500 to-blue-700","data-testid":"button-edit-submit",children:K?"جاري رفع الصورة...":de.isPending?"جاري التحديث...":"تحديث المشروب"})]})]})]})}),e.jsx(ue,{open:it,onOpenChange:t=>{H(t),t||(J(null),h([]))},children:e.jsxs(ge,{className:"bg-[#2d1f1a] border-green-500/20 text-white max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(pe,{children:e.jsxs(be,{className:"text-green-400 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"تعديل وصفة: ",S?.nameAr]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"bg-[#1a1410] p-3 rounded-lg border border-green-500/20",children:e.jsxs("p",{className:"text-gray-400 text-sm",children:["سعر البيع: ",e.jsxs("span",{className:"text-accent font-bold",children:[S?.price," ريال"]})]})}),e.jsxs("div",{children:[e.jsx(m,{className:"text-gray-300 text-lg",children:"اختر المواد الخام للوصفة"}),e.jsx("p",{className:"text-gray-500 text-sm mb-3",children:"حدد الكميات المستخدمة في تحضير المنتج"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto mb-3",children:F.filter(t=>t.isActive===1).map(t=>{const s=d.some(i=>i.rawItemId===t.id),a=d.find(i=>i.rawItemId===t.id);return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-[#1a1410] rounded-lg border border-primary/10",children:[e.jsx(fe,{id:`recipe-edit-${t.id}`,checked:s,onCheckedChange:i=>{h(i?[...d,{rawItemId:t.id,rawItem:t,quantity:10,unit:t.unit}]:d.filter(n=>n.rawItemId!==t.id))},className:"border-green-500/50","data-testid":`checkbox-recipe-edit-${t.id}`}),e.jsxs("label",{htmlFor:`recipe-edit-${t.id}`,className:"text-gray-300 flex-1 cursor-pointer",children:[e.jsx("span",{children:t.nameAr}),e.jsxs("span",{className:"text-gray-500 text-xs mr-2",children:["(",t.unitCost.toFixed(2)," ريال/",t.unit,")"]})]}),s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{type:"number",min:"0.1",step:"0.1",value:a?.quantity||10,onChange:i=>{h(d.map(n=>n.rawItemId===t.id?{...n,quantity:parseFloat(i.target.value)||0}:n))},className:"w-20 bg-[#2d1f1a] border-green-500/30 text-white text-center","data-testid":`input-recipe-qty-${t.id}`}),e.jsxs(O,{value:a?.unit||t.unit,onValueChange:i=>{h(d.map(n=>n.rawItemId===t.id?{...n,unit:i}:n))},children:[e.jsx(U,{className:"w-20 bg-[#2d1f1a] border-green-500/30 text-white","data-testid":`select-recipe-unit-${t.id}`,children:e.jsx(z,{})}),e.jsxs(L,{className:"bg-[#2d1f1a] border-primary/20 text-white",children:[e.jsx(l,{value:"g",children:"جرام"}),e.jsx(l,{value:"ml",children:"مل"}),e.jsx(l,{value:"kg",children:"كجم"}),e.jsx(l,{value:"liter",children:"لتر"}),e.jsx(l,{value:"piece",children:"قطعة"})]})]})]})]},t.id)})}),d.length>0&&e.jsx("div",{className:"bg-gradient-to-r from-background to-background p-4 rounded-lg border border-green-500/30 mt-3",children:(()=>{const{totalCost:t,breakdown:s}=Ee(d),a=S?.price?parseFloat(String(S.price)):0,i=a-t,n=a>0?i/a*100:0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("span",{className:"text-gray-300 font-medium flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-green-400"}),"تكلفة الوصفة"]})}),s.length>0&&e.jsx("div",{className:"space-y-1 mb-3 text-sm",children:s.map((o,g)=>e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsxs("span",{children:[o.name," (",o.quantity," ",o.unit,")"]}),e.jsxs("span",{children:[o.cost.toFixed(2)," ريال"]})]},g))}),e.jsxs("div",{className:"border-t border-green-500/20 pt-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"تكلفة الوصفة (COGS):"}),e.jsxs("span",{className:"text-green-400 font-bold",children:[t.toFixed(2)," ريال"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"سعر البيع:"}),e.jsxs("span",{className:"text-white font-bold",children:[a.toFixed(2)," ريال"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"هامش الربح:"}),e.jsxs("span",{className:`font-bold ${i>=0?"text-green-500":"text-red-500"}`,children:[i.toFixed(2)," ريال (",n.toFixed(1),"%)"]})]})]})]})})()})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>{H(!1),J(null),h([])},className:"border-gray-600 text-gray-300","data-testid":"button-recipe-cancel",children:"إلغاء"}),e.jsx(u,{type:"button",onClick:gt,disabled:ce.isPending||d.length===0,className:"bg-gradient-to-r from-green-500 to-green-700","data-testid":"button-recipe-save",children:ce.isPending?"جاري الحفظ...":"حفظ الوصفة"})]})]})]})}),e.jsx(Qe,{open:!!te,onOpenChange:()=>_(null),children:e.jsxs(Be,{className:"bg-[#2d1f1a] border-red-500/20 text-white",children:[e.jsxs(He,{children:[e.jsx(Je,{className:"text-red-500",children:"تأكيد الحذف"}),e.jsx(We,{className:"text-gray-300",children:"هل أنت متأكد من حذف هذا المشروب؟ لا يمكن التراجع عن هذا الإجراء."})]}),e.jsxs(Xe,{children:[e.jsx(Ze,{className:"bg-transparent border-gray-600 text-gray-300","data-testid":"button-delete-cancel",children:"إلغاء"}),e.jsx(Ye,{onClick:ft,disabled:oe.isPending,className:"bg-gradient-to-r from-red-500 to-red-700 text-white","data-testid":"button-delete-confirm",children:oe.isPending?"جاري الحذف...":"حذف"})]})]})}),e.jsx(Qe,{open:rt,onOpenChange:ne,children:e.jsxs(Be,{className:"bg-[#2d1f1a] border-primary/20 text-white",children:[e.jsxs(He,{children:[e.jsx(Je,{className:"text-accent",children:"تأكيد إنشاء منتج بدون وصفة"}),e.jsxs(We,{className:"text-gray-300",children:["أنت على وشك إنشاء منتج بدون وصفة. هذا يعني أن:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-gray-400",children:[e.jsx("li",{children:"لن يتم خصم المخزون تلقائياً عند البيع"}),e.jsx("li",{children:"لن يمكن حساب تكلفة المنتج بدقة"}),e.jsx("li",{children:'لن يكون المنتج "جاهز للبيع" بالكامل'})]}),e.jsx("p",{className:"mt-3 text-accent",children:"يمكنك إضافة الوصفة لاحقاً من قائمة المنتجات."})]})]}),e.jsxs(Xe,{children:[e.jsx(Ze,{className:"bg-transparent border-gray-600 text-gray-300","data-testid":"button-skip-recipe-cancel",children:"الرجوع لإضافة الوصفة"}),e.jsx(Ye,{onClick:mt,className:"bg-gradient-to-r from-amber-600 to-amber-700 text-white","data-testid":"button-skip-recipe-confirm",children:"إنشاء بدون وصفة"})]})]})})]}):null}export{sa as default};
