import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as n}from"./vendor-react-Bzsngnqy.js";import{I as p,u as D,c as O,t as Y,e as H,C as M,x as B,y as G,V,f as z,aa as J,ab as K,ac as P,ai as S,L as c,aj as L,B as k,U as Q,p as X,G as Z,v as F}from"./index-CLvpp2UE.js";import{P as _}from"./phone-input-C_eDBAZg.js";import{L as $}from"./lock-Dvxo6ahY.js";import{E as T}from"./eye-off-AEXWPIZp.js";import{E as q}from"./eye-cZNGFzyE.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";function ee({value:v,onChange:a,placeholder:m="5xxxxxxxx أو email@example.com",className:b="",id:s,"data-testid":g,required:f}){const l=v.includes("@"),N=u=>{const h=u.target.value;if(l||h.includes("@"))a(h);else{let r=h.replace(/\D/g,"");r=r.startsWith("0")?r.slice(1):r,r=r.slice(0,9),a(r)}};return e.jsxs("div",{className:"relative",children:[!l&&e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-amber-400/70 font-semibold text-sm",children:"+966 |"}),e.jsx(p,{id:s,type:l?"email":"tel",inputMode:l?"email":"numeric",placeholder:m,value:v,onChange:N,className:`${l?"":"pl-16"} bg-stone-800/50 border-amber-900/50 text-amber-50 placeholder:text-amber-200/40 focus:border-amber-600 focus:ring-amber-600/30 ${b}`,dir:"ltr","data-testid":g,required:f})]})}function ce(){const{t:v,i18n:a}=D(),[,m]=O(),{setCustomer:b}=Y(),{toast:s}=H(),[g,f]=n.useState(""),[l,N]=n.useState(""),[u,h]=n.useState(""),[r,y]=n.useState(""),[C,A]=n.useState(""),[x,E]=n.useState(!1),[j,w]=n.useState(!1),[I,R]=n.useState("login"),U=async t=>{t.preventDefault();const i=g.replace(/\s/g,"").trim();if(!i){s({title:a.language==="ar"?"خطأ":"Error",description:a.language==="ar"?"يرجى إدخال رقم الجوال أو البريد الإلكتروني":"Please enter phone number or email",variant:"destructive"});return}if(!r||r.length<4){s({title:a.language==="ar"?"خطأ":"Error",description:a.language==="ar"?"كلمة المرور يجب أن تكون على الأقل 4 أحرف":"Password must be at least 4 characters",variant:"destructive"});return}w(!0);try{const d=await(await F("POST","/api/customers/login",{identifier:i,password:r})).json();b(d),s({title:a.language==="ar"?"مرحباً بك!":"Welcome!",description:a.language==="ar"?`أهلاً ${d.name}، تم تسجيل دخولك بنجاح`:`Hello ${d.name}, you have logged in successfully`}),m("/")}catch(o){console.error("Login error:",o),s({title:a.language==="ar"?"خطأ":"Error",description:o.message||(a.language==="ar"?"العميل غير مسجل لدينا":"Customer not found"),variant:"destructive"})}finally{w(!1)}},W=async t=>{t.preventDefault();const i=g.replace(/\s/g,"").trim();if(!i||i.length!==9){s({title:a.language==="ar"?"خطأ":"Error",description:a.language==="ar"?"يرجى إدخال رقم جوال مكون من 9 أرقام":"Please enter a 9-digit phone number",variant:"destructive"});return}if(!i.startsWith("5")){s({title:a.language==="ar"?"خطأ":"Error",description:a.language==="ar"?"رقم الجوال يجب أن يبدأ بالرقم 5":"Phone number must start with 5",variant:"destructive"});return}if(!l||l.trim().length<2){s({title:a.language==="ar"?"خطأ":"Error",description:a.language==="ar"?"الاسم يجب أن يكون على الأقل حرفين":"Name must be at least 2 characters",variant:"destructive"});return}if(!u||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u)){s({title:a.language==="ar"?"خطأ":"Error",description:a.language==="ar"?"البريد الإلكتروني مطلوب وصيغته غير صحيحة":"Invalid email address",variant:"destructive"});return}if(!r||r.length<4){s({title:a.language==="ar"?"خطأ":"Error",description:a.language==="ar"?"كلمة المرور يجب أن تكون على الأقل 4 أحرف":"Password must be at least 4 characters",variant:"destructive"});return}w(!0);try{const d=await(await F("POST","/api/customers/register",{phone:i,name:l.trim(),email:u.trim(),password:r,referralCode:C.trim()||void 0})).json();b(d),s({title:a.language==="ar"?"مرحباً بك!":"Welcome!",description:a.language==="ar"?`أهلاً ${d.name}، تم إنشاء حسابك بنجاح`:`Hello ${d.name}, your account has been created successfully`}),m("/")}catch(o){console.error("Registration error:",o),s({title:a.language==="ar"?"خطأ":"Error",description:o.message||(a.language==="ar"?"حدث خطأ أثناء إنشاء الحساب":"An error occurred while creating your account"),variant:"destructive"})}finally{w(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, hsl(175 20% 10%) 0%, hsl(175 18% 18%) 50%, hsl(175 20% 10%) 100%)"},dir:a.language==="ar"?"rtl":"ltr",children:e.jsxs(M,{className:"w-full max-w-md border-primary/30 bg-gradient-to-br from-foreground/5 to-foreground/10 backdrop-blur shadow-2xl",children:[e.jsxs(B,{className:"space-y-3 text-center pb-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-2xl overflow-hidden shadow-lg shadow-accent/50 backdrop-blur-xl border border-white/20 bg-[#a7b0b1]/30",children:e.jsx("img",{src:"/logo.png",alt:"CLUNY CAFE",className:"w-full h-full object-cover rounded-2xl"})})}),e.jsx(G,{className:"tracking-tight text-3xl font-bold text-[#a7b0b1]",children:a.language==="ar"?"مرحباً بك في CLUNY CAFE":"Welcome to CLUNY CAFE"}),e.jsx(V,{className:"text-lg text-[#b2babc]",children:a.language==="ar"?"سجل دخولك للحصول على حسابك الخاص":"Sign in to access your account"})]}),e.jsxs(z,{children:[e.jsxs(J,{value:I,onValueChange:t=>R(t),className:"w-full",children:[e.jsxs(K,{className:"h-10 items-center justify-center rounded-md p-1 grid w-full grid-cols-2 bg-primary/20 text-primary",children:[e.jsx(P,{value:"login","data-testid":"tab-login",children:a.language==="ar"?"تسجيل دخول":"Login"}),e.jsx(P,{value:"register","data-testid":"tab-register",children:a.language==="ar"?"حساب جديد":"New Account"})]}),e.jsx(S,{value:"login",className:"space-y-5 mt-5",children:e.jsxs("form",{onSubmit:U,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"login-identifier",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center gap-2 text-[#1f2025]",children:[e.jsx(L,{className:"w-4 h-4"}),a.language==="ar"?"رقم الجوال أو البريد الإلكتروني":"Phone number or Email"]}),e.jsx(ee,{id:"login-identifier",value:g,onChange:t=>f(t),placeholder:a.language==="ar"?"5xxxxxxxx أو email@example.com":"5xxxxxxxx or email@example.com","data-testid":"input-identifier",required:!0}),e.jsx("p",{className:"text-xs text-card/70 mt-1",children:a.language==="ar"?"يمكنك تسجيل الدخول بالجوال (9 أرقام يبدأ بـ 5) أو البريد الإلكتروني":"Login with phone (9 digits starting with 5) or email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"login-password",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center gap-2 text-[#1f2025]",children:[e.jsx($,{className:"w-4 h-4"}),a.language==="ar"?"كلمة المرور":"Password"]}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"login-password",type:x?"text":"password",placeholder:a.language==="ar"?"أدخل كلمة المرور":"Enter password",value:r,onChange:t=>y(t.target.value),className:`bg-primary/20 border-primary/50 text-card placeholder:text-card/60 focus:border-accent focus:ring-accent/30 ${a.language==="ar"?"pl-10":"pr-10"}`,"data-testid":"input-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>E(!x),className:`absolute ${a.language==="ar"?"left-3":"right-3"} top-2.5 text-accent hover:text-accent/80`,"data-testid":"button-toggle-password",children:x?e.jsx(T,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"})})]}),e.jsx("button",{type:"button",onClick:()=>m("/forgot-password"),className:"text-xs text-accent/80 hover:text-accent transition-colors underline-offset-4 hover:underline","data-testid":"link-forgot-password",children:a.language==="ar"?"نسيت كلمة المرور؟":"Forgot Password?"})]}),e.jsx(k,{type:"submit",disabled:j,className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-accent to-accent/90 hover:from-accent/90 hover:to-accent/80 text-card shadow-lg shadow-accent/50 transition-all duration-300 hover:scale-[1.02]","data-testid":"button-login",children:j?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:a.language==="ar"?"جارٍ تسجيل الدخول...":"Logging in..."})]}):a.language==="ar"?"تسجيل الدخول":"Login"})]})}),e.jsx(S,{value:"register",className:"space-y-5 mt-5",children:e.jsxs("form",{onSubmit:W,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"register-name",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center gap-2 text-[#1f2025]",children:[e.jsx(Q,{className:"w-4 h-4"}),a.language==="ar"?"الاسم":"Name"]}),e.jsx(p,{id:"register-name",type:"text",placeholder:a.language==="ar"?"أدخل اسمك":"Enter your name",value:l,onChange:t=>N(t.target.value),className:"bg-stone-800/50 border-amber-900/50 text-amber-50 placeholder:text-amber-200/40 focus:border-amber-600 focus:ring-amber-600/30","data-testid":"input-name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"register-phone",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center gap-2 text-[#1f2025]",children:[e.jsx(X,{className:"w-4 h-4"}),a.language==="ar"?"رقم الجوال":"Phone Number"]}),e.jsx(_,{id:"register-phone",value:g,onChange:t=>f(t),placeholder:"5xxxxxxxx","data-testid":"input-phone-register",required:!0}),e.jsx("p",{className:"text-xs text-amber-200/50 mt-1",children:a.language==="ar"?"ابدأ بـ 5 ثم باقي الأرقام (9 أرقام)":"Start with 5 followed by remaining digits (9 digits)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"register-email",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center gap-2 text-[#1f2025]",children:[e.jsx(L,{className:"w-4 h-4"}),a.language==="ar"?"البريد الإلكتروني":"Email Address"]}),e.jsx(p,{id:"register-email",type:"email",placeholder:"example@email.com",value:u,onChange:t=>h(t.target.value),className:"bg-stone-800/50 border-amber-900/50 text-amber-50 placeholder:text-amber-200/40 focus:border-amber-600 focus:ring-amber-600/30","data-testid":"input-email",dir:"ltr",required:!0}),e.jsx("p",{className:"text-xs text-amber-200/50 mt-1",children:a.language==="ar"?"مطلوب لاستعادة كلمة المرور إذا نسيتها":"Required for password recovery"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"register-password",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center gap-2 text-[#1f2025]",children:[e.jsx($,{className:"w-4 h-4"}),a.language==="ar"?"كلمة المرور":"Password"]}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"register-password",type:x?"text":"password",placeholder:a.language==="ar"?"أدخل كلمة المرور (4 أحرف على الأقل)":"Enter password (min 4 characters)",value:r,onChange:t=>y(t.target.value),className:`bg-stone-800/50 border-amber-900/50 text-amber-50 placeholder:text-amber-200/40 focus:border-amber-600 focus:ring-amber-600/30 ${a.language==="ar"?"pl-10":"pr-10"}`,"data-testid":"input-password-register",required:!0}),e.jsx("button",{type:"button",onClick:()=>E(!x),className:`absolute ${a.language==="ar"?"left-3":"right-3"} top-2.5 text-amber-400 hover:text-amber-300`,"data-testid":"button-toggle-password-register",children:x?e.jsx(T,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"register-referral",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center gap-2 text-[#1f2025]",children:[e.jsx(Z,{className:"w-4 h-4"}),a.language==="ar"?"كود الإحالة (اختياري)":"Referral Code (Optional)"]}),e.jsx(p,{id:"register-referral",type:"text",placeholder:a.language==="ar"?"أدخل كود الإحالة للحصول على نقاط إضافية":"Enter referral code for bonus points",value:C,onChange:t=>A(t.target.value),className:"bg-stone-800/50 border-amber-900/50 text-amber-50 placeholder:text-amber-200/40 focus:border-amber-600 focus:ring-amber-600/30","data-testid":"input-referral-code"}),e.jsx("p",{className:"text-xs text-green-400/70 mt-1",children:a.language==="ar"?"ستحصل أنت ومن أحالك على 50 نقطة لكل منكما!":"You and your referrer will each get 50 bonus points!"})]}),e.jsx(k,{type:"submit",disabled:j,className:"w-full h-12 text-lg font-bold bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-lg shadow-green-900/50 transition-all duration-300 hover:scale-[1.02]","data-testid":"button-register",children:j?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:a.language==="ar"?"جارٍ إنشاء الحساب...":"Creating account..."})]}):a.language==="ar"?"إنشاء حساب":"Create Account"})]})})]}),e.jsx("div",{className:"pt-6 text-center",children:e.jsx("button",{type:"button",onClick:()=>m("/"),className:"text-amber-300/70 hover:text-amber-200 transition-colors text-sm underline-offset-4 hover:underline","data-testid":"link-skip",children:a.language==="ar"?"تخطي وتصفح القائمة":"Skip and explore menu"})})]})]})})}export{ce as default};
