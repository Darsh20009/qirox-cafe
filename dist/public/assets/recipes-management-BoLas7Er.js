import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as g}from"./vendor-react-Bzsngnqy.js";import{a as p,b as C}from"./vendor-query-CX8ZYlKb.js";import{e as w,a6 as b,D as E,Z as q,B as d,P as h,E as A,F as D,H as R,L as o,I as l,a0 as $,C as P,x as S,y as F,f as T,a7 as k,v as j,N as H}from"./index-61RjstaY.js";import{C as L}from"./chef-hat-D6Gkp1MI.js";import{P as M}from"./pen-DpqiHEKk.js";import"./vendor-utils-BKCsaWdX.js";function Z(){const{toast:m}=w(),[f,u]=g.useState(!1),[s,r]=g.useState({coffeeItemId:"",nameAr:"",nameEn:"",ingredients:[{rawItemId:"",quantity:0,unit:"g"}]}),{data:c=[],isLoading:v}=p({queryKey:["/api/recipes"]});p({queryKey:["/api/recipes/costs"],queryFn:async()=>{const t={};for(const a of c)try{const i=await(await j("GET",`/api/recipes/coffee-item/${a.coffeeItemId}/cost`)).json();t[a.id]=i.totalCost||0}catch{t[a.id]=0}return t}});const x=C({mutationFn:async t=>(await j("POST","/api/recipes",t)).json(),onSuccess:()=>{m({title:"✅ Recipe created successfully"}),H.invalidateQueries({queryKey:["/api/recipes"]}),r({coffeeItemId:"",nameAr:"",nameEn:"",ingredients:[{rawItemId:"",quantity:0,unit:"g"}]}),u(!1)},onError:()=>m({title:"❌ Failed to create recipe",variant:"destructive"})}),I=()=>{r({...s,ingredients:[...s.ingredients,{rawItemId:"",quantity:0,unit:"g"}]})},N=t=>{r({...s,ingredients:s.ingredients.filter((a,n)=>n!==t)})},y=async()=>{if(!s.coffeeItemId||!s.nameAr){m({title:"Please fill all fields",variant:"destructive"});return}x.mutate(s)};return v?e.jsx(b,{}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Recipe Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"PHASE 1: Cost calculation enabled"})]})]}),e.jsxs(E,{open:f,onOpenChange:u,children:[e.jsx(q,{asChild:!0,children:e.jsxs(d,{className:"gap-2","data-testid":"button-create-recipe",children:[e.jsx(h,{className:"w-4 h-4"})," New Recipe"]})}),e.jsxs(A,{className:"max-w-md",children:[e.jsx(D,{children:e.jsx(R,{children:"Create Recipe"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Coffee Item ID"}),e.jsx(l,{placeholder:"item-espresso",value:s.coffeeItemId,onChange:t=>r({...s,coffeeItemId:t.target.value}),"data-testid":"input-coffeeItemId"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Name (Arabic)"}),e.jsx(l,{placeholder:"إسبريسو",value:s.nameAr,onChange:t=>r({...s,nameAr:t.target.value}),"data-testid":"input-nameAr"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Name (English)"}),e.jsx(l,{placeholder:"Espresso",value:s.nameEn,onChange:t=>r({...s,nameEn:t.target.value}),"data-testid":"input-nameEn"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"block",children:"Ingredients"}),s.ingredients.map((t,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{placeholder:"Raw item ID",value:t.rawItemId,onChange:n=>{const i=[...s.ingredients];i[a].rawItemId=n.target.value,r({...s,ingredients:i})},className:"flex-1","data-testid":`input-ingredient-rawItemId-${a}`}),e.jsx(l,{type:"number",placeholder:"Qty",value:t.quantity,onChange:n=>{const i=[...s.ingredients];i[a].quantity=parseFloat(n.target.value),r({...s,ingredients:i})},className:"w-24","data-testid":`input-ingredient-quantity-${a}`}),e.jsx(l,{placeholder:"Unit",value:t.unit,onChange:n=>{const i=[...s.ingredients];i[a].unit=n.target.value,r({...s,ingredients:i})},className:"w-20","data-testid":`input-ingredient-unit-${a}`}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>N(a),"data-testid":`button-remove-ingredient-${a}`,children:e.jsx($,{className:"w-4 h-4"})})]},a)),e.jsxs(d,{variant:"outline",onClick:I,className:"w-full","data-testid":"button-add-ingredient",children:[e.jsx(h,{className:"w-4 h-4 mr-2"})," Add Ingredient"]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(d,{variant:"outline",onClick:()=>u(!1),className:"flex-1","data-testid":"button-cancel",children:"Cancel"}),e.jsx(d,{onClick:y,className:"flex-1",disabled:x.isPending,"data-testid":"button-create",children:x.isPending?"Creating...":"Create"})]})]})]})]})]}),c&&c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(t=>e.jsxs(P,{"data-testid":`card-recipe-${t.id}`,children:[e.jsxs(S,{children:[e.jsx(F,{className:"text-lg",children:t.nameAr}),t.nameEn&&e.jsx("p",{className:"text-sm text-secondary-foreground",children:t.nameEn})]}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsx("p",{className:"text-xs text-secondary-foreground",children:"Cost per Unit"}),e.jsxs("p",{className:"text-xl font-bold","data-testid":`text-cost-${t.id}`,children:[t.totalCost?.toFixed(2)||"N/A"," SAR"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium mb-2",children:"Ingredients"}),e.jsx("ul",{className:"text-xs space-y-1",children:t.ingredients?.map((a,n)=>e.jsxs("li",{"data-testid":`text-ingredient-${t.id}-${n}`,children:["• ",a.quantity," ",a.unit]},n))})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(d,{variant:"outline",size:"sm",className:"flex-1","data-testid":`button-edit-${t.id}`,children:[e.jsx(M,{className:"w-3 h-3 mr-1"})," Edit"]})})]})})]},t.id))}):e.jsx(k,{title:"No recipes found",description:"Create your first recipe to get started"})]})}export{Z as default};
