import{j as e}from"./vendor-ui-DJm-zmnP.js";import{r as d}from"./vendor-react-Bzsngnqy.js";import{c as C,d as E,e as I,C as f,f as j,B as N,L,I as M,o as P,k as S}from"./index-61RjstaY.js";import{M as D,T as z,L as b,a as A}from"./leaflet-Cu_ciSmi.js";import{P as F}from"./Polygon-5vJjI_lU.js";import{N as R}from"./navigation-DLyCnKEJ.js";import{u as O}from"./hooks-Be5loCHH.js";import"./vendor-query-CX8ZYlKb.js";import"./vendor-utils-BKCsaWdX.js";delete b.Icon.Default.prototype._getIconUrl;b.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const v=[{name:"السويدي",nameEn:"Al-Suwaidi",coordinates:[{lat:24.68,lng:46.7},{lat:24.69,lng:46.71},{lat:24.695,lng:46.705},{lat:24.685,lng:46.695}]},{name:"البديعة",nameEn:"Al-Badia",coordinates:[{lat:24.66,lng:46.72},{lat:24.67,lng:46.73},{lat:24.68,lng:46.725},{lat:24.67,lng:46.715}]},{name:"ظهرة البديعة",nameEn:"Dahrat Al-Badia",coordinates:[{lat:24.65,lng:46.73},{lat:24.66,lng:46.74},{lat:24.67,lng:46.735},{lat:24.66,lng:46.725}]}],x={lat:24.7136,lng:46.6753};function B({position:a,setPosition:s}){return O({click(l){s({lat:l.latlng.lat,lng:l.latlng.lng})}}),a?e.jsx(A,{position:[a.lat,a.lng]}):null}function T(a,s){let l=!1;for(let i=0,n=s.length-1;i<s.length;n=i++){const c=s[i].lat,o=s[i].lng,m=s[n].lat,r=s[n].lng;o>a.lng!=r>a.lng&&a.lat<(m-c)*(a.lng-o)/(r-o)+c&&(l=!l)}return l}function J(){const[,a]=C(),{setDeliveryInfo:s,cartItems:l}=E(),{toast:i}=I(),[n,c]=d.useState(x),[o,m]=d.useState(""),[r,g]=d.useState(!1),[u,h]=d.useState("");(!l||l.length===0)&&(i({title:"السلة فارغة",description:"الرجاء إضافة منتجات إلى السلة أولاً",variant:"destructive"}),a("/menu")),d.useEffect(()=>{for(const t of v)if(T(n,t.coordinates)){g(!0),h(t.name);return}g(!1),h("")},[n]);const w=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{c({lat:t.coords.latitude,lng:t.coords.longitude})},t=>{i({title:"خطأ في تحديد الموقع",description:"لم نتمكن من الوصول إلى موقعك الحالي",variant:"destructive"})})},k=()=>{if(!o.trim()){i({title:"تنبيه",description:"الرجاء إدخال عنوان التوصيل",variant:"destructive"});return}const t=r?0:10;s({type:"delivery",address:{fullAddress:o,lat:n.lat,lng:n.lng,zone:u||"الرياض"},deliveryFee:t}),a("/checkout")};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",dir:"rtl",children:"حدد موقع التوصيل"}),e.jsx("p",{className:"text-muted-foreground",dir:"rtl",children:"اضغط على الخريطة لتحديد موقعك"})]}),e.jsx(f,{className:"mb-6",children:e.jsx(j,{className:"p-0",children:e.jsx("div",{className:"h-[400px] sm:h-[500px] rounded-md overflow-hidden",children:e.jsxs(D,{center:[x.lat,x.lng],zoom:12,style:{height:"100%",width:"100%"},children:[e.jsx(z,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),v.map((t,y)=>e.jsx(F,{positions:t.coordinates.map(p=>[p.lat,p.lng]),pathOptions:{color:"#22c55e",fillColor:"#22c55e",fillOpacity:.2}},y)),e.jsx(B,{position:n,setPosition:c})]})})})}),e.jsxs(N,{onClick:w,variant:"outline",className:"w-full mb-6","data-testid":"button-current-location",children:[e.jsx(R,{className:"w-4 h-4 ml-2"}),e.jsx("span",{dir:"rtl",children:"استخدم موقعي الحالي"})]}),e.jsx(f,{className:"mb-6",children:e.jsx(j,{className:"p-5",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"address",className:"mb-3 block text-base font-semibold",dir:"rtl",children:"عنوان التوصيل"}),e.jsx(M,{id:"address",placeholder:"مثال: شارع الأمير محمد بن عبدالعزيز، البديعة",value:o,onChange:t=>m(t.target.value),dir:"rtl",className:"text-base","data-testid":"input-address"})]}),e.jsx("div",{className:`p-4 rounded-md ${r?"bg-green-50 dark:bg-green-950":"bg-yellow-50 dark:bg-yellow-950"}`,children:e.jsxs("div",{className:"flex items-start gap-3",dir:"rtl",children:[e.jsx(P,{className:`w-6 h-6 mt-0.5 flex-shrink-0 ${r?"text-green-600":"text-yellow-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-semibold mb-1 ${r?"text-green-700 dark:text-green-300":"text-yellow-700 dark:text-yellow-300"}`,children:r?"منطقة توصيل مجاني ":"رسوم التوصيل: 10 ريال"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r?`الحي: ${u}`:"خارج مناطق التوصيل المجاني"})]})]})})]})})}),e.jsxs(N,{onClick:k,className:"w-full",size:"lg","data-testid":"button-confirm",children:[e.jsx("span",{dir:"rtl",children:"تأكيد الموقع والمتابعة للدفع"}),e.jsx(S,{className:"w-5 h-5 mr-2"})]})]})})}export{J as default};
